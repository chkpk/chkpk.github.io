(function(a,b){var c={},d={isDeserializing:!1,isCalculatingBus:!1,images:{},registerImage:function(a,b,e,f){d.images[a]=new c.ImageAsset(a,b,e,f)},unregisterImage:function(a){delete d.images[a]},getImageAsset:function(a){return d.images[a]},showVersion:function(a){d.isCtrlDown(a)&&a.shiftKey&&a.keyCode==76&&alert("TWaver HTML5 "+c.Util.getVersion()+"\n"+f)},callLater:function(a,b,c,d){return setTimeout(function(){a.apply(b,c)},d||D.CALL_LATER_DELAY)},isEmptyObject:function(a){for(var b in a)return!1;return!0},xml:function(b){if(a.DOMParser)return(new DOMParser).parseFromString(b,"text/xml");var c=new ActiveXObject("Microsoft.XmlDOM");return c.async=!1,c.loadXml(b),c},num:function(a){return typeof a=="number"&&!isNaN(a)&&isFinite(a)},getter:function(a){var b=a.charAt(0).toUpperCase()+a.slice(1),c=/ble$/.test(a)||/ed$/.test(a)?"is":"get";return c+b},setter:function(a){var b=a.charAt(0).toUpperCase()+a.slice(1);return"set"+b},_id:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],id:function(){var a=[];for(var b=0;b<32;b++)a[b]=this._id[Math.floor(Math.random()*16)];return a[12]="4",a[16]=this._id[a[16]&3|8],a.join("")},keys:function(a){var b=new B;for(var c in a)b.add(c);return b},es:["toString","toLocaleString","valueOf"],ip:function(a,b){var c="_"+b;a[d.getter(b)]=function(){return this[c]},a[d.setter(b)]=function(a){var d=this[c];this[c]=a,this.firePropertyChange(b,d,a)}},validateLicense:function(a){f=a},ibool:function(a,b){var c="_"+b,e=b.charAt(0).toUpperCase()+b.slice(1);a["is"+e]=function(){return this[c]},a[d.setter(b)]=function(a){var d=this[c];this[c]=a,this.firePropertyChange(b,d,a)}},getValue:function(a,b,c){var d=b.charAt(0).toUpperCase()+b.slice(1);return c==="boolean"?a["is"+d]():a["get"+d]()},setValue:function(a,b,c){a["set"+b.charAt(0).toUpperCase()+b.slice(1)](c)},clone:function(a){if(!a)return null;var b={};for(var c in a)b[c]=a[c];return b},classCache:{},getClass:function(b){var c=d.classCache[b];if(!c){var e=b.split("."),f=e.length;c=a;for(var g=0;g<f;g++)c=c[e[g]];d.classCache[b]=c}return c},newInstance:function(a){var b=d.getClass(a);if(!b)return null;var c=arguments.length,e=arguments;if(c===1)return new b;if(c===2)return new b(e[1]);if(c===3)return new b(e[1],e[2]);if(c===4)return new b(e[1],e[2],e[3]);if(c===5)return new b(e[1],e[2],e[3],e[4]);if(c===6)return new b(e[1],e[2],e[3],e[4],e[5]);if(c===7)return new b(e[1],e[2],e[3],e[4],e[5],e[6]);if(c===8)return new b(e[1],e[2],e[3],e[4],e[5],e[6],e[7]);throw"don't support args more than 7"},addMethod:function(a,b){var c=a.prototype;for(var d in b)c[d]=b[d]},ext:function(a,b,c){var e;typeof a=="string"&&(e=a,a=d.getClass(a));if(b){var f=function(){};f.prototype=b.prototype,a.prototype=new f,a.prototype.constructor=a,a.superClass=b.prototype,b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=b)}e&&(a.prototype.getClassName=function(){return e});if(c){var g=a.prototype;for(var i in c)h.ext(i,g,c);var j=d.es.length;for(var k=0;k<j;k++)i=d.es[k],c.hasOwnProperty(i)&&!c.propertyIsEnumerable(i)&&(g[i]=c[i])}},setViewBounds:function(a,b){if(!a)return;if(a.adjustBounds)a.adjustBounds(b);else{var c=a.style;!c&&a.getView()&&(c=a.getView().style),c&&(c.position="absolute",c.left=b.x+"px",c.top=b.y+"px",c.width=b.width+"px",c.height=b.height+"px")}},getImageSrc:function(a){var b=d.getImageAsset(a);return b?b.getSrc()?b.getSrc():b.getImage().getAttribute("src"):a},nextColorCount:0,nextColor:function(){return d.nextColorCount>=D.COLORS.length&&(d.nextColorCount=0),D.COLORS[d.nextColorCount++]},isCtrlDown:function(a){return a.ctrlKey||a.metaKey}},f="This license applies to the evaluation version of TWaver. The License is limited to noncommercial use. Noncommercial use relates only to educational, research, personal or evaluation purposes. Any other use is commercial use. You may not use the Software in connection with any business activities.And You are not permitted to modify the software or attempt to decipher, decompile, disassemble or reverse engineer this Software.";a.twaver=c,c.animate={},c.network={},c.network.interaction={},c.controls={},c.charts={},c.layout={};var g=function(){var a={},b=navigator.userAgent.toLowerCase();return a.isOpera=/opera/.test(b),a.isIE=/msie/.test(b),a.isFirefox=/firefox/i.test(b),a.isChrome=/chrome/i.test(b),a.isSafari=!a.isChrome&&/safari/i.test(b),a.isIPhone=/iphone/.test(b),a.isIPod=/ipod/.test(b),a.isIPad=/ipad/.test(b),a.isAndroid=/android/i.test(b),a.isWebOS=/webos/i.test(b),a.isTouchable="ontouchend"in document,a}(),h={__accessor:function(a,b){var c=b.__accessor,e=c.length;for(var f=0;f<e;f++)d.ip(a,c[f])},__bool:function(a,b){var c=b.__bool,e=c.length;for(var f=0;f<e;f++)d.ibool(a,c[f])},__client:function(a,b){a.getClient=function(a){return this._clientMap[a]},a.setClient=function(a,b){var c=this._clientMap[a];return b==null?delete this._clientMap[a]:this._clientMap[a]=b,this.firePropertyChange("C:"+a,c,b)&&this.onClientChanged(a,c,b),this},a.getClientProperties=function(){return d.keys(this._clientMap)},a.onClientChanged=function(a,b,c){}},__style:function(a,e){a.getStyle=function(a,d){var e=this._styleMap[a];return d===b&&(d=!0),e==null&&d?c.Styles.getStyle(a):e},a.setStyle=function(a,b){var c=this._styleMap[a];return b==null?delete this._styleMap[a]:this._styleMap[a]=b,this.firePropertyChange("S:"+a,c,b)&&this.onStyleChanged(a,c,b),this},a.getStyleProperties=function(){return d.keys(this._styleMap)},a.onStyleChanged=function(a,b,c){}},__new:function(a,b){a.newInstance=function(){var a=d.getClass(this.getClassName());if(!a)return null;var b=arguments.length,c=arguments;if(b===0)return new a;if(b===1)return new a(c[0]);if(b===2)return new a(c[0],c[1]);if(b===3)return new a(c[0],c[1],c[2]);if(b===4)return new a(c[0],c[1],c[2],c[3]);if(b===5)return new a(c[0],c[1],c[2],c[3],c[4]);if(b===6)return new a(c[0],c[1],c[2],c[3],c[4],c[5]);if(b===7)return new a(c[0],c[1],c[2],c[3],c[4],c[5],c[6]);throw"don't support args more than 7"}},__property:function(a,b){a.getValue=function(a,b){return this._propertyType==="accessor"?a[d.getter(this._propertyName)]():this._propertyType==="style"&&a.getStyle?a.getStyle(this._propertyName):this._propertyType==="client"&&a.getClient?a.getClient(this._propertyName):this._propertyType==="field"?a[this._propertyName]:null},a.setValue=function(a,b,c){if(this._propertyType==="accessor")a[d.setter(this._propertyName)](b);else{if(this._propertyType==="style"&&a.setStyle)return a.setStyle(this._propertyName,b);if(this._propertyType==="client"&&a.setClient)return a.setClient(this._propertyName,b);this._propertyType==="field"&&(a[this._propertyName]=b)}}},map:{__accessor:1,__bool:1,__client:1,__style:1,__new:1,__tree:1,__property:1},ext:function(a,b,c){h.map[a]===1?h[a](b,c):b[a]=c[a]}};h.__tree=function(a,b){a._rootVisible=!0,a._initTree=function(a){this._rootData=null,this._expandMap={},this._levelMap={}},a.validateModel=function(){this._rowDatas.clear(),this._levelMap={},this._dataRowMap={},this._currentLevel=0,this._rootData?this._rootVisible?this.isVisible(this._rootData)&&this._buildData(this._rootData):this._buildChildren(this._rootData):this._buildChildren(),delete this._currentLevel},a._buildData=function(a){this._dataRowMap[a.getId()]=this._rowDatas.size(),this._rowDatas.add(a),this._levelMap[a.getId()]=this._currentLevel,this.isExpanded(a)&&(this._currentLevel++,this._buildChildren(a),this._currentLevel--)},a._buildChildren=function(a){var b=a?a.getChildren():this._box.getRoots(),c=this.getCurrentSortFunction();c&&this.isChildrenSortable(a)?b.toList(this.isVisible,this).sort(c).forEach(function(a){this._buildData(a)},this):b.forEach(function(a){this.isVisible(a)&&this._buildData(a)},this)},a.getLevel=function(a){return this._levelMap[a.getId()]},a.getToggleImage=function(a){return a.getChildrenSize()>0?this.isExpanded(a)?this._expandIcon:this._collapseIcon:null},a.isCheckable=function(a){return this.isCheckMode()},a.isCheckMode=function(){return h.__tree._checkMap[this._checkMode]===1},a.isChildrenSortable=function(a){return!0},a.handleDataBoxChange=function(a){a.kind==="remove"?delete this._expandMap[a.data.getId()]:a.kind==="clear"&&(this._expandMap={}),this.invalidateModel()},a.isExpanded=function(a){return this._expandMap[a.getId()]===1},a.expand=function(a){if(this.isExpanded(a))return;var b=a.getParent();while(b!=null&&b!==this._rootData)this._expandMap[b.getId()]=1,b=b.getParent();this._expandMap[a.getId()]=1,this.invalidateModel()},a.collapse=function(a){if(!this.isExpanded(a))return;delete this._expandMap[a.getId()],this.invalidateModel()},a.expandAll=function(){this._box.forEach(function(a){this._expandMap[a.getId()]=1},this),this.invalidateModel()},a.collapseAll=function(){this._expandMap={},this.invalidateModel()},a._handleClick=function(a){this.isFocusOnClick()&&c.Util.setFocus(this._view);if(this._isValidating)return;var b;a.target._expandData?(b=a.target._expandData,this.isExpanded(b)?(this.collapse(b),this.fireInteractionEvent({kind:"collapse",data:b})):(this.expand(b),this.fireInteractionEvent({kind:"expand",data:b}))):a.target._selectData||a.target.parentNode._selectData?this._handlePressSelection(a.target._selectData||a.target.parentNode._selectData,a):this._treeColumn&&!this.isCheckMode()&&(b=this.getDataAt(a),b&&this._handlePressSelection(b,a)),this._currentEditor&&!this._isCommitting&&(this._isCommitting=!0,this.commitEditValue(this._currentEditor._editInfo,this._currentEditor)),this.updateCurrentEditor&&this.updateCurrentEditor(a)},a.handleChange=function(a){if(this._isCommitting||this._isCanceling||this._isValidating)return;var b=a.target._checkData;if(b){var c=this.isSelected(b),d=this.getSelectionModel(),e;if(this._checkMode==="default")c?d.removeSelection(b):d.appendSelection(b);else if(this._checkMode==="children")e=new B(b),e.addAll(b.getChildren());else if(this._checkMode==="descendant")e=new B,s.fillDescendant(b,e);else if(this._checkMode==="descendantAncestor"){e=new B,s.fillDescendant(b,e);if(!c){var f=b.getParent();while(f)e.add(f),f=f.getParent()}}c?d.removeSelection(e):d.appendSelection(e)}a.target._editInfo&&this.commitEditValue&&(this._isCommitting=!0,this.commitEditValue(a.target._editInfo,a.target))},a.onLabelRendered=function(a,b,c,d,e,f){},a._renderTree=function(a,b,c,e){var f=this._levelMap[b.getId()],g=this.getToggleImage(b),h=this.__spanPool.get();g?h.style.width=this._indent*f+"px":h.style.width=this._indent*(f+1)+"px",h.style.display="inline-block",a.appendChild(h);if(g){var i=this.__imagePool.get();i.setAttribute("src",d.getImageSrc(g)),i.style.verticalAlign="middle",i._expandData=b,a.appendChild(i)}var j=this.isCheckable(b),k=this.getUncheckableStyle()==="disabled";if(j||k){var l=this._addCheckBox(a,b,e);l.disabled=!j}var m=this.getIcon(b);if(m){var n=this.isCheckMode()||this._treeColumn?null:b;this._addIcon(a,b,m,n)}var o=this.getLabel(b);o&&(h=this.__textPool.get(),h.style.whiteSpace="nowrap",h.style.verticalAlign="middle",h.style.padding="1px 2px 1px 2px",h.innerHTML=o,!this.isCheckMode()&&!this._treeColumn&&(h._selectData=b,h.style.backgroundColor=e?this.getSelectColor(b):""),this.onLabelRendered(h,b,o,c,f,e),a.appendChild(h))}},h.__tree._checkMap={"default":1,children:1,descendant:1,descendantAncestor:1};var k=function(a,b,c,d,e,f){this._m11=a,this._m12=b,this._m21=c,this._m22=d,this._offsetX=e,this._offsetY=f,this._type=0;if(this._m21!=0||this._m12!=0)this._type=4;else{if(this._m11!=1||this._m22!=1)this._type=2;if(this._offsetX!=0||this._offsetY!=0)this._type|=1;(this._type&(2|1))==0&&(this._type=0)}};k.prototype.transform=function(){var a;arguments.length===2?a={x:arguments[0],y:arguments[1]}:a=arguments[0];if(!a||!d.num(a.x)||!d.num(a.y))throw"arguments should contain x, y";switch(this._type){case 0:return{x:a.x,y:a.y};case 1:return{x:this._offsetX+a.x,y:this._offsetY+a.y};case 2:return{x:a.x*this._m11,y:a.y*this._m22};case 3:return{x:a.x*this._m11+this._offsetX,y:a.y*this._m22+this._offsetY}}return{x:this._m11*a.x+a.y*this._m21+this._offsetX,y:this._m22*a.y+a.x*this._m12+this._offsetY}};var l={getDistance:function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)},getCenterPoint:function(a,b){return{x:(a.x+b.x)/2,y:(a.y+b.y)/2}},isPointInPolygon:function(a,b){a=a._as;var c=0,d=0,e=!1,f=a.length;for(c=0,d=f-1;c<f;d=c++){var g=a[c],h=a[d];g.y>b.y!=h.y>b.y&&b.x<(h.x-g.x)*(b.y-g.y)/(h.y-g.y)+g.x&&(e=!e)}return e},unionRect:function(a,b){if(a&&!b)return d.clone(a);if(!a&&b)return d.clone(b);if(a&&b){var c={};return c.x=Math.min(a.x,b.x),c.y=Math.min(a.y,b.y),c.width=Math.max(a.x+a.width,b.x+b.width)-c.x,c.height=Math.max(a.y+a.height,b.y+b.height)-c.y,c}return null},intersects:function(a,b){if(!a||!b)return!1;var c=b.width,d=b.height,e=a.width,f=a.height;if(e<=0||f<=0||c<=0||d<=0)return!1;var g=b.x,h=b.y,i=a.x,j=a.y;return e+=i,f+=j,c+=g,d+=h,(e<i||e>g)&&(f<j||f>h)&&(c<g||c>i)&&(d<h||d>j)},intersection:function(a,b){if(!a||!b)return!1;var c=b.x,d=b.y,e=a.x,f=a.y,g=c;g+=b.width;var h=d;h+=b.height;var i=e;i+=a.width;var j=f;return j+=a.height,c<e&&(c=e),d<f&&(d=f),g>i&&(g=i),h>j&&(h=j),g-=c,h-=d,g===0||h===0?null:{x:c,y:d,width:g,height:h}},contains:function(a,b){var c=b.x,d=b.y,e=b.width,f=b.height,g=a.width,h=a.height;if((g|h|e|f)<0)return!1;var i=a.x,j=a.y;if(c<i||d<j)return!1;g+=i,e+=c;if(e<=c){if(g>=i||e>g)return!1}else if(g>=i&&e>g)return!1;h+=j,f+=d;if(f<=d){if(h>=j||f>h)return!1}else if(h>=j&&f>h)return!1;return!0},getLinePoints:function(a){if(!a)return null;var b=new B;return a.forEach(function(a){b.addAll(a)}),b},getLineRect:function(a){var b=l.getLinePoints(a);return l.getRect(b)},getRect:function(a){if(!a)return null;a._as&&(a=a._as);var b=a.length;if(b<=0)return null;var c=a[0],d={x:c.x,y:c.y,width:0,height:0};for(var e=1;e<b;e++){c=a[e];var f=Math.min(d.x,c.x),g=Math.max(d.x+d.width,c.x),h=Math.min(d.y,c.y),i=Math.max(d.y+d.height,c.y);d.x=f,d.y=h,d.width=g-f,d.height=i-h}return d},addPadding:function(a,b,c,d){arguments.length===3&&(d=-1);var e=b.getStyle(c)*d;e!=0&&l.grow(a,e,e),e=b.getStyle(c+".left")*d,e!=0&&(a.x-=e,a.width+=e),e=b.getStyle(c+".right")*d,e!=0&&(a.width+=e),e=b.getStyle(c+".top")*d,e!=0&&(a.y-=e,a.height+=e),e=b.getStyle(c+".bottom")*d,e!=0&&(a.height+=e),a.width<0&&(a.width=-a.width,a.x-=a.width),a.height<0&&(a.height=-a.height,a.y-=a.height)},grow:function(a,b,c){var d=a.width+b+b;if(d<0)return;var e=a.height+c+c;if(e<0)return;a.x-=b,a.y-=c,a.width=d,a.height=e},containsPoint:function(a,b,c){return arguments.length<3&&(c=b.y,b=b.x),!a||b<a.x||c<a.y||b>a.x+a.width||c>a.y+a.height?!1:!0},getHotSpot:function(a,b,c,d,e){if(e==="oval"){var f=.35;return{x:a+c*.5+c*f,y:b+d/2-Math.sqrt(.25-f*f)*d}}if(e==="circle"){var g=a+c/2,h=b+d/2,i=Math.min(c,d)/2;a=g-i,b=h-i,c=i*2,d=i*2;var j=c/2,k=d/2,l=j*k/Math.sqrt(j*j+k*k);return{x:a+c/2+l,y:b+d/2-l}}var m={x:a+c,y:b};return c>3&&(m.x-=3),d>3&&(m.y+=3),m},getCircleRect:function(a){var b=Math.min(a.width,a.height)/2;return{x:a.x+a.width/2-b,y:a.y+a.height/2-b,width:b*2,height:b*2}},getEllipsePoint:function(a,b){if(!a||!b)return null;var c=a.x+a.width/2,d=a.y+a.height/2,e=b.x-c,f=b.y-d,g=a.width/2,h=a.height/2,i=Math.sqrt(1/(1/g/g+f*f/e/e/h/h));e<0&&(i=-i);var j;return e==0?f>0?j=h:j=-h:j=i*f/e,{x:c+i,y:d+j}},createMatrix:function(a,b,c){var d=Math.sin(a),e=Math.cos(a),f=b*(1-e)+c*d,g=c*(1-e)-b*d;return new k(e,d,-d,e,f,g)},calculatePointInfoAlongLineBySegments:function(a,b,c,d,e){return l.calculatePointInfoAlongLine(l.getPointObject(a,b),c,d,e)},calculatePointInfoAlongLine:function(a,c,d,e){c=c===b?!0:c,d=d||0,e=e||0;if(!a||a.size()<2)throw"must more than two points";if(!c){var f=l.reversePath(a);return l.calculatePointInfoAlongLine(f,!0,d,e)}a._as&&(a=a._as);var g,h,i=0,j=0,k,m,n=a.length,o;for(m=0;m<n;m++){o=a[m];if(m==0){h=o;continue}if(d<=0){k=l.calculatePointInfoOnStraightLine(l._getPoint(h),l._getControlPoint(o),d,e),g=k;break}j=l._getLength(o,h);if(i+j>d){k=l.getPathInfo(o,h,d-i,e,j),g=k;break}i+=j,h=o}if(g==null){var p,q;h=a[n-1],q=l._getPoint(h),h instanceof B&&(h=h._as),p=h instanceof Array?l._getControlPoint(h):l._getPoint(a[n-2]);var r=Math.atan2(q.y-p.y,q.x-p.x);k=l.transformPoint(q,r,d-i,e),k.angle=r,g=k}return g},reversePath:function(a){var b=new B,c=null,d;a._as&&(a=a._as);for(var e=a.length-1;e>=0;e--)d=a[e],b.add(l._getReversePath(d,c)),c=d;return b},_getPoint:function(a){return a._as&&(a=a._as),a instanceof Array?a[a.length-1]:a},_getControlPoint:function(a){return a._as&&(a=a._as),a instanceof Array?a[a.length-2]:a},_getReversePath:function(a,b){var c=l._getPoint(a);return b&&b._as&&(b=b._as),b!=null&&b instanceof Array?b.length==2?new B([b[0],c]):new B([b[1],b[0],c]):c},_getLength:function(a,b){var c=l._getPoint(b),d=l._getPoint(a);a instanceof B&&(a=a._as);if(a instanceof Array)return l.calculateCurveLength(c,a,1);var e=d.y-c.y,f=d.x-c.x;return Math.sqrt(f*f+e*e)},getPathInfo:function(a,b,c,d,e){var f=l._getPoint(b),g=l._getPoint(a),h;a instanceof B&&(a=a._as);if(a instanceof Array){e<0&&(e=l._getLength(a,b));var i=c/e,j=l.calculatePointInfoOnCurveLine(f,a,i);f=j.point,h=j.angle,c=0}else h=Math.atan2(g.y-f.y,g.x-f.x);return l.transformPoint(f,h,c,d)},transformPoint:function(a,b,c,d){var e={x:c,y:d},f=l.createMatrix(b,0,0);return e=f.transform(e),e.x+=a.x,e.y+=a.y,{point:e,angle:b}},calculatePointInfoOnStraightLine:function(a,b,c,d){var e=Math.atan2(b.y-a.y,b.x-a.x);return l.transformPoint(a,e,c,d)},calculatePointInfoOnCurveLine:function(a,b,c){if(c<0||c>1)throw"Illegal arguments";return b._as&&(b=b._as),b.length==2?l._calculatePointInfoOnCurveLine2(a,b[0],b[1],c):l._calculatePointInfoOnCurveLine3(a,b[0],b[1],b[2],c)},_calculatePointInfoOnCurveLine2:function(a,b,c,d){var e=2*(a.x+c.x-2*b.x)*d+2*b.x-2*a.x,f=2*(a.y+c.y-2*b.y)*d+2*b.y-2*a.y,g=Math.atan2(f,e),h=(a.x+c.x-2*b.x)*d*d+(2*b.x-2*a.x)*d+a.x,i=(a.y+c.y-2*b.y)*d*d+(2*b.y-2*a.y)*d+a.y;return{point:{x:h,y:i},angle:g}},_calculatePointInfoOnCurveLine3:function(a,b,c,d,e){var f,g,h;f=1-e,g=f*f*f,h=e*e*e;var i=g*a.x+3*e*f*f*b.x+3*e*e*f*c.x+h*d.x,j=g*a.y+3*e*f*f*b.y+3*e*e*f*c.y+h*d.y;return{point:{x:i,y:j},angle:Math.atan2(l._bezeSpeedY(a,b,c,d,e),l._bezeSpeedX(a,b,c,d,e))}},calculateCurveLength:function(a,b,c){return b._as&&(b=b._as),b.length==2?l._calculateCurveLength(a,b[0],b[1],c):l._calculateBezierCurveLength(a,b[0],b[1],b[2],c)},_calculateCurveLength:function(a,b,c,d){if(d<=0||d>1)return 0;var e=Math.floor(d*(Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))+Math.sqrt((c.x-b.x)*(c.x-b.x)+(c.y-b.y)*(c.y-b.y)))/2),f=0;e<=0&&(e=1);var g=d/e,h,i,j=0;for(var k=0;k<e;k++)j=g*k,h=2*(a.x+c.x-2*b.x)*j+2*b.x-2*a.x,i=2*(a.y+c.y-2*b.y)*j+2*b.y-2*a.y,h*=g,i*=g,f+=Math.sqrt(h*h+i*i);return f},_calculateBezierCurveLength:function(a,b,c,d,e){if(e<=0||e>1)return 0;var f=1e4,g=Math.floor(f*e);(g&1)==1&&g++;if(g==0)return 0;var h=Math.floor(g/2),i=0,j=0,k=e/g,m;for(m=0;m<h;m++)i+=l._bezeSpeed(a,b,c,d,(2*m+1)*k);for(m=1;m<h;m++)j+=l._bezeSpeed(a,b,c,d,2*m*k);return(l._bezeSpeed(a,b,c,d,0)+l._bezeSpeed(a,b,c,d,1)+2*j+4*i)*k/3},_bezeSpeedX:function(a,b,c,d,e){var f=1-e;return-3*a.x*f*f+3*b.x*f*f-6*b.x*f*e+6*c.x*f*e-3*c.x*e*e+3*d.x*e*e},_bezeSpeedY:function(a,b,c,d,e){var f=1-e;return-3*a.y*f*f+3*b.y*f*f-6*b.y*f*e+6*c.y*f*e-3*c.y*e*e+3*d.y*e*e},_bezeSpeed:function(a,b,c,d,e){var f=l._bezeSpeedX(a,b,c,d,e),g=l._bezeSpeedY(a,b,c,d,e);return Math.sqrt(f*f+g*g)},getPointObject:function(a,b){if(!b||b.size()==0)return a;var c=new B;b=b._as,a=a._as;var d=0,e,f,g=b.length,h=a.length;for(e=0;e<g;e++){f=b[e];if(d==h)break;"cubicto"===f?d<h-2&&c.add([a[d++],a[d++],a[d++]]):"quadto"===f?d<h-1&&c.add([a[d++],a[d++]]):d<h&&c.add(a[d++])}for(;d<h;d++)c.add(a[d]);return c},calculateLineLength:function(a,b){if(!a||a.size()<2)return 0;if(b)return l.calculateLineLength(l.getPointObject(a,b));a=a._as;var c,d=a.length,e,f,g,h,i,j,k=0;for(c=0;c<d;c++){g=a[c];if(c==0){e=g;continue}f=g,f instanceof B&&(f=f._as),f instanceof Array?(h=l.calculateCurveLength(e,f,1),e=f[f.length-1]):(j=g.y-e.y,i=g.x-e.x,h=Math.sqrt(i*i+j*j),e=f),k+=h}return k}},m={getPoints:function(a){var b=new B;return a.forEach(function(a){b.add({x:a.x,y:a.y}),b.add({x:a.x+a.width,y:a.y+a.height}),b.add({x:a.x+a.width,y:a.y}),b.add({x:a.x,y:a.y+a.height})}),b},rectangle:function(a){var b;return a.forEach(function(a){b=l.unionRect(b,a)}),b},oval:function(a){var b=m.rectangle(a),c=0,d=b.height/b.width,e=d*d,f=b.x+b.width/2,g=b.y+b.height/2,h=m.getPoints(a);h.forEach(function(a){var b=a.x-f,d=a.y-g,h=b*b+d*d/e;h>c&&(c=h)}),c=Math.sqrt(c);var i=d*c;return{x:f-c,y:g-i,width:c*2,height:i*2}},circle:function(a){var b=m.rectangle(a),c=0,d=b.x+b.width/2,e=b.y+b.height/2,f=m.getPoints(a);return f.forEach(function(a){var b=a.x-d,f=a.y-e,g=b*b+f*f;g>c&&(c=g)}),c=Math.sqrt(c),{x:d-c,y:e-c,width:c*2,height:c*2}},roundrect:function(a){var b=m.rectangle(a),c=Math.min(b.width,b.height)/16;return l.grow(b,c,c),b},star:function(a){var b=m.rectangle(a);return l.grow(b,b.width,b.height),b},triangle:function(a){var b=m.rectangle(a);return b.x-=b.width/2,b.width*=2,b.y-=b.height,b.height*=2,b},hexagon:function(a){var b=m.rectangle(a);return b.x-=b.width/2,b.width*=2,b},pentagon:function(a){var b=m.rectangle(a);return b.x-=b.width/6,b.width+=b.width/3,b.y-=b.height/4,b.height+=b.height/4,b},diamond:function(a){var b=m.rectangle(a);return b.x-=b.width/2,b.width+=b.width,b.y-=b.height/2,b.height+=b.height,b}},o={"topleft.topleft":function(a,b){return{x:a.x-b.width,y:a.y-b.height}},"topleft.topright":function(a,b){return{x:a.x,y:a.y-b.height}},"top.top":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y-b.height}},"topright.topleft":function(a,b){return{x:a.x+a.width-b.width,y:a.y-b.height}},"topright.topright":function(a,b){return{x:a.x+a.width,y:a.y-b.height}},topleft:function(a,b){return{x:a.x-b.width/2,y:a.y-b.height/2}},top:function(a,b){return{x:a.x-b.width/2+a.width/2,y:a.y-b.height/2}},topright:function(a,b){return{x:a.x-b.width/2+a.width,y:a.y-b.height/2}},"topleft.bottomleft":function(a,b){return{x:a.x-b.width,y:a.y}},"topleft.bottomright":function(a,b){return{x:a.x,y:a.y}},"top.bottom":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y}},"topright.bottomleft":function(a,b){return{x:a.x-b.width+a.width,y:a.y}},"topright.bottomright":function(a,b){return{x:a.x+a.width,y:a.y}},"left.left":function(a,b){return{x:a.x-b.width,y:a.y+a.height/2-b.height/2}},left:function(a,b){return{x:a.x-b.width/2,y:a.y+a.height/2-b.height/2}},"left.right":function(a,b){return{x:a.x,y:a.y+a.height/2-b.height/2}},center:function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height/2-b.height/2}},"right.left":function(a,b){return{x:a.x+a.width-b.width,y:a.y+a.height/2-b.height/2}},right:function(a,b){return{x:a.x+a.width-b.width/2,y:a.y+a.height/2-b.height/2}},"right.right":function(a,b){return{x:a.x+a.width,y:a.y+a.height/2-b.height/2}},"bottomleft.topleft":function(a,b){return{x:a.x-b.width,y:a.y+a.height-b.height}},"bottomleft.topright":function(a,b){return{x:a.x,y:a.y+a.height-b.height}},"bottom.top":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height-b.height}},"bottomright.topleft":function(a,b){return{x:a.x+a.width-b.width,y:a.y+a.height-b.height}},"bottomright.topright":function(a,b){return{x:a.x+a.width,y:a.y+a.height-b.height}},bottomleft:function(a,b){return{x:a.x-b.width/2,y:a.y+a.height-b.height/2}},bottom:function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height-b.height/2}},bottomright:function(a,b){return{x:a.x+a.width-b.width/2,y:a.y+a.height-b.height/2}},"bottomleft.bottomleft":function(a,b){return{x:a.x-b.width,y:a.y+a.height}},"bottomleft.bottomright":function(a,b){return{x:a.x,y:a.y+a.height}},"bottom.bottom":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height}},"bottomright.bottomleft":function(a,b){return{x:a.x+a.width-b.width,y:a.y+a.height}},"bottomright.bottomright":function(a,b){return{x:a.x+a.width,y:a.y+a.height}},get:function(a,b,c){if(!b)throw"refRect can not be null";c||(c={width:0,height:0});var d=o[a];if(d)return d(b,c);throw"Can not resolve '"+a+"' position"}},p={preventDefault:function(a){if(a.target.keepDefault)return;if(a.target.parentNode&&a.target.parentNode.keepDefault)return;if(a.shiftKey)return;a.preventDefault?a.preventDefault():a.returnValue=!1},insertAfter:function(a,b){return b?b.parentNode.insertBefore(a,b.nextSibling):a.parentNode.insertBefore(a,a.parentNode.firstChild),a},forEach:function(a,b,c){if(!p.isVisible(a))return;var d=a.childNodes.length;for(var e=0;e<d;e++)p.forEach(a.childNodes[e],b,c);c?b.call(c,a):b(a)},setVisible:function(a,b){a.style.display=b?"block":"none"},isVisible:function(a){return"style"in a&&a.style.display!=="none"},release:function(a){var b=a.childNodes.length;for(var c=0;c<b;c++)p.release(a.childNodes[c]);b>0&&p.clear(a),a._pool&&a._pool.release(a)},clear:function(a){while(a.firstChild)a.removeChild(a.firstChild)},setZoom:function(a,b){var c=a.style;if(c.setProperty){if(g.isFirefox){c.setProperty("-moz-transform","scale("+b+")",null),c.setProperty("-moz-transform-origin","0 0",null);return}if(g.isOpera){c.setProperty("-o-transform","scale("+b+")",null),c.setProperty("-o-transform-origin","0 0",null);return}}c.zoom=b},setBorderRaidus:function(a,b){g.isFirefox?a.style.MozBorderRadius=b:a.style.borderRadius=b},createSelect:function(a,b){var c=document.createElement("select"),d,e,f;if(a.values)for(d=0;d<a.values.length;d++)e=a.values[d],f=document.createElement("option"),f.innerHTML=a.map[e],f.setAttribute("value",e),e===b&&f.setAttribute("selected","true"),c.appendChild(f);else for(d=0;d<a.length;d++)e=a[d],f=document.createElement("option"),f.innerHTML=e,f.setAttribute("value",e),e===b&&f.setAttribute("selected","true"),c.appendChild(f);return c},createImg:function(a){var b=document.createElement("img");return b.style.position="absolute",typeof a=="string"&&b.setAttribute("src",a),b},createView:function(a,b){var c=document.createElement("div");return c.style.position=D.VIEW_POSITION,c.style.fontSize=D.VIEW_FONT_SIZE,c.style.fontFamily=D.VIEW_FONT_FAMILY,c.style.cursor="default",c.style.outline="none",c.style.textAlign="left",c.tabIndex=0,b||(c.onmousedown=p.preventDefault),c.style.setProperty&&(c.style.setProperty("-khtml-user-select","none",null),c.style.setProperty("-webkit-user-select","none",null),c.style.setProperty("-moz-user-select","none",null)),a&&(c.style.overflow=a),c},createDiv:function(){var a=document.createElement("div");return a.style.position="absolute",a},createCanvas:function(){var a=document.createElement("canvas");return a.style.position="absolute",a},setCanvas:function(a,b,c,d,e){arguments.length===2&&(c=b.y,d=b.width,e=b.height,b=b.x),a.style.left=b+"px",a.style.top=c+"px",a.setAttribute("width",d),a.setAttribute("height",e),a._viewRect={x:b,y:c,width:d,height:e};var f=a.getContext("2d");return f.shadowBlur!==0&&(f.shadowOffsetX=0,f.shadowOffsetY=0,f.shadowBlur=0,f.shadowColor="rgba(0,0,0,0.0)"),f.clearRect(0,0,d,e),f.translate(-b,-c),f},setImg:function(a,b,c){a.setAttribute("src",b),a.style.left=c.x+"px",a.style.top=c.y+"px",a.style.width=c.width+"px",a.style.height=c.height+"px",a._viewRect=d.clone(c)},setDiv:function(a,b,c,e,f){e=d.num(e)?e:0,a.style.left=b.x-e+"px",a.style.top=b.y-e+"px",a.style.width=b.width+"px",a.style.height=b.height+"px",a._viewRect=d.clone(b),c?a.style.backgroundColor=c:a.style.backgroundColor="",e>0?a.style.border=e+"px "+f+" solid":a.style.border=""},addEventListener:function(a,b,c,d){var e="_"+a+"_";if(d[e])return;var f=function(a){arguments.callee.instance[arguments.callee.method](a)};f.method=b,f.instance=d,d[e]=f,c.addEventListener(a,f,!1)},removeEventListener:function(a,b,c){var d="_"+a+"_",e=c[d];e&&(b.removeEventListener(a,e,!1),delete c[d])},isValidEvent:function(a,b){if(!b)return!1;if(b.target===a)if(g.isFirefox){if(a.clientHeight<a.scrollHeight&&b.layerX<25)return!1;if(a.clientWidth<a.scrollWidth&&b.layerY<25)return!1}else if(b.offsetX>a.clientWidth||b.offsetY>a.clientHeight)return!1;return!0},getLogicalPoint:function(a,b,c,d){c=c?c:1;var e;if(g.isTouchable&&b.changedTouches&&b.changedTouches.length>0){var f=a.getBoundingClientRect(),h=b.changedTouches[0],i=g.isAndroid?0:w.scrollLeft(),j=g.isAndroid?0:w.scrollTop();return e={x:(h.clientX+a.scrollLeft-f.left-i)/c,y:(h.clientY+a.scrollTop-f.top-j)/c},e}if(!p.isValidEvent(a,b))return null;if(b.target===a)return g.isFirefox?e={x:(b.layerX+a.scrollLeft)/c,y:(b.layerY+a.scrollTop)/c}:e={x:(b.offsetX+a.scrollLeft)/c,y:(b.offsetY+a.scrollTop)/c},e;g.isFirefox?e={x:b.layerX,y:b.layerY}:g.isOpera||g.isIE?e={x:b.offsetX,y:b.offsetY}:e={x:b.offsetX/c,y:b.offsetY/c};var k=b.target;!g.isOpera&&k.tagName==="SPAN"&&k.style.position!=="absolute"&&(k=k.offsetParent);while(k&&k!==a&&k!==d)e.x+=k.offsetLeft,e.y+=k.offsetTop,k=k.offsetParent;return k?e:null},handle_mousedown:function(b,c){p.target&&p.handle_mouseup(c),a.addEventListener("mousemove",p.handle_mousemove,!1),a.addEventListener("mouseup",p.handle_mouseup,!1),p.target=b},handle_mousemove:function(a){p.target.handle_mousemove&&p.target.handle_mousemove(a),p.target.handleMouseMove&&p.target.handleMouseMove(a)},handle_mouseup:function(b){p.target.handle_mouseup&&p.target.handle_mouseup(b),p.target.handleMouseUp&&p.target.handleMouseUp(b),a.removeEventListener("mousemove",p.handle_mousemove,!1),a.removeEventListener("mouseup",p.handle_mouseup,!1),delete p.target},getClientPoint:function(a){return{x:a.clientX,y:a.clientY}}},q={cache:{},g:document.createElement("canvas").getContext("2d"),getTextSize:function(a,b){q.g.font=a?a:D.FONT;var c=q.cache[q.g.font];return c||(c=q.g.measureText("e").width*2+4,q.cache[q.g.font]=c),{width:q.g.measureText(b).width+4,height:c}},drawText:function(a,c,d,e,f){e||(e=D.FONT),a.font=e,a.fillStyle=f,a.textAlign="center",a.textBaseline="middle";var h,i;d?d.width===b?(h=d.x,i=d.y):(h=d.x+d.width/2,i=d.y+d.height/2):(h=0,i=0),g.isOpera&&(i-=2),a.fillText(c,h,i)},drawArc:function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s;Math.abs(e)>2*Math.PI&&(e=2*Math.PI),m=Math.ceil(Math.abs(e)/(Math.PI/4)),i=e/m,j=-i,k=-d;if(m>0){n=b+Math.cos(d)*f,o=c+Math.sin(-d)*g,h?a.lineTo(n,o):a.moveTo(n,o);for(var t=0;t<m;t++)k+=j,l=k-j/2,p=b+Math.cos(k)*f,q=c+Math.sin(k)*g,r=b+Math.cos(l)*(f/Math.cos(j/2)),s=c+Math.sin(l)*(g/Math.cos(j/2)),a.quadraticCurveTo(r,s,p,q)}},dashedLine:function(a,b,c,d,e,f,g){var h=f-d,i=g-e,j=Math.sqrt(h*h+i*i);if(j==0)return;h/=j,i/=j;var k=j,l=-c.offset,m=c.drawing,n=c.patternIndex;while(l<k)l+=b[n],l>=k&&(c.offset=b[n]-(l-k),c.patternIndex=n,c.drawing=m,l=k),m?a.lineTo(d+l*h,e+l*i):a.moveTo(d+l*h,e+l*i),m=!m,n=(n+1)%b.length},drawLinePoints:function(a,b,c,d,e){var f=0,g,h,i,j,k,l,m,n=b.size(),o=0,p;c&&c.length>0?p=new r(a,c[0],c.length>1?c[1]:c[0]):p=a;if(d)for(o=0,m=d.size();o<m;o++){g=d.get(o);if("moveto"===g&&f<n)h=b.get(f++),p.moveTo(h.x,h.y);else if("lineto"===g&&f<n)h=b.get(f++),p.lineTo(h.x,h.y);else if("cubicto"===g&&f<n-2)h=b.get(f++),i=b.get(f++),j=b.get(f++),p.bezierCurveTo(h.x,h.y,i.x,i.y,j.x,j.y);else{if(!("quadto"===g&&f<n-1))throw"Can not resolve segment '"+g+"'";h=b.get(f++),i=b.get(f++),p.quadraticCurveTo(h.x,h.y,i.x,i.y)}}else{h=b.get(0),p.moveTo(h.x,h.y);for(f=1;f<n;f++)l=b.get(f),l.size?(k=l.size(),k===2?(h=l.get(0),i=l.get(1),p.quadraticCurveTo(h.x,h.y,i.x,i.y)):k===3&&(h=l.get(0),i=l.get(1),j=l.get(2),p.bezierCurveTo(h.x,h.y,i.x,i.y,j.x,j.y))):p.lineTo(l.x,l.y)}e&&p.closePath()},drawRoundRect:function(a,b,c,d,e,f,g,h,i){arguments.length===6&&(g=f,h=f,i=f);var j=b+d,k=c+e,l=d<e?d*2:e*2;f=f<l?f:l,g=g<l?g:l,h=h<l?h:l,i=i<l?i:l;var m=i*.292893218813453,n=i*.585786437626905;a.moveTo(j,k-i),a.quadraticCurveTo(j,k-n,j-m,k-m),a.quadraticCurveTo(j-n,k,j-i,k),m=h*.292893218813453,n=h*.585786437626905,a.lineTo(b+h,k),a.quadraticCurveTo(b+n,k,b+m,k-m),a.quadraticCurveTo(b,k-n,b,k-h),m=f*.292893218813453,n=f*.585786437626905,a.lineTo(b,c+f),a.quadraticCurveTo(b,c+n,b+m,c+m),a.quadraticCurveTo(b+n,c,b+f,c),m=g*.292893218813453,n=g*.585786437626905,a.lineTo(j-g,c),a.quadraticCurveTo(j-n,c,j-m,c+m),a.quadraticCurveTo(j,c+n,j,c+g),a.lineTo(j,k-i)},drawVector:function(a,b,c,d,e,f,g){arguments.length===4&&(e=d.y,f=d.width,g=d.height,d=d.x);var h=q["_"+b];h&&(a.beginPath(),c&&c.length>0&&(a=new r(a,c[0],c.length>1?c[1]:c[0])),h(a,d,e,f,g))},_rectangle:function(a,b,c,d,e){a.rect(b,c,d,e)},_circle:function(a,b,c,d,e){var f=b+d/2,g=c+e/2,h=Math.min(d,e)/2;a instanceof r?q.drawArc(a,f,g,0,Math.PI*2,h,h,!1):a.arc(f,g,h,0,Math.PI*2,!0)},_oval:function(a,b,c,d,e){if(a instanceof r)q.drawArc(a,b+d/2,c+e/2,0,Math.PI*2,d/2,e/2,!1);else{var f=.5522848,g=d/2*f,h=e/2*f,i=b+d,j=c+e,k=b+d/2,l=c+e/2;a.moveTo(b,l),a.bezierCurveTo(b,l-h,k-g,c,k,c),a.bezierCurveTo(k+g,c,i,l-h,i,l),a.bezierCurveTo(i,l+h,k+g,j,k,j),a.bezierCurveTo(k-g,j,b,l+h,b,l)}},_roundrect:function(a,b,c,d,e){q.drawRoundRect(a,b,c,d,e,Math.min(Math.min(d,e)/4,10))},_star:function(a,b,c,d,e){var f=d*2,g=e*2,h=b+d/2,i=c+e/2;a.moveTo(h-f/4,i-g/12),a.lineTo(
b+d*.306,c+e*.579),a.lineTo(h-f/6,i+g/4),a.lineTo(b+d/2,c+e*.733),a.lineTo(h+f/6,i+g/4),a.lineTo(b+d*.693,c+e*.579),a.lineTo(h+f/4,i-g/12),a.lineTo(b+d*.611,c+e*.332),a.lineTo(h+0,i-g/4),a.lineTo(b+d*.388,c+e*.332),a.closePath()},_triangle:function(a,b,c,d,e){a.moveTo(b+d/2,c),a.lineTo(b+d,c+e),a.lineTo(b,c+e),a.closePath()},_hexagon:function(a,b,c,d,e){a.moveTo(b,c+e/2),a.lineTo(b+d/4,c+e),a.lineTo(b+d*3/4,+c+e),a.lineTo(b+d,c+e/2),a.lineTo(b+d*3/4,c),a.lineTo(b+d/4,c),a.closePath()},_pentagon:function(a,b,c,d,e){var f=d*2,g=e*2,h=b+d/2,i=c+e/2;a.moveTo(h-f/4,i-g/12),a.lineTo(h-f/6,i+g/4),a.lineTo(h+f/6,i+g/4),a.lineTo(h+f/4,i-g/12),a.lineTo(h+0,i-g/4),a.closePath()},_diamond:function(a,b,c,d,e){a.moveTo(b+d/2,c),a.lineTo(b,c+e/2),a.lineTo(b+d/2,c+e),a.lineTo(b+d,c+e/2),a.closePath()},fill:function(a,b,c,d,e,f,g,h){var i=q[c];i?arguments.length===5?a.fillStyle=i(a,b,d,e.x,e.y,e.width,e.height):a.fillStyle=i(a,b,d,e,f,g,h):a.fillStyle=b},"linear.southwest":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e+g,d+f,e);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.southeast":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e+g,d,e);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.northwest":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e+g,d,e);return h.addColorStop(0,b),h.addColorStop(1,c),h},"linear.northeast":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e,d,e+g);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.north":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d,e+g);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.south":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d,e+g);return h.addColorStop(0,b),h.addColorStop(1,c),h},"linear.west":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d+f,e);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.east":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d+f,e);return h.addColorStop(0,b),h.addColorStop(1,c),h},"radial.center":function(a,b,c,d,e,f,g){return q.createRadialGradient(a,b,c,d,e,f,g,.5,.5)},"radial.southwest":function(a,b,c,d,e,f,g){return q.createRadialGradient(a,b,c,d,e,f,g,.75,.25)},"radial.southeast":function(a,b,c,d,e,f,g){return q.createRadialGradient(a,b,c,d,e,f,g,.75,.75)},"radial.northwest":function(a,b,c,d,e,f,g){return q.createRadialGradient(a,b,c,d,e,f,g,.25,.25)},"radial.northeast":function(a,b,c,d,e,f,g){return q.createRadialGradient(a,b,c,d,e,f,g,.75,.25)},"radial.north":function(a,b,c,d,e,f,g){return q.createRadialGradient(a,b,c,d,e,f,g,.5,.25)},"radial.south":function(a,b,c,d,e,f,g){return q.createRadialGradient(a,b,c,d,e,f,g,.5,.75)},"radial.west":function(a,b,c,d,e,f,g){return q.createRadialGradient(a,b,c,d,e,f,g,.25,.5)},"radial.east":function(a,b,c,d,e,f,g){return q.createRadialGradient(a,b,c,d,e,f,g,.75,.5)},"spread.horizontal":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d+f,e);return h.addColorStop(0,b),h.addColorStop(.5,c),h.addColorStop(1,b),h},"spread.vertical":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d,e+g);return h.addColorStop(0,b),h.addColorStop(.5,c),h.addColorStop(1,b),h},"spread.diagonal":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e,d,e+g);return h.addColorStop(0,b),h.addColorStop(.5,c),h.addColorStop(1,b),h},"spread.antidiagonal":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d+f,e+g);return h.addColorStop(0,b),h.addColorStop(.5,c),h.addColorStop(1,b),h},"spread.north":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e-g/4,d,e+g+g/4);return h.addColorStop(0,b),h.addColorStop(1/3,c),h.addColorStop(2/3,b),h.addColorStop(1,c),h},"spread.south":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e-g/4,d,e+g+g/4);return h.addColorStop(0,c),h.addColorStop(1/3,b),h.addColorStop(2/3,c),h.addColorStop(1,b),h},"spread.west":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d-f/4,e,d+f+f/4,e);return h.addColorStop(0,b),h.addColorStop(1/3,c),h.addColorStop(2/3,b),h.addColorStop(1,c),h},"spread.east":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d-f/4,e,d+f+f/4,e);return h.addColorStop(0,c),h.addColorStop(1/3,b),h.addColorStop(2/3,c),h.addColorStop(1,b),h},createRadialGradient:function(a,b,c,d,e,f,g,h,i){var j=a.createRadialGradient(d+f*h,e+g*i,Math.min(f,g)/24,d+f/2,e+g/2,Math.max(f,g)/2);return j.addColorStop(0,c),j.addColorStop(1,b),j},drawPath:function(a,b,c,e,f,g,h,i){var j=a._element,k=a.getBodyRect();e&&l.addPadding(k,j,c+".padding",1);var m=d.clone(k),n=j.getStyle(c+".outline.width");n>0&&l.grow(m,n/2,n/2);var o=a.setShadow(a,b,m),p=j.getStyle(c+".fill"),r;if(p){a._innerColor&&!s.hasDefault(a._element)?r=a._innerColor:r=j.getStyle(c+".fill.color");var t=j.getStyle(c+".gradient");t?q.fill(o,r,t,j.getStyle(c+".gradient.color"),k):o.fillStyle=r}var u=j.getStyle(c+".shape");return p&&(o.beginPath(),g?q.drawLinePoints(o,g,null,h,i):q.drawVector(o,u,null,k),o.fill()),n>0&&(o.lineWidth=n,o.lineCap=j.getStyle(c+".cap"),o.lineJoin=j.getStyle(c+".join"),o.strokeStyle=j.getStyle(c+".outline.color"),o.beginPath(),g?q.drawLinePoints(o,g,f,h,i):q.drawVector(o,u,f,k),o.stroke()),m},draw3DRect:function(a,b,c,d,e,f,g){if(c===0)return;arguments.length<=4&&(g=d.height,f=d.width,e=d.y,d=d.x);var h=c>0;c=Math.abs(c);var i,j;a.lineWidth=1,a.lineCap="square";if(c===1)i=q.brighter(b),j=q.darker(b),a.strokeStyle=h?i:j,a.beginPath(),a.moveTo(d,e),a.lineTo(d,e+g),a.moveTo(d,e),a.lineTo(d+f,e),a.closePath(),a.stroke(),a.strokeStyle=h?j:i,a.beginPath(),a.moveTo(d,e+g),a.lineTo(d+f,e+g),a.moveTo(d+f,e),a.lineTo(d+f,e+g),a.closePath(),a.stroke();else{var k=c*2,l=50/k;for(var m=0;m<k;m++)i=q.brighter(b,50-m*l),j=q.darker(b,50-m*l),d+=.5,e+=.5,f-=1,g-=1,a.strokeStyle=h?i:j,a.beginPath(),a.moveTo(d,e),a.lineTo(d,e+g),a.moveTo(d,e),a.lineTo(d+f,e),a.closePath(),a.stroke(),a.strokeStyle=h?j:i,a.beginPath(),a.moveTo(d,e+g),a.lineTo(d+f,e+g),a.moveTo(d+f,e),a.lineTo(d+f,e+g),a.closePath(),a.stroke()}},brighter:function(a,b){return b||(b=50),q.adjustBrightness2(a,b)},darker:function(a,b){return b||(b=50),q.adjustBrightness2(a,-b)},adjustBrightness2:function(a,b){var d,e,f;if(b===0)return g;var g=c.ImageAsset._getValue(a);return b<0?(b=(100+b)/100,d=Math.ceil((g>>16&255)*b),e=Math.ceil((g>>8&255)*b),f=Math.ceil((g&255)*b)):(b/=100,d=g>>16&255,e=g>>8&255,f=g&255,d+=(255-d)*b,e+=(255-e)*b,f+=(255-f)*b,d=Math.min(Math.ceil(d),255),e=Math.min(Math.ceil(e),255),f=Math.min(Math.ceil(f),255)),"rgba("+d+","+e+","+f+",1)"},getColorArray:function(a){var b=c.ImageAsset._canvas;b.width=3,b.height=3;var d=b.getContext("2d");return d.clearRect(0,0,3,3),d.fillStyle=a,d.beginPath(),d.rect(0,0,3,3),d.closePath(),d.fill(),d.getImageData(1,1,1,1).data},hit:function(a,b,c){if(!a)return!1;var d=a._viewRect;if(!d)return!1;b-=d.x,c-=d.y;if(b<0||c<0||b>=d.width||c>=d.height)return!1;try{var e=a.getContext("2d").getImageData(b,c,1,1),f=e.data;for(var g=0,h=f.length;g<h;g+=4)if(f[g+3]!==0)return!0}catch(i){return!0}return!1},intersects:function(a,b){if(!a)return!1;b=l.intersection(b,a._viewRect);if(!b)return!1;b.x-=a._viewRect.x,b.y-=a._viewRect.y;try{var c=a.getContext("2d").getImageData(b.x,b.y,b.width,b.height),d=c.data;for(var e=0;n=d.length,e<n;e+=4)if(d[e+3]!==0)return!0}catch(f){}return!1}},r=function(a,b,c){this.g=a,this.onLength=b,this.offLength=c,this.isLine=!0,this.overflow=0,this.dashLength=b+c,this.pen={x:0,y:0}};d.ext(r,Object,{_curveaccuracy:6,moveTo:function(a,b){this.pen={x:a,y:b},this.g.moveTo(a,b),this.start||(this.start={x:a,y:b})},lineTo:function(a,b){var c=a-this.pen.x,d=b-this.pen.y,e=Math.atan2(d,c),f=Math.cos(e),g=Math.sin(e),h=this.lineLength(this.pen.x,this.pen.y,a,b);if(this.overflow){if(this.overflow>h){this.isLine?this._lineTo(a,b):this.moveTo(a,b),this.overflow-=h;return}this.isLine?this._lineTo(this.pen.x+f*this.overflow,this.pen.y+g*this.overflow):this.moveTo(this.pen.x+f*this.overflow,this.pen.y+g*this.overflow),h-=this.overflow,this.overflow=0,this.isLine=!this.isLine;if(!h)return}var i=Math.floor(h/this.dashLength);if(i){var j=f*this.onLength,k=g*this.onLength,l=f*this.offLength,m=g*this.offLength;for(var n=0;n<i;n++)this.isLine?(this._lineTo(this.pen.x+j,this.pen.y+k),this.moveTo(this.pen.x+l,this.pen.y+m)):(this.moveTo(this.pen.x+l,this.pen.y+m),this._lineTo(this.pen.x+j,this.pen.y+k));h-=this.dashLength*i}this.isLine?h>this.onLength?(this._lineTo(this.pen.x+f*this.onLength,this.pen.y+g*this.onLength),this.moveTo(a,b),this.overflow=this.offLength-(h-this.onLength),this.isLine=!1):(this._lineTo(a,b),h==this.onLength?(this.overflow=0,this.isLine=!this.isLine):(this.overflow=this.onLength-h,this.moveTo(a,b))):h>this.offLength?(this.moveTo(this.pen.x+f*this.offLength,this.pen.y+g*this.offLength),this._lineTo(a,b),this.overflow=this.onLength-(h-this.offLength),this.isLine=!0):(this.moveTo(a,b),h==this.offLength?(this.overflow=0,this.isLine=!this.isLine):this.overflow=this.offLength-h)},quadraticCurveTo:function(a,b,c,d){var e=this.pen.x,f=this.pen.y,g=this.curveLength(e,f,a,b,c,d),h=0,i=0,j;if(this.overflow){if(this.overflow>g){this.isLine?this._curveTo(a,b,c,d):this.moveTo(c,d),this.overflow-=g;return}h=this.overflow/g,j=this.curveSliceUpTo(e,f,a,b,c,d,h),this.isLine?this._curveTo(j[2],j[3],j[4],j[5]):this.moveTo(j[4],j[5]),this.overflow=0,this.isLine=!this.isLine;if(!g)return}var k=g-g*h,l=Math.floor(k/this.dashLength),m=this.onLength/g,n=this.offLength/g;if(l)for(var o=0;o<l;o++)this.isLine?(i=h+m,j=this.curveSlice(e,f,a,b,c,d,h,i),this._curveTo(j[2],j[3],j[4],j[5]),h=i,i=h+n,j=this.curveSlice(e,f,a,b,c,d,h,i),this.moveTo(j[4],j[5])):(i=h+n,j=this.curveSlice(e,f,a,b,c,d,h,i),this.moveTo(j[4],j[5]),h=i,i=h+m,j=this.curveSlice(e,f,a,b,c,d,h,i),this._curveTo(j[2],j[3],j[4],j[5])),h=i;k=g-g*h,this.isLine?k>this.onLength?(i=h+m,j=this.curveSlice(e,f,a,b,c,d,h,i),this._curveTo(j[2],j[3],j[4],j[5]),this.moveTo(c,d),this.overflow=this.offLength-(k-this.onLength),this.isLine=!1):(j=this.curveSliceFrom(e,f,a,b,c,d,h),this._curveTo(j[2],j[3],j[4],j[5]),g==this.onLength?(this.overflow=0,this.isLine=!this.isLine):(this.overflow=this.onLength-k,this.moveTo(c,d))):k>this.offLength?(i=h+n,j=this.curveSlice(e,f,a,b,c,d,h,i),this.moveTo(j[4],j[5]),j=this.curveSliceFrom(e,f,a,b,c,d,i),this._curveTo(j[2],j[3],j[4],j[5]),this.overflow=this.onLength-(k-this.offLength),this.isLine=!0):(this.moveTo(c,d),k==this.offLength?(this.overflow=0,this.isLine=!this.isLine):this.overflow=this.offLength-k)},bezierCurveTo:function(a,b,c,b,d,e){this.pen={x:d,y:e},this.g.bezierCurveTo(a,b,c,b,d,e)},rect:function(a,b,c,d){this.pen={x:a,y:b},this.moveTo(a,b),this.lineTo(a,b+d),this.lineTo(a+c,b+d),this.lineTo(a+c,b),this.lineTo(a,b)},closePath:function(){this.lineTo(this.start.x,this.start.y)},lineLength:function(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(e*e+f*f)},curveLength:function(a,b,c,d,e,f,g){var h=0,i=a,j=b,k,l,m,n,o,p,q,r=g>0?g:this._curveaccuracy;for(var s=1;s<=r;s++)m=s/r,n=1-m,o=n*n,p=2*m*n,q=m*m,k=o*a+p*c+q*e,l=o*b+p*d+q*f,h+=this.lineLength(i,j,k,l),i=k,j=l;return h},curveSlice:function(a,b,c,d,e,f,g,h){if(g==0)return this.curveSliceUpTo(a,b,c,d,e,f,h);if(h==1)return this.curveSliceFrom(a,b,c,d,e,f,g);var i=this.curveSliceUpTo(a,b,c,d,e,f,h);return i.push(g/h),this.curveSliceFrom.apply(this,i)},curveSliceUpTo:function(a,b,c,d,e,f,g){if(g!=1){var h=c+(e-c)*g,i=d+(f-d)*g;c=a+(c-a)*g,d=b+(d-b)*g,e=c+(h-c)*g,f=d+(i-d)*g}return[a,b,c,d,e,f]},curveSliceFrom:function(a,b,c,d,e,f,g){if(g!=1){var h=a+(c-a)*g,i=b+(d-b)*g;c+=(e-c)*g,d+=(f-d)*g,a=h+(c-h)*g,b=i+(d-i)*g}return[a,b,c,d,e,f]},_lineTo:function(a,b){if(a==this.pen.x&&b==this.pen.y)return;this.pen={x:a,y:b},this.g.lineTo(a,b)},_curveTo:function(a,b,c,d){if(a==c&&b==d&&c==this.pen.x&&d==this.pen.y)return;this.pen={x:c,y:d},this.g.quadraticCurveTo(a,b,c,d)}});var s={DEFAULTS:{"default":1,"default.vector":1,"vector.default":1},VECTORS:{vector:1,"default.vector":1,"vector.default":1},hasDefault:function(a){if(a instanceof E){var b=a.getStyle("body.type");return s.DEFAULTS[b]===1}return!0},hasVector:function(a){if(a instanceof E){var b=a.getStyle("body.type");return s.VECTORS[b]===1}return!1},hasAgentLinks:function(a){var b=a.getChildrenSize();for(var c=0;c<b;c++){var d=a.getChildAt(c);if(d instanceof E&&s.hasAgentLinks(d))return!0}return a.hasAgentLinks()},getParents:function(a,b,c){c||(c=!0);var d=new B,e=a.getParent();while(e!=null&&e!==b)d.add(e,0),e=e.getParent();return c&&e!=null&&e===b&&d.add(e,0),d},getSubNetwork:function(a){if(!a)return null;if(a instanceof c.Link){var b=a.getFromAgent(),d=a.getToAgent();if(!b||!d)return null;var e=s.getSubNetwork(b),f=s.getSubNetwork(d);return e===f?e:null}var g=a.getParent();if(!g)return null;while(g instanceof c.Link&&!g.ISubNetwork)g=g.getParent();return g.ISubNetwork?g:s.getSubNetwork(g)},figureSameSubNetworkAgent:function(a){if(!a)return null;var b=a.getParent();while(b instanceof F){if(!(b.getParent()instanceof F))return b.isExpanded()?a:b;b.isExpanded()||(a=b),b=b.getParent()}return a},figureSpanSubNetworkAgent:function(a,b){if(!a||!b)return null;var c=s.getSubNetwork(a),d=s.getSubNetwork(b);if(c!=d){while(d!=null&&c!=d)d=s.getSubNetwork(d);if(c===d)return a;var e=new B;e.add(a,0);var f=a.getParent();while(f instanceof E){if(!!b.isDescendantOf(f))break;e.add(f,0),f=f.getParent()}var g=e.size();for(var h=0;h<g;h++){var i=e.get(h);if(i instanceof F&&!i.isExpanded())return i;if(i.ISubNetwork)return i}return a}return a},figureFromAgent:function(a){if(a.isLooped())return a.getFromNode();var b=s.figureSameSubNetworkAgent(a.getFromNode()),c=s.figureSameSubNetworkAgent(a.getToNode());return b===c?a.getFromNode():s.figureSpanSubNetworkAgent(b,c)},figureToAgent:function(a){if(a.isLooped())return a.getToNode();var b=s.figureSameSubNetworkAgent(a.getFromNode()),c=s.figureSameSubNetworkAgent(a.getToNode());return b===c?a.getToNode():s.figureSpanSubNetworkAgent(c,b)},getBundleLinks:function(a,b){if(!a||!b)return null;var c,d,e,f;if(a===b){f=a.getLoopedLinks();if(!f)return null;f=new B(f)}else{var g=a.getAgentLinks(),h=b.getAgentLinks();if(!g||!h)return null;d=g.size();for(c=0;c<d;c++)e=g.get(c),h.contains(e)&&(f||(f=new B),f.add(e))}if(f!=null)for(c=0;c<f.size();c++)e=f.get(c),e.getStyle("link.bundle.enable")||(e._setBundleLinks(null),f.removeAt(c),c--);return f},resetBundleLinks:function(a,b){var d=s.getBundleLinks(a,b);if(!d||d.size()===0)return;var e=null;if(d.size()===1){e=d.get(0),e._setBundleLinks(null);return}var f,g,h=new B;for(f=0;f<d.size();f++)e=d.get(f),g=e.getStyle("link.bundle.id"),h.indexOf(g)<0&&h.add(g);h.sort();var i,j=new B,k;for(k=0;k<h.size();k++){g=h.get(k);var l=new B;for(f=0;f<d.size();f++)e=d.get(f),g===e.getStyle("link.bundle.id")&&l.add(e);i=new c.BundleLinks(l,j),j.add(i)}for(k=0;k<j.size();k++){i=j.get(k);for(f=0;f<i.getLinks().size();f++)e=i.getLinks().get(f),e._setBundleLinks(i)}},moveElements:function(a,b,c,d){var e=s.filterMovingElements(a,d),f=e.size();for(var g=0;g<f;g++)e.get(g).translate(b,c)},filterMovingElements:function(a,b){var d=new B,e=a.size();for(var f=0;f<e;f++){var g=a.get(f);if(!(g instanceof E))continue;if(b&&!b(g))continue;var h=!0,i=d.toArray();for(var j=0;j<i.length;j++){var k=i[j];h&&k instanceof c.Follower&&g instanceof c.Follower&&g.isLoopedHostOn(k)?h=!1:k instanceof c.Follower&&k.isHostOn(g)?d.remove(k):h&&g instanceof c.Follower&&k instanceof E&&g.isHostOn(k)?h=!1:s.isDescendantOfGroup(k,g)?d.remove(k):h&&s.isDescendantOfGroup(g,k)&&(h=!1)}h&&d.add(g)}return d},isDescendantOfGroup:function(a,b){if(!!a&&b instanceof F){if(!b.hasChildren())return!1;a=a.getParent();while(a instanceof F){if(a===b)return!0;a=a.getParent()}return!1}return!1},fillDescendant:function(a,b){b.add(a),a.hasChildren()&&a.getChildren().forEach(function(a){s.fillDescendant(a,b)})}},t={between:function(a,b,c){return c>=a&&c<=b?!0:c>=b&&c<=a?!0:!1},considerEast:function(a,b,c){return b?t.between(b.x,c.x,a.x)?c.x>b.x:Math.abs(b.x-a.x)>Math.abs(c.x-a.x):!0},considerWest:function(a,b,c){return b?t.between(b.x,c.x,a.x)?c.x<b.x:Math.abs(b.x-a.x)>Math.abs(c.x-a.x):!0},considerNorth:function(a,b,c){return b?t.between(b.y,c.y,a.y)?c.y<b.y:Math.abs(b.y-a.y)>Math.abs(c.y-a.y):!0},considerSouth:function(a,b,c){return b?t.between(b.y,c.y,a.y)?c.y>b.y:Math.abs(b.y-a.y)>Math.abs(c.y-a.y):!0},getHorizontalPoint:function(a,b,c){return t.between(b.x,c.x,a.x)?{x:a.x,y:b.y}:Math.abs(a.x-b.x)<Math.abs(a.x-c.x)?{x:b.x,y:b.y}:{x:c.x,y:c.y}},getVerticalPoint:function(a,b,c){return t.between(b.y,c.y,a.y)?{x:b.x,y:a.y}:Math.abs(a.y-b.y)<Math.abs(a.y-c.y)?{x:b.x,y:b.y}:{x:c.x,y:c.y}},getPoint:function(a,b,c,d,e){var f=Math.abs(d.x-c.x)>Math.abs(d.y-c.y);if("south"===e)return f&&t.considerSouth(b,a,c)?t.getHorizontalPoint(b,c,d):null;if("north"===e)return f&&t.considerNorth(b,a,c)?t.getHorizontalPoint(b,c,d):null;if("west"===e)return!f&&t.considerWest(b,a,c)?t.getVerticalPoint(b,c,d):null;if("east"===e)return!f&&t.considerEast(b,a,c)?t.getVerticalPoint(b,c,d):null;if("nearby"===e){var g;return f?g=t.getHorizontalPoint(b,c,d):g=t.getVerticalPoint(b,c,d),!a||l.getDistance(a,b)>l.getDistance(g,b)?g:null}return null},getBusPoint:function(a,b,c){var d,e=a.size();if(e>0){var f=a.get(0);for(var g=1;g<e;g++){var h=a.get(g),i=t.getPoint(d,b,f,h,c);i&&(d=i),f=h}d||(d={x:f.x,y:f.y})}return d}},u={createFromPoint:function(a){var b=a._element;if(!b.getFromAgent())return{x:0,y:0};var e=b.getStyle("link.from.position"),f=b.getStyle("link.from.xoffset"),g=b.getStyle("link.from.yoffset"),h;if(!d.isCalculatingBus){d.isCalculatingBus=!0;if(b.getFromAgent()instanceof c.Bus){var i=b.getFromAgent();if(s.hasVector(i)){var j=i.getStyle("vector.shape");if(j==="oval")h=l.getEllipsePoint(i.getRect(),u.createToPoint(a));else if(j==="circle")h=l.getEllipsePoint(l.getCircleRect(i.getRect()),u.createToPoint(a));else if(j==="rectangle"||j==="roundrect"){var k=new B;k.add({x:i.x,y:i.y}),k.add({x:i.x+i.width,y:i.y}),k.add({x:i.x+i.width,y:i.y+i.height}),k.add({x:i.x,y:i.y+i.height}),k.add({x:i.x,y:i.y}),h=t.getBusPoint(k,u.createToPoint(a),i.getStyle("bus.style"))}}else h=t.getBusPoint(i.getPoints(),u.createToPoint(a),i.getStyle("bus.style"))}d.isCalculatingBus=!1}return h?(h.x+=f,h.y+=g):h=a._network.getPosition(e,b.getFromAgent(),null,f,g),h},createToPoint:function(a){var b=a._element;if(!b.getToAgent())return{x:0,y:0};var e=b.getStyle("link.to.position"),f=b.getStyle("link.to.xoffset"),g=b.getStyle("link.to.yoffset"),h;if(!d.isCalculatingBus){d.isCalculatingBus=!0;if(b.getToAgent()instanceof c.Bus){var i=b.getToAgent();if(s.hasVector(i)){var j=i.getStyle("vector.shape");if(j==="oval")h=l.getEllipsePoint(i.getRect(),u.createFromPoint(a));else if(j==="circle")h=l.getEllipsePoint(l.getCircleRect(i.getRect()),u.createFromPoint(a));else if(j==="rectangle"||j==="roundrect"){var k=new B;k.add({x:i.x,y:i.y}),k.add({x:i.x+i.width,y:i.y}),k.add({x:i.x+i.width,y:i.y+i.height}),k.add({x:i.x,y:i.y+i.height}),k.add({x:i.x,y:i.y}),h=t.getBusPoint(k,u.createFromPoint(a),i.getStyle("bus.style"))}}else h=t.getBusPoint(i.getPoints(),u.createFromPoint(a),i.getStyle("bus.style"))}d.isCalculatingBus=!1}return h?(h.x+=f,h.y+=g):h=a._network.getPosition(e,b.getToAgent(),null,f,g),h},fillLoopedPoints:function(a,b,c){var d,e=u.getBundleGap(a,!0),f=e,g=a.getStyle("link.looped.type"),h=a.getStyle("link.looped.direction");if(h==="north")return g==="arc"?u.drawArc(b.x+b.width/2,b.y,0,Math.PI,e,e,!1,c):(d={x:b.x+b.width/2,y:b.y},c.add({x:d.x+f,y:d.y}),c.add({x:d.x+f,y:d.y-e}),c.add({x:d.x-f,y:d.y-e}),c.add({x:d.x-f,y:d.y})),{x:b.x+b.width/2,y:b.y-e};if(h==="northeast")return g==="arc"?u.drawArc(b.x+b.width,b.y,Math.PI*1.5,Math.PI*1.5,e,e,!1,c):(d={x:b.x+b.width,y:b.y},c.add({x:d.x,y:d.y+f}),c.add({x:d.x+f,y:d.y+f}),c.add({x:d.x+f,y:d.y-e}),c.add({x:d.x-f,y:d.y-e}),c.add({x:d.x-f,y:d.y})),{x:b.x+b.width+e*.707,y:b.y-e*.707};if(h==="east")return g==="arc"?u.drawArc(b.x+b.width,b.y+b.height/2,Math.PI*1.5,Math.PI,e,e,!1,c):(d={x:b.x+b.width,y:b.y+b.height/2},c.add({x:d.x,y:d.y-f}),c.add({x:d.x+e,y:d.y-f}),c.add({x:d.x+e,y:d.y+f}),c.add({x:d.x,y:d.y+f})),{x:b.x+b.width+e,y:b.y+b.height/2};if(h==="southeast")return g==="arc"?u.drawArc(b.x+b.width,b.y+b.height,Math.PI,Math.PI*1.5,e,e,!1,c):(d={x:b.x+b.width,y:b.y+b.height},c.add({x:d.x,y:d.y-f}),c.add({x:d.x+f,y:d.y-f}),c.add({x:d.x+f,y:d.y+e}),c.add({x:d.x-f,y:d.y+e}),c.add({x:d.x-f,y:d.y})),{x:b.x+b.width+e*.707,y:b.y+b.height+e*.707};if(h==="south")return g==="arc"?u.drawArc(b.x+b.width/2,b.y+b.height,Math.PI,Math.PI,e,e,!1,c):(d={x:b.x+b.width/2,y:b.y+b.height},c.add({x:d.x-f,y:d.y}),c.add({x:d.x-f,y:d.y+e}),c.add({x:d.x+f,y:d.y+e}),c.add({x:d.x+f,y:d.y})),{x:b.x+b.width/2,y:b.y+b.height+e};if(h==="southwest")return g==="arc"?u.drawArc(b.x,b.y+b.height,Math.PI*.5,Math.PI*1.5,e,e,!1,c):(d={x:b.x,y:b.y+b.height},c.add({x:d.x,y:d.y-f}),c.add({x:d.x-f,y:d.y-f}),c.add({x:d.x-f,y:d.y+e}),c.add({x:d.x+f,y:d.y+e}),c.add({x:d.x+f,y:d.y})),{x:b.x-e*.707,y:b.y+b.height+e*.707};if(h==="west")return g==="arc"?u.drawArc(b.x,b.y+b.height/2,Math.PI*.5,Math.PI,e,e,!1,c):(d={x:b.x,y:b.y+b.height/2},c.add({x:d.x,y:d.y-f}),c.add({x:d.x-e,y:d.y-f}),c.add({x:d.x-e,y:d.y+f}),c.add({x:d.x,y:d.y+f})),{x:b.x-e,y:b.y+b.height/2};if(h==="northwest")return g==="arc"?u.drawArc(b.x,b.y,0,Math.PI*1.5,e,e,!1,c):(d={x:b.x,y:b.y},c.add({x:d.x,y:d.y+f}),c.add({x:d.x-f,y:d.y+f}),c.add({x:d.x-f,y:d.y-e}),c.add({x:d.x+f,y:d.y-e}),c.add({x:d.x+f,y:d.y})),{x:b.x-e*.707,y:b.y-e*.707};throw"Can not resolve link looped direction '"+h+"'"},drawArc:function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s;Math.abs(d)>2*Math.PI&&(d=2*Math.PI),m=Math.ceil(Math.abs(d)/(Math.PI/4)),i=d/m,j=-i,k=-c;if(m>0){n=a+Math.cos(c)*e,o=b+Math.sin(-c)*f,h.add({x:n,y:o});for(var t=0;t<m;t++){k+=j,l=k-j/2,p=a+Math.cos(k)*e,q=b+Math.sin(k)*f,r=a+Math.cos(l)*(e/Math.cos(j/2)),s=b+Math.sin(l)*(f/Math.cos(j/2));var u=new B;u.add({x:r,y:s}),u.add({x:p,y:q}),h.add(u)}}},fillBundlePoints:function(a,b,c,d,e){var f=a._element.getBundleCount(),g=a._element.getBundleIndex(),h=a.getStyle("link.bundle.expanded"),i=u.getBundleGap(a,!1);if(i===0&&b!=="parallel")return e.add(c),e.add(d),l.getCenterPoint(c,d);var j=u.getBundleOffset(a),k=l.getDistance(c,d);(b==="arc"||b==="triangle")&&e.add({x:0,y:0}),b==="arc"&&e.add({x:0,y:i}),e.add({x:j,y:i}),e.add({x:k-j,y:i}),b==="arc"&&e.add({x:k,y:i}),(b==="arc"||b==="triangle")&&e.add({x:k,y:0});var m=Math.atan2(d.y-c.y,d.x-c.x),n=l.createMatrix(m,0,0);for(var o=0,p=e.size();o<p;o++){var q=e.get(o);q=n.transform(q),q.x+=c.x,q.y+=c.y,e.set(o,q)}if(b==="arc"){var r=l.getCenterPoint(e.get(2),e.get(3)),s=new B;return s.add(e.get(1)),s.add(e.get(2)),e.set(1,s),s=new B,s.add(e.get(4)),s.add(e.get(5)),e.set(4,s),e.removeAt(5),e.removeAt(2),r}return u.calculateCenterPoint(e)},calculateCenterPoint:function(a){var b=a.size();if(a==null||b<1)return{x:0,y:0};if(b%2===0){var c=b/2,d=a.get(c-1),e=a.get(c);return{x:(d.x+e.x)/2,y:(d.y+e.y)/2}}return a.get((b-1)/2)},getBundleOffset:function(a){var b=l.getDistance(a.getFromPoint(),a.getToPoint()),c=a.getStyle("link.bundle.offset");return b>c*2?c:b/2},getBundleGap:function(a,b){var c=a._element;if(!c.getBundleLinks())return b?c.getStyle("link.looped.gap"):0;var d=b?"link.looped.gap":"link.bundle.gap",e=null,f=0,g=0,h=c.getBundleLinks().getSiblings(),i=0,j=c.getStyle("link.bundle.independent");for(var k=0,l=h.size();k<l;k++){var m=h.get(k);if(j&&m!==c.getBundleLinks())continue;for(var n=0,o=m.getLinks().size();n<o;n++){var p=m.getLinks().get(n);if(j!==p.getStyle("link.bundle.independent"))continue;if(a._network.isVisible(p)){if(e==null)e=p,i=p.getStyle(d);else{var q=p.getStyle(d);g+=i/2+q/2,i=q}p===c&&(f=g)}}}if(b)return g-f+i;var r=f-g/2;return e!=null&&c.getFromAgent()!==e.getFromAgent()&&(r=-r),r},isTargetPriority:function(a,b,c){if(a){if(b.height<c.height)return b.height+c.height<Math.max(b.y+b.height,c.y+c.height)-Math.min(b.y,c.y)+b.height/2}else if(b.width<c.width)return b.width+c.width<Math.max(b.x+b.width,c.x+c.width)-Math.min(b.x,c.x)+b.width/2;return!0},calculateOrthogonalAndFlexionalLinkPoints:function(a,b,c,d){var e=u.isHorizontal(a,b,c,d),f=new B;if(u.isFlexionalTypeLink(a))u.flexional(e,b,c,f,d.getStyle("link.extend"));else{u.orthogonal(a,b,c,f,e,d);var g=u.isSplitByPercent(a,d),h=g?u.calculateSplitValueByPercent(a,e,b,c,d.getStyle("link.split.percent")):d.getStyle("link.split.value");h===0&&(e=!e)}var i;f.size()===0?u.isTargetPriority(e,b,c)?(i={x:c.x+c.width/2,y:c.y+c.height/2},f.add(u.rectanglePerimeter(b,!0,i)),f.add(u.rectanglePerimeter(c,!1,f.get(f.size()-1)))):(i={x:b.x+b.width/2,y:b.y+b.height/2},i=u.rectanglePerimeter(c,!1,i),f.add(u.rectanglePerimeter(b,!0,i)),f.add(i)):(i=f.get(0),f.add(u.rectanglePerimeter(b,!0,i),0),f.add(u.rectanglePerimeter(c,!1,f.get(f.size()-1))));var j=f.size();if(j<2)return f;var k=f.get(0);for(var l=1;l<j-1;l++){var m=f.get(l);m.x===k.x&&m.y===k.y&&(f.remove(m),j--,l--),k=m}return f},isHorizontal:function(a,b,c,d){if(a){if(a==="flexional.horizontal"||a==="orthogonal.horizontal"||a==="orthogonal.H.V"||a==="extend.left"||a==="extend.right")return!0;if(a==="flexional.vertical"||a==="orthogonal.vertical"||a==="orthogonal.V.H"||a==="extend.top"||a==="extend.bottom")return!1}var e=u.calculateXGap(b,c),f=u.calculateYGap(b,c);return e>=f},flexional:function(a,b,c,d,e){a?u.flexionalHorizontal(b,c,d,e):u.flexionalVertical(b,c,d,e)},isSplitByPercent:function(a,b){return b.getStyle("link.split.by.percent")},isExtendTypeLink:function(a){return a&&(a==="extend.top"||a==="extend.left"||a==="extend.bottom"||a==="extend.right")},isFlexionalTypeLink:function(a){return a&&(a==="flexional"||a==="flexional.horizontal"||a==="flexional.vertical")},calculateControlPoint:function(a,b,c,d,e){if(a==="orthogonal.H.V"||a==="orthogonal.V.H")return{x:d.x+d.width/2,y:d.y+d.height/2};var f;if(u.isExtendTypeLink(a)){var g=Math.min(c.y,d.y),h=Math.min(c.x,d.x),i=Math.max(c.y+c.height,d.y+d.height),j=Math.max(c.x+c.width,d.x+d.width);f=e.getStyle("link.extend");if(a==="extend.top")return{x:(h+j)/2,y:g-f};if(a==="extend.left")return{x:h-f,y:(g+i)/2};if(a==="extend.bottom")return{x:(h+j)/2,y:i+f};if(a==="extend.right")return{x:j+f,y:(g+i)/2}}var k=u.isSplitByPercent(a,e);f=k?u.calculateSplitValueByPercent(a,b,c,d,e.getStyle("link.split.percent")):e.getStyle("link.split.value");if(f===Number.NEGATIVE_INFINITY||f===Number.POSITIVE_INFINITY)return{x:d.x+d.width/2,y:d.y+d.height/2};if(f===0)return{x:c.x+c.width/2,y:c.y+c.height/2};if(b){var l=c.x+c.x+c.width<d.x+d.x+d.width;return{x:u.calculateSplitLocation(l,f,c.x,c.width),y:c.y+c.height/2}}var m=c.y+c.y+c.height<d.y+d.y+d.height;return{x:c.x+c.width/2,y:u.calculateSplitLocation(m,f,c.y,c.height)}},calculateGap:function(a,b,c,d){var e=Math.max(b,d)-Math.min(a,c);return e-(b-a+d-c)},calculateXGap:function(a,b){var c=Math.max(a.x+a.width,b.x+b.width)-Math.min(a.x,b.x);return c-a.width-b.width},calculateYGap:function(a,b){var c=Math.max(a.y+a.height,b.y+b.height)-Math.min(a.y,b.y);return c-a.height-b.height},calculateSplitValueByPercent:function(a,b,c,d,e){var f=u.calculateSplitGapByPercent(e,b,c,d);return f*e},calculateSplitGapByPercent:function(a,b,c,d,e){return b?u._calculateSplitGapByPercent(a,c.x,c.x+c.width,d.x,d.x+d.width):u._calculateSplitGapByPercent(a,c.y,c.y+c.height,d.y,d.y+d.height)},_calculateSplitGapByPercent:function(a,b,c,d,e){var f=u.calculateGap(b,c,d,e),g=b+c<d+e;if(f>0){if(a===1)return f+(e-d)/2;if(a>=0&&a<1)return f;if(a<0)return g?d-b:c-e}return g&&a>0||!g&&a<0?Math.abs(c-e):Math.abs(b-d)},calculateSplitPercentByControlPoint:function(a,b,c,d){return b?u.calculateSplitPercent(a.x,c.x,c.x+c.width,d.x,d.x+d.width):u.calculateSplitPercent(a.y,c.y,c.y+c.height,d.y,d.y+d.height)},calculateSplitPercent:function(a,b,c,d,e){if(a>=b&&a<=c)return 0;var f=u.calculateGap(b,c,d,e);if(f>0&&a>=d&&a<=e)return 1;var g=b+c<d+e;if(f>0){if(a>Math.min(c,e)&&a<Math.max(b,d))return Math.abs(a-(g?c:b))/f;if(g){if(a<b)return(a-b)/(d-b)}else if(a>c)return(c-a)/(c-e)}return a>c?(g?a-c:c-a)/Math.abs(c-e):(g?a-b:b-a)/Math.abs(b-d)},calculateSplitLocation:function(a,b,c,d){return a===b>0?c+d+Math.abs(b):c-Math.abs(b)},calculateAngle:function(a,b){if(a!==0&&b!==0)return Math.atan2(a,b);if(a===0){if(b>0)return 0;if(b<0)return Math.PI}return a>0?Math.PI/2:-Math.PI/2},drawCorner:function(a,b){var c=a.size();if(c<3)return;var d=b.getStyle("link.corner");if(d==="none")return;var e=b.getStyle("link.xradius"),f=b.getStyle("link.yradius"),g,h,i=a.get(0),j=a.get(1),k,l;for(var m=2;m<c;m++){var n=a.get(m),o=j.x-i.x,p=j.y-i.y,q=n.x-j.x,r=n.y-j.y,s=p===0;if(o===0&&r===0||p===0&&q===0){s?(g=Math.min(m===2?Math.abs(o):Math.abs(o)/2,e),h=Math.min(m===c-1?Math.abs(r):Math.abs(r)/2,f),k={x:j.x-(o>0?g:-g),y:j.y},l={x:j.x,y:j.y+(r>0?h:-h)}):(g=Math.min(m===c-1?Math.abs(q):Math.abs(q)/2,e),h=Math.min(m===2?Math.abs(p):Math.abs(p)/2,f),k={x:j.x,y:j.y-(p>0?h:-h)},l={x:j.x+(q>0?g:-g),y:j.y}),a.remove(j),m--,c--;if(k.x!==i.x||k.y!==i.y)a.add(k,m),m++,c++;if(d==="bevel")a.add(l,m),m++,c++;else if(d==="round"){var t=new B;t.add(j),t.add(l),a.add(t,m),m++,c++}}i=j,j=n}l&&l.x===j.x&&l.y===j.y&&a.remove(j)},orthogonal:function(a,b,c,d,e,f){var g=f.getStyle("link.control.point"),h=g==null;if(g){var i=l.unionRect(b,c);l.containsPoint(i,g)||(e=u.calculateIsHorizontalByControlPoint(g.x,g.y,i.y,i.x,i.y+i.height,i.x+i.width))}else g=u.calculateControlPoint(a,e,b,c,f);e?u.sideToSide(b,c,g,d,h):u.topToBottom(b,c,g,d,h)},calculateIsHorizontalByControlPoint:function(a,b,c,d,e,f){return b<c&&c-b>d-a&&c-b>a-f||b>e&&b-e>d-a&&b-e>a-f?!1:!0},contains:function(a,b,c){return b>=a.x&&b<=a.x+a.width&&c>=a.y&&c<=a.y+a.height},topToBottom:function(a,b,c,d,e){var f=Math.max(a.y,b.y),g=Math.min(a.y+a.height,b.y+b.height),h=c?c.y:g+(f-g)/2,i=a.x+a.width/2,j=b.x+b.width/2;!e&&c&&(c.x>=a.x&&c.x<=a.x+a.width&&(i=c.x),c.x>=b.x&&c.x<=b.x+b.width&&(j=c.x)),!u.contains(b,i,h)&&!u.contains(a,i,h)&&d.add({x:i,y:h}),!u.contains(b,j,h)&&!u.contains(a,j,h)&&d.add({x:j,y:h});if(d.size()===0)if(c)!u.contains(b,c.x,h)&&!u.contains(a,c.x,h)&&d.add({x:c.x,y:h});else{var k=Math.max(a.x,b.x),l=Math.min(a.x+a.width,b.x+b.width);d.add({x:k+(l-k)/2,y:h})}},sideToSide:function(a,b,c,d,e){var f=Math.max(a.x,b.x),g=Math.min(a.x+a.width,b.x+b.width),h=c?c.x:g+(f-g)/2,i=a.y+a.height/2,j=b.y+b.height/2;!e&&c&&(c.y>=a.y&&c.y<=a.y+a.height&&(i=c.y),c.y>=b.y&&c.y<=b.y+b.height&&(j=c.y)),!u.contains(b,h,i)&&!u.contains(a,h,i)&&d.add({x:h,y:i}),!u.contains(b,h,j)&&!u.contains(a,h,j)&&d.add({x:h,y:j});if(d.size()===0)if(c)!u.contains(b,h,c.y)&&!u.contains(a,h,c.y)&&d.add({x:h,y:c.y});else{var k=Math.max(a.y,b.y),l=Math.min(a.y+a.height,b.y+b.height);d.add({x:h,y:k+(l-k)/2})}},flexionalHorizontal:function(a,b,c,d){var e=b.x+b.width<a.x,f=a.x+a.width<b.x,g=e?a.x:a.x+a.width,h=a.y+a.height/2,i=f?b.x:b.x+b.width,j=b.y+b.height/2,k=d,l=e?-k:k,m={x:g+l,y:h};l=f?-k:k;var n={x:i+l,y:j};if(e===f){var o=e?Math.min(g,i)-d:Math.max(g,i)+d;c.add({x:o,y:h}),c.add({x:o,y:j})}else if(m.x<n.x===e){var p=h+(j-h)/2;c.add(m),c.add({x:m.x,y:p}),c.add({x:n.x,y:p}),c.add(n)}else c.add(m),c.add(n)},flexionalVertical:function(a,b,c,d){var e=b.y+b.height<a.y,f=a.y+a.height<b.y,g=a.x+a.width/2,h=e?a.y:a.y+a.height,i=b.x+b.width/2,j=f?b.y:b.y+b.height,k=d,l=e?-k:k,m={x:g,y:h+l};l=f?-k:k;var n={x:i,y:j+l};if(e===f){var o=e?Math.min(h,j)-d:Math.max(h,j)+d;c.add({x:g,y:o}),c.add({x:i,y:o})}else if(m.y<n.y===e){var p=g+(i-g)/2;c.add(m),c.add({x:p,y:m.y}),c.add({x:p,y:n.y}),c.add(n)}else c.add(m),c.add(n)},rectanglePerimeter:function(a,b,c){var d=a.x+a.width/2,e=a.y+a.height/2,f=c.x-d,g=c.y-e,h=Math.atan2(g,f),i={x:0,y:0},j=Math.PI,k=Math.PI/2,l=k-h,m=Math.atan2(a.height,a.width);return h<-j+m||h>j-m?(i.x=a.x,i.y=e-a.width*Math.tan(h)/2):h<-m?(i.y=a.y,i.x=d-a.height*Math.tan(l)/2):h<m?(i.x=a.x+a.width,i.y=e+a.width*Math.tan(h)/2):(i.y=a.y+a.height,i.x=d+a.height*Math.tan(l)/2),c.x>=a.x&&c.x<=a.x+a.width?i.x=c.x:c.y>=a.y&&c.y<=a.y+a.height&&(i.y=c.y),c.x<a.x?i.x=a.x:c.x>a.x+a.width&&(i.x=a.x+a.width),c.y<a.y?i.y=a.y:c.y>a.y+a.height&&(i.y=a.y+a.height),i},isSplitTypeLink:function(a){return a&&(a==="orthogonal"||a==="orthogonal.horizontal"||a==="orthogonal.vertical")},isOrthogonalOrFlexionalLink:function(a){if(a instanceof c.ShapeLink)return!1;if(a.isLooped())return!1;var b=a.getStyle("link.type");return u.isOrthogonalOrFlexionalType(b)},isOrthogonalLink:function(a){if(a instanceof c.ShapeLink)return!1;if(a.isLooped())return!1;var b=a.getStyle("link.type");return u.isOrthogonalType(b)},isOrthogonalOrFlexionalType:function(a){return a==="orthogonal"||a==="orthogonal.horizontal"||a==="orthogonal.H.V"||a==="orthogonal.vertical"||a==="orthogonal.V.H"||a==="extend.top"||a==="extend.left"||a==="extend.bottom"||a==="extend.right"||a==="flexional"||a==="flexional.horizontal"||a==="flexional.vertical"},isOrthogonalType:function(a){return a==="orthogonal"||a==="orthogonal.horizontal"||a==="orthogonal.H.V"||a==="orthogonal.vertical"||a==="orthogonal.V.H"||
a==="extend.top"||a==="extend.left"||a==="extend.bottom"||a==="extend.right"},hasControlPoint:function(a){return a==="orthogonal"||a==="orthogonal.horizontal"||a==="orthogonal.vertical"||a==="extend.bottom"||a==="extend.left"||a==="extend.right"||a==="extend.top"},getControlPoint:function(a,b){if(!a)throw"link can't be null";var c=a.getStyle("link.type");if(!u.hasControlPoint(c))return null;var d=a.getStyle("link.control.point");if(d)return d;var e,f;b==null?(e=a.getFromAgent().getRect(),f=a.getToAgent().getRect()):(e=u.getLinkSourceBounds(b),f=u.getLinkTargetBounds(b));if(e==null||f==null)return null;var g=u.isHorizontal(c,e,f,a);return u.calculateControlPoint(a.getStyle("link.type"),g,e,f,a)},getSplitValueByControlPoint:function(a,b,c,d,e){if(b==="extend.top")return Math.min(c.y,d.y)-a.y;if(b==="extend.left")return Math.min(c.x,d.x)-a.x;if(b==="extend.bottom")return a.y-Math.max(c.y+c.height,d.y+d.height);if(b==="extend.right")return a.x-Math.max(c.x+c.width,d.x+d.width);var f;if(e){var g=c.x+c.x+c.width<d.x+d.x+d.width;return f=g?a.x-c.x+c.width:c.x-a.x,f>0?f:f>-c.width?0:f+c.width}var h=c.y+c.y+c.height<d.y+d.y+d.height;return f=h?a.y-c.y-c.height:c.y-a.y,f>0?f:f>-c.height?0:f+c.height},isHorizontalByControlPoint:function(a,b,c,d,e){var f=l.unionRect(c,d);return l.containsPoint(f,a)?u.isHorizontal(b,c,d,e):u.calculateIsHorizontalByControlPoint(a.x,a.y,f.y,f.x,f.y+f.height,f.x+f.width)},setParamsByControlPoint:function(a,b,c,d,e){var f=u.isHorizontalByControlPoint(a,d,b,c,e),g=e.getStyle("link.control.point");(g||d==="orthogonal"||d==="orthogonal.horizontal"||d==="orthogonal.vertical")&&e.setStyle("link.type",f?"orthogonal.horizontal":"orthogonal.vertical");if(g){e.setStyle("link.control.point",a);return}var h=u.getSplitValueByControlPoint(a,d,b,c,f);if(u.isExtendTypeLink(d)){e.setStyle("link.extend",h);return}var i=u.isSplitByPercent(d,e);if(!i){e.setStyle("link.split.value",h);return}if(h===0){e.setStyle("link.split.percent",0);return}e.setStyle("link.split.percent",u.calculateSplitPercentByControlPoint(a,f,b,c))},getLinkNodeBounds:function(a,b,c,d,e){if(a==null)return null;var f;if(!d){var g=a.getNetwork().getPosition(e,a,null,b,c);f={x:g.x,y:g.y,width:1,height:1}}else f=a.getBodyRect(),f.x+=b,f.y+=c;return f},getLinkSourceBounds:function(a){var b=a._element,c=a.getNetwork().getElementUI(b.getFromAgent());if(c==null)return null;var d=b.getStyle("link.from.position"),e=b.getStyle("link.from.xoffset"),f=b.getStyle("link.from.yoffset"),g=b.getStyle("link.from.at.edge");return u.getLinkNodeBounds(c,e,f,g,d)},getLinkTargetBounds:function(a){var b=a._element,c=a.getNetwork().getElementUI(b.getToAgent());if(c==null)return null;var d=b.getStyle("link.to.position"),e=b.getStyle("link.to.xoffset"),f=b.getStyle("link.to.yoffset"),g=b.getStyle("link.to.at.edge");return u.getLinkNodeBounds(c,e,f,g,d)},orthogonalAndFlexional:function(a,b){var c=u.getLinkSourceBounds(a);if(c==null)return null;var d=u.getLinkTargetBounds(a);if(d==null)return null;var e=u.calculateOrthogonalAndFlexionalLinkPoints(b,c,d,a._element);return u.offsetLink(a,e),a.setHotSpot(u.calculateCenterPoint(e)),b!=="flexional"&&u.drawCorner(e,a._element),e},offsetLink:function(a,b){var c=a._element,e=c.isBundleAgent();if(e)return;var f=u.getBundleGap(a,!1);if(f===0)return;var g,h,i=!1,j=!1,k=b.get(0),l=d.clone(k);for(var m=1,n=b.size();m<n;m++){var o=b.get(m),p=o.x-l.x,q=o.y-l.y;l=d.clone(o),h=u.calculateAngle(p,q);if(p===0)(h-g)%Math.PI===0&&(h-g)%(2*Math.PI)!==0&&(i=!i,i&&(q=-q)),(h-g)%Math.PI!==0&&(k.x+=q<0?f:-f),o.x+=q<0?f:-f;else if(q===0){(h-g)%Math.PI===0&&(h-g)%(2*Math.PI)!==0&&(j=!j,j&&(p=-p));if(!g||(h-g)%Math.PI!==0)k.y-=p<0?f:-f;o.y-=p<0?f:-f}g=h,k=o}}},v={findMoveToBottomDatas:function(a,b,c){for(var d=0;d<c.size();d++){var e=c.get(d);a.contains(e)&&b.add(e)}for(d=0;d<c.size();d++)e=c.get(d),v.findMoveToBottomDatas(a,b,e.getChildren())},findMoveToTopDatas:function(a,b,c){for(var d=0;d<c.size();d++){var e=c.get(c.size()-1-d);a.contains(e)&&b.add(e)}for(d=0;d<c.size();d++)e=c.get(d),v.findMoveToTopDatas(a,b,e.getChildren())},findMoveUpDatas:function(a,b,c){var d=!1;for(var e=0;e<c.size();e++){var f=c.get(e);a.contains(f)?d&&b.add(f):d=!0}for(e=0;e<c.size();e++)f=c.get(e),v.findMoveUpDatas(a,b,f.getChildren())},findMoveDownDatas:function(a,b,c){var d=!1;for(var e=0;e<c.size();e++){var f=c.get(c.size()-1-e);a.contains(f)?d&&b.add(f):d=!0}for(e=0;e<c.size();e++)f=c.get(e),v.findMoveDownDatas(a,b,f.getChildren())}},w={scrollLeft:function(){return w._filterResults(a.pageXOffset?a.pageXOffset:0,document.documentElement?document.documentElement.scrollLeft:0,document.body?document.body.scrollLeft:0)},scrollTop:function(){return w._filterResults(a.pageYOffset?a.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)},_filterResults:function(a,b,c){var d=a?a:0;return b&&(!d||d>b)&&(d=b),c&&(!d||d>c)?c:d},isSingleTouch:function(a){return a.touches&&a.touches.length==1},isMultiTouch:function(a){return a.touches&&a.touches.length>1},getDistance:function(a){if(!w.isMultiTouch(a))return 0;var b=a.touches[0],c=a.touches[1];return Math.sqrt(Math.pow(b.clientX-c.clientX,2)+Math.pow(b.clientY-c.clientY,2))}},x={_string:function(a,b,c){var d=c._stringPool.get();d.style.whiteSpace="nowrap",d.style.verticalAlign="middle",d.style.padding="0px 2px",d.innerHTML=a,d.setAttribute("title",a),b.appendChild(d)},_boolean:function(a,b,c){var d=c._booleanPool.get();b._editInfo?(d._editInfo=b._editInfo,delete b._editInfo,d.disabled=!1):d.disabled=!0,d.type="checkbox",d.style.margin="0px 2px",d.style.verticalAlign="middle",d.checked=a,b.appendChild(d),b.style.textAlign===""&&(b.style.textAlign="center")},_color:function(a,b,c){var d=c._colorPool.get();d.style.width="100%",d.style.height="100%",d.style.backgroundColor=a,d.setAttribute("title",a),b.appendChild(d)},render:function(a,b,c,d){if(b==null)return;var e=x["_"+a];e?e(b,c,d):typeof b=="boolean"?x._boolean(b,c,d):x._string(b,c,d)}},y={toolTipDiv:null,getToolTipDiv:function(){if(!y.toolTipDiv){y.toolTipDiv=document.createElement("div");var a=D,b=y.toolTipDiv.style;b.position="absolute",b.color=a.TOOLTIP_COLOR,b.background=a.TOOLTIP_BACKGROUND,b.fontSize=a.TOOLTIP_FONT_SIZE,b.padding=a.TOOLTIP_PADDING,b.border=a.TOOLTIP_BORDER,b.borderRadius=a.TOOLTIP_BORDER_RADIUS,b.boxShadow=a.TOOLTIP_BOX_SHADOW,b.setProperty&&b.setProperty("-webkit-box-shadow",a.TOOLTIP_BOX_SHADOW,null)}return y.toolTipDiv},isToolTipVisible:function(){return y.getToolTipDiv().parentNode?!0:!1},hideToolTip:function(){var a=y.getToolTipDiv();a.parentNode&&a.parentNode.removeChild(a)},showToolTip:function(a,b){if(!a||!b){y.hideToolTip();return}var c,d,e;a.target?(c=a.clientX,d=a.clientY):(c=a.x,d=a.y),e=y.getToolTipDiv(),e.innerHTML=b,e.style.left=c+D.TOOLTIP_XOFFSET+"px",e.style.top=d+D.TOOLTIP_YOFFSET+"px",e.parentNode||document.body.appendChild(e)}},z={handleClicked:function(a,b,c){c?a.fireInteractionEvent({kind:"clickElement",event:b,element:c}):a.fireInteractionEvent({kind:"clickBackground",event:b})},handleDoubleClicked:function(a,b,e){if(a.isEditingElement())return;e?a.fireInteractionEvent({kind:"doubleClickElement",event:b,element:e}):a.fireInteractionEvent({kind:"doubleClickBackground",event:b}),e?e instanceof c.Link&&a.isDoubleClickToLinkBundle()?e.ISubNetwork&&a.isDoubleClickToSubNetwork()&&!d.isCtrlDown(b)?(a.isDoubleClickToEmptySubNetwork()||e.getChildrenSize()>0)&&a.setCurrentSubNetwork(e,a.isSubNetworkAnimate(),function(){a.fireInteractionEvent({kind:"enterSubNetwork",event:b,element:e})}):e.reverseBundleExpanded()&&a.fireInteractionEvent({kind:"bundleLink",event:b,element:e}):e.ISubNetwork&&a.isDoubleClickToSubNetwork()?(a.isDoubleClickToEmptySubNetwork()||e.getChildrenSize()>0)&&a.setCurrentSubNetwork(e,a.isSubNetworkAnimate(),function(){a.fireInteractionEvent({kind:"enterSubNetwork",event:b,element:e})}):e instanceof F&&a.isDoubleClickToGroupExpand()&&(e.reverseExpanded(),a.fireInteractionEvent({kind:"expandGroup",event:b,element:e})):a.isDoubleClickToUpSubNetwork()&&a.upSubNetwork(a.isSubNetworkAnimate(),function(){a.fireInteractionEvent({kind:"upSubNetwork",event:b})})},handleKeyDown:function(a,b){d.isCtrlDown(b)&&b.keyCode==65?(a.isKeyboardSelectEnabled()&&a.selectAll().size()>0&&a.fireInteractionEvent({kind:"selectAll"}),p.preventDefault(b)):b.keyCode==46?(a.isKeyboardRemoveEnabled()&&a.removeSelection()&&a.fireInteractionEvent({kind:"removeElement"}),p.preventDefault(b)):d.showVersion(b)}},A={_hitCanvas:null,getHitCanvas:function(a,b){this._hitCanvas==null&&(this._hitCanvas=p.createCanvas()),arguments.length==0&&(a=2,b=2),this._hitCanvas.setAttribute("width",""+a-1),this._hitCanvas.setAttribute("height",""+b-1),this._hitCanvas.setAttribute("width",""+a),this._hitCanvas.setAttribute("height",""+b);var c=this.getCtx(this._hitCanvas);return c.clearRect(0,0,a,b),this._hitCanvas},disposeHitCanvas:function(){this._hitCanvas=null},getCtx:function(a){return a.getContext("2d")},render:function(a,c,d){c!=b&&(a.fillStyle=c,a.fill()),d!=b&&(a.strokeStyle=d,a.stroke())},text:function(a,b,c,d,e,f){a.textAlign="center",a.textBaseline="middle",e!=null&&(a.fillStyle=e,a.fillText(b,c,d)),f&&(a.strokeStyle=f,a.strokeText(b,c,d))},circle:function(a,b,c,d,e,f){a.arc(b,c,d,0,2*Math.PI,!0),a.closePath(),this.render(a,e,f)},rect:function(a,b,c,d,e,f,g){a.rect(b,c,d,e),a.closePath(),this.render(a,f,g)},OUT_LEFT:1,OUT_TOP:2,OUT_RIGHT:4,OUT_BOTTOM:8,outcode:function(a,b,c,d,e,f){var g=0;return e<=0?g|=this.OUT_LEFT|this.OUT_RIGHT:a<c?g|=this.OUT_LEFT:a>c+e&&(g|=this.OUT_RIGHT),f<=0?g|=this.OUT_TOP|this.OUT_BOTTOM:b<d?g|=this.OUT_TOP:b>d+f&&(g|=this.OUT_BOTTOM),g},intersectsLine:function(a,b,c,d,e,f,g,h){var i,j;if((j=this.outcode(c,d,e,f,g,h))==0)return!0;while((i=this.outcode(a,b,e,f,g,h))!=0){if((i&j)!=0)return!1;if((i&(this.OUT_LEFT|this.OUT_RIGHT))!=0){var k=e;(i&this.OUT_RIGHT)!=0&&(k+=g),b+=(k-a)*(d-b)/(c-a),a=k}else{var l=f;(i&this.OUT_BOTTOM)!=0&&(l+=h),a+=(l-b)*(c-a)/(d-b),b=l}}return!0}};c.Pool=function(a,b){typeof a=="string"?this.func=function(){return document.createElement(a)}:this.func=a,this.tagName=a,b!=null&&(this.redundancy=b)},d.ext("twaver.Pool",Object,{redundancy:2,currentIndex:-1,get:function(){this.currentIndex++;if(this.currentIndex===this.size()){var a=this.func();return a._pool=this,a.style.margin="0px",a.style.padding="0px",this.list||(this.list=new B),this.list.add(a),a}return this.list.get(this.currentIndex)},release:function(a){this.list&&this.list.remove(a)>=0&&(delete a._selectData,delete a._expandData,delete a._checkData,delete a._editInfo,delete a.keepDefault,a.style.margin="0px",a.style.padding="0px",a.style.backgroundColor="",a.removeAttribute("title"),this.tagName==="img"&&a.removeAttribute&&(a.removeAttribute("width"),a.removeAttribute("height"),a.removeAttribute("src")),this.list.add(a),this.currentIndex--)},reset:function(){this.currentIndex=-1},clear:function(){if(this.list)while(this.redundancy+this.currentIndex<this.list.size()-1)delete this.list.removeAt(this.list.size()-1)._pool},size:function(){return this.list?this.list.size():0}}),c.Util={getVersion:function(){return"1.2"},registerImage:function(a,b,c,e){d.registerImage(a,b,c,e)},unregisterImage:function(a){d.unregisterImage(a)},getImageAsset:function(a){return d.getImageAsset(a)},validateLicense:function(a){d.validateLicense(a)},moveElements:function(a,b,d,e,f){if(b===0&&d===0)return;if(!a||a.isEmpty())return;var g=c.animate.AnimateManager,h,i;g.endAnimate(),a=s.filterMovingElements(a),e&&(h=new B,i=new B),a.forEach(function(a){a instanceof E&&(e?(h.add(a),i.add({x:a.getX()+b,y:a.getY()+d})):a.translate(b,d))}),e?g.start(new c.animate.AnimateLocation(h,i,f)):f&&f()},isTypeOf:function(a,b){if(a===b)return!0;var c=a.superClass;while(c){if(c===b.prototype)return!0;c=c.constructor.superClass}return!1},setFocus:function(a){if(document.activeElement===a)return;var b,c,d=document.documentElement,e=document.body,f;d&&(g.isIE||g.isOpera||d.scrollLeft||d.scrollTop)?(b=d.scrollLeft,c=d.scrollTop,f=d):e&&(b=e.scrollLeft,c=e.scrollTop,f=e),a.focus(),f&&(f.scrollLeft=b,f.scrollTop=c)},isOpera:g.isOpera,isIE:g.isIE,isFirefox:g.isFirefox,isChrome:g.isChrome,isSafari:g.isSafari,isIPhone:g.isIPhone,isIPod:g.isIPod,isIPad:g.isIPad,isAndroid:g.isAndroid,isWebOS:g.isWebOS,isTouchable:g.isTouchable,ext:function(a,b,c){d.ext(a,b,c)},grow:function(a,b,c){l.grow(a,b,c)},containsPoint:function(a,b,c){return l.containsPoint.apply(null,arguments)},intersects:function(a,b){return l.intersects(a,b)},unionRect:function(a,b){return l.unionRect(a,b)},createDiv:function(){return p.createDiv()},createCanvas:function(){return p.createCanvas()},setCanvas:function(a,b,c,d,e){return p.setCanvas.apply(null,arguments)},drawVector:function(a,b,c,d,e,f,g){q.drawVector.apply(null,arguments)},fill:function(a,b,c,d,e,f,g,h){q.fill.apply(null,arguments)},getClass:function(a){return d.getClass(a)},getAllClassNames:function(){var a=[],b;for(b in d.classCache)a.push(b);return a},newInstance:function(a){return d.newInstance.apply(null,arguments)},isDeserializing:function(){return d.isDeserializing},addEventListener:function(a,b,c,d){p.addEventListener(a,b,c,d)},removeEventListener:function(a,b,c){p.removeEventListener(a,b,c)},drawArrow:function(a,b,c,d,e,f,g,h,i,j,k,l){C.drawArrow.apply(null,arguments)},calculatePointAngleAlongLine:function(a,b,c,d,e){return l.calculatePointInfoAlongLineBySegments(a,b,c,d,e)},getSubNetwork:function(a){return s.getSubNetwork(a)}},d.ext("twaver.Util",Object,{});var B=function(){this._as=[];if(arguments.length===1){var a=arguments[0];a instanceof B&&(a=a._as);if(a instanceof Array){var b=a.length;for(var c=0;c<b;c++)this._as.push(a[c])}else a!=null&&this._as.push(a)}else if(arguments.length>1){b=arguments.length;for(c=0;c<b;c++)this._as.push(arguments[c])}};c.List=B,d.ext("twaver.List",Object,{size:function(){return this._as.length},isEmpty:function(){return this._as.length===0},add:function(a,c){return c===b?this._as.push(a):this._as.splice(c,0,a)},addAll:function(a){a instanceof B&&(a=a._as);if(a instanceof Array){var b=a.length;for(var c=0;c<b;c++)this._as.push(a[c])}else this._as.push(a)},get:function(a){return this._as[a]},remove:function(a){var b=this._as.indexOf(a);return b>=0&&b<this._as.length&&this.removeAt(b),b},removeAt:function(a){return this._as.splice(a,1)[0]},set:function(a,b){return this._as[a]=b},clear:function(){return this._as.splice(0,this._as.length)},contains:function(a){return this.indexOf(a)>=0},indexOf:function(a){return this._as.indexOf(a)},forEach:function(a,b){var c=this._as.length;for(var d=0;d<c;d++){var e=this._as[d];b?a.call(b,e):a(e)}},forEachReverse:function(a,b){var c=this._as.length;for(var d=c-1;d>=0;d--){var e=this._as[d];b?a.call(b,e):a(e)}},toArray:function(a,b){if(a){var c=[],d=this._as.length;for(var e=0;e<d;e++){var f=this._as[e];b?a.call(b,f)&&c.push(f):a(f)&&c.push(f)}return c}return this._as.concat()},toList:function(a,b){if(a){var c=new B,d=this._as.length;for(var e=0;e<d;e++){var f=this._as[e];b?a.call(b,f)&&c.add(f):a(f)&&c.add(f)}return c}return new B(this)},sort:function(a){return a?this._as.sort(a):this._as.sort(),this},toString:function(){return this._as.toString()}});var C={shapeMap:{},init:function(){C.register("arrow.standard",C.createStandardArrow()),C.register("arrow.delta",C.createDeltaArrow()),C.register("arrow.diamond",C.createDiamondArrow()),C.register("arrow.short",C.createShortArrow()),C.register("arrow.slant",C.createSlantArrow())},createStandardArrow:function(){var a=new B;return a.add({x:-1,y:-5/9}),a.add({x:-0.75,y:0}),a.add({x:-1,y:5/9}),a.add({x:0,y:0}),a.add({x:-1,y:-5/9}),a},createDeltaArrow:function(){var a=new B;return a.add({x:-1,y:-5/9}),a.add({x:-1,y:5/9}),a.add({x:0,y:0}),a.add({x:-1,y:-5/9}),a},createDiamondArrow:function(){var a=new B;return a.add({x:-7/12,y:5/9}),a.add({x:-14/12,y:0}),a.add({x:-7/12,y:-5/9}),a.add({x:0,y:0}),a.add({x:-7/12,y:5/9}),a},createShortArrow:function(){var a=new B;return a.add({x:-8/12,y:6/9}),a.add({x:-5/12,y:0}),a.add({x:-8/12,y:-6/9}),a.add({x:0,y:0}),a.add({x:-8/12,y:6/9}),a},createSlantArrow:function(){var a=new B;return a.add({x:-1,y:-5/9}),a.add({x:-6.5/12,y:0}),a.add({x:-0.75,y:4/9}),a.add({x:0,y:0}),a.add({x:-1,y:-5/9}),a},register:function(a,b){C.shapeMap[a]=b},getShape:function(a){if(a)return C.shapeMap[a];throw"shape type can't be null"},getArrowRect:function(a,b,c,d,e,f,g){var h=C.getShape(c);if(!h||h.size()<=0)return null;var i=l.calculatePointInfoAlongLine(a,b,f,g),j=i.point,m=i.angle,n=h._as,o,p=n.length,q=new B,r,s;s=new k(d,0,0,e,j.x,j.y);for(o=0;o<p;o++)q.add(s.transform(n[o]));s=l.createMatrix(m+Math.PI,j.x,j.y);for(o=0;o<p;o++)r=q.get(o),r instanceof B&&(r=r._as),r instanceof Array?(r[0]=s.transform(r[0]),r[1]=s.transform(r[1])):q.set(o,s.transform(r));return l.getLineRect(q)},drawArrow:function(a,b,c,d,e,f,g,h,i,j,k,m){i=i||0,j=j||0,k=k||0;var n=k>=0&&m;if(!g&&!n)return;var o=C.getShape(f);if(!o||o.size()<=0)return;var p=l.calculatePointInfoAlongLine(d,e,i,j),q=p.point,r=p.angle;g&&(a.fillStyle=h),a.beginPath(),n&&(a.lineWidth=k,a.strokeStyle=m),C._drawArrow(a,o,r,q,b,c),g&&a.fill(),n&&a.stroke()},_drawArrow:function(a,b,c,d,e,f){b=b._as;var g,h=b.length,i=new B,j,m;m=new k(e,0,0,f,d.x,d.y);for(g=0;g<h;g++)i.add(m.transform(b[g]));i=i._as,m=l.createMatrix(c+Math.PI,d.x,d.y);var n=i[0];n=m.transform(n),a.moveTo(n.x,n.y);for(g=1;g<h;g++)j=i[g],j instanceof B&&(j=j._as),j instanceof Array?(j[0]=m.transform(j[0]),j[1]=m.transform(j[1]),a.quadraticCurveTo(j[0].x,j[0].y,j[1].x,j[1].y)):(j=m.transform(j),a.lineTo(j.x,j.y))},drawLinkArrow:function(a,b,c){if(c.size()<2)return;a._element.getStyle("arrow.from")&&C._drawFromArrow(a,b,c),a._element.getStyle("arrow.to")&&C._drawToArrow(a,b,c)},_drawFromArrow:function(a,b,c){var d=a._element,e=d.getStyle("arrow.from.fill"),f=d.getStyle("arrow.from.outline.width");if(e||f>=0){var g=d.getStyle("arrow.from.width"),h=d.getStyle("arrow.from.height"),i=d.getStyle("arrow.from.xoffset");if(i>0&&i<1){var j;a.getLineLength?j=a.getLineLength():j=a._element.getLineLength(),i*=j}else a.getLineLength&&(i+=C.calculateArrowXOffsetAtEdge(c,a,!0));var k=d.getStyle("arrow.from.yoffset"),l=d.getStyle("arrow.from.shape");C.drawArrow(b,g,h,c,!0,l,e,d.getStyle("arrow.from.color"),i,k,f,d.getStyle("arrow.from.outline.color"))}},_drawToArrow:function(a,b,c){var d=a._element,e=d.getStyle("arrow.to.fill"),f=d.getStyle("arrow.to.outline.width");if(e||f>=0){var g=d.getStyle("arrow.to.width"),h=d.getStyle("arrow.to.height"),i=d.getStyle("arrow.to.xoffset");if(i>0&&i<1){var j;a.getLineLength?j=a.getLineLength():j=a._element.getLineLength(),i*=j}else a.getLineLength&&(i+=C.calculateArrowXOffsetAtEdge(c,a,!1));var k=d.getStyle("arrow.to.yoffset"),l=d.getStyle("arrow.to.shape");C.drawArrow(b,g,h,c,!1,l,e,d.getStyle("arrow.to.color"),i,k,f,d.getStyle("arrow.to.outline.color"))}},calculateArrowXOffsetAtEdge:function(a,b,c){if(a==null||a.size()<2)return 0;var d=b._element,e=c?d.getStyle("arrow.from.at.edge"):d.getStyle("arrow.to.at.edge");if(!e)return 0;var f=c?b._network.getElementUI(d.getFromAgent()):b._network.getElementUI(d.getToAgent());if(!f)return 0;var g=f._bodyRect;if(g==null)return 0;var h=l._getPoint(a.get(c?0:a.size()-1)),i=0,j=b.getLineLength();while(C._containsByInt(g,Math.floor(h.x),Math.floor(h.y),!1)&&i<j)h=l.calculatePointInfoAlongLine(a,c,i++).point;return i},_containsByInt:function(a,c,d,e){return e=e===b?!0:e,e?c>=Math.floor(a.x)&&c<=Math.floor(a.x+a.width)&&d>=Math.floor(a.y)&&d<=Math.floor(a.y+a.height):c>Math.floor(a.x)&&c<Math.floor(a.x+a.width)&&d>Math.floor(a.y)&&d<Math.floor(a.y+a.height)}};C.init(),c.EventDispatcher=function(){},d.ext("twaver.EventDispatcher",null,{contains:function(a,b){if(this._ls)for(var c=0,d=this._ls.size(),e;c<d;c++){e=this._ls.get(c);if(a===e.l&&b===e.s)return!0}return!1},add:function(a,b,c){var d={l:a,s:b,a:c};this._ls||(this._ls=new B),this._f?(this._addPendings||(this._addPendings=new B),this._addPendings.add(d)):d.a?this._ls.add(d,0):this._ls.add(d)},remove:function(a,b){this._ls&&(this._f?(this._removePendings||(this._removePendings=new B),this._removePendings.add({l:a,s:b})):this._remove(a,b))},_remove:function(a,b){for(var c=0,d=this._ls.size(),e;c<d;c++){e=this._ls.get(c);if(e.l===a&&e.s===b){this._ls.removeAt(c);return}}},fire:function(a){if(this._ls){var b,c=this._ls.size(),d;this._f=!0;for(b=0;b<c;b++)d=this._ls.get(b),d.s?d.l.call(d.s,a):d.l(a);this._f=!1;if(this._removePendings){c=this._removePendings.size();for(b=0;b<c;b++)d=this._removePendings.get(b),this._remove(d.l,d.s);delete this._removePendings}if(this._addPendings){c=this._addPendings.size();for(b=0;b<c;b++)d=this._addPendings.get(b),d.a?this._ls.add(d,0):this._ls.add(d);delete this._addPendings}}}}),c.ImageAsset=function(a,b,c,d){this._name=a,this._width=c,this._height=d,typeof b=="string"?this._src=b:typeof b=="function"?this._func=b:this._image=b},d.ext("twaver.ImageAsset",Object,{getName:function(){return this._name},getSrc:function(){return this._src},getImage:function(a){if(!a||!this._image)return this._image;this._map||(this._map={});var b=this._map[a];if(b)return b;var d=c.ImageAsset._getValue(a);return b=c.ImageAsset._getImage(this._image,d,this.getWidth(),this.getHeight()),this._map[a]=b,b},getWidth:function(){return this._width},getHeight:function(){return this._height},getFunction:function(){return this._func}}),c.ImageAsset._canvas=document.createElement("canvas"),c.ImageAsset._colors={},c.ImageAsset._getValue=function(a){var b=c.ImageAsset._colors[a];if(b!=null)return b;var d=c.ImageAsset._canvas;d.width=3,d.height=3;var e=d.getContext("2d");e.clearRect(0,0,3,3),e.fillStyle=a,e.beginPath(),e.rect(0,0,3,3),e.closePath(),e.fill();var f=e.getImageData(1,1,1,1).data;return b=(f[0]<<16)+(f[1]<<8)+f[2],c.ImageAsset._colors[a]=b,b},c.ImageAsset._getImage=function(a,b,c,d){var e=document.createElement("canvas");e.width=c,e.height=d;var f=e.getContext("2d");f.drawImage(a,0,0);try{var g=f.getImageData(0,0,c,d),h=g.data;for(var i=0;n=h.length,i<n;i+=4){var j=h[i+0],k=h[i+1],l=h[i+2],m=j*77+k*151+l*28>>8;m=m<<16|m<<8|m,m&=b,h[i+0]=m>>16&255,h[i+1]=m>>8&255,h[i+2]=m&255}f.putImageData(g,0,0)}catch(o){return a}return e};var D={COLORS:["#6495ED","#FFFF00","#00FFFF","#FF0000","#7FFF00","#E0A580","#5FC0CB","#FA00F0","#A1BC50","#FFD700","#4169E1","#E5A5F5","#1E90FF","#696969","#FF6347","#00BFEF","#FFD700","#80E090","#5F9EA0","#A000FF","#7FAF00","#228BA2","#FF00FF","#7FFFD4","#800000","#0000CD","#20B2AA","#D2691E","#6495BD","#DC143C","#F0A8AF","#008B8B","#800080","#B8860B","#4B0082","#00FF00","#FFA500","#FF4500","#FFFF00","#9ACD32","#00008B","#FF1493","#ADFF2F","#4682B4","#00C0B1"],CALL_LATER_DELAY:17,SCROLL_BAR_WIDTH:17,SELECT_COLOR:"#C2CFF1",FOCUS_ON_CLICK:!0,VIEW_POSITION:"absolute",VIEW_FONT_SIZE:"12px",VIEW_FONT_FAMILY:"arial, tahoma, sans-serif, helvetica",TOOLTIP_BACKGROUND:"lightyellow",TOOLTIP_FONT_SIZE:"12px",TOOLTIP_COLOR:"black",TOOLTIP_PADDING:"4px 8px",TOOLTIP_BORDER:"1px solid gray",TOOLTIP_BORDER_RADIUS:"6px",TOOLTIP_XOFFSET:12,TOOLTIP_YOFFSET:12,TOOLTIP_BOX_SHADOW:"0px 0px 3px #AAA",ZOOM_MAX:5,ZOOM_MIN:.1,ZOOM_INCREMENT:1.3,ZOOM_ANIMATE:!0,COLUMN_WIDTH:80,COLUMN_HORIZONTAL_ALIGN:"",COLUMN_PROPERTY_TYPE:"accessor",COLUMN_VALUE_TYPE:"string",COLUMN_EDITABLE:!1,COLUMN_SORTABLE:!0,COLUMN_VISIBLE:!0,COLUMN_RESIZABLE:!0,COLUMN_MOVABLE:!0,COLUMN_RENDER_CELL:null,COLUMN_RENDER_HEADER:null,PROPERTY_HORIZONTAL_ALIGN:"",PROPERTY_PROPERTY_TYPE:"accessor",PROPERTY_VALUE_TYPE:"string",PROPERTY_EDITABLE:!1,PROPERTY_CATEGORY_NAME:null,PROPERTY_RENDER_NAME:null,PROPERTY_RENDER_VALUE:null,TAB_WIDTH:100,TAB_CLOSABLE:!1,TAB_RESIZABLE:!0,TAB_MOVABLE:!0,TAB_DISABLED:!1,TAB_VISIBLE:!0,ACCORDION_EXPAND_ICON:"expand_icon",ACCORDION_COLLAPSE_ICON:"collapse_icon",ACCORDION_TITLE_HEIGHT:20,ACCORDION_TITLE_BACKGROUND:"#EBEBEB",ACCORDION_BORDER_BOTTOM_COLOR:"lightgray",TITLEPANE_TITLE_HEIGHT:20,TITLEPANE_TITLE_BACKGROUND:"#DDD",TITLEPANE_TITLE_HORIZONTAL_ALIGN:"left",BORDERPANE_HGAP:0,BORDERPANE_VGAP:0,CHARTPANE_TITLE_HEIGHT:20,CHARTPANE_TITLE_HORIZONTAL_ALIGN:"center",CHARTPANE_LEGEND_ORIENTATION:"bottom",CHARTPANE_LEGEND_WIDTH:80,LEGENDPANE_ICON_WIDTH:10,LEGENDPANE_ICON_HEIGHT:10,LEGENDPANE_ICON_RADIUS:0,LEGENDPANE_ROW_HEIGHT:20,LEGENDPANE_ORIENTATION:"horizontal",LEGENDPANE_HIDDEN_COLOR:"#BABBBC",LEGENDPANE_SELECT_BACKGROUND_COLOR:"#00007D",LEGENDPANE_SELECT_FOREGROUND_COLOR:"#FFFFFF",CHART_TOOLTIP_ENABLED:!0,CHART_SELECT_TOLERANCE:0,CHART_XGAP:6,CHART_YGAP:6,CHART_XZOOM_ENABLED:!0,CHART_YZOOM_ENABLED:!0,CHART_XTRANSLATE_ENABLED:!0,CHART_YTRANSLATE_ENABLED:!0,CHART_DOUBLE_CLICK_TO_RESET:!0,CHART_VALUE_VISIBLE:!0,CHART_VALUE_FONT:null,CHART_BACKGROUND_VISIBLE:!1,CHART_BACKGROUND_FILL:!0,CHART_BACKGROUND_FILL_COLOR:"rgba(50,50,50,0.11)",CHART_BACKGROUND_OUTLINE_WIDTH:1,CHART_BACKGROUND_OUTLINE_COLOR:"rgba(50,50,50,0.11)",CHART_BACKGROUND_GRADIENT:"linear.north",CHART_BACKGROUND_GRADIENT_COLOR:"#FFFFFF",PIECHART_TYPE:"oval",PIECHART_START_ANGLE:0,PIECHART_SELECT_OFFSET:5,PIECHART_SHADOW_OFFSET:1,PIECHART_SHADOW_COLOR:"#C2CFF1",PIECHART_LINE_RATE:.5,PIECHART_DONUT_RATE:.5,PIECHART_VALUE_POSITION:.5,BARCHART_TYPE:"default",BARCHART_UPPER_LIMIT:null,BARCHART_LOWER_LIMIT:0,BARCHART_XAXIS_LINE_COLOR:"#808080",BARCHART_XAXIS_LINE_WIDTH:1,BARCHART_XAXIS_TEXT_COLOR:"#000000",BARCHART_XAXIS_TEXT_FONT:null,BARCHART_YAXIS_LINE_COLOR:"#808080",BARCHART_YAXIS_LINE_WIDTH:1,BARCHART_YAXIS_TEXT_COLOR:"#000000",BARCHART_YAXIS_TEXT_FONT:null,BARCHART_XSCALE_TEXT_FONT:null,BARCHART_XSCALE_TEXT_COLOR:"#000000",BARCHART_XSCALE_TEXT_ORIENTATION:"horizontal",BARCHART_YSCALE_TEXT_VISIBLE:!0,BARCHART_YSCALE_TEXT_COLOR:"#000000",BARCHART_YSCALE_TEXT_FONT:null,BARCHART_YSCALE_LINE_COLOR:"#808080",BARCHART_YSCALE_LINE_WIDTH:.3,BARCHART_YSCALE_VALUE_GAP:0,BARCHART_YSCALE_PIXEL_GAP:20,BARCHART_YSCALE_MIN_TEXT_VISIBLE:!1,LINECHART_INTERRUPTABLE:!0,LINECHART_UPPER_LIMIT:null,LINECHART_LOWER_LIMIT:null,LINECHART_XAXIS_LINE_COLOR:"#808080",LINECHART_XAXIS_LINE_WIDTH:1,LINECHART_XAXIS_TEXT_COLOR:"#000000",LINECHART_XAXIS_TEXT_FONT:null,LINECHART_YAXIS_LINE_COLOR:"#808080",LINECHART_YAXIS_LINE_WIDTH:1,LINECHART_YAXIS_TEXT_COLOR:"#000000",LINECHART_YAXIS_TEXT_FONT:null,LINECHART_XSCALE_TEXT_FONT:null,LINECHART_XSCALE_TEXT_COLOR:"#000000",LINECHART_XSCALE_TEXT_ORIENTATION:"horizontal",LINECHART_XSCALE_LINE_COLOR:"#808080",LINECHART_XSCALE_LINE_WIDTH:.3,LINECHART_YSCALE_TEXT_VISIBLE:!0,LINECHART_YSCALE_TEXT_COLOR:"#000000",LINECHART_YSCALE_TEXT_FONT:null,LINECHART_YSCALE_LINE_COLOR:"#808080",LINECHART_YSCALE_LINE_WIDTH:.3,LINECHART_YSCALE_VALUE_GAP:0,LINECHART_YSCALE_PIXEL_GAP:20,LINECHART_YSCALE_MIN_TEXT_VISIBLE:!1,BUBBLECHART_UPPER_LIMIT:null,BUBBLECHART_LOWER_LIMIT:null,BUBBLECHART_XAXIS_UPPER_LIMIT:null,BUBBLECHART_XAXIS_LOWER_LIMIT:null,BUBBLECHART_XAXIS_LINE_COLOR:"#808080",BUBBLECHART_XAXIS_LINE_WIDTH:1,BUBBLECHART_XAXIS_TEXT_COLOR:"#000000",BUBBLECHART_XAXIS_TEXT_FONT:null,BUBBLECHART_YAXIS_LINE_COLOR:"#808080",BUBBLECHART_YAXIS_LINE_WIDTH:1,BUBBLECHART_YAXIS_TEXT_COLOR:"#000000",BUBBLECHART_YAXIS_TEXT_FONT:null,BUBBLECHART_XSCALE_TEXT_FONT:null,BUBBLECHART_XSCALE_TEXT_COLOR:"#000000",BUBBLECHART_XSCALE_TEXT_ORIENTATION:"horizontal",BUBBLECHART_XSCALE_LINE_COLOR:"#808080",BUBBLECHART_XSCALE_LINE_WIDTH:.3,BUBBLECHART_YSCALE_TEXT_VISIBLE:!0,BUBBLECHART_YSCALE_TEXT_COLOR:"#000000",BUBBLECHART_YSCALE_TEXT_FONT:null,BUBBLECHART_YSCALE_LINE_COLOR:"#808080",BUBBLECHART_YSCALE_LINE_WIDTH:.3,BUBBLECHART_YSCALE_VALUE_GAP:0,BUBBLECHART_YSCALE_PIXEL_GAP:20,BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE:!1,BUBBLECHART_SELECT_SHADOW_COLOR:"#000000",BUBBLECHART_SELECT_SHADOW_OFFSET:3,RADARCHART_AXIS_TEXT_FONT:null,RADARCHART_AXIS_TEXT_COLOR:"#000000",RADARCHART_AXIS_TEXT_VISIBLE:!0,RADARCHART_SCALE_TEXT_FONT:null,RADARCHART_SCALE_TEXT_COLOR:"#000000",RADARCHART_SCALE_TEXT_VISIBLE:!0,RADARCHART_AXIS_VISIBLE:!0,RADARCHART_AXIS_LINE_COLOR:"#808080",RADARCHART_AXIS_LINE_WIDTH:3,RADARCHART_AXIS_START_ANGLE:0,RADARCHART_RING_VISIBLE:!0,RADARCHART_RING_TYPE:"line",RADARCHART_RING_LINE_COLOR:"#808080",RADARCHART_RING_LINE_WIDTH:1,RADARCHART_SCALE_COUNT:5,RADARCHART_SCALE_MAXVALUE:1,RADARCHART_SCALE_MINVALUE:0,RADARCHART_ANCHOR_VISIBLE:!0,RADARCHART_AREA_FILL:!0,RADARCHART_AREA_FILL_ALPHA:.2,RADARCHART_AREA_SELECT_FILL_ALPHA:.5,DIALCHART_UPPER_LIMIT:100,DIALCHART_LOWER_LIMIT:0,DIALCHART_START_ANGLE:0,DIALCHART_END_ANGLE:360,DIALCHART_INNER_RADIUS:.8,DIALCHART_COLOR_RANGE_FILL_COLOR:"#808080",DIALCHART_OUTLINE_WIDTH:0,DIALCHART_OUTLINE_COLOR:"#808080",DIALCHART_SCALE_INSIDE:!0,DIALCHART_MAJOR_SCALE_COUNT:11,DIALCHART_MAJOR_SCALE_LINE_WIDTH:2,DIALCHART_MAJOR_SCALE_LINE_LENGTH:8,DIALCHART_MAJOR_SCALE_LINE_COLOR:"#000000",DIALCHART_MINOR_SCALE_COUNT:4,DIALCHART_MINOR_SCALE_LINE_WIDTH:1,DIALCHART_MINOR_SCALE_LINE_LENGTH:4,DIALCHART_MINOR_SCALE_LINE_COLOR:"#000000",DIALCHART_SCALE_TEXT_VISIBLE:!0,DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE:!0,DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE:!0,DIALCHART_SCALE_TEXT_FONT:null,DIALCHART_SCALE_TEXT_COLOR:"#000000",DIALCHART_PIVOT_RADIUS:10,DIALCHART_PIVOT_FILL:!0,DIALCHART_PIVOT_FILL_COLOR:"#808080",DIALCHART_PIVOT_OUTLINE_WIDTH:0,DIALCHART_PIVOT_OUTLINE_COLOR:"#808080",DIALCHART_VALUE_POSITION:.5,DIALCHART_INNER_DARKER_RADIUS:10,DIALCHART_OUTER_BRIGHTER_RADIUS:10,DIALCHART_SELECT_SHADOW_COLOR:"#000000",DIALCHART_SELECT_SHADOW_OFFSET:3,TABPANE_TAB_GAP:1,TABPANE_TAB_RADIUS:0,TABPANE_TAB_HEIGHT:24,TABPANE_TAB_ORIENTATION:"top",TABPANE_RESIZE_TOLERANCE:3,TABPANE_TAB_BACKGROUND:"#EBEBEB",TABPANE_DISABLED_COLOR:"#BABBBC",TABPANE_SELECT_BACKGROUND:"white",TABPANE_MOVE_BACKGROUND:"rgba(184,211,240,0.7)",TABPANE_INSERT_BACKGROUND:"orange",TABPANE_HORIZONTAL_ALIGN:"center",TABPANE_CLOSE_ICON:"close_icon",TABPANE_SELECT_NEXT_ON_CLOSE:!0,TABPANE_SELECT_NEXT_ON_INVISIBLE:!0,LIST_ROW_HEIGHT:19,LIST_INDENT:2,LIST_ROW_LINE_WIDTH:0,LIST_ROW_LINE_COLOR:"#DDD",LIST_MAKE_VISIBLE_ON_SELECTED:!0,LIST_KEYBOARD_REMOVE_ENABLED:!0,LIST_KEYBOARD_SELECT_ENABLED:!0,TREE_ROW_HEIGHT:19,TREE_INDENT:16,TREE_ROW_LINE_WIDTH:0,TREE_ROW_LINE_COLOR:"#DDD",TREE_MAKE_VISIBLE_ON_SELECTED:!0,TREE_KEYBOARD_REMOVE_ENABLED:!0,TREE_KEYBOARD_SELECT_ENABLED:!0,TREE_EXPAND_ICON:"expand_icon",TREE_COLLAPSE_ICON:"collapse_icon",TABLE_ROW_HEIGHT:19,TABLE_ROW_LINE_WIDTH:1,TABLE_ROW_LINE_COLOR:"#DDD",TABLE_COLUMN_LINE_WIDTH:1,TABLE_COLUMN_LINE_COLOR:"#DDD",TABLE_MAKE_VISIBLE_ON_SELECTED:!0,TABLE_KEYBOARD_REMOVE_ENABLED:!0,TABLE_KEYBOARD_SELECT_ENABLED:!0,TABLE_EDITABLE:!1,TABLEHEADER_HEIGHT:24,TABLEHEADER_RESIZE_TOLERANCE:3,TABLEHEADER_BACKGROUND:"#EBEBEB",TABLEHEADER_MOVE_BACKGROUND:"rgba(184,211,240,0.7)",TABLEHEADER_INSERT_BACKGROUND:"orange",TABLEHEADER_COLUMN_LINE_COLOR:"#DDD",TABLEHEADER_SORT_DESC_ICON:"sort_desc",TABLEHEADER_SORT_ASC_ICON:"sort_asc",TABLEHEADER_SORT_ICON_POSITION:"98% 50%",TREETABLE_ROW_HEIGHT:19,TREETABLE_INDENT:16,TREETABLE_ROW_LINE_WIDTH:1,TREETABLE_ROW_LINE_COLOR:"#DDD",TREETABLE_COLUMN_LINE_WIDTH:1,TREETABLE_COLUMN_LINE_COLOR:"#DDD",TREETABLE_MAKE_VISIBLE_ON_SELECTED:!0,TREETABLE_KEYBOARD_REMOVE_ENABLED:!0,TREETABLE_KEYBOARD_SELECT_ENABLED:!0,TREETABLE_EXPAND_ICON:"expand_icon",TREETABLE_COLLAPSE_ICON:"collapse_icon",TREETABLE_EDITABLE:!1,PROPERTYSHEET_AUTO_ADJUSTABLE:!0,PROPERTYSHEET_INDENT:16,PROPERTYSHEET_ROW_HEIGHT:19,PROPERTYSHEET_ROW_LINE_WIDTH:1,PROPERTYSHEET_COLUMN_LINE_WIDTH:1,PROPERTYSHEET_BORDER_COLOR:"#EBEBEB",PROPERTYSHEET_EXPAND_ICON:"expand_icon",PROPERTYSHEET_COLLAPSE_ICON:"collapse_icon",PROPERTYSHEET_PROPERTY_NAME_WIDTH:100,PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN:"",PROPERTYSHEET_SUM_WIDTH:200,PROPERTYSHEET_RESIZE_TOLERANCE:3,PROPERTYSHEET_EDITABLE:!1,PROPERTYSHEET_CATEGORIZABLE:!0,PROPERTYSHEET_EXPAND_CATEGORY:!0,SPLITPANE_ORIENTATION:"horizontal",SPLITPANE_POSITION:.5,SPLITPANE_DIVIDER_WIDTH:6,SPLITPANE_DIVIDER_BACKGROUND:"#CCCCFF",SPLITPANE_DIVIDER_OPACITY:.5,SPLITPANE_MASK_BACKGROUND:"",NODE_WIDTH:50,NODE_HEIGHT:50,IMAGE_NODE:"node_image",IMAGE_GROUP:"group_image",IMAGE_SUBNETWORK:"subnetwork_image",ICON_DATABOX:"databox_icon",ICON_DATA:"data_icon",ICON_NODE:"node_icon",ICON_LINK:"link_icon",ICON_GROUP:"group_icon",ICON_SUBNETWORK:"subnetwork_icon",ICON_GRID:"grid_icon",ICON_BUS:"bus_icon",ICON_SHAPENODE:"shapenode_icon",ICON_SHAPELINK:"shapelink_icon",ICON_LINKSUBNETWORK:"linksubnetwork_icon",ICON_SHAPESUBNETWORK:"shapesubnetwork_icon",LAYER_DEFAULT_ID:"default",LAYER_DEFAULT_NAME:"default",ATTACHMENT_POINTER_LENGTH:10,ATTACHMENT_POINTER_WIDTH:8,ATTACHMENT_CORNER_RADIUS:5,ATTACHMENT_CONTENT_WIDTH:30,ATTACHMENT_CONTENT_HEIGHT:20,ATTACHMENT_POSITION:"topright.topright",ATTACHMENT_XOFFSET:0,ATTACHMENT_YOFFSET:0,ATTACHMENT_PADDING:0,ATTACHMENT_PADDING_LEFT:0,ATTACHMENT_PADDING_RIGHT:0,ATTACHMENT_PADDING_TOP:0,ATTACHMENT_PADDING_BOTTOM:0,ATTACHMENT_DIRECTION:"right",ATTACHMENT_FILL:!1,ATTACHMENT_FILL_COLOR:"#000000",ATTACHMENT_GRADIENT:null,ATTACHMENT_GRADIENT_COLOR
:"#FFFFFF",ATTACHMENT_OUTLINE_WIDTH:-1,ATTACHMENT_OUTLINE_COLOR:"#000000",ATTACHMENT_CAP:"butt",ATTACHMENT_JOIN:"miter",ATTACHMENT_SHADOWABLE:!0,NETWORK_TOOLTIP_ENABLED:!0,NETWORK_SELECT_MODE:"mix",NETWORK_MAKE_VISIBLE_ON_SELECTED:!0,NETWORK_NO_AGENT_LINK_VISIBLE:!1,NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE:!1,NETWORK_SUBNETWORK_ANIMATE:!0,NETWORK_SENDTOTOP_ON_SELECTED:!0,NETWORK_KEYBOARD_REMOVE_ENABLED:!0,NETWORK_KEYBOARD_SELECT_ENABLED:!0,NETWORK_RECT_SELECT_ENABLED:!0,NETWORK_DOUBLECLICK_TO_SUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_UPSUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_LINKBUNDLE:!0,NETWORK_DOUBLECLICK_TO_GROUPEXPAND:!0,NETWORK_SELECT_OUTLINE_COLOR:"#2877A8",NETWORK_SELECT_OUTLINE_WIDTH:1,NETWORK_SELECT_FILL_COLOR:"rgba(184,211,240,0.4)",NETWORK_LAZYMOVE_OUTLINE_COLOR:"#2877A8",NETWORK_LAZYMOVE_OUTLINE_WIDTH:1,NETWORK_LAZYMOVE_FILL_COLOR:"rgba(184,211,240,0.4)",NETWORK_LAZYMOVE_FILL:!0,NETWORK_LAZYMOVE_ANIMATE:!0,NETWORK_RESIZE_POINT_FILL_COLOR:"#FFFFFF",NETWORK_RESIZE_POINT_OUTLINE_COLOR:"#000000",NETWORK_RESIZE_POINT_OUTLINE_WIDTH:1,NETWORK_RESIZE_LINE_COLOR:"#000000",NETWORK_RESIZE_LINE_WIDTH:1,NETWORK_RESIZE_ANIMATE:!0,NETWORK_EDIT_POINT_SIZE:3,NETWORK_EDIT_POINT_FILL_COLOR:"#FFFF00",NETWORK_EDIT_POINT_OUTLINE_COLOR:"#000000",NETWORK_EDIT_POINT_OUTLINE_WIDTH:1,NETWORK_EDIT_LINE_COLOR:"rgba(184,211,240,0.7)",NETWORK_EDIT_LINE_WIDTH:2,OVERVIEW_FILL_COLOR:"rgba(184,211,240,0.4)",OVERVIEW_OUTLINE_COLOR:"#B8D3F0",OVERVIEW_OUTLINE_WIDTH:1,OVERVIEW_SELECT_COLOR:"#0000FF",OVERVIEW_SELECT_WIDTH:1,OVERVIEW_PADDING:1,OVERVIEW_ANIMATE:!0,OVERVIEW_MAX_PACKING_WIDTH:-1,OVERVIEW_MAX_PACKING_HEIGHT:-1,LINK_BUNDLE_AGENT_FUNCTION:null,ELEMENTUI_FUNCTION:function(a,b){var c=b.getElementUIClass();return c?new c(a,b):null},CANVASUI_FUNCTION:function(a,b){var c=b.getCanvasUIClass();return c?new c(a,b):null},SORT_FUNCTION:function(a,c){if(a===c)return 0;if(a==null&&c!=null)return 1;if(a!=null&&c==null)return-1;if(a==null&&c==null)return 0;var d=typeof a,e=typeof c,f;return d==="string"&&e==="string"&&(f=a.localeCompare(c)),d==="number"&&e==="number"&&(f=a-c),f===b&&(f=(""+a).localeCompare(""+c)),f>0?1:f<0?-1:0}};(function(){var b=D;if(a.OverrideTWaverDefaults)for(var c in OverrideTWaverDefaults)b[c]=OverrideTWaverDefaults[c];b.VIEW_FONT_SIZE&&b.VIEW_FONT_FAMILY?b.FONT=b.VIEW_FONT_SIZE+" "+b.VIEW_FONT_FAMILY:b.FONT=document.createElement("canvas").getContext("2d").font,b.CHART_VALUE_FONT||(b.CHART_VALUE_FONT="10px "+b.VIEW_FONT_FAMILY),b.BARCHART_XSCALE_TEXT_FONT||(b.BARCHART_XSCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.BARCHART_YSCALE_TEXT_FONT||(b.BARCHART_YSCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.BARCHART_XAXIS_TEXT_FONT||(b.BARCHART_XAXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.BARCHART_YAXIS_TEXT_FONT||(b.BARCHART_YAXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.LINECHART_XSCALE_TEXT_FONT||(b.LINECHART_XSCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.LINECHART_YSCALE_TEXT_FONT||(b.LINECHART_YSCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.LINECHART_XAXIS_TEXT_FONT||(b.LINECHART_XAXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.LINECHART_YAXIS_TEXT_FONT||(b.LINECHART_YAXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.BUBBLECHART_XAXIS_TEXT_FONT||(b.BUBBLECHART_XAXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.BUBBLECHART_YAXIS_TEXT_FONT||(b.BUBBLECHART_YAXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.BUBBLECHART_XSCALE_TEXT_FONT||(b.BUBBLECHART_XSCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.BUBBLECHART_YSCALE_TEXT_FONT||(b.BUBBLECHART_YSCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.RADARCHART_AXIS_TEXT_FONT||(b.RADARCHART_AXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.RADARCHART_SCALE_TEXT_FONT||(b.RADARCHART_SCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.DIALCHART_SCALE_TEXT_FONT||(b.DIALCHART_SCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY)})(),c.Defaults=D,d.ext("twaver.Defaults",Object,{}),c.SerializationSettings=function(){var a=c.SerializationSettings;this.isDataBoxSerializable=a.isDataBoxSerializable,this.isLayerBoxSerializable=a.isLayerBoxSerializable,this.isStyleSerializable=a.isStyleSerializable,this.isClientSerializable=a.isClientSerializable,this._pm=d.clone(a._pm),this._sm=d.clone(a._sm),this._cm=d.clone(a._cm)},function(){var a=c.SerializationSettings;a.isDataBoxSerializable=!0,a.isLayerBoxSerializable=!0,a.isStyleSerializable=!0,a.isClientSerializable=!0,a._pm={},a._sm={},a._cm={},a.setPropertyType=function(b,c){a._pm[b]=c},a.getPropertyType=function(b){return a._pm[b]},a.setStyleType=function(b,c){a._sm[b]=c},a.getStyleType=function(b){return a._sm[b]},a.setClientType=function(b,c){a._cm[b]=c},a.getClientType=function(b){return a._cm[b]}}(),d.ext("twaver.SerializationSettings",Object,{setPropertyType:function(a,b){this._pm[a]=b},getPropertyType:function(a){return this._pm[a]},setStyleType:function(a,b){this._sm[a]=b},getStyleType:function(a){return this._sm[a]},setClientType:function(a,b){this._cm[a]=b},getClientType:function(a){return this._cm[a]}}),c.Styles={_m:{},setStyle:function(a,b){b==null?delete c.Styles._m[a]:c.Styles._m[a]=b},getStyle:function(a){return c.Styles._m[a]},getStyleProperties:function(){return d.keys(c.Styles._m)}},function(){var a=function(a,b){c.SerializationSettings.setPropertyType(a,b)};a("name","cdata"),a("icon","string"),a("toolTip","cdata"),a("parent","data"),a("layerId","string"),a("alarmState","alarmstate"),a("image","string"),a("location","point"),a("width","number"),a("height","number"),a("expanded","boolean"),a("host","data"),a("fromNode","data"),a("toNode","data"),a("points","list.point"),a("segments","list.string"),a("angle","number"),a=function(a,b,d){d==null&&(b!=null?d=typeof b:d="string"),c.Styles.setStyle(a,b),c.SerializationSettings.setStyleType(a,d)},a("chart.color",null),a("chart.value",0),a("chart.values",null,"list.number"),a("chart.value.color","#000000"),a("chart.value.font",null),a("chart.line.width",2),a("chart.marker.size",6),a("chart.marker.shape","circle"),a("chart.bubble.shape","circle"),a("chart.names",null,"list.string"),a("chart.xaxis.values",null,"list.number"),a("chart.yaxis.values",null,"list.number"),a("dialchart.rear.extension",0),a("dialchart.base.width",5),a("dialchart.top.width",0),a("dialchart.radius",.8),a("inner.color",null),a("outer.shape","rectangle"),a("outer.color",null),a("outer.width",2),a("outer.padding",1),a("outer.padding.left",0),a("outer.padding.right",0),a("outer.padding.top",0),a("outer.padding.bottom",0),a("outer.cap","butt"),a("outer.join","miter"),a("shadow.color",null),a("shadow.xoffset",3),a("shadow.yoffset",3),a("shadow.blur",6),a("select.style","shadow"),a("select.color","rgba(0, 0, 0, 0.7)"),a("select.shape","rectangle"),a("select.width",2),a("select.padding",2),a("select.padding.left",0),a("select.padding.right",0),a("select.padding.top",0),a("select.padding.bottom",0),a("select.cap","butt"),a("select.join","miter"),a("whole.alpha",1),a("body.type","default"),a("network.label",null,"cdata"),a("image.padding",0),a("image.padding.left",0),a("image.padding.right",0),a("image.padding.top",0),a("image.padding.bottom",0),a("vector.shape","rectangle"),a("vector.fill",!0),a("vector.fill.color","#CCCCFF"),a("vector.outline.width",-1),a("vector.outline.pattern",null,"array.number"),a("vector.outline.color","#5B5B5B"),a("vector.gradient","none"),a("vector.gradient.color","#FFFFFF"),a("vector.padding",0),a("vector.padding.left",0),a("vector.padding.right",0),a("vector.padding.top",0),a("vector.padding.bottom",0),a("vector.cap","butt"),a("vector.join","miter"),a("vector.deep",0),a("group.shape","rectangle"),a("group.fill",!0),a("group.fill.color","#CCCCFF"),a("group.outline.width",-1),a("group.outline.color","#5B5B5B"),a("group.gradient","none"),a("group.gradient.color","#FFFFFF"),a("group.padding",5),a("group.padding.left",0),a("group.padding.right",0),a("group.padding.top",0),a("group.padding.bottom",0),a("group.cap","butt"),a("group.join","miter"),a("group.deep",1),a("label.alpha",1),a("label.color","#000000"),a("label.font",null),a("label.position","bottom.bottom"),a("label.direction","below"),a("label.corner.radius",0),a("label.pointer.length",0),a("label.pointer.width",8),a("label.xoffset",0),a("label.yoffset",2),a("label.padding",0),a("label.padding.left",0),a("label.padding.right",0),a("label.padding.top",0),a("label.padding.bottom",0),a("label.fill",!1),a("label.fill.color","#C0C0C0"),a("label.gradient","none"),a("label.gradient.color","#FFFFFF"),a("label.outline.width",-1),a("label.outline.color","#000000"),a("label.cap","butt"),a("label.join","miter"),a("label.shadowable",!0),a("icons.names",null,"array.string"),a("icons.colors",null,"array.string"),a("icons.position","topleft.bottomright"),a("icons.orientation","right"),a("icons.xoffset",0),a("icons.yoffset",0),a("icons.xgap",1),a("icons.ygap",1),a("alarm.alpha",1),a("alarm.color","#000000"),a("alarm.font",null),a("alarm.position","hotspot"),a("alarm.direction","aboveright"),a("alarm.corner.radius",5),a("alarm.pointer.length",10),a("alarm.pointer.width",8),a("alarm.xoffset",0),a("alarm.yoffset",0),a("alarm.padding",0),a("alarm.padding.left",0),a("alarm.padding.right",0),a("alarm.padding.top",0),a("alarm.padding.bottom",0),a("alarm.gradient","none"),a("alarm.gradient.color","#FFFFFF"),a("alarm.outline.width",-1),a("alarm.outline.color","#000000"),a("alarm.cap","butt"),a("alarm.join","miter"),a("alarm.shadowable",!0),a("link.color","#658DC1"),a("link.width",3),a("link.cap","butt"),a("link.join","miter"),a("link.type","arc"),a("link.pattern",null,"array.number"),a("link.extend",20),a("link.control.point",null,"point"),a("link.bundle.id",0),a("link.bundle.enable",!0),a("link.bundle.expanded",!0),a("link.bundle.independent",!1),a("link.bundle.offset",20),a("link.bundle.gap",12),a("link.looped.gap",6),a("link.looped.direction","northwest"),a("link.looped.type","arc"),a("link.from.position","center"),a("link.from.xoffset",0),a("link.from.yoffset",0),a("link.from.at.edge",!0),a("link.to.position","center"),a("link.to.xoffset",0),a("link.to.yoffset",0),a("link.to.at.edge",!0),a("link.split.by.percent",!0),a("link.split.percent",.5),a("link.split.value",20),a("link.corner","round"),a("link.xradius",8),a("link.yradius",8),a("link.handler.alpha",1),a("link.handler.color","#000000"),a("link.handler.font",null),a("link.handler.position","topleft.topleft"),a("link.handler.direction","below"),a("link.handler.corner.radius",0),a("link.handler.pointer.length",0),a("link.handler.pointer.width",8),a("link.handler.xoffset",0),a("link.handler.yoffset",0),a("link.handler.padding",0),a("link.handler.padding.left",0),a("link.handler.padding.right",0),a("link.handler.padding.top",0),a("link.handler.padding.bottom",0),a("link.handler.fill",!1),a("link.handler.fill.color","#C0C0C0"),a("link.handler.gradient","none"),a("link.handler.gradient.color","#FFFFFF"),a("link.handler.outline.width",-1),a("link.handler.outline.color","#000000"),a("link.handler.cap","butt"),a("link.handler.join","miter"),a("link.handler.shadowable",!0),a("follower.row.index",0),a("follower.column.index",0),a("follower.row.span",1),a("follower.column.span",1),a("follower.padding",0),a("follower.padding.left",0),a("follower.padding.right",0),a("follower.padding.top",0),a("follower.padding.bottom",0),a("grid.row.count",1),a("grid.column.count",1),a("grid.row.percents",null,"array.number"),a("grid.column.percents",null,"array.number"),a("grid.border",1),a("grid.border.left",0),a("grid.border.right",0),a("grid.border.top",0),a("grid.border.bottom",0),a("grid.padding",1),a("grid.padding.left",0),a("grid.padding.right",0),a("grid.padding.top",0),a("grid.padding.bottom",0),a("grid.fill",!0),a("grid.fill.color","#C0C0C0"),a("grid.deep",1),a("grid.cell.deep",-1),a("shapelink.type","lineto"),a("shapenode.closed",!1),a("shapenode.pattern",null,"array.number"),a("bus.style","nearby"),a("arrow.from",!1),a("arrow.from.fill",!0),a("arrow.from.shape","arrow.standard"),a("arrow.from.color","#000000"),a("arrow.from.xoffset",0),a("arrow.from.yoffset",0),a("arrow.from.width",12),a("arrow.from.height",9),a("arrow.from.outline.color","#000000"),a("arrow.from.outline.width",-1),a("arrow.from.at.edge",!0),a("arrow.to",!1),a("arrow.to.fill",!0),a("arrow.to.shape","arrow.standard"),a("arrow.to.color","#000000"),a("arrow.to.xoffset",0),a("arrow.to.yoffset",0),a("arrow.to.width",12),a("arrow.to.height",9),a("arrow.to.outline.color","#000000"),a("arrow.to.outline.width",-1),a("arrow.to.at.edge",!0)}(),d.ext("twaver.Styles",Object,{}),c.PropertyChangeDispatcher=function(){this._dispatcher=new c.EventDispatcher},d.ext("twaver.PropertyChangeDispatcher",Object,{addPropertyChangeListener:function(a,b,c){this._dispatcher.add(a,b,c)},removePropertyChangeListener:function(a,b){this._dispatcher.remove(a,b)},firePropertyChange:function(a,b,c){if(b==c)return!1;var d={property:a,oldValue:b,newValue:c,source:this};return this._dispatcher.fire(d),this.onPropertyChanged(d),!0},onPropertyChanged:function(a){}}),c.animate.Animate=function(){},d.ext("twaver.animate.Animate",Object,{current:0,step:8,delay:4,finishFunction:null,shouldBeFinished:!1,getCurrentDelay:function(){return this.delay*this.current+1},action:function(a){}}),c.animate.AnimateProperty=function(a,b,c){this.objects=a,this.newValues=b,this.finishFunction=c,this.oldValues=new B;var d=this.objects.size();for(var e=0;e<d;e++){var f=this.objects.get(e);this.oldValues.add(this.getPropertyValue(f))}},d.ext("twaver.animate.AnimateProperty",c.animate.Animate,{action:function(a){var b=this.objects.size();for(var c=0;c<b;c++){var d=this.objects.get(c),e=this.oldValues.get(c),f=this.newValues.get(c);this.currentAction(d,e,f,a)}},getPropertyValue:function(a){},currentAction:function(a,b,c,d){}}),c.animate.AnimateBounds=function(a,b,c){this.node=a,this.newBounds=b,this.oldBounds=a.getRect(),this.finishFunction=c},d.ext("twaver.animate.AnimateBounds",c.animate.Animate,{shouldBeFinished:!0,action:function(a){var b=this.oldBounds,c=this.newBounds;node.setLocation(b.x+(c.x-b.x)*a,b.y+(c.y-b.y)*a),node.setSize(b.width+(c.width-b.width)*a,b.height+(c.height-b.height)*a)}}),c.animate.AnimateCenterLocation=function(a,b,d){c.animate.AnimateCenterLocation.superClass.constructor.call(this,a,b,d)},d.ext("twaver.animate.AnimateCenterLocation",c.animate.AnimateProperty,{getPropertyValue:function(a){return a.getCenterLocation()},currentAction:function(a,b,c,d){var e=b.x+(c.x-b.x)*d,f=b.y+(c.y-b.y)*d;a.setCenterLocation(e,f)}}),c.animate.AnimateLocation=function(a,b,d){c.animate.AnimateLocation.superClass.constructor.call(this,a,b,d)},d.ext("twaver.animate.AnimateLocation",c.animate.AnimateProperty,{getPropertyValue:function(a){return a.getLocation()},currentAction:function(a,b,c,d){var e=b.x+(c.x-b.x)*d,f=b.y+(c.y-b.y)*d;a.setLocation(e,f)}}),c.animate.AnimateScrollPosition=function(a,b,c){this.view=a,this.oldHorizontalOffset=a.scrollLeft,this.oldVerticalOffset=a.scrollTop,this.newHorizontalOffset=b,this.newVerticalOffset=c},d.ext("twaver.animate.AnimateScrollPosition",c.animate.Animate,{action:function(a){this.view.scrollLeft=this.oldHorizontalOffset+(this.newHorizontalOffset-this.oldHorizontalOffset)*a,this.view.scrollTop=this.oldVerticalOffset+(this.newVerticalOffset-this.oldVerticalOffset)*a}}),c.animate.AnimateZoom=function(a,b,c){this.view=a,this.oldZoom=a.getZoom(),this.newZoom=b,this.finishFunction=c},d.ext("twaver.animate.AnimateZoom",c.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setZoom(this.oldZoom+(this.newZoom-this.oldZoom)*a,!1)}}),c.animate.AnimateXZoom=function(a,b,c){this.view=a,this.oldXZoom=a.getXZoom(),this.newXZoom=b,this.finishFunction=c},d.ext("twaver.animate.AnimateXZoom",c.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setXZoom(this.oldXZoom+(this.newXZoom-this.oldXZoom)*a,!1)}}),c.animate.AnimateYZoom=function(a,b,c){this.view=a,this.oldYZoom=a.getYZoom(),this.newYZoom=b,this.finishFunction=c},d.ext("twaver.animate.AnimateYZoom",c.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setYZoom(this.oldYZoom+(this.newYZoom-this.oldYZoom)*a,!1)}}),c.animate.AnimateXYZoom=function(a,b,c,d){this.view=a,this.oldXZoom=a.getXZoom(),this.newXZoom=b,this.oldYZoom=a.getYZoom(),this.newYZoom=c,this.finishFunction=d},d.ext("twaver.animate.AnimateXYZoom",c.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setXZoom(this.oldXZoom+(this.newXZoom-this.oldXZoom)*a,!1),this.view.setYZoom(this.oldYZoom+(this.newYZoom-this.oldYZoom)*a,!1)}}),c.animate.AnimateSubNetwork=function(a,b,c){this.network=a,this.subNetwork=b,this.finishFunction=c},d.ext("twaver.animate.AnimateSubNetwork",c.animate.Animate,{shouldBeFinished:!0,action:function(a){a>.5?(this.network.getView().style.opacity=a*2-1,this.network._setCurrentSubNetwork(this.subNetwork)):this.network.getView().style.opacity=1-a*2}}),c.animate.AnimateManager={timer:null,animate:null,start:function(a,b){var e=c.animate.AnimateManager;a.current<0&&(a.current=0),b?d.callLater(e.startImpl,null,[a],b):e.startImpl(a)},startImpl:function(a){var b=c.animate.AnimateManager;b.animate&&b.endAnimate(),b.animate=a,b.timer=setTimeout(b.tick,a.getCurrentDelay())},tick:function(){var a=c.animate.AnimateManager,b=a.animate;if(!b)return;if(b.current<0){b.current++;return}b.current<b.step&&(b.current++,b.action(b.current/b.step),a.timer=setTimeout(a.tick,b.getCurrentDelay())),b.current>=b.step&&a.endAnimate()},endAnimate:function(){var a=c.animate.AnimateManager;if(a.animate){a.animate.shouldBeFinished&&a.animate.current<a.animate.step&&(a.animate.current=a.animate.step,a.animate.action(a.animate.current/a.animate.step));var b=a.animate.finishFunction;a.animate=null,a.timer&&(clearTimeout(a.timer),a.timer=null),b&&b()}else a.timer&&(clearTimeout(a.timer),a.timer=null)}},c.DataBox=function(a){c.DataBox.superClass.constructor.apply(this,arguments),arguments.length===1&&(this._name=a),this._dataList=new B,this._dataMap={},this._rootList=new B,this._rootMap={},this._clientMap={},this._dataBoxChangeDispatcher=new c.EventDispatcher,this._dataPropertyChangeDispatcher=new c.EventDispatcher,this._hierarchyChangeDispatcher=new c.EventDispatcher,this._selectionModel=new c.SelectionModel(this)},d.ext("twaver.DataBox",c.PropertyChangeDispatcher,{IClient:!0,__client:1,__new:1,_limit:-1,_name:"DataBox",_icon:D.ICON_DATABOX,__accessor:["name","icon","toolTip"],getSelectionModel:function(){return this._selectionModel},size:function(){return this._dataList.size()},isEmpty:function(){return this._dataList.isEmpty()},getLimit:function(){return this._limit},setLimit:function(a){var b=this._limit;this._limit=a,this.firePropertyChange("limit",b,a),this._checkLimit()},_checkLimit:function(){this._limit>=0&&this.size()>this._limit&&this.removeFirst(this.size()-this._limit)},removeFirst:function(a){arguments.length===0&&(a=1);while(a>0&&this._dataList.size()>0){var b=this._dataList.get(0);this.remove(b),a--}},getSiblings:function(a){if(!this.contains(a))throw a+" dosen't belong to this dataBox";var b=a.getParent();return b?b.getChildren():this._rootList},getRoots:function(){return this._rootList},getSiblingIndex:function(a){return a.getParent()?a.getParent().getChildren().indexOf(a):this._rootList.indexOf(a)},getDatas:function(){return this._dataList},getDataAt:function(a){return this._dataList.get(a)},toDatas:function(a,b){return this._dataList.toList(a,b)},forEach:function(a,b){this._dataList.forEach(a,b)},forEachReverse:function(a,b){this._dataList.forEachReverse(a,b)},forEachByDepthFirst:function(a,b,c){if(b)this._depthFirst(a,b,c);else{var d=this._rootList.size();for(var e=0;e<d;e++){var f=this._rootList.get(e);if(this._depthFirst(a,f,c)===!1)return}}},_depthFirst:function(a,b,c){var d=b.getChildrenSize();for(var e=0;e<d;e++){var f=b.getChildAt(e);if(this._depthFirst(a,f,c)===!1)return!1}if(c){if(a.call(c,b)===!1)return!1}else if(a(b)===!1)return!1},forEachByBreadthFirst:function(a,b,c){var d=new B;b?d.add(b):this._rootList.forEach(d.add,d);while(d.size()>0){b=d.removeAt(0),b.getChildren().forEach(d.add,d);if(c){if(a.call(c,b)===!1)return}else if(a(b)===!1)return}},add:function(a,b){if(!a)return;arguments.length===1&&(b=-1);var c=a.getId();if(this._dataMap.hasOwnProperty(c))throw"Data with ID '"+c+"' already exists";this._dataMap[c]=a,this._dataList.add(a),a.getParent()||(this._rootMap[c]=a,b>=0?this._rootList.add(a,b):this._rootList.add(a)),a.addPropertyChangeListener(this.handleDataPropertyChange,this,!0),this._dataBoxChangeDispatcher.fire({kind:"add",data:a}),this._checkLimit()},remove:function(a){this.removeById(a.getId())},removeSelection:function(){this._selectionModel.toSelection().forEach(function(a){this.remove(a)},this)},removeById:function(a){var b=this.getDataById(a);if(!b)return;b instanceof c.Link&&(b.setFromNode(null),b.setToNode(null)),b instanceof E&&b.getLinks()&&b.getLinks().toList().forEach(function(a){this.remove(a)},this),b instanceof E&&b.getFollowers()&&b.getFollowers().toList().forEach(function(a){a.setHost(null)}),b instanceof c.Follower&&b.getHost()&&b.setHost(null),b.toChildren().forEach(function(a){this.remove(a)},this),b.getParent()&&b.getParent().removeChild(b),this._dataList.remove(b),delete this._dataMap[a],this._rootMap[a]&&(delete this._rootMap[a],this._rootList.remove(b)),this._dataBoxChangeDispatcher.fire({kind:"remove",data:b}),b.removePropertyChangeListener(this.handleDataPropertyChange,this)},clear:function(){if(this._dataList.size()>0){this._dataList.forEach(function(a){a.removePropertyChangeListener(this.handleDataPropertyChange,this)},this);var a=this._dataList.toList();this._dataList.clear(),this._dataMap={},this._rootList.clear(),this._rootMap={},this._dataBoxChangeDispatcher.fire({kind:"clear",datas:a})}},getDataById:function(a){return this._dataMap[a]},containsById:function(a){return this._dataMap.hasOwnProperty(a)},contains:function(a){return a?this._dataMap[a.getId()]===a:!1},moveTo:function(a,b){if(!this.contains(a))throw a+" dosen't belong to this dataBox";var c=this.getSiblings(a),d=c.indexOf(a);if(d===b||d<0)return;b>=0&&b<=c.size()&&(c.remove(a),b>c.size()&&b--,c.add(a,b),this._hierarchyChangeDispatcher.fire({data:a,oldIndex:d,newIndex:b}))},moveUp:function(a){var b=this.getSiblings(a);this.moveTo(a,b.indexOf(a)-1)},moveDown:function(a){var b=this.getSiblings(a);this.moveTo(a,b.indexOf(a)+1)},moveToTop:function(a){this.moveTo(a,0)},moveToBottom:function(a){var b=this.getSiblings(a);this.moveTo(a,b.size())},moveSelectionUp:function(a){a||(a=this._selectionModel);var b=new B;v.findMoveUpDatas(a,b,this._rootList),b.forEach(this.moveUp,this)},moveSelectionDown:function(a){a||(a=this._selectionModel);var b=new B;v.findMoveDownDatas(a,b,this._rootList),b.forEach(this.moveDown,this)},moveSelectionToTop:function(a){a||(a=this._selectionModel);var b=new B;v.findMoveToTopDatas(a,b,this._rootList),b.forEach(this.moveToTop,this)},moveSelectionToBottom:function(a){a||(a=this._selectionModel);var b=new B;v.findMoveToBottomDatas(a,b,this._rootList),b.forEach(this.moveToBottom,this)},handleDataPropertyChange:function(a){var b=a.source;if(a.property==="parent"){var c=b.getId();b.getParent()?this._rootMap[c]&&(delete this._rootMap[c],this._rootList.remove(b)):this._rootMap[c]||(this._rootMap[c]=b,this._rootList.add(b))}this.onDataPropertyChanged(b,a),this._dataPropertyChangeDispatcher.fire(a)},onDataPropertyChanged:function(a,b){},addDataBoxChangeListener:function(a,b,c){this._dataBoxChangeDispatcher.add(a,b,c)},removeDataBoxChangeListener:function(a,b){this._dataBoxChangeDispatcher.remove(a,b)},addDataPropertyChangeListener:function(a,b,c){this._dataPropertyChangeDispatcher.add(a,b,c)},removeDataPropertyChangeListener:function(a,b){this._dataPropertyChangeDispatcher.remove(a,b)},addHierarchyChangeListener:function(a,b,c){this._hierarchyChangeDispatcher.add(a,b,c)},removeHierarchyChangeListener:function(a,b){this._hierarchyChangeDispatcher.remove(a,b)}}),c.ElementBox=function(a){c.ElementBox.superClass.constructor.apply(this,arguments),this._styleMap={},this._alarmBox=new c.AlarmBox(this),this._layerBox=new c.LayerBox(this),this._alarmStatePropagator=new c.AlarmStatePropagator(this),this._alarmStatePropagator.setEnable(!0),this._indexChangeDispatcher=new c.EventDispatcher},c.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY={fromAgent:1,toAgent:1,expanded:1,parent:1,host:1},d.ext("twaver.ElementBox",c.DataBox,{IStyle:!0,__style:1,_name:"ElementBox",add:function(a,b){if(!a)return;if(!a.IElement)throw"Only IElement can be added into ElementBox";c.ElementBox.superClass.add.apply(this,arguments),this.adjustElementIndex(a)},onDataPropertyChanged:function(a,b){c.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY[b.property]&&this.adjustElementIndex(a),c.ElementBox.superClass.onDataPropertyChanged.apply(this,arguments)},addIndexChangeListener:function(a,b,c){this._indexChangeDispatcher.add(a,b,c)},removeIndexChangeListener:function(a,b){this._indexChangeDispatcher.remove(a,b)},sendToTop:function(a){if(!this.contains(a))return;if(a!==this.getDatas().get(this.size()-1)){var b=this.getDatas().indexOf(a);this.getDatas().removeAt(b),this.getDatas().add(a),this._indexChangeDispatcher.fire({element:a,oldIndex:b,newIndex:this.size()-1})}a instanceof c.Link&&(a.getFromAgent()&&!a.getFromAgent().isAdjustedToBottom()&&this.sendToTop(a.getFromAgent()),a.getToAgent()&&!a.getToAgent().isAdjustedToBottom()&&this.sendToTop(a.getToAgent())),a instanceof E&&a.getFollowers()&&a.getFollowers().forEach(function(b){if(b.isRelatedTo(a))return;if(a instanceof c.Follower&&b.isLoopedHostOn(a))return;this.sendToTop(b)},this);if(a.ISubNetwork)return;if(a instanceof F&&!a.isExpanded())return;a.getChildren().forEach(function(a){a instanceof c.Link||this.sendToTop(a)},this)},sendToBottom:function(a,b){if(a===b)return;if(!this.contains(a))return;if(b&&!this.contains(b))return;var d=this.getDatas().remove(a),e=0;b&&(e=this.getDatas().indexOf(b)),this.getDatas().add(a,e),d!=e&&(this._indexChangeDispatcher.fire({element:a,oldIndex:d,newIndex:e}),a.getParent()&&!a.getParent().ISubNetwork&&!(a.getParent()instanceof c.Link)&&this.sendToBottom(a.getParent(),a))},fireIndexChange:function(a,b,c){this._indexChangeDispatcher.fire({element:a,oldIndex:b,newIndex:c})},adjustElementIndex:function(a){if(!this.contains(a))return;a.isAdjustedToBottom()?(this.sendToBottom(a),a.getChildren().forEach(this.adjustElementIndex,this)):this.sendToTop(a)},forEachByLayer:function(a,b,c){var d=this.size(),e=this.getDatas();if(!b)this._layerBox.forEachByDepthFirst(function(b){for(var f=0;f<d;f++){var g=e.get(f);if(this._layerBox.getLayerByElement(g)===b)if(c){if(a.call(c,g)===!1)return}else if(a(g)===!1)return}},null,this);else for(var f=0;f<d;f++){var g=e.get(f);if(this._layerBox.getLayerByElement(g)===b)if(c){if(a.call(c,g)===!1)return}else if(a(g)===!1)return}},forEachByLayerReverse:function(a,b,c){var d=new B;this.forEachByLayer(function(a){d.add(a,0)},b),d.forEach(a,c)},getLayerBox:function(){return this._layerBox},getAlarmBox:function(){return this._alarmBox},getAlarmStatePropagator:function(){return this._alarmStatePropagator}}),c.SelectionModel=function(a){c.SelectionModel.superClass.constructor.apply(this,arguments),this._selectionMode="multipleSelection",this._selectionList=new B,this._selectionChangeDispatcher=new c.EventDispatcher,this._selectionMap={},this._setDataBox(a)},d.ext("twaver.SelectionModel",c.PropertyChangeDispatcher,{getSelectionMode:function(){return this._selectionMode},setSelectionMode:function(a){if(this._selectionMode===a)return;if(a!=="noneSelection"&&a!=="singleSelection"&&a!=="multipleSelection")return;this.clearSelection();var b=this._selectionMode;this._selectionMode=a,this.firePropertyChange("selectionMode",b,this._selectionMode)},getDataBox:function(){return this._dataBox},_setDataBox:function(a){if(!a)throw"dataBox can not be null";if(this._dataBox===a)return;this._dataBox&&(this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this));var b=this._dataBox;this._dataBox=a,this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this.firePropertyChange("dataBox",b,this._dataBox)},dispose:function(){this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this)},handleDataBoxChange:function(a){if(a.kind==="remove"){var b=a.data;this.contains(b)&&(this._selectionList.remove(b),delete this._selectionMap[b.getId()],this.fireSelectionChange("remove",new B(b)))}else a.kind==="clear"&&this.clearSelection()},getFilterFunction:function(){return this._filterFunction},setFilterFunction:function(a){if(this._filterFunction===a)return;this.clearSelection();var b=this._filterFunction;this._filterFunction=a,this.firePropertyChange("filterFunction",b,this._filterFunction)},fireSelectionChange:function(a,b,c){c&&(this._selectionList.forEach(function(a){c.contains(a)?c.remove(a):c.add(a)}),b=c.toList()),this._selectionChangeDispatcher.fire({kind:a,datas:new B(b)})},addSelectionChangeListener:function(a,b,c){this._selectionChangeDispatcher.add(a,b,c)},removeSelectionChangeListener:function(a,b){this._selectionChangeDispatcher.remove(a,b)},_filterList:function(a,b){var c=new B(a);for(var d=0;d<c.size();d++){var e=c.get(d);if(this._filterFunction&&!this._filterFunction(e)||b&&this.contains(e)||!b&&!this.contains(e)||!this._dataBox.contains(e))c.removeAt(d),d--}return c},appendSelection:function(a){if(this._selectionMode==="noneSelection")return;var b=this._filterList(a,!0);if(b.isEmpty())return;var c=null;this._selectionMode==="singleSelection"&&(c=new B(this._selectionList),this._selectionList.clear(),this._selectionMap={},b=new B(b.get(b.size()-1)));for(var d=0;d<b.size();d++){var e=b.get(d);this._selectionList.add(e),this._selectionMap[e.getId()]=e}this.fireSelectionChange("append",b,c)},removeSelection:function(a){var b=this._filterList(a);if(b.size()===0)return;for(var c=0;c<b.size();c++){var d=b.get(c);this._selectionList.remove(d),delete this._selectionMap[d.getId()]}this.fireSelectionChange("remove",b)},toSelection:function(a,b){return this._selectionList.toList(a,b)},getSelection:function(){return this._selectionList},setSelection:function(a){if(this._selectionMode==="noneSelection")return;if(this._selectionList.size()===0&&a==null)return;var b=new B(this._selectionList);this._selectionList.clear(),this._selectionMap={};var c=this._filterList(a,!0);this._selectionMode==="singleSelection"&&c.size()>1&&(c=new B(c.get(c.size()-1)));for(var d=0;d<c.size();d++){var e=c.get(d);this._selectionList.add(e),this._selectionMap[e.getId()]=e}this.fireSelectionChange("set",null,b)},clearSelection:function(){if(this._selectionList.size()>0){var a=this._selectionList.toList();this._selectionList.clear(),this._selectionMap={},this.fireSelectionChange("clear",a)}},selectAll:function(){if(this._selectionMode==="noneSelection")return;var a=this._dataBox.toDatas(),b=0,c=null;if(this._filterFunction)for(b=0;b<a.size();b++)c=a.get(b),this._filterFunction(c)||(a.removeAt(b),b--);var d=new B(this._selectionList);this._selectionList.clear(),this._selectionMap={},this._selectionMode==="singleSelection"&&a.size()>1&&(a=new B(a.get(a.size()-1)));for(b=0;b<a.size();b++)c=a.get(b),this._selectionList.add(c),this._selectionMap[c.getId()]=c;this.fireSelectionChange("all",null,d)},size:function(){return this._selectionList.size()},contains:function(a){return a?this._selectionMap[a.getId()]!=null:!1},getLastData:function(){return this._selectionList.size()>0?this._selectionList.get(this._selectionList.size()-1):null},getFirstData:function(){return this._selectionList.size()>0?this._selectionList.get(0):null},isSelectable:function(a){return a?this._selectionMode==="noneSelection"?!1:this._filterFunction&&!this._filterFunction(a)?!1:!0:!1}}),c.QuickFinder=function(a,b,c,e,f){this._map={};if(!a)throw"dataBox can not be null";if(!b)throw"propertyName can not be null";this._dataBox=a,this._propertyName=b,this._propertyType=c||"accessor",this._propertyType==="accessor"&&(this._getter=d.getter(b)),this._valueFunction=e||this.getValue,this._filterFunction=f||this.isInterested,this._dataBox.forEach(this._addData,this),this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this,!0)},d.ext("twaver.QuickFinder",Object,{_NULL_:"twaver-null-key",getValueFunction:function(){return this._valueFunction},getFilterFunction:function(){return this._filterFunction},handleDataBoxChange:function(a){a.kind==="add"?this._addData(a.data):a.kind==="remove"?this._removeData(a.data):a.kind==="clear"&&(this._map={})},handleDataPropertyChange:function(a){if(!this._filterFunction.call(this,a.source))return;if(this._propertyType!=="accessor"||this._propertyName!==a.property)if(this._propertyType!=="style"||!a.source.IStyle||"S:"+this._propertyName!==a.property)if(this.
_propertyType!=="client"||"C:"+this._propertyName!==a.property)return;var b=this._getMap(a.oldValue);b&&b.remove(a.source),this._addData(a.source)},_getMap:function(a){return a=a==null?this._NULL_:a,this._map[a]},find:function(a){var b=this._getMap(a);return b?b.toList():new B},findFirst:function(a){var b=this._getMap(a);return!b||b.isEmpty()?null:b.get(0)},_addData:function(a){if(!this._filterFunction.call(this,a))return;var b=this._valueFunction.call(this,a),c=this._getMap(b);c||(c=new B,b=b==null?this._NULL_:b,this._map[b]=c),c.add(a)},_removeData:function(a){if(!this._filterFunction.call(this,a))return;var b=this._valueFunction.call(this,a),c=this._getMap(b);c&&(c.remove(a),c.isEmpty()&&(b=b==null?this._NULL_:b,delete this._map[b]))},dispose:function(){this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),delete this._dataBox},getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isInterested:function(a){return this._propertyType==="style"&&!a.IStyle?!1:this._propertyType==="accessor"&&this._valueFunction===this.getValue&&!a[this._getter]?!1:!0},getValue:function(a){return this._propertyType==="accessor"?a[this._getter]():this._propertyType==="style"&&a.getStyle?a.getStyle(this._propertyName):this._propertyType==="client"&&a.getClient?a.getClient(this._propertyName):null}}),c.PropertyPropagator=function(a,b,c){if(!a)throw"dataBox can not be null";if(!b)throw"propertyName can not be null";this._dataBox=a,this._propertyName=b,this._propertyType=c||"accessor",this._propertyType==="accessor"&&(this._getter=d.getter(b),this._setter=d.setter(b)),this._enable=!1,this._isPropagating=!1},d.ext("twaver.PropertyPropagator",Object,{getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isEnable:function(){return this._enable},setEnable:function(a){if(this._enable===a)return;this._enable=a,this._enable?(this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this._dataBox.forEach(function(a){this.propagate(a)},this)):(this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this))},handleDataBoxChange:function(a){a.data&&this.propagate(a.data)},handleDataPropertyChange:function(a){if(this.isInterestedProperty(a))this.propagate(a.source);else if(a.property==="parent"){var b=a.oldValue;b&&this.propagate(b),this.propagate(a.source)}},isInterestedProperty:function(a){return this._propertyType==="accessor"&&this._propertyName===a.property?!0:this._propertyType==="style"&&a.IElement&&"S:"+this._propertyName===a.property?!0:this._propertyType==="client"&&"C:"+this._propertyName===a.property?!0:!1},propagate:function(a){if(!a||this._isPropagating)return;this._isPropagating=!0,this.propagateToTop(a),this._isPropagating=!1},propagateToTop:function(a){this.propagateToParent(null,a);while(a&&a.getParent())this.propagateToParent(a,a.getParent()),a=a.getParent()},propagateToParent:function(a,b){}}),c.AlarmStatePropagator=function(a){c.AlarmStatePropagator.superClass.constructor.call(this,a,"alarmState")},d.ext("twaver.AlarmStatePropagator",c.PropertyPropagator,{handleDataPropertyChange:function(a){a.property==="enablePropagation"?this.propagate(a.source):c.AlarmStatePropagator.superClass.handleDataPropertyChange.call(this,a)},propagateToParent:function(a,b){var d=null;b.getChildren().forEach(function(a){var b=a.getAlarmState().getHighestOverallAlarmSeverity();c.AlarmSeverity.compare(b,d)>0&&(d=b)}),b.getAlarmState().setPropagateSeverity(d)}}),c.AlarmSeverity=function(a,b,c,d,e){this.value=a,this.name=b,this.nickName=c,this.color=d,this.displayName=e},d.ext("twaver.AlarmSeverity",Object,{toString:function(){return this.displayName?this.displayName:this.name}}),function(){var a=c.AlarmSeverity;a.severities=new B,a._vm={},a._nm={},a._cp=function(a,b){if(a&&b){var c=a.value-b.value;return c>0?1:c<0?-1:0}return a&&!b?1:!a&&b?-1:0},a.forEach=function(b,c){a.severities.forEach(b,c)},a.getSortFunction=function(){return a._cp},a.setSortFunction=function(b){a._cp=b,a.severities.sort(b)},a.add=function(b,c,d,e,f){var g=new a(b,c,d,e,f);return a._vm[b]=g,a._nm[c]=g,a.severities.add(g),a.severities.sort(a._cp),g},a.remove=function(b){var c=a._nm[b];return c&&(delete a._nm[b],delete a._vm[c.value],a.severities.remove(c)),c},a.CRITICAL=a.add(500,"Critical","C","#FF0000"),a.MAJOR=a.add(400,"Major","M","#FFA000"),a.MINOR=a.add(300,"Minor","m","#FFFF00"),a.WARNING=a.add(200,"Warning","W","#00FFFF"),a.INDETERMINATE=a.add(100,"Indeterminate","N","#C800FF"),a.CLEARED=a.add(0,"Cleared","R","#00FF00"),a.isClearedAlarmSeverity=function(a){return a?a.value===0:!1},a.getByName=function(b){return a._nm[b]},a.getByValue=function(b){return a._vm[b]},a.clear=function(){a.severities.clear(),a._vm={},a._nm={}},a.compare=function(b,c){return a._cp(b,c)}}(),c.AlarmState=function(a){this._e=a,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0},d.ext("twaver.AlarmState",Object,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._e.firePropertyChange("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var a=null;for(var b in this._am){b=c.AlarmSeverity.getByName(b);if(c.AlarmSeverity.isClearedAlarmSeverity(b))continue;if(this.getAcknowledgedAlarmCount(b)===0)continue;a?a=c.AlarmSeverity.compare(a,b)>0?a:b:a=b}this._haa=a},_c2:function(){var a=null;for(var b in this._nm){b=c.AlarmSeverity.getByName(b);if(c.AlarmSeverity.isClearedAlarmSeverity(b))continue;if(this.getNewAlarmCount(b)===0)continue;a?a=c.AlarmSeverity.compare(a,b)>0?a:b:a=b}this._hna=a},_c3:function(){if(!this._hna){this._hls=!1;return}for(var a in this._nm){a=c.AlarmSeverity.getByName(a);if(c.AlarmSeverity.isClearedAlarmSeverity(a))continue;if(this.getNewAlarmCount(a)===0)continue;if(c.AlarmSeverity.compare(this._hna,a)>0){this._hls=!0;return}}this._hls=!1},_c4:function(){var a=this._haa,b=this._hna,d=this._ps;this._hoa=a,c.AlarmSeverity.compare(b,this._hoa)>0&&(this._hoa=b),c.AlarmSeverity.compare(d,this._hoa)>0&&(this._hoa=d)},_c5:function(){var a=this._haa,b=this._hna;this._hta=a,c.AlarmSeverity.compare(b,this._hta)>0&&(this._hta=b)},increaseAcknowledgedAlarm:function(a,b){b==null&&(b=1);if(b===0)return;var c=this._am[a.name];c==null&&(c=0),c+=b,this._am[a.name]=c,this._f()},increaseNewAlarm:function(a,b){b==null&&(b=1);if(b===0)return;var c=this._nm[a.name];c==null&&(c=0),c+=b,this._nm[a.name]=c,this._f()},decreaseAcknowledgedAlarm:function(a,b){b==null&&(b=1);if(b===0)return;var c=this._am[a.name];c==null&&(c=0),c-=b;if(c<0)throw"Alarm count can not be negative";this._am[a.name]=c,this._f()},decreaseNewAlarm:function(a,b){b==null&&(b=1);if(b===0)return;var c=this._nm[a.name];c==null&&(c=0),c-=b;if(c<0)throw"Alarm count can not be negative";this._nm[a.name]=c,this._f()},acknowledgeAlarm:function(a){this.decreaseNewAlarm(a,1),this.increaseAcknowledgedAlarm(a,1)},acknowledgeAllAlarms:function(a){if(a){var b=this.getNewAlarmCount(a);this.decreaseNewAlarm(a,b),this.increaseAcknowledgedAlarm(a,b)}else for(var d in this._nm)this.acknowledgeAllAlarms(c.AlarmSeverity.getByName(d))},_c6:function(){this._aac=0;for(var a in this._am)a=c.AlarmSeverity.getByName(a),this._aac+=this.getAcknowledgedAlarmCount(a)},getAcknowledgedAlarmCount:function(a){if(a){var b=this._am[a.name];return b==null?0:b}return this._aac},getAlarmCount:function(a){return this.getAcknowledgedAlarmCount(a)+this.getNewAlarmCount(a)},_c7:function(){this._nac=0;for(var a in this._nm)a=c.AlarmSeverity.getByName(a),this._nac+=this.getNewAlarmCount(a)},getNewAlarmCount:function(a){if(a){var b=this._nm[a.name];return b==null?0:b}return this._nac},setNewAlarmCount:function(a,b){this._nm[a.name]=b,this._f()},removeAllNewAlarms:function(a){a?delete this._nm[a]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(a,b){this._am[a.name]=b,this._f()},removeAllAcknowledgedAlarms:function(a){a?delete this._am[a.name]:this._am={},this._f()},isEmpty:function(){return this._hoa==null},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(a){this._ep||(a=null);if(this._ps===a)return;var b=this._ps;this._ps=a,this._f(),this._e.firePropertyChange("propagateSeverity",b,a)},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(a){var b=this._ep;this._ep=a,this._e.firePropertyChange("enablePropagation",b,a)&&(a||this.setPropagateSeverity(null))}}),c.AlarmBox=function(a){if(!a)throw"elementBox can not be null.";c.AlarmBox.superClass.constructor.call(this),this._elementBox=a,this._alarmElementMapping=new c.AlarmElementMapping(this,a),this._elementBox.addDataBoxChangeListener(this.handleElementBoxChange,this,!0),this.addDataBoxChangeListener(this.handleAlarmBoxChange,this,!0),this.addDataPropertyChangeListener(this.handleAlarmPropertyChange,this,!0)},d.ext("twaver.AlarmBox",c.DataBox,{__accessor:["removeAlarmWhenElementIsRemoved"],_name:"AlarmBox",_removeAlarmWhenAlarmIsCleared:!1,_removeAlarmWhenElementIsRemoved:!0,getElementBox:function(){return this._elementBox},isRemoveAlarmWhenAlarmIsCleared:function(){return this._removeAlarmWhenAlarmIsCleared},setRemoveAlarmWhenAlarmIsCleared:function(a){var b=this._removeAlarmWhenAlarmIsCleared;this._removeAlarmWhenAlarmIsCleared=a,this.firePropertyChange("removeAlarmWhenAlarmIsCleared",b,a),a&&this.toDatas(function(a){return a.isCleared()}).forEach(this.remove,this)},getAlarmElementMapping:function(){return this._alarmElementMapping},setAlarmElementMapping:function(a){if(!a)throw"alarmElementMapping can not be null";if(this._alarmElementMapping===a)return;var b=this._alarmElementMapping;this.getDatas().forEach(this._decreaseAlarmState,this),this._alarmElementMapping=a,this.getDatas().forEach(this._increaseAlarmState,this),this.firePropertyChange("alarmElementMapping",b,a)},handleElementBoxChange:function(a){a.kind==="add"?this.handleElementAdded(a.data):a.kind==="remove"?(this.handleElementRemoved(a.data),this._removeAlarmWhenElementIsRemoved&&this.removeAlarmsByElement(a.data)):a.kind==="clear"&&(a.datas.forEach(this.handleElementRemoved,this),this._removeAlarmWhenElementIsRemoved&&this.clear())},handleAlarmBoxChange:function(a){a.kind==="add"?this._increaseAlarmState(a.data):a.kind==="remove"?this._decreaseAlarmState(a.data):a.kind==="clear"&&a.datas.forEach(this._decreaseAlarmState,this)},handleAlarmPropertyChange:function(a){var b=a.source;b.isCleared()||(a.property==="alarmSeverity"?this.handleAlarmSeverityChange(b,a):a.property==="acked"&&this.handleAckedChange(b,a)),a.property==="cleared"&&(b.isCleared()?(this._decreaseAlarmState(b,!0),this._removeAlarmWhenAlarmIsCleared&&this.remove(b)):this._increaseAlarmState(b,!0))},handleAckedChange:function(a,b){if(!a.getAlarmSeverity())return;var c=this.getCorrespondingElements(a);if(c)for(var d=0;d<c.size();d++){var e=c.get(d);b.oldValue?e.getAlarmState().decreaseAcknowledgedAlarm(a.getAlarmSeverity()):e.getAlarmState().decreaseNewAlarm(a.getAlarmSeverity()),b.newValue?e.getAlarmState().increaseAcknowledgedAlarm(a.getAlarmSeverity()):e.getAlarmState().increaseNewAlarm(a.getAlarmSeverity())}},handleAlarmSeverityChange:function(a,b){var c=b.oldValue,d=b.newValue,e=this.getCorrespondingElements(a);if(e)for(var f=0;f<e.size();f++){var g=e.get(f);c&&(a.isAcked()?g.getAlarmState().decreaseAcknowledgedAlarm(c):g.getAlarmState().decreaseNewAlarm(c)),d&&(a.isAcked()?g.getAlarmState().increaseAcknowledgedAlarm(d):g.getAlarmState().increaseNewAlarm(d))}},getCorrespondingAlarms:function(a){return this._alarmElementMapping.getCorrespondingAlarms(a)},getCorrespondingElements:function(a){return this._alarmElementMapping.getCorrespondingElements(a)},handleElementAdded:function(a){var b=this.getCorrespondingAlarms(a);if(b)for(var c=0;c<b.size();c++){var d=b.get(c);if(d.isCleared())continue;var e=d.getAlarmSeverity();e&&(d.isAcked()?a.getAlarmState().increaseAcknowledgedAlarm(e):a.getAlarmState().increaseNewAlarm(e))}},_increaseAlarmState:function(a,b){if(a.isCleared()&&!b)return;var c=a.getAlarmSeverity();if(c){var d=this.getCorrespondingElements(a);if(d)for(var e=0;e<d.size();e++){var f=d.get(e);a.isAcked()?f.getAlarmState().increaseAcknowledgedAlarm(c):f.getAlarmState().increaseNewAlarm(c)}}},_decreaseAlarmState:function(a,b){if(a.isCleared()&&!b)return;var c=a.getAlarmSeverity();if(!c)return;var d=this.getCorrespondingElements(a);if(d)for(var e=0;e<d.size();e++){var f=d.get(e);a.isAcked()?f.getAlarmState().decreaseAcknowledgedAlarm(c):f.getAlarmState().decreaseNewAlarm(c)}},handleElementRemoved:function(a){var b=this.getCorrespondingAlarms(a);b&&b.forEach(function(b){!b.isCleared()&&b.getAlarmSeverity()&&(b.isAcked()?a.getAlarmState().decreaseAcknowledgedAlarm(b.getAlarmSeverity()):a.getAlarmState().decreaseNewAlarm(b.getAlarmSeverity()))})},removeAlarmsByElement:function(a){var b=this.getCorrespondingAlarms(a);b&&b.forEach(this.remove,this)},add:function(a,b){if(!a.IAlarm)throw"Only IAlarm can be added into AlarmBox";if(this._removeAlarmWhenAlarmIsCleared&&a.isCleared())return;c.AlarmBox.superClass.add.apply(this,arguments)}}),c.AlarmElementMapping=function(a,b){if(!b)throw"ElementBox can not be null";if(!a)throw"AlarmBox can not be null";this._elementBox=b,this._alarmBox=a,this._alarmsFinder=new c.QuickFinder(a,"elementId")},d.ext("twaver.AlarmElementMapping",Object,{getCorrespondingAlarms:function(a){return this._alarmsFinder.find(a.getId())},getCorrespondingElements:function(a){var b=this._elementBox.getDataById(a.getElementId());return new B(b)},dispose:function(){this._alarmsFinder.dispose(),delete this._elementBox,delete this._alarmBox,delete this._alarmsFinder}}),c.AlarmStateStatistics=function(a){c.AlarmStateStatistics.superClass.constructor.apply(this,arguments),this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.elementMap={},this.setElementBox(a)},d.ext("twaver.AlarmStateStatistics",c.PropertyChangeDispatcher,{getElementBox:function(){return this._elementBox},setElementBox:function(a){if(!a)throw"ElementBox can not be null";if(this._elementBox===a)return;var b=this._elementBox;b&&(b.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),b.removeDataBoxChangeListener(this.handleElementBoxChange,this),this.severtiyMap={},this.elementMap={}),this._elementBox=a,this.reset(),a.addDataPropertyChangeListener(this.handleElementPropertyChange,this),a.addDataBoxChangeListener(this.handleElementBoxChange,this),this.firePropertyChange("elementBox",b,a)},dispose:function(){this._elementBox.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),this._elementBox.removeDataBoxChangeListener(this.handleElementBoxChange,this),delete this._elementBox},handleElementPropertyChange:function(a){a.property==="alarmState"&&(this.increase(a.source),this.fireAlarmStateChange())},handleElementBoxChange:function(a){a.kind==="add"?(this.increase(a.data),this.fireAlarmStateChange()):a.kind==="remove"?(this.decrease(a.data),this.fireAlarmStateChange()):a.kind==="clear"&&(this.severtiyMap={},this.elementMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,c.AlarmSeverity.forEach(function(a){var b=this.getSumInfo(a);this.sumAcked+=b.ackedCount,this.sumNew+=b.newCount,this.sumTotal+=b.totalCount},this),this.firePropertyChange("alarmState",!1,!0)},getNewAlarmCount:function(a){if(!a)return this.sumNew;var b=this.getSumInfo(a);return b.newCount},getAcknowledgedAlarmCount:function(a){if(!a)return this.sumAcked;var b=this.getSumInfo(a);return b.ackedCount},getTotalAlarmCount:function(a){if(!a)return this.sumTotal;var b=this.getSumInfo(a);return b.totalCount},getSumInfo:function(a){var b=this.severtiyMap[a.name];return b||(b={},b.newCount=0,b.ackedCount=0,b.totalCount=0,this.severtiyMap[a.name]=b),b},decrease:function(a){var b=this.elementMap[a.getId()];b&&(delete this.elementMap[a.getId()],c.AlarmSeverity.forEach(function(a){var c=b[a.name],d=this.getSumInfo(a);d.newCount=d.newCount-c.newCount,d.ackedCount=d.ackedCount-c.ackedCount,d.totalCount=d.totalCount-c.totalCount},this))},increase:function(a){this.decrease(a);if(this._filterFunction&&!this._filterFunction(a))return;var b={};this.elementMap[a.getId()]=b,c.AlarmSeverity.forEach(function(c){var d={};d.newCount=a.getAlarmState().getNewAlarmCount(c),d.ackedCount=a.getAlarmState().getAcknowledgedAlarmCount(c),d.totalCount=a.getAlarmState().getAlarmCount(c),b[c.name]=d;var e=this.getSumInfo(c);e.newCount=e.newCount+d.newCount,e.ackedCount=e.ackedCount+d.ackedCount,e.totalCount=e.totalCount+d.totalCount},this)},reset:function(){this.severtiyMap={},this.elementMap={},this._elementBox.forEach(this.increase,this),this.fireAlarmStateChange()},setFilterFunction:function(a){var b=this._filterFunction;this._filterFunction=a,this.reset(),this.firePropertyChange("filterFunction",b,a)},getFilterFunction:function(){return _filterFunction}}),c.LayerBox=function(a){c.LayerBox.superClass.constructor.call(this),this._elementBox=a,this._defaultLayer=new c.Layer(D.LAYER_DEFAULT_ID,D.LAYER_DEFAULT_NAME),this.add(this._defaultLayer)},d.ext("twaver.LayerBox",c.DataBox,{_name:"LayerBox",getElementBox:function(){return this._elementBox},getDefaultLayer:function(){return this._defaultLayer},add:function(a,b){if(!a.ILayer)throw"Only ILayer can be added into LayerBox";c.LayerBox.superClass.add.apply(this,arguments)},removeById:function(a){if(a===this._defaultLayer.getId())throw"Cannot remove default layer";c.LayerBox.superClass.removeById.call(this,a)},getLayerByElement:function(a){if(!a)return null;var b=this.getDataById(a.getLayerId());return b?b:this._defaultLayer},clear:function(){this.toDatas().forEach(function(a){a!=this._defaultLayer&&this.removeById(a.getId())},this)}}),c.BundleLinks=function(a,b){this._links=a,this._siblings=b;var d,e,f=c.Styles.getStyle("link.bundle.expanded");for(d=0;d<a.size();d++){e=a.get(d);var g=e.getStyle("link.bundle.expanded",!1);if(g!=null){f=g;break}}f==null&&(f=!0);if(D.LINK_BUNDLE_AGENT_FUNCTION){var h=D.LINK_BUNDLE_AGENT_FUNCTION(a);h==null?h=a.get(0):h!=a.get(0)&&(a.remove(h),a.add(h,0))}for(d=0;d<a.size();d++)a.get(d).setStyle("link.bundle.expanded",f)},d.ext("twaver.BundleLinks",Object,{getLinks:function(){return this._links},getSiblings:function(){return this._siblings},forEachSiblingLink:function(a,b){this._siblings.forEach(function(c){c.getLinks().forEach(a,b)})}}),c.Data=function(a){c.Data.superClass.constructor.apply(this,arguments),this._childList=new B,this._childMap={},this._clientMap={};if(a===b||a===null)this._id=d.id();else if(typeof a=="string"||typeof a=="number"||typeof a=="boolean")this._id=a;else{for(var e in a)if(e==="clients")for(var f in a.clients)this._clientMap[f]=a.clients[f];else if(e==="styles")for(var g in a.styles)this._styleMap[g]=a.styles[g];else a[e]!=null&&(this["_"+e]=a[e]);this._id==null&&(this._id=d.id())}},d.ext("twaver.Data",c.PropertyChangeDispatcher,{IData:!0,IClient:!0,__client:1,__new:1,_parent:null,__accessor:["name","icon","toolTip"],_icon:D.ICON_DATA,getId:function(){return this._id},getChildren:function(){return this._childList},getChildrenSize:function(){return this._childList.size()},toChildren:function(a,b){return this._childList.toList(a,b)},addChild:function(a,c){c===b&&(c=this._childList.size());if(!a||a===this)return!1;if(this._childMap[a.getId()])return!1;if(this.isDescendantOf(a))return!1;a.getParent()&&a.getParent().removeChild(a);if(c<0||c>this._childList.size())c=this._childList.size();return this._childList.add(a,c),this._childMap[a._id]=a,a.setParent(this),this.firePropertyChange("children",null,a),this.onChildAdded(a,c),!0},onChildAdded:function(a,b){},removeChild:function(a){if(!a)return!1;if(!this._childMap[a._id])return!1;var b=this._childList.remove(a);return delete this._childMap[a._id],this.firePropertyChange("children",a,null),a.setParent(null),this.onChildRemoved(a,b),!0},onChildRemoved:function(a,b){},getChildAt:function(a){return this._childList.get(a)},clearChildren:function(){if(this._childList.size()===0)return!1;var a=this._childList.toArray(),b=a.length;for(var c=0;c<b;c++)this.removeChild(a[c]);return this.onChildrenCleared(a),!0},onChildrenCleared:function(a){},getParent:function(){return this._parent},setParent:function(a){if(this._isUpdatingParent||this._parent===a||this===a)return;if(a&&a.isDescendantOf(this))return;var b=this._parent;this._parent=a,this._isUpdatingParent=!0,b&&b.removeChild(this),a&&a.addChild(this),delete this._isUpdatingParent,this.firePropertyChange("parent",b,a),this.onParentChanged(b,a)},onParentChanged:function(a,b){},hasChildren:function(){return this._childList.size()>0},isRelatedTo:function(a){return a?this.isDescendantOf(a)||a.isDescendantOf(this):!1},isParentOf:function(a){return a?this._childMap[a._id]!=null:!1},isDescendantOf:function(a){if(!a)return!1;if(!a.hasChildren())return!1;var b=this._parent;while(b){if(a===b)return!0;b=b.getParent()}return!1},toString:function(){return this.getName()?this.getName():this._id}}),c.Alarm=function(a,b,d,e,f){c.Alarm.superClass.constructor.call(this,a),this._elementId=b,this._alarmSeverity=d,this._acked=e||!1,this._cleared=f||!1},d.ext("twaver.Alarm",c.Data,{IAlarm:!0,getElementId:function(){return this._elementId},__accessor:["acked","cleared","alarmSeverity"]}),c.Layer=function(a){c.Layer.superClass.constructor.call(this,a)},d.ext("twaver.Layer",c.Data,{ILayer:!0,__accessor:["visible","movable","editable"],_visible:!0,_movable:!0,_editable:!0}),c.Element=function(a){this._styleMap=this._styleMap||{},this._alarmState=new c.AlarmState(this),c.Element.superClass.constructor.call(this,a)},d.ext("twaver.Element",c.Data,{IElement:!0,IStyle:!0,__accessor:["layerId"],__style:1,getAlarmState:function(){return this._alarmState},isAdjustedToBottom:function(){return!1},getElementUIClass:function(){return null},getCanvasUIClass:function(){return null}}),c.Dummy=function(a){c.Dummy.superClass.constructor.call(this,a)},d.ext("twaver.Dummy",c.Element,{IDummy:!0});var E=function(a){this._location={x:0,y:0},E.superClass.constructor.call(this,a)};c.Node=E,E.IS_INTERESTED_NODE_PROPERTY={location:1,width:1,height:1,expanded:1},d.ext("twaver.Node",c.Element,{_icon:D.ICON_NODE,_image:D.IMAGE_NODE,getLoopedLinks:function(){return this._loopedLinks},getLinks:function(){return this._links},getAgentLinks:function(){return this._agentLinks},getFollowers:function(){return this._followers},_addFollower:function(a){this._followers||(this._followers=new B),this._followers.add(a)},_removeFollower:function(a){this._followers.remove(a),this._followers.isEmpty()&&delete this._followers},getFromLinks:function(){return this._fromLinks},getToLinks:function(){return this._toLinks},_addFromLink:function(a){this._allLinks||(this._allLinks=new B),this._fromLinks||(this._fromLinks=new B),this._allLinks.add(a),this._fromLinks.add(a),this._resetLinkSet()},_addToLink:function(a){this._allLinks||(this._allLinks=new B),this._toLinks||(this._toLinks=new B),this._allLinks.add(a),this._toLinks.add(a),this._resetLinkSet()},_removeFromLink:function(a){this._allLinks.remove(a),this._fromLinks.remove(a),this._allLinks.size()===0&&delete this._allLinks,this._fromLinks.size()===0&&delete this._fromLinks,this._resetLinkSet()},_removeToLink:function(a){this._allLinks.remove(a),this._toLinks.remove(a),this._allLinks.size()===0&&delete this._allLinks,this._toLinks.size()===0&&delete this._toLinks,this._resetLinkSet()},_resetLinkSet:function(){delete this._loopedLinks;if(!this._allLinks||this._allLinks.size()===0){delete this._links;return}var a;this._allLinks.forEach(function(b){b.isLooped()&&(a||(a={}),a[b._id]||(this._loopedLinks||(this._loopedLinks=new B),this._loopedLinks.add(b),a[b._id]=b))},this),a?(this._links=new B,this._allLinks.forEach(function(b){a[b._id]?a[b._id]!==!1&&(a[b._id]=!1,this._links.add(b)):this._links.add(b)},this)):this._links=this._allLinks},hasAgentLinks:function(){return this._agentLinks!=null&&!this._agentLinks.isEmpty()},getFromAgentLinks:function(){return this._fromAgentLinks},getToAgentLinks:function(){return this._toAgentLinks},_addFromAgentLink:function(a){this._fromAgentLinks||(this._fromAgentLinks=new B),this._allAgentLinks||(this._allAgentLinks=new B),this._fromAgentLinks.add(a),this._allAgentLinks.add(a),this._resetAgentLinkSet()},_addToAgentLink:function(a){this._toAgentLinks||(this._toAgentLinks=new B),this._allAgentLinks||(this._allAgentLinks=new B),this._toAgentLinks.add(a),this._allAgentLinks.add(a),this._resetAgentLinkSet()},_removeFromAgentLink:function(a){this._fromAgentLinks.remove(a),this._allAgentLinks.remove(a),this._fromAgentLinks.size()===0&&delete this._fromAgentLinks,this._allAgentLinks.size()===0&&delete this._allAgentLinks,this._resetAgentLinkSet()},_removeToAgentLink:function(a){this._toAgentLinks.remove(a),this._allAgentLinks.remove(a),this._toAgentLinks.size()===0&&delete this._toAgentLinks,this._allAgentLinks.size()===0&&delete this._allAgentLinks,this._resetAgentLinkSet()},_resetAgentLinkSet:function(){delete this._agentLinks;if(!this._allAgentLinks||this._allAgentLinks.size()===0)return;var a={};this._allAgentLinks.forEach(function(b){a[b._id]?this._agentLinks||(this._agentLinks=new B):a[b._id]=b},this),this._agentLinks?this._allAgentLinks.forEach(function(b){a[b._id]&&(this._agentLinks.add(b),delete a[b._id])},this):this._agentLinks=this._allAgentLinks},getImage:function(){return this._image},setImage:function(a){var b=this._image,c=this.getWidth(),d=this.getHeight();this._image=a,this.firePropertyChange("image",b,a),this.firePropertyChange("width",c,this.getWidth()),this.firePropertyChange("height",d,this.getHeight())},getX:function(){return this._location.x},getY:function(){return this._location.y},setX:function(a){this.setLocation(a,this._location.y)},setY:function(a){this.setLocation(this._location.x,a)},getLocation:function(){return this._location},setLocation:function(a,b){var c;arguments.length===2?c={x:arguments[0],y:arguments[1]}:c=arguments[0];if(!d.num(c.x)||!d.num(c.y))return;if(c.x===this._location.x&&c.y===this._location.y)return;var e=this._location;this._location=c,this.firePropertyChange("location",e,c)},getCenterLocation:function(){return{x:this.getX()+this.getWidth()/2,y:this.getY()+this.getHeight()/2}},setCenterLocation:function(a,b){var c;arguments.length===2?c={x:arguments[0],y:arguments[1]}:c=d.clone(arguments[0]);if(!d.num(c.x)||!d.num(c.y))return;c.x-=this.getWidth()/2,c.y-=this.getHeight()/2,this.setLocation(c)},translate:function(a,b){this.setLocation(this.getX()+a,this.getY()+b)},getWidth:function(){if(d.num(this._width)&&this._width>=0)return this._width;var a=d.getImageAsset(this._image);if(a){var b=a.getWidth();if(d.num(b)&&b>=0)return b}return D.NODE_WIDTH},setWidth:function(a){var b=this._width;this._width=a,this.firePropertyChange("width",b,a)},getHeight:function(){if(d.num(this._height)&&this._height>=0)return this._height;var a=d.getImageAsset(this._image);if(a){var b=a.getHeight();if(d.num(b)&&b>=0)return b}return D.NODE_HEIGHT},setHeight:function(a){var b=this._height;this._height=a,this.firePropertyChange("height",b,a)},setSize:function(){arguments.length===2?(this.setWidth(arguments[0]),this.setHeight(arguments[1])):(this.setWidth(arguments[0].width),this.setHeight(arguments[0].height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getRect:function(){return{x:this.getX(),y:this.getY(),width:this.getWidth(),height:this.getHeight()}},onParentChanged:function(a,b){E.superClass.onParentChanged.call(this,a,b),this._checkLinkAgent()},_checkLinkAgent:function(){if(this._links){var a=this._links.size();for(var b=0;b<a;b++)this._links.get(b)._checkAgentNode()}},onPropertyChanged:function(a){E.superClass.onPropertyChanged.call(this,a);if(this._followers){var b=this._followers.size();for(var c=0;c<b;c++)this._followers.get(c).handleHostPropertyChange(a)}this.getParent()instanceof F&&E.IS_INTERESTED_NODE_PROPERTY[a.property]&&this.getParent().updateLocationFromChildren()},getElementUIClass:function(){return c.network.NodeUI},getCanvasUIClass:function(){return c.canvas.NodeUI}}),c.Link=function(a,b,d){c.Link.superClass.constructor.call(this,a instanceof E?null:a),a instanceof E&&(d=b,b=a),this.setFromNode(b),this.setToNode(d)},c.Link.IS_INTERESTED_BUNDLE_STYLE={"link.bundle.enable":1,"link.bundle.id":1,"link.bundle.independent":1},d.ext("twaver.Link",c.Element,{_fromNode:null,_toNode:null,_fromAgent:null,_toAgent:null,_icon:D.ICON_LINK,getFromNode:function(){return this._fromNode},getToNode:function(){return this._toNode},getFromAgent:function(){return this._fromAgent},getToAgent:function(){return this._toAgent},setFromNode:function(a){if(this._fromNode===a)return;var b=this._fromNode;this._fromNode=a,b&&b._removeFromLink(this),this._fromNode&&this._fromNode._addFromLink(this),this._checkAgentNode(),this.firePropertyChange("fromNode",b,a)},setToNode:function(a){if(this._toNode===a)return;var b=this._toNode;this._toNode=a,b&&b._removeToLink(this),this._toNode&&this._toNode._addToLink(this),this._checkAgentNode(),this.firePropertyChange("toNode",b,a)},isLooped:function(){return this._fromNode===this._toNode&&this._fromNode!=null&&this._toNode!=null},_checkAgentNode:function(){var a=s.figureFromAgent(this),b;this._fromAgent!=a&&(b=this._fromAgent,this._fromAgent&&this._fromAgent._removeFromAgentLink(this),this._fromAgent=a,this._fromAgent&&this._fromAgent._addFromAgentLink(this),this.firePropertyChange("fromAgent",b,this._fromAgent),s.resetBundleLinks(b,this._toAgent),s.resetBundleLinks(this._fromAgent,this._toAgent));var c=s.figureToAgent(this);this._toAgent!=c&&(b=this._toAgent,this._toAgent&&this._toAgent._removeToAgentLink(this),this._toAgent=c,this._toAgent&&this._toAgent._addToAgentLink(this),this.firePropertyChange("toAgent",b,this._toAgent),s.resetBundleLinks(b,this._fromAgent),s.resetBundleLinks(this._toAgent,this._fromAgent))},_setBundleLinks:function(a){this._bundleLinks=a,this.firePropertyChange("bundleLinks",!0,!1)},getBundleLinks:function(){return this._bundleLinks},getBundleCount:function(){return this._bundleLinks?this._bundleLinks.getLinks().size():1},getBundleIndex:function(){return this._bundleLinks?this._bundleLinks.getLinks().indexOf(this):0},reverseBundleExpanded:function(){if(this._bundleLinks&&this._bundleLinks.getLinks().size()>0){var a,b,c=this._bundleLinks.getLinks(),d=!this.getStyle("link.bundle.expanded");for(a=0;a<c.size();a++)b=c.get(a),b.setStyle("link.bundle.expanded",d);var e=this._bundleLinks.getSiblings();for(a=0;a<e.size();a++){var f=e.get(a);if(f!=this._bundleLinks){c=f.getLinks();for(var g=0;g<c.size();g++)b=c.get(g),b.firePropertyChange("bundleLinks",null,f)}}return!0}return!1},isBundleAgent:function(){return this._bundleLinks!=null&&this._bundleLinks.getLinks().size()>1&&this===this._bundleLinks.getLinks().get(0)&&!this.getStyle("link.bundle.expanded")},onStyleChanged:function(a,b,d){c.Link.superClass.onStyleChanged.call(this,a,b,d),c.Link.IS_INTERESTED_BUNDLE_STYLE[a]&&s.resetBundleLinks(this._toAgent,this._fromAgent)},getElementUIClass:function(){return c.network.LinkUI},getCanvasUIClass:function(){return c.canvas.LinkUI}}),c.Follower=function(a){this._isUpdatingFollower=!1,this._isUpdatingLocation=!1,c.Follower.superClass.constructor.call(this,a)},c.Follower.IS_INTERESTED_HOST_GRID_PROPERTY={location:1,width:1,height:1,"S:grid.row.count":1,"S:grid.column.count":1,"S:grid.row.percents":1,"S:grid.column.percents":1,"S:grid.border":1,"S:grid.border.left":1,"S:grid.border.right":1,"S:grid.border.top":1,"S:grid.border.bottom":1,"S:grid.padding":1,"S:grid.padding.left":1,"S:grid.padding.right":1,"S:grid.padding.top":1,"S:grid.padding.bottom":1},c.Follower.IS_INTERESTED_FOLLOWER_STYLE={"follower.row.index":1,"follower.column.index":1,"follower.row.span":1,"follower.column.span":1,"follower.padding":1,"follower.padding.left":1,"follower.padding.right":1,"follower.padding.top":1,"follower.padding.bottom":1},d.ext("twaver.Follower",E,{_host:null,getHost:function(){return this._host},setHost:function(a){if(this===a||this._host===a)return;var b=this
._host;b&&b._removeFollower(this),this._host=a,this._host&&this._host._addFollower(this),this.firePropertyChange("host",b,a),this.onHostChanged(b,a)},onStyleChanged:function(a,b,d){c.Follower.superClass.onStyleChanged.call(this,a,b,d),c.Follower.IS_INTERESTED_FOLLOWER_STYLE[a]&&this.updateFollower(null)},setLocation:function(){if(this._isUpdatingLocation)return;this._isUpdatingLocation=!0,c.Follower.superClass.setLocation.apply(this,arguments),this._isUpdatingLocation=!1},onHostChanged:function(a,b){this.updateFollower(null)},handleHostPropertyChange:function(a){this.updateFollower(a)},updateFollower:function(a){if(this._isUpdatingFollower||d.isDeserializing)return;this._isUpdatingFollower=!0,this.updateFollowerImpl(a),this._isUpdatingFollower=!1},updateFollowerImpl:function(a){var b=this.getHost();if(b instanceof c.Grid){if(!a||c.Follower.IS_INTERESTED_HOST_GRID_PROPERTY[a.property]){var d=this.getStyle("follower.row.index"),e=this.getStyle("follower.column.index"),f=b.getCellRect(d,e);if(!f)return;var g=this.getStyle("follower.row.span"),h=this.getStyle("follower.column.span");if(g!=1||h!=1){var i=b.getCellRect(d+g-1,e+h-1);i&&(f=l.unionRect(f,i))}l.addPadding(f,this,"follower.padding"),this.setLocation(f.x,f.y),this.setWidth(f.width),this.setHeight(f.height)}}else if(a!=null&&a.property==="location"){var j=a.oldValue,k=a.newValue,m=this.getLocation();this.setLocation(m.x+(k.x-j.x),m.y+(k.y-j.y))}},isHostOn:function(a){if(!a)return!1;var b={},d=this._host;while(d&&d!=this&&!b[d.getId()]){if(d===a)return!0;b[d.getId()]=d,d instanceof c.Follower?d=d.getHost():d=null}return!1},isLoopedHostOn:function(a){return this.isHostOn(a)&&a.isHostOn(this)}});var F=function(a){this._isUpdatingLocationFromChildren=!1,this._isAdjusting=!1,this._expanded=!1,F.superClass.constructor.call(this,a)};c.Group=F,d.ext("twaver.Group",c.Follower,{_image:D.IMAGE_GROUP,_icon:D.ICON_GROUP,isAdjustedToBottom:function(){return this.isExpanded()&&s.hasAgentLinks(this)},onChildAdded:function(a,b){F.superClass.onChildAdded.apply(this,arguments),this.updateLocationFromChildren()},onChildRemoved:function(a,b){F.superClass.onChildRemoved.apply(this,arguments),this.updateLocationFromChildren()},updateLocationFromChildren:function(){if(this._isAdjusting||d.isDeserializing)return;var a,b=0,c=this.getChildrenSize(),e;for(;b<c;b++)e=this.getChildAt(b),e instanceof E&&(a=l.unionRect(a,this.getChildRect(e)));a&&(this._isUpdatingLocationFromChildren=!0,this.setLocation(a.x+a.width/2-this.getWidth()/2,a.y+a.height/2-this.getHeight()/2),this._isUpdatingLocationFromChildren=!1)},getChildRect:function(a){var b;return a instanceof E&&(a instanceof F?(a.isExpanded()&&a.getChildren().forEach(function(c){b=l.unionRect(b,a.getChildRect(c))}),b||(b=a.getRect())):b=a.getRect()),b},setLocation:function(){if(this._isAdjusting)return;var a;arguments.length===2?a={x:arguments[0],y:arguments[1]}:a=arguments[0];if(!d.isDeserializing&&!this._isUpdatingLocationFromChildren){this._isAdjusting=!0;var b=a.x-this.getX(),c=a.y-this.getY();s.moveElements(this.getChildren(),b,c),this._isAdjusting=!1}F.superClass.setLocation.call(this,a)},reverseExpanded:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._expanded},setExpanded:function(a){if(this._expanded===a)return;var b=this._expanded;this._expanded=a,this.firePropertyChange("expanded",b,this._expanded),this._checkLinkAgent()},_checkLinkAgent:function(){F.superClass._checkLinkAgent.call(this);var a=this.getChildrenSize();for(var b=0;b<a;b++){var c=this.getChildAt(b);c instanceof E&&c._checkLinkAgent()}},getElementUIClass:function(){return c.network.GroupUI},getCanvasUIClass:function(){return c.canvas.GroupUI}}),c.SubNetwork=function(a){c.SubNetwork.superClass.constructor.call(this,a)},d.ext("twaver.SubNetwork",c.Follower,{ISubNetwork:!0,_image:D.IMAGE_SUBNETWORK,_icon:D.ICON_SUBNETWORK,_checkLinkAgent:function(){c.SubNetwork.superClass._checkLinkAgent.call(this);var a=this.getChildrenSize();for(var b=0;b<a;b++){var d=this.getChildAt(b);d instanceof E&&d._checkLinkAgent()}}}),c.Grid=function(a){c.Grid.superClass.constructor.call(this,a)},d.ext("twaver.Grid",c.Follower,{_icon:D.ICON_GRID,_image:null,getCellObject:function(a,b){arguments.length===1&&(b=a.y,a=a.x);var c=this.getStyle("grid.row.count"),d=this.getStyle("grid.column.count");for(var e=0;e<c;e++)for(var f=0;f<d;f++){var g=this.getCellRect(e,f);if(l.containsPoint(g,a,b))return{rowIndex:e,columnIndex:f,rect:g}}return null},getCellRect:function(a,b){var c=this.getStyle("grid.row.count"),d=this.getStyle("grid.column.count");if(c<=0||d<=0)return null;if(a<0||a>=c)return null;if(b<0||b>=d)return null;var e=this.getRect();l.addPadding(e,this,"grid.border");var f=0,g=this.getStyle("grid.row.percents"),h=this.getStyle("grid.column.percents");if(g&&g.length===c){var i=0;for(f=0;f<a;f++)i+=e.height*g[f];e.y+=i,e.height=e.height*g[a]}else e.height=e.height/c,e.y+=e.height*a;if(h&&h.length===d){var j=0;for(f=0;f<b;f++)j+=e.width*h[f];e.x+=j,e.width=e.width*h[b]}else e.width=e.width/d,e.x+=e.width*b;return l.addPadding(e,this,"grid.padding"),e},getElementUIClass:function(){return c.network.GridUI},getCanvasUIClass:function(){return c.canvas.GridUI}}),c.ShapeNode=function(a){this._isUpdatingShapeNode=!1,this._points=new B,c.ShapeNode.superClass.constructor.call(this,a)},d.ext("twaver.ShapeNode",c.Follower,{_icon:D.ICON_SHAPENODE,__accessor:["segments"],getElementUIClass:function(){return c.network.ShapeNodeUI},getCanvasUIClass:function(){return c.canvas.ShapeNodeUI},getPoints:function(){return this._points},setPoints:function(a){a||(a=new B),this._points=a,this.firePointsChange()},getSegments:function(){return this._segments},setSegments:function(a){a||(a=new B),this._segments=a,this._reCalculateLineLength(),this.firePointsChange()},addPoint:function(a,b){this._points.add(a,b),this.firePointsChange()},setPoint:function(a,b){this._points.set(a,b),this.firePointsChange()},removePoint:function(a){this._points.remove(a),this.firePointsChange()},removeAt:function(a){this._points.removeAt(a),this.firePointsChange()},setWidth:function(a){a<1&&(a=1);if(!this._isUpdatingShapeNode&&!d.isDeserializing){this._isUpdatingShapeNode=!0;for(var b=0;b<this._points.size();b++){var e=this._points.get(b);e.x=(e.x-this.getX())*a/this.getWidth()+this.getX()}this.firePointsChange(),this._isUpdatingShapeNode=!1}c.ShapeNode.superClass.setWidth.apply(this,arguments)},setHeight:function(a){a<1&&(a=1);if(!this._isUpdatingShapeNode&&!d.isDeserializing){this._isUpdatingShapeNode=!0;for(var b=0;b<this._points.size();b++){var e=this._points.get(b);e.y=(e.y-this.getY())*a/this.getHeight()+this.getY()}this.firePointsChange(),this._isUpdatingShapeNode=!1}c.ShapeNode.superClass.setHeight.apply(this,arguments)},setLocation:function(){if(!this._isUpdatingShapeNode&&!d.isDeserializing){var a;arguments.length===2?a={x:arguments[0],y:arguments[1]}:a=arguments[0];if(!d.num(a.x)||!d.num(a.y))return;var b=a.x-this.getX(),e=a.y-this.getY();if(b===0&&e===0)return;this._isUpdatingShapeNode=!0;for(var f=0;f<this._points.size();f++){var g=this._points.get(f);g.x+=b,g.y+=e}this.firePointsChange(),this._isUpdatingShapeNode=!1}c.ShapeNode.superClass.setLocation.apply(this,arguments)},firePointsChange:function(){if(!this._isUpdatingShapeNode&&!d.isDeserializing){var a=l.getRect(this._points);a&&(this._isUpdatingShapeNode=!0,this.setLocation(a.x,a.y),this.setWidth(a.width),this.setHeight(a.height),this._isUpdatingShapeNode=!1)}this._reCalculateLineLength(),this.firePropertyChange("points",null,this._points)},_reCalculateLineLength:function(){this._points!=null&&this._points.size()>0?this._lineLength=l.calculateLineLength(this._points,this._segments):this._lineLength=0},getLineLength:function(){return this._lineLength}}),c.Bus=function(a){this._styleMap={},this._styleMap["vector.fill"]=!1,this._styleMap["shapenode.closed"]=!1,c.Bus.superClass.constructor.call(this,a)},d.ext("twaver.Bus",c.ShapeNode,{_icon:D.ICON_BUS,firePointsChange:function(){var a=this._points.size();if(!d.isDeserializing&&a>=2){var b=this._points.get(0);for(var e=1;e<a;e++){var f=this._points.get(e);Math.abs(f.x-b.x)>Math.abs(f.y-b.y)?f.y=b.y:f.x=b.x,b=f}}c.Bus.superClass.firePointsChange.apply(this,arguments)}}),c.ShapeLink=function(a,b,d){this._points=new B,this._styleMap={},this._styleMap["link.bundle.enable"]=!1,c.ShapeLink.superClass.constructor.call(this,a,b,d)},d.ext("twaver.ShapeLink",c.Link,{_icon:D.ICON_SHAPELINK,getElementUIClass:function(){return c.network.ShapeLinkUI},getCanvasUIClass:function(){return c.canvas.ShapeLinkUI},getPoints:function(){return this._points},setPoints:function(a){a||(a=new B),this._points=a,this.firePointsChange()},addPoint:function(a,b){this._points.add(a,b),this.firePointsChange()},setPoint:function(a,b){this._points.set(a,b),this.firePointsChange()},removePoint:function(a){this._points.remove(a),this.firePointsChange()},removeAt:function(a){this._points.removeAt(a),this.firePointsChange()},firePointsChange:function(){this.firePropertyChange("points",null,this._points)}}),c.ShapeSubNetwork=function(a){c.ShapeSubNetwork.superClass.constructor.call(this,a)},d.ext("twaver.ShapeSubNetwork",c.ShapeNode,{ISubNetwork:!0,_icon:D.ICON_SHAPESUBNETWORK,_checkLinkAgent:function(){c.ShapeSubNetwork.superClass._checkLinkAgent.call(this);var a=this.getChildrenSize();for(var b=0;b<a;b++){var d=this.getChildAt(b);d instanceof E&&d._checkLinkAgent()}}}),c.LinkSubNetwork=function(a){c.LinkSubNetwork.superClass.constructor.call(this,a)},d.ext("twaver.LinkSubNetwork",c.Link,{ISubNetwork:!0,_icon:D.ICON_LINKSUBNETWORK}),c.RotatableNode=function(a){c.RotatableNode.superClass.constructor.call(this,a)},d.ext("twaver.RotatableNode",c.Follower,{_angle:0,getAngle:function(){return this._angle},setAngle:function(a){var b=this._angle;this._angle=a,this.firePropertyChange("angle",b,a)},getWidth:function(){return this._angle==0?this._getOrignalWidth():this._getRotateRect().width},setWidth:function(a){},getHeight:function(){return this._angle==0?this._getOrignalHeight():this._getRotateRect().height},setHeight:function(a){},getElementUIClass:function(){return c.network.RotatableNodeUI},getCanvasUIClass:function(){return c.canvas.RotatableNodeUI},_getRotateRect:function(){var a=this._getOrignalWidth(),b=this._getOrignalHeight(),c=l.createMatrix(this._angle*Math.PI/180,a/2,b/2),d=[{x:0,y:0},{x:a,y:0},{x:a,y:b},{x:0,y:b}];for(var e=0,f=d.length;e<f;e++)d[e]=c.transform(d[e]);return l.getRect(d)},_getOrignalWidth:function(){return c.RotatableNode.superClass.getWidth.call(this)},_getOrignalHeight:function(){return c.RotatableNode.superClass.getHeight.call(this)}}),c.controls.ControlBase=function(){c.controls.ControlBase.superClass.constructor.apply(this,arguments),this._pools=new B},d.ext("twaver.controls.ControlBase",c.PropertyChangeDispatcher,{addPool:function(a){this._pools.contains(a)||this._pools.add(a)},removePool:function(a){this._pools.remove(a)},adjustBounds:function(a){var b=this._view.style;b.position="absolute",b.left=a.x+"px",b.top=a.y+"px",b.width=a.width+"px",b.height=a.height+"px",this.invalidate&&this.invalidate()},getView:function(){return this._view},invalidate:function(a){this._invalidate||(this._invalidate=!0,d.callLater(this.validate,this,null,a))},validate:function(){if(!this._invalidate)return;this._invalidate=!1,this._view.offsetWidth===0&&this._view.offsetHeight===0&&this._reinvalidateCount!==null?(this._reinvalidateCount===b&&(this._reinvalidateCount=100),this._reinvalidateCount>0?this._reinvalidateCount--:this._reinvalidateCount=null,this.invalidate()):this.validateImpl()},validateImpl:function(){}}),c.controls.ViewBase=function(){c.controls.ViewBase.superClass.constructor.apply(this,arguments),this._interactionDispatcher=new c.EventDispatcher,this._viewDispatcher=new c.EventDispatcher},d.ext("twaver.controls.ViewBase",c.controls.ControlBase,{__bool:["focusOnClick"],_focusOnClick:D.FOCUS_ON_CLICK,getSelectionModel:function(){return this._selectionModel?this._selectionModel:this._box.getSelectionModel()},isShareSelectionModel:function(){return this._selectionModel==null},setShareSelectionModel:function(a){var b=this._selectionModel==null;if(b===a)return;a?(this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.dispose(),this._selectionModel=null):(this._box.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel=new c.SelectionModel(this._box),this._selectionModel.addSelectionChangeListener(this.handleSelectionChange,this)),this.onShareSelectionModelChanged(),this.firePropertyChange("shareSelectionModel",b,a)},removeSelection:function(){if(this.getSelectionModel().size()===0)return null;var a=this.getSelectionModel().toSelection();return a.forEach(function(a){this._box.remove(a)},this),a},selectAll:function(){var a=new B;return this._box.forEach(function(b){this.isVisible(b)&&a.add(b)},this),this.getSelectionModel().setSelection(a),a},isSelected:function(a){return this.getSelectionModel().contains(a)},isSelectable:function(a){return this.getSelectionModel().isSelectable(a)},getLabel:function(a){return a.getName()},getToolTip:function(a){return a.getToolTip()},getIcon:function(a){return a.getIcon()},getSelectColor:function(a){return D.SELECT_COLOR},addViewListener:function(a,b,c){this._viewDispatcher.add(a,b,c)},removeViewListener:function(a,b){this._viewDispatcher.remove(a,b)},fireViewEvent:function(a){this._viewDispatcher.fire(a)},addInteractionListener:function(a,b,c){this._interactionDispatcher.add(a,b,c)},removeInteractionListener:function(a,b){this._interactionDispatcher.remove(a,b)},fireInteractionEvent:function(a){this._interactionDispatcher.fire(a)},invalidate:function(a){this._invalidate||(this._invalidate=!0,this.fireViewEvent({kind:"invalidate"}),d.callLater(this.validate,this,null,a))},validate:function(){if(!this._invalidate)return;this._invalidate=!1,this._isValidating=!0,this.fireViewEvent({kind:"validateStart"}),this.validateImpl(),this.fireViewEvent({kind:"validateEnd"}),delete this._isValidating}}),c.controls.View=function(){c.controls.View.superClass.constructor.apply(this,arguments)},d.ext("twaver.controls.View",c.controls.ViewBase,{_zoom:1,_maxZoom:D.ZOOM_MAX,_minZoom:D.ZOOM_MIN,getRootDiv:function(){return this._rootDiv},isValidEvent:function(a){return p.isValidEvent(this._view,a)},getAlarmFillColor:function(a){if(a.IElement){var b=a.getAlarmState().getHighestNewAlarmSeverity();if(b)return b.color}return null},getInnerColor:function(a){if(a.IElement){var b=a.getAlarmState().getHighestNativeAlarmSeverity();return b?b.color:a.getStyle("inner.color")}return null},getOuterColor:function(a){if(a.IElement){var b=a.getAlarmState().getPropagateSeverity();return b?b.color:a.getStyle("outer.color")}return null},zoomOverview:function(a){var b=Math.min(this._view.clientWidth/this._viewRect.width,this._view.clientHeight/this._viewRect.height);this.setZoom(b,a)},getLogicalPoint:function(a){return p.getLogicalPoint(this._view,a,this.getZoom(),this._rootDiv)},centerByLogicalPoint:function(a,b,d){d&&c.animate.AnimateManager.endAnimate();var e=this._view.scrollWidth-this._view.clientWidth,f=this._view.scrollHeight-this._view.clientHeight,g=(a-this._view.clientWidth/this._zoom/2)*this._zoom,h=(b-this._view.clientHeight/this._zoom/2)*this._zoom;g<0&&(g=0),h<0&&(h=0),g>e&&(g=e),h>f&&(h=f),d?c.animate.AnimateManager.start(new c.animate.AnimateScrollPosition(this._view,g,h)):(this._view.scrollLeft=g,this._view.scrollTop=h)},panByOffset:function(a,b){a*=this.getZoom(),b*=this.getZoom();var c=this._view.scrollLeft+a,d=this._view.scrollTop+b,e=this._view.scrollWidth-this._view.clientWidth,f=this._view.scrollHeight-this._view.clientHeight;c<0&&(c=0),c>e&&(c=e),d<0&&(d=0),d>f&&(d=f);var g={x:(c-this._view.scrollLeft)/this.getZoom(),y:(d-this._view.scrollTop)/this.getZoom()};return this._view.scrollLeft=c,this._view.scrollTop=d,g},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(a){if(a<0)return;var b=this._maxZoom;this._maxZoom=a,this.firePropertyChange("maxZoom",b,a),this.getZoom()>a&&this.setZoom(a)},getMinZoom:function(){return this._minZoom},setMinZoom:function(a){if(a<0)return;var b=this._minZoom;this._minZoom=a,this.firePropertyChange("minZoom",b,a),this.getZoom()<a&&this.setZoom(a,!1)},getZoom:function(){return this._zoom},onZoomChanged:function(a,b){},zoomIn:function(a){this.setZoom(this._zoom*D.ZOOM_INCREMENT,a)},zoomOut:function(a){this.setZoom(this._zoom/D.ZOOM_INCREMENT,a)},zoomReset:function(a){this.setZoom(1,a)},setZoom:function(a,b){if(!d.num(a)||a<=0)return;a<this._minZoom&&(a=this._minZoom),a>this._maxZoom&&(a=this._maxZoom);if(a===this._zoom)return;b==null&&(b=D.ZOOM_ANIMATE);if(b)c.animate.AnimateManager.start(new c.animate.AnimateZoom(this,a));else{var e=(this._view.scrollLeft+this._view.clientWidth/2)/this._zoom,f=(this._view.scrollTop+this._view.clientHeight/2)/this._zoom,g=this._zoom;this._zoom=a,p.setZoom(this._rootDiv,a),this.firePropertyChange("zoom",g,a),this.onZoomChanged(g,a),this.centerByLogicalPoint(e,f,!1)}}}),c.charts.IS_INVALIDATE_PROPERTY={xZoom:1,xTranslate:1,yZoom:1,yTranslate:1},c.charts.ChartBase=function(a){c.charts.ChartBase.superClass.constructor.apply(this,arguments),this._uniqueColors={},this._nonDataColors={},this._publishedDatas=new B,this._view=p.createView("hidden"),this._canvas=p.createCanvas(),this._view.appendChild(this._canvas),this.setDataBox(a?a:new c.ElementBox),this.invalidate();var b;g.isTouchable?b=c.charts.ChartTouchInteraction:b=c.charts.ChartInteraction,b&&new b(this),this.setToolTipEnabled(D.CHART_TOOLTIP_ENABLED)},d.ext("twaver.charts.ChartBase",c.controls.ViewBase,{__accessor:["xGap","yGap","xTranslate","yTranslate","valueVisible","sortFunction","visibleFunction","xTranslateEnabled","yTranslateEnabled","xZoomEnabled","yZoomEnabled","selectTolerance","backgroundVisible","backgroundFill","backgroundFillColor","backgroundOutlineWidth","backgroundOutlineColor","backgroundGradient","backgroundGradientColor"],__bool:["doubleClickToReset","focusOnClick"],_backgroundVisible:D.CHART_BACKGROUND_VISIBLE,_backgroundFill:D.CHART_BACKGROUND_FILL,_backgroundFillColor:D.CHART_BACKGROUND_FILL_COLOR,_backgroundOutlineWidth:D.CHART_BACKGROUND_OUTLINE_WIDTH,_backgroundOutlineColor:D.CHART_BACKGROUND_OUTLINE_COLOR,_backgroundGradient:D.CHART_BACKGROUND_GRADIENT,_backgroundGradientColor:D.CHART_BACKGROUND_GRADIENT_COLOR,_selectTolerance:D.CHART_SELECT_TOLERANCE,_doubleClickToReset:D.CHART_DOUBLE_CLICK_TO_RESET,_focusOnClick:D.FOCUS_ON_CLICK,_sortFunction:null,_visibleFunction:null,_canvasWidth:0,_canvasHeight:0,_xGap:D.CHART_XGAP,_yGap:D.CHART_YGAP,_xTranslate:0,_yTranslate:0,_xTranslateEnabled:D.CHART_XTRANSLATE_ENABLED,_yTranslateEnabled:D.CHART_YTRANSLATE_ENABLED,_xZoom:1,_yZoom:1,_maxZoom:D.ZOOM_MAX,_minZoom:D.ZOOM_MIN,_xZoomEnabled:D.CHART_XZOOM_ENABLED,_yZoomEnabled:D.CHART_YZOOM_ENABLED,_valueVisible:D.CHART_VALUE_VISIBLE,_valueFont:D.CHART_VALUE_FONT,isToolTipEnabled:function(){return this._toolTipListener?!0:!1},setToolTipEnabled:function(a){if(a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){y.showToolTip(a,b.getToolTip(a))},this._canvas.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(y.hideToolTip(),this._canvas.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},getToolTip:function(a){if(this._toolTipInfos){var b=this.getLogicalPoint(a);b.x-=this._xTranslate,b.y-=this._yTranslate;var c=this._toolTipInfos.size();for(var d=c-1;d>=0;d--){var e=this._toolTipInfos.get(d);if(e.rect&&l.containsPoint(e.rect,b))return this.getToolTipByData(e.data,e)}}else{var f=this.tryGetDataAt(a);if(f)return this.getToolTipByData(f,{value:this.getValue(f)})}return null},getToolTipByData:function(a,c){return c.value!==b?this.formatValueText(c.value,a):null},addToolTipInfo:function(a,b,c,d,e,f,g){this._toolTipInfos&&this._toolTipInfos.add({data:f,rect:{x:a,y:b,width:c,height:d},value:e,index:g})},getLogicalPoint:function(a){return p.getLogicalPoint(this._canvas,a,1)},getTextSize:function(a,b){var c=q.getTextSize(a,b);return c.width&&(c.width+=4),c},getUniqueColor:function(a,c){if(a==null)return null;var d;if(!c){d=this._nonDataColors[a];if(d)return d}var e=q.getColorArray(a);if(!c)return e[3]!=255?d=a:d="rgba("+e[0]+","+e[1]+","+e[2]+",0.99)",this._nonDataColors[a]=d,d;var f="rgb("+e[0]+","+e[1]+","+e[2]+")";if(this._uniqueColors[f]!==b&&this._uniqueColors[f]!==c){var h=1,i=-1,j=1;g.isOpera&&(e=[e[0],e[1],e[2]]);for(;;){e[0]+=h,e[0]>=255?(e[0]=255,h=-1):e[0]<=0&&(e[0]=0,h=1),f="rgb("+e[0]+","+e[1]+","+e[2]+")";if(this._uniqueColors[f]===b||this._uniqueColors[f]===c)break;e[1]+=i,e[1]>=255?(e[1]=255,i=-1):e[1]<=0&&(e[1]=0,i=1),f="rgb("+e[0]+","+e[1]+","+e[2]+")";if(this._uniqueColors[f]===b||this._uniqueColors[f]===c)break;e[2]+=j,e[2]>=255?(e[2]=255,j=-1):e[2]<=0&&(e[2]=0,j=1),f="rgb("+e[0]+","+e[1]+","+e[2]+")";if(this._uniqueColors[f]===b||this._uniqueColors[f]===c)break}}return this._uniqueColors[f]=c,f},tryGetDataAt:function(a,b){if(b==null||b<0)b=this._selectTolerance;a.target&&(a=p.getLogicalPoint(this._canvas,arguments[0],1));if(!a)return null;var c=a.x-b,d=a.y-b,e=b*2+1,f=b*2+1;try{var g=this._canvas.getContext("2d").getImageData(c,d,e,f).data;for(var h=0;n=g.length,h<n;h+=4)if(g[h+3]===255){var i="rgb("+g[h]+","+g[h+1]+","+g[h+2]+")",j=this._uniqueColors[i];if(j)return j}}catch(k){}return null},_getPoint:function(){var a,b;if(arguments.length===2)a=arguments[0],b=arguments[1];else if(arguments[0].target){var c=p.getLogicalPoint(this._canvas,arguments[0],1);if(!c)return null;a=c.x,b=c.y}else a=arguments[0].x,b=arguments[0].y;return{x:a,y:b}},getDataAt:function(){var a=this._getPoint.apply(this,arguments),b=a.x,c=a.y;if(b<0||c<0||b>this._canvasWidth||c>this._canvasHeight)return null;try{var d=this._canvas.getContext("2d").getImageData(b,c,1,1).data;if(d[3]===255){var e="rgb("+d[0]+","+d[1]+","+d[2]+")",f=this._uniqueColors[e];if(f)return f}}catch(g){}return null},getBackgroundRect:function(){return this._backgroundRect},drawBackground:function(a,b){this._backgroundRect=d.clone(b),b!=null&&b.width>0&&b.height>0&&this._backgroundVisible&&(this._backgroundFill&&q.fill(a,this.getUniqueColor(this._backgroundFillColor),this._backgroundGradient,this.getUniqueColor(this._backgroundGradientColor),b),this._backgroundOutlineWidth>0&&(a.lineWidth=this._backgroundOutlineWidth,a.strokeStyle=this._backgroundOutlineColor),a.beginPath(),a.rect(b.x,b.y,b.width,b.height),a.closePath(),this._backgroundFill&&a.fill(),this._backgroundOutlineWidth>0&&a.stroke())},getName:function(a){return a.getName()},getColor:function(a){return a.getStyle?a.getStyle("chart.color"):a.getClient("chart.color")},getValue:function(a){return a.getStyle?a.getStyle("chart.value"):0},getValueColor:function(a){return a.getStyle?a.getStyle("chart.value.color"):c.Styles.getStyle("chart.value.color")},setValueFont:function(a){if(a===this._valueFont)return;var b=a;this._valueFont=a,this.firePropertyChange("valueFont",b,a)},getValueFont:function(a){if(a){var b=a.getStyle?a.getStyle("chart.value.font"):c.Styles.getStyle("chart.value.font");if(b)return b}return this._valueFont},formatValueText:function(a,b){return a},getCanvasWidth:function(){return this._canvasWidth},getCanvasHeight:function(){return this.canvasHeight},getCanvas:function(){return this._canvas},isVisible:function(a){return this._internalVisibleFunction&&!this._internalVisibleFunction(a)?!1:this._visibleFunction?this._visibleFunction(a):!0},onPropertyChanged:function(a){c.charts.IS_INVALIDATE_PROPERTY[a.property]?this.invalidate():this.invalidateModel()},getDataBox:function(){return this._box},setDataBox:function(a){if(!a)throw"DataBox can not be null";if(this._box===a)return;var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleDataBoxChange,this),b.removeDataPropertyChangeListener(this.handlePropertyChange,this),b.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange("dataBox",b,this._box)},handleDataBoxChange:function(a){this.invalidateModel()},handlePropertyChange:function(a){this.invalidateModel()},handleHierarchyChange:function(a){this.invalidateModel()},handleSelectionChange:function(a){this.invalidateModel()},getUnfilteredDatas:function(){return this._unfilteredDatas?this._unfilteredDatas:this._publishedDatas},getPublishedDatas:function(){return this._publishedDatas},createPublishedDatas:function(){return this._unfilteredDatas=new B,this._buildChildren(this._box.getRoots(),this._unfilteredDatas),this._sortFunction&&this._unfilteredDatas.sort(this._sortFunction),this._unfilteredDatas.toList(this.isVisible,this)},_buildChildren:function(a,b){a.forEach(function(a){b.add(a),this._buildChildren(a.getChildren(),b)},this)},invalidateModel:function(){if(this._invalidateModel)return;this._invalidateModel=!0,this.invalidate()},validateImpl:function(){this._invalidateModel&&(this._invalidateModel=!1,this._uniqueColors={},this._nonDataColors={},this._publishedDatas=this.createPublishedDatas(),this._publishedDatas.forEach(function(a){a.IStyle?a.getStyle("chart.color")||a.setStyle("chart.color",d.nextColor()):a.getClient("chart.color")||a.setClient("chart.color",d.nextColor())}),this.validateModel());var a=this._canvas.getContext("2d");this._canvasWidth=this._view.clientWidth,this._canvasHeight=this._view.clientHeight,this._canvas.setAttribute("width",this._canvasWidth),this._canvas.setAttribute("height",this._canvasHeight),a.clearRect(0,0,this._canvasWidth,this._canvasHeight),this._canvasWidth>0&&this._canvasHeight>0&&(a.translate(this._xTranslate,this._yTranslate),this._valueTexts=this._valueVisible?new B:null,this.validateDisplay(a,this._canvasWidth*this._xZoom,this._canvasHeight*this._yZoom),delete this._valueTexts,a.translate(-this._xTranslate,-this._yTranslate))},validateModel:function(){},validateDisplay:function(a,b,c){},drawLine:function(a,b,c,d,e,f,g){c>0&&(a.lineWidth=c,a.strokeStyle=this.getUniqueColor(b),a.beginPath(),a.moveTo(d,e),a.lineTo(f,g),a.stroke())},drawValueTexts:function(a){this._valueTexts&&this._valueTexts.forEach(function(b){q.drawText(a,b.text,b,b.font,b.color)})},drawVerticalText:function(a,b,c,d,e){e=this.getUniqueColor(e),a.translate(c.x,c.y),a.rotate(-Math.PI/2),q.drawText(a,b,null,d,e),a.rotate(Math.PI/2),a.translate(-c.x,-c.y)},_getValueTextInfo:function(a,b){if(this._valueTexts){var c=this.formatValueText(b,a);if(c&&c!==""){var d=this.getValueColor(a),e={text:c,font:this.getValueFont(a),color:this.getUniqueColor(d,a)};return this._valueTexts.add(e),e}}return null},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(a){if(a<0)return;var b=this._maxZoom;this._maxZoom=a,this.firePropertyChange("maxZoom",b,a),this.getXZoom()>a&&this.setXZoom(a,!1),this.getYZoom()>a&&this.setYZoom(a,!1)},getMinZoom:function(){return this._minZoom},setMinZoom:function(a){if(a<0)return;var b=this._minZoom;this._minZoom=a,this.firePropertyChange("minZoom",b,a),this.getXZoom()<a&&this.setXZoom(a),this.getYZoom()<a&&this.setYZoom(a)},zoomIn:function(a){a==null&&(a=D.ZOOM_ANIMATE),a?c.animate.AnimateManager.start(new c.animate.AnimateXYZoom(this,this._xZoom*D.ZOOM_INCREMENT,this._yZoom*D.ZOOM_INCREMENT)):(this.xZoomIn(!1),this.yZoomIn(!1))},zoomOut:function(a){a==null&&(a=D.ZOOM_ANIMATE),a?c.animate.AnimateManager.start(new c.animate.AnimateXYZoom(this,this._xZoom/D.ZOOM_INCREMENT,this._yZoom/D.ZOOM_INCREMENT)):(this.xZoomOut(!1),this.yZoomOut(!1))},zoomReset:function(a){a==null&&(a=D.ZOOM_ANIMATE),a?c.animate.AnimateManager.start(new c.animate.AnimateXYZoom(this,1,1)):(this.xZoomReset(!1),this.yZoomReset(!1))},getXZoom:function(){return this._xZoom},onXZoomChanged:function(a,b){},xZoomIn:function(a){this.setXZoom(this._xZoom*D.ZOOM_INCREMENT,a)},xZoomOut:function(a){this.setXZoom(this._xZoom/D.ZOOM_INCREMENT,a)},xZoomReset:function(a){this.setXZoom(1,a)},setXZoom:function(a,b){if(!d.num(a)||a<=0)return;a<this._minZoom&&(a=this._minZoom),a>this._maxZoom&&(a=this._maxZoom);if(a===this.xZoom)return;b==null&&(b=D.ZOOM_ANIMATE);if(b)c.animate.AnimateManager.start(new c.animate.AnimateXZoom(this,a));else{var e=this._xZoom,f=this._xTranslate-(this._canvasWidth/2-this._xTranslate)/e*(a-e);this._xZoom=a,this.firePropertyChange("xZoom",e,a),this.onXZoomChanged(e,a),this.setXTranslate(f)}},getYZoom:function(){return this._yZoom},onYZoomChanged:function(a,b){},yZoomIn:function(a){this.setYZoom(this._yZoom*D.ZOOM_INCREMENT,a)},yZoomOut:function(a){this.setYZoom(this._yZoom/D.ZOOM_INCREMENT,a)},yZoomReset:function(a){this.setYZoom(1,a)},setYZoom:function(a,b){if(!d.num(a)||a<=0)return;a<this._minZoom&&(a=this._minZoom),a>this._maxZoom&&(a=this._maxZoom);if(a===this.YZoom)return;b==null&&(b=D.ZOOM_ANIMATE);if(b)c.animate.AnimateManager.start(new c.animate.AnimateYZoom(this,a));else{var e=this._yZoom,f=this._yTranslate-(this._canvasHeight/2-this._yTranslate)/e*(a-e);this._yZoom=a,this.firePropertyChange("yZoom",e,a),this.onYZoomChanged(e,a),this.setYTranslate(f)}}}),c.charts.ScaleChart=function(a){c.charts.ScaleChart.superClass.constructor.apply(this,arguments)},d.ext("twaver.charts.ScaleChart",c.charts.ChartBase,{__accessor:["upperLimit","lowerLimit","xAxisText","xAxisLineColor","xAxisLineWidth","xAxisTextColor","xAxisTextFont","yAxisText","yAxisLineColor","yAxisLineWidth","yAxisTextColor","yAxisTextFont","xScaleTexts","xScaleTextFont","xScaleTextColor","xScaleTextOrientation","yScaleTextVisible","yScaleTextColor","yScaleTextFont","yScaleLineColor","yScaleLineWidth","yScaleValueGap","yScalePixelGap","yScaleMinTextVisible"],_reset:function(){this._map={},this._max=0,this._min=0,this._columnCount=this._xScaleTexts?this._xScaleTexts.size():0,this._upperLimit!=null&&(this._max=this._upperLimit),this._lowerLimit!=null&&(this._min=this._lowerLimit)},getMin:function(){return this._min},getMax:function(){return this._max},getRange:function(){return this._range},getColumnCount:function(){return this._columnCount},getColumnWidth:function(){return this._columnWidth},getValues:function(a){return a.getStyle?a.getStyle("chart.values"):null},formatYScaleText:function(a){return a.toFixed(2)},_initRange:function(){this._lowerLimit==null&&(this._min>=this._max&&(this._min=this._max-Math.abs(this._max)*.1),this._min=this._min-(this._max-this._min)*.1),this._range=this._max-this._min},_initValuesProportion:function(){this._publishedDatas.forEach(function(a){var b=this._map[a.getId()];b.values.forEach(function(a){a==null?b.proportions.add(null):b.proportions.add(this._range==0?0:a/this._range)},this)},this)},_commonValidateModel:function(){this._publishedDatas.forEach(function(a){var b=new B(this.getValues(a));b.size()>this._columnCount&&(this._columnCount=b.size());var c={data:a,values:b,proportions:new B,color:this.getUniqueColor(this.getColor(a),a)};this._initInfo&&this._initInfo(a,c),this._map[a.getId()]=c,(this._upperLimit==null||this._lowerLimit==null)&&b.forEach(function(a){a!=null&&(this._upperLimit==null&&a>this._max&&(this._max=a),this._lowerLimit==null&&a<this._min&&(this._min=a))},this)},this),this._initRange(),this._initValuesProportion()},validateDisplay:function(a,b,c){var d=0;this._xAxisText&&(d=this.getTextSize(this._xAxisTextFont,this._xAxisText).height);var e=0;this._xScaleTexts&&this._xScaleTexts.forEach(function(a){var b=this.getTextSize(this._xScaleTextFont,a),c=this._xScaleTextOrientation==="vertical"?b.width:b.height;c>e&&(e=c)},this);var f=c-this._yGap-d-e,g=f-this._yGap,h=this._upperLimit==null?g*.9:g,i=0;this._yAxisText&&(i=this.getTextSize(this._yAxisTextFont,this._yAxisText).height);var j,k;this._yScaleValueGap>0?(j=Math.max(this._yScaleValueGap/this._range*h,1),k=this._yScaleValueGap):(j=Math.max(this._yScalePixelGap,1),k=this._range*(j/h));var l=0,m=new B,n,o;if(this._yScaleTextVisible){n=this._yScaleMinTextVisible?0:j;var p=this._min+(this._yScaleMinTextVisible?0:k);while(n<=g+1){o=this.formatYScaleText(p);if(o){var r=this.getTextSize(this._yScaleTextFont,o);r.width>l&&(l=r.width),m.add({text:o,size:r,cursor:n})}n+=j,p+=k}}var s={x:this._xGap+i+l,y:this._yGap,width
:b-this._xGap-i-l-this._xGap,height:c-this._yGap-e-d-this._yGap};this.drawBackground(a,s),this._columnCount>0?this._columnWidth=s.width/(this._columnCount*3+1)*2:this._columnWidth=s.width/2,this._columnWidth===0&&(this._columnWidth=1);if(this._yScaleLineWidth>0){n=0;while(n<=g+1)this.drawLine(a,this._yScaleLineColor,this._yScaleLineWidth,s.x,f-n,s.x+s.width,f-n),n+=j}this._xAxisText&&q.drawText(a,this._xAxisText,{x:s.x+s.width/2,y:f+e+d/2},this._xAxisTextFont,this.getUniqueColor(this._xAxisTextColor)),this._yAxisText&&this.drawVerticalText(a,this._yAxisText,{x:this._xGap+i/2,y:g/2+this._yGap},this._yAxisTextFont,this.getUniqueColor(this._yAxisTextColor)),this.drawLine(a,this._yAxisLineColor,this._yAxisLineWidth,s.x,s.y+s.height,s.x,s.y);var t=this.getUniqueColor(this._yScaleTextColor);m.forEach(function(b){var c={x:this._xGap+i+l-b.size.width/2,y:f-b.cursor};q.drawText(a,b.text,c,this._yScaleTextFont,t)},this);var u=s.y+s.height+e/2;t=this.getUniqueColor(this._xScaleTextColor);var v=this._xScaleLineWidth>0?this.getUniqueColor(this._xScaleLineColor):null;for(var w=0;w<this._columnCount;w++){var x=s.x+this._columnWidth*(1+w*1.5);if(this._xScaleTexts&&w<this._xScaleTexts.size()){o=this._xScaleTexts.get(w);if(o){var y={x:x,y:u};this._xScaleTextOrientation==="vertical"?this.drawVerticalText(a,o,y,this._yScaleTextFont,t):q.drawText(a,o,y,this._xScaleTextFont,t)}}this._type!=="default"&&v&&this.drawLine(a,v,this._xScaleLineWidth,x,s.y+s.height,x,s.y)}var z=f+this._min/k*j;this._publishedDatas.size()>0&&this._columnCount>0&&this.drawContent(a,s,h,z),this.drawLine(a,this._xAxisLineColor,this._xAxisLineWidth,s.x,s.y+s.height,s.x+s.width,s.y+s.height)}}),c.controls.ListBase=function(a){c.controls.ListBase.superClass.constructor.apply(this,arguments),this._invalidate=!1,this._invalidateModel=!1,this._invalidateDisplay=!1,this._invalidateDatas=null,this._rowDatas=new B,this._startRowIndex=0,this._endRowIndex=0,this._renderMap={},this._dataRowMap={},this.__divPool=new c.Pool("div",20),this.__imagePool=new c.Pool("img",20),this.__canvasPool=new c.Pool("canvas",20),this.__spanPool=new c.Pool("span",20),this.__textPool=new c.Pool("span",20),this.__checkBoxPool=new c.Pool("input",20),this._pools.add(this.__divPool),this._pools.add(this.__imagePool),this._pools.add(this.__canvasPool),this._pools.add(this.__spanPool),this._pools.add(this.__textPool),this._pools.add(this.__checkBoxPool),this._view=p.createView("auto"),this._rootDiv=p.createDiv(),this._dataDiv=p.createDiv(),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._dataDiv),this.setDataBox(a?a:new c.DataBox);var b=this;b.handleChange&&b._view.addEventListener("change",function(a){b.handleChange(a)},!1);var d;g.isTouchable?d=c.controls.ListBaseTouchInteraction:d=c.controls.ListBaseInteraction,d&&new d(this)},d.ext("twaver.controls.ListBase",c.controls.View,{getDataDiv:function(){return this._dataDiv},getStartRowIndex:function(){return this._startRowIndex},getEndRowIndex:function(){return this._endRowIndex},getRowDatas:function(){return this._rowDatas},getRowIndexByData:function(a){return this._dataRowMap[a.getId()]},getRowIndexById:function(a){return this._dataRowMap[a]},getRowSize:function(){return this._rowDatas.size()},getDataBox:function(){return this._box},setDataBox:function(a){if(!a)throw"DataBox can not be null";if(this._box===a)return;var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleDataBoxChange,this),b.removeDataPropertyChangeListener(this.handlePropertyChange,this),b.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange("dataBox",b,this._box)},onPropertyChanged:function(a){a.property==="zoom"?this.invalidate():this.invalidateModel()},invalidateModel:function(){if(this._invalidateModel)return;this._invalidateModel=!0,this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate()},invalidateDisplay:function(){if(this._invalidateDisplay)return;this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate()},invalidateData:function(a){if(this._invalidateDisplay)return;this._invalidateDatas||(this._invalidateDatas={}),this._invalidateDatas[a.getId()]=a,this.invalidate()},validateImpl:function(){var a=this._view.scrollLeft,b=this._view.scrollTop;this._invalidateModel&&(this._invalidateModel=!1,this.validateModel()),this._invalidateDisplay&&(this._invalidateDisplay=!1,this._renderMap={},p.release(this._dataDiv),this._dataDiv.style.height=this.getRowSize()*this._rowHeight+"px");var c;if(this._invalidateDatas){for(c in this._invalidateDatas){var e=this._renderMap[c];e&&(p.release(e),this._dataDiv.removeChild(e),delete this._renderMap[c])}this._invalidateDatas=null}var f=this._view.scrollTop/this._zoom,g=this._view.clientHeight/this._zoom;this._startRowIndex=Math.floor(f/this._rowHeight)-2,this._endRowIndex=Math.ceil((f+g)/this._rowHeight)+2,this._startRowIndex<0&&(this._startRowIndex=0),this._endRowIndex>this._rowDatas.size()&&(this._endRowIndex=this._rowDatas.size());var h=this._rowHeight-this._rowLineWidth-2+"px",i=this._rowLineWidth+"px";for(var j=this._startRowIndex;j<this._endRowIndex;j++){var k=this._rowDatas.get(j);c=k.getId();var l=this._renderMap[c];if(!l){l=this.__divPool.get();var m=l.style;m.position="absolute",m.whiteSpace="nowrap",m.lineHeight=h,m.top=j*this._rowHeight+"px",m.borderStyle="solid",m.borderWidth="0px",m.borderBottomWidth=i,m.borderBottomColor=this._rowLineColor,this._dataDiv.appendChild(l),this._renderMap[c]=l;var n=this.isSelected(k);this.renderData(l,k,j,n),this.onDataRendered(l,k,j,n)}}d.keys(this._renderMap).forEach(function(a){var b=this.getRowIndexById(a);if(b<this._startRowIndex||b>=this._endRowIndex){var c=this._renderMap[a];p.release(c),this._dataDiv.removeChild(c),delete this._renderMap[a]}},this),this._pools.forEach(function(a){a.clear()}),this._view.scrollLeft!==a&&(this._view.scrollLeft=a),this._view.scrollTop!==b&&(this._view.scrollTop=b),this.adjustRowSize(),this.onValidated()},adjustRowSize:function(){var a,b,c=this._rowHeight-this._rowLineWidth+"px",d=Math.floor((this._view.scrollLeft+this._view.clientWidth)/this._zoom)+"px";for(a in this._renderMap)b=this._renderMap[a],b.style.height=c,b.style.width=d},onValidated:function(){},onDataRendered:function(a,b,c,d){},_addCheckBox:function(a,b,c){var d=this.__checkBoxPool.get();return d.keepDefault=!0,d.type="checkbox",d.style.margin="0px 2px",d.style.verticalAlign="middle",d._checkData=b,d.checked=c,d.disabled=!1,a.appendChild(d),d},_addIcon:function(a,b,c,e){var f=d.getImageAsset(c),g=this.getInnerColor(b),h=this.getOuterColor(b),i=this.getAlarmFillColor(b),j;if((g||h||i)&&f&&f.getImage()){var k=f.getWidth(),l=f.getHeight();j=this.__canvasPool.get(),j.style.verticalAlign="middle",j.setAttribute("width",k),j.setAttribute("height",l);var m=j.getContext("2d");m.clearRect(0,0,k,l),m.drawImage(f.getImage(g),0,0,k,l),h&&(m.lineWidth=2,m.strokeStyle=h,m.beginPath(),m.rect(0,0,k,l),m.closePath(),m.stroke()),i&&(m.fillStyle=q.createRadialGradient(m,i,"white",1,l-9,8,8,.75,.25),m.beginPath(),m.arc(5,l-5,4,0,Math.PI*2,!0),m.closePath(),m.fill())}else j=this.__imagePool.get(),j.style.verticalAlign="middle",j.setAttribute("src",d.getImageSrc(c));j.style.margin="0px 1px 0px 1px",j._selectData=e,a.appendChild(j)},isVisible:function(a){return this._box.contains(a)?this._visibleFunction?this._visibleFunction(a):!0:!1},handleDataBoxChange:function(a){this.invalidateModel()},handlePropertyChange:function(a){a.property==="parent"?this.invalidateModel():this.invalidateData(a.source)},handleHierarchyChange:function(a){this.invalidateModel()},handleSelectionChange:function(a){a.datas.forEach(function(a){this.invalidateData(a)},this),this.onSelectionChanged(a)},getRowIndexAt:function(a){var b=this.getLogicalPoint(a);if(!b)return-1;var c=parseInt(b.y/this._rowHeight);return c>=0&&c<this._rowDatas.size()?c:-1},getDataAt:function(a){var b=this.getRowIndexAt(a);return b>=0?this._rowDatas.get(b):null},getCurrentSortFunction:function(){return this._sortFunction},validateModel:function(){this._rowDatas.clear(),this._dataRowMap={},this._buildChildren(this._box.getRoots()),this._rowDatas=this._rowDatas.toList(this.isVisible,this);var a=this.getCurrentSortFunction();a&&this._rowDatas.sort(a);var b=this._rowDatas.size();for(var c=0;c<b;c++)this._dataRowMap[this._rowDatas.get(c).getId()]=c},_buildChildren:function(a){a.forEach(function(a){this._rowDatas.add(a),this._buildChildren(a.getChildren())},this)},_handlePressSelection:function(a,b){var c=this.getSelectionModel();if(d.isCtrlDown(b))c.contains(a)?c.removeSelection(a):c.appendSelection(a);else if(b.shiftKey&&c.getLastData()){var e=c.getLastData(),f=this.getRowIndexByData(e),g=this.getRowIndexByData(a),h=new B;h.add(this.getRowDatas().get(f));while(f!==g)f+=g>f?1:-1,h.add(this.getRowDatas().get(f));c.setSelection(h)}else(c.size()!==1||!c.contains(a))&&c.setSelection(a);this.fireInteractionEvent({kind:b.detail===2?"doubleClick":"click",data:a})},_handleClick:function(a){this.isFocusOnClick()&&c.Util.setFocus(this._view);if(!this.isCheckMode()){var b=this.getDataAt(a);b&&this._handlePressSelection(b,a)}this._currentEditor&&this.commitEditValue(this._currentEditor._editInfo,this._currentEditor),this.updateCurrentEditor&&this.updateCurrentEditor(a)},handleChange:function(a){if(this._isCanceling||this._isValidating)return;var b=a.target._checkData;if(b){var c=this.isSelected(b),d=this.getSelectionModel();c?d.removeSelection(b):d.appendSelection(b)}a.target._editInfo&&this.commitEditValue&&this.commitEditValue(a.target._editInfo,a.target)},scrollToData:function(a){var b=this.getRowIndexById(a.getId());if(b<0)return;var c=b*this._rowHeight,d=c+this._rowHeight,e=this._view.scrollTop;this._view.scrollTop>c&&(e=c),this._view.scrollTop+this._view.clientHeight<d&&(e=d-this._view.clientHeight),this._view.scrollTop!=e&&(this._view.scrollTop=e,this.invalidate())},makeVisible:function(a){if(!this.isVisible(a))return;this.expand&&this.expand(a),d.callLater(this.scrollToData,this,[a],D.CALL_LATER_DELAY*2)},onSelectionChanged:function(a){this._makeVisibleOnSelected&&(a.kind==="append"||a.kind==="set"||a.kind==="all")&&(this.expand&&this.getSelectionModel().getSelection().forEach(function(a){a.getParent()&&this.expand(a.getParent())},this),d.callLater(this.scrollToData,this,[this.getSelectionModel().getLastData()],D.CALL_LATER_DELAY*2))},onShareSelectionModelChanged:function(){this.invalidateModel()}}),c.controls.TableBase=function(a){this._columnBox=new c.ColumnBox,this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange,this),this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange,this),this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange,this),c.controls.TableBase.superClass.constructor.apply(this,arguments),this._cellPool=new c.Pool("div",20),this._stringPool=new c.Pool("span",20),this._booleanPool=new c.Pool("input",20),this._colorPool=new c.Pool("div",20),this._pools.add(this._cellPool),this._pools.add(this._stringPool),this._pools.add(this._booleanPool),this._pools.add(this._colorPool)},d.ext("twaver.controls.TableBase",c.controls.ListBase,{getColumnBox:function(){return this._columnBox},handleColumnBoxChange:function(a){this.invalidateDisplay()},handleColumnPropertyChange:function(a){a.source!==this._sortColumn||a.property!=="sortDirection"&&a.property!=="sortFunction"&&a.property!=="sortable"?this.invalidateDisplay():this.invalidateModel()},handleColumnHierarchyChange:function(a){this.invalidateDisplay()},renderData:function(a,b,c,d){var e=this._columnBox.getRoots(),f=e.size(),g=0,h=this._rowHeight-this._rowLineWidth+"px",i;for(var j=0;j<f;j++){var k=e.get(j),l=k.getWidth();l<0&&(l=0);var m=Math.min(this._columnLineWidth,l);if(k.isVisible()){var n=this._cellPool.get();i=n.style,i.position="absolute",i.whiteSpace="nowrap",i.verticalAlign="middle",i.textAlign=k.getHorizontalAlign(),i.overflow="hidden",i.textOverflow="ellipsis",i.left=g+"px",i.width=l-m+"px",i.height=h,i.borderStyle="solid",i.borderWidth="0px",i.borderRightWidth=m+"px",i.borderRightColor=this._columnLineColor,a.appendChild(n);var o={data:b,value:this.getValue(b,k),div:n,view:this,column:k,rowIndex:c,selected:d};this.renderCell(o),this.onCellRendered(o),g+=l}}i=a.style,i.width=g+"px",i.height=h,i.backgroundColor=d?this.getSelectColor(b):""},adjustRowSize:function(){},onCellRendered:function(a){},getCurrentSortFunction:function(){var a=this._sortColumn;if(a){var b=a.getSortFunction();if(b){var c=this,d="asc"===a.getSortDirection()?1:-1;return function(e,f){var g=c.getValue(e,a),h=c.getValue(f,a);return b.call(c,g,h,e,f)*d}}}return this._sortFunction},renderCell:function(a){var b=a.column;if(b.renderCell){b.renderCell(a);return}var c=a.value,d=b.getEnumInfo();d&&d.values&&(c=d.map[c]),a.view.isCellEditable(a.data,b)&&(a.enumInfo=d,a.div._editInfo=a),x.render(b.getValueType(),c,a.div,a.view)},getValue:function(a,b){return b.getValue(a,this)},setValue:function(a,b,c){b.setValue(a,c,this)},isCellEditable:function(a,b){return this.isEditable()&&b.isEditable()},commitEditValue:function(a,b){if(this._isCanceling)return;var d;b.type==="checkbox"?d=b.checked:d=b.value;var e=a.column,f=e.getValueType();f==="int"&&typeof d=="string"?d=parseInt(d):f==="number"&&typeof d=="string"&&(d=parseFloat(d)),this.setValue(a.data,e,d);if(this._currentEditor){var g=this._currentEditor;delete this._currentEditor,this._rootDiv.removeChild(g),c.Util.setFocus(this._view)}},cancelEditing:function(){if(this._currentEditor){this._isCanceling=!0;var a=this._currentEditor;delete this._currentEditor,this._rootDiv.removeChild(a),c.Util.setFocus(this._view),delete this._isCanceling}},updateCurrentEditor:function(a){var b=a.target;if(b===this._currentEditor||b.parentNode===this._currentEditor)return;var d;while(b&&b!==this._view&&!(d=b._editInfo))b=b.parentNode;if(d&&b===d.div){d.enumInfo?this._currentEditor=p.createSelect(d.enumInfo,d.value):(this._currentEditor=document.createElement("input"),d.value!=null&&(this._currentEditor.value=d.value));if(this._currentEditor){this._currentEditor.addEventListener("keydown",function(a){var b=a.target._editInfo.view;a.keyCode===13?b.commitEditValue(a.target._editInfo,a.target):a.keyCode===27&&b.cancelEditing()},!1),self=this,this._currentEditor.addEventListener("blur",function(a){var b=a.target._editInfo.view;if(b._isCanceling)return;b.commitEditValue(a.target._editInfo,a.target)},!1),this._currentEditor.keepDefault=!0,this._currentEditor._editInfo=d;var e=this._currentEditor.style;e.position="absolute",e.margin="0px",e.border="0px",e.padding="0px",e.left=d.div.style.left,e.top=d.div.parentNode.style.top,e.width=d.div.style.width,e.height=d.div.style.height,this._rootDiv.appendChild(this._currentEditor),c.Util.setFocus(this._currentEditor)}}},onColumnSorted:function(a){}}),c.network.Network=function(a){c.network.Network.superClass.constructor.apply(this,arguments),this._elementUIMap={},this._layerMap={},this._layerList=new B,this._view=p.createView("auto"),this._rootDiv=p.createDiv(),this._topDiv=p.createDiv(),this._attachmentDiv=p.createDiv(),this._layersDiv=p.createDiv(),this._bottomDiv=p.createDiv(),this._rootDiv.appendChild(this._bottomDiv),this._rootDiv.appendChild(this._layersDiv),this._rootDiv.appendChild(this._attachmentDiv),this._rootDiv.appendChild(this._topDiv),this._view.appendChild(this._rootDiv),this.setElementBox(a?a:new c.ElementBox),g.isTouchable?this.setTouchInteractions():this.setDefaultInteractions(!1),this.setToolTipEnabled(D.NETWORK_TOOLTIP_ENABLED)},d.ext("twaver.network.Network",c.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","movingElement","selectingElement","rectSelectEnabled"],_viewRect:{x:0,y:0,width:0,height:0},_currentSubNetwork:null,_selectMode:D.NETWORK_SELECT_MODE,_noAgentLinkVisible:D.NETWORK_NO_AGENT_LINK_VISIBLE,_makeVisibleOnSelected:D.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:D.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:D.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:D.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_subNetworkAnimate:D.NETWORK_SUBNETWORK_ANIMATE,_transparentSelectable:D.NETWORK_TRANSPARENT_SELECTABLE,_removeElementUIOnInvisible:D.NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE,_elementUIFunction:D.ELEMENTUI_FUNCTION,_doubleClickToUpSubNetwork:D.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:D.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:D.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:D.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:D.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_sendToTopOnSelected:D.NETWORK_SENDTOTOP_ON_SELECTED,_selectOutlineColor:D.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:D.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:D.NETWORK_SELECT_FILL_COLOR,_lazyMoveOutlineColor:D.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:D.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:D.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:D.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:D.NETWORK_LAZYMOVE_ANIMATE,_editPointSize:D.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:D.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:D.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:D.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:D.NETWORK_EDIT_LINE_COLOR,_editLineWidth:D.NETWORK_EDIT_LINE_WIDTH,_resizePointFillColor:D.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:D.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:D.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:D.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:D.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:D.NETWORK_RESIZE_ANIMATE,_invalidate:!1,_invalidateElementVisibility:!1,_invalidateElementIndex:!1,_isEditingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,getLabel:function(a){return a.getStyle("network.label")||a.getName()},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(a){this._toolTipEnabled=a;if(a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){var c=b.getElementAt(a);if(c){var d=b.getToolTip(c);y.showToolTip(a,d);return}y.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(y.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},getTopDiv:function(){return this._topDiv},getAttachmentDiv:function(){return this._attachmentDiv},getLayersDiv:function(){return this._layersDiv},getBottomDiv:function(){return this._bottomDiv},validateImpl:function(){var a=0,b=null,c=null,d=null,e=this._invalidateElementVisibility;this._invalidateElementVisibility&&(this._invalidateElementVisibility=!1,this._removeElementUIOnInvisible&&(this._invalidateElementIndex=!0),this.forEachElementUI(function(e){e.validate();var f=e.getElement();e.setVisible(this.isVisible(f));if(this._removeElementUIOnInvisible){b=this.getLayerDivByElement(f);if(e.isVisible()){if(e.getView().parentNode!==b){b.appendChild(e.getView()),c=e.getAttachments();for(a=0;a<c.size();a++)d=c.get(a),d.isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(d.getView())}}else if(e.getView().parentNode===b){b.removeChild(e.getView()),c=e.getAttachments();for(a=0;a<c.size();a++)d=c.get(a),d.isShowInAttachmentDiv()&&this._attachmentDiv.removeChild(d.getView())}}else if(!e.getView().parentNode){b=this.getLayerDivByElement(f),b.appendChild(e.getView()),c=e.getAttachments();for(a=0;a<c.size();a++)d=c.get(a),d.isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(d.getView())}},null,this));if(this._invalidateElementIndex){this._invalidateElementIndex=!1;var f,g=this;this._box.getLayerBox().forEachByDepthFirst(function(a){var b=g._layerMap[a.getId()],c;g._box.forEachByLayer(function(a){var d=g._elementUIMap[a.getId()];if(d&&d.getView().parentNode===b){c=p.insertAfter(d.getView(),c);var e=d.getAttachments();for(var h=0;h<e.size();h++){var i=e.get(h);i.getView().parentNode===g._attachmentDiv&&(f=p.insertAfter(i.getView(),f))}}},a)})}if(e&&!this._invalidateElementVisibility){var h;for(var i in this._elementUIMap){var j=this._elementUIMap[i];j.isVisible()&&(h=l.unionRect(h,j.getViewRect()))}h?h={x:0,y:0,width:h.x+h.width,height:h.y+h.height}:h={x:0,y:0,width:0,height:0};if(h.x!==this._viewRect.x||h.y!==this._viewRect.y||h.width!==this._viewRect.width||h.height!==this._viewRect.height){var k=this._viewRect;this._viewRect=h,this._rootDiv.style.left="0px",this._rootDiv.style.top="0px",this._rootDiv.style.width=h.width+"px",this._rootDiv.style.height=h.height+"px",this.firePropertyChange("viewRect",k,h)}}},setInteractions:function(a){var b=this._interactions;b&&b.forEach(function(a){a.tearDown()}),this._interactions=a,a&&a.forEach(function(a){a.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",b,a)},getInteractions:function(){return this._interactions},upSubNetwork:function(a,b){this._currentSubNetwork&&this.setCurrentSubNetwork(s.getSubNetwork(this._currentSubNetwork),a,b)},sendToTop:function(a){if(!this.isVisible(a))return;var b=a;while(this.isVisible(b.getParent())){b=b.getParent();if(!b)break}b!==a&&this._box.adjustElementIndex(b),this._box.adjustElementIndex(a)},invalidateElementIndex:function(){this._invalidateElementIndex||(this._invalidateElementIndex=!0,this.invalidate())},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},updateLayers:function(){p.clear(this._layersDiv),p.clear(this._attachmentDiv),this._layerMap={},this._layerList.clear();var a=this;this._box.getLayerBox().forEachByDepthFirst(function(b){var c=p.createDiv();p.setVisible(c,b.isVisible()),a._layerMap[b.getId()]=c,a._layersDiv.appendChild(c),a._layerList.add(b)}),this._box.forEach(this.createElementUI,this)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(a,b,d){var e=c.animate.AnimateManager;e.endAnimate();if(b){if(this._currentSubNetwork===a)return;if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";e.start(new c.animate.AnimateSubNetwork(this,a,d))}else this._setCurrentSubNetwork(a),d&&d()},_setCurrentSubNetwork:function(a){if(this._currentSubNetwork===a)return;if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";var b=this._currentSubNetwork;this._currentSubNetwork=a,this.firePropertyChange("currentSubNetwork",b,a),this.invalidateElementVisibility()},isVisible:function(a){if(!this._box.contains(a))return!1;if(this._visibleFunction&&!this._visibleFunction(a))return!1;if(!this._box.getLayerBox().getLayerByElement(a).isVisible())return!1;if(s.getSubNetwork(a)!==this._currentSubNetwork)return!1;if(a instanceof c.Link){if(!this.isNoAgentLinkVisible()){if(!a.getFromAgent()||!a.getToAgent())return!1;if(!this.isVisible(a.getFromAgent())||!this.isVisible(a.getToAgent()))return!1}if(a.getBundleIndex()>0&&a.getBundleCount()>1&&!a.getStyle("link.bundle.expanded"))return!1}else{var b=a.getParent();while(b&&!b.ISubNetwork){if(b instanceof F)if(!b.isExpanded()||!this.isVisible(b))return!1;b=b.getParent()}}return a.IDummy?!1:!0},isMovable:function(a){return this._box.contains(a)?a instanceof c.Link?!1:this._movableFunction&&!this._movableFunction(a)?!1:this._box.getLayerBox().getLayerByElement(a).isMovable():!1},isEditable:function(a){return this._box.contains(a)?this._editableFunction&&!this._editableFunction(a)?!1:this._box.getLayerBox().getLayerByElement(a).isEditable():!1},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(a){var b=this._visibleFunction;this._visibleFunction=a,this.firePropertyChange("visibleFunction",b,a),this.invalidateElementVisibility()},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(a){var b=this._editableFunction;this._editableFunction=a,this.firePropertyChange("editableFunction",b,a),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getElementBox:function(){return this._box},setElementBox:function(a){if(!a)throw"ElementBox can not be null";if(this._box===a)return;var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleElementBoxChange,this),b.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),b.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),b.removeIndexChangeListener(this.handleIndexChange,this),b.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),b.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),b.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this.updateLayers(),this.invalidateElementVisibility(),this.firePropertyChange("elementBox",b,this._box)},invalidateElementUI:function(a,b){var c=this.getElementUI(a);c&&c.invalidate(b)},invalidateElementUIs:function(a){for(var b in this._elementUIMap){var c=this._elementUIMap[b];c.invalidate(a)}},invalidateSelectedElementUIs:function(a){this.getSelectionModel().getSelection().forEach(function(b){this.invalidateElementUI(b,a)},this)},getElementUI:function(a){return a?this._elementUIMap[a.getId()]:null},getLayerDivByElement:function(a){var b=this._box.getLayerBox().getLayerByElement(a);return b?this._layerMap[b.getId()]:null},createElementUI:function(a){var b=this._elementUIMap[a.getId()];b||(b=this._elementUIFunction(this,a),b&&(this._elementUIMap[a.getId()]=b));if(b){var c=this.getLayerDivByElement(a);b.getView().parentNode!==c&&(c.appendChild(b.getView()),b.getAttachments().forEach(function(a){a.isShowInAttachmentDiv()&&a.getView().parentNode!==this._attachmentDiv&&this._attachmentDiv.appendChild(a.getView())},this)),this.invalidateElementIndex()}},invalidateBundleLink:function(a){a instanceof c.Link&&a.getBundleLinks()&&a.getBundleLinks().forEachSiblingLink(function(b){if(b!==a){var c=this.getElementUI(b);c&&c.invalidate(!1)}},this)},handleLayerBoxChange:function(a){this.updateLayers(),this.invalidateElementVisibility()},handleLayerPropertyChange:function(a){var b=a.source;if(a.property==="visible"){var c=this._layerMap[b.getId()];p.setVisible(c,b.isVisible())}else a.property==="editable"&&this.invalidateSelectedElementUIs(!0);this.invalidateElementVisibility()},handleLayerHierarchyChange:function(a){var b=0,c;this._layerList.clear(),this._box.getLayerBox().forEachByDepthFirst(function(a){var b=this._layerMap[a.getId()];c=p.insertAfter(b,c),this._layerList.add(a)},null,this),this.invalidateElementVisibility()},handleSelectionChange:function(a){a.datas.forEach(function(b){var c=this.getElementUI(b);c&&c.handleSelectionChange(a)},this),this.invalidateElementVisibility();var b=this.getSelectionModel().getLastData();b&&(a.kind==="append"||a.kind==="set")&&(this.isMakeVisibleOnSelected()&&this.makeVisible(b),this.isSendToTopOnSelected()&&this.sendToTop(b))},makeVisible:function(a){var b=this.getElementUI(a);if(!b)return;var c=s.getSubNetwork(a);if(c!==this._currentSubNetwork){var e=this;this.setCurrentSubNetwork(c,this.isSubNetworkAnimate(),function(){d.callLater(e.makeVisible,e,[a])});return}var f=a;while((f=f.getParent())&&f!==c)f instanceof F&&f.setExpanded(!0);var g=b.getUnionBodyBounds();if(!g)return;var h={x:this._view.scrollLeft/this._zoom,y:this._view.scrollTop/this._zoom,width:this._view.clientWidth/this._zoom,height:this._view.clientHeight/this._zoom};l.intersects(h,g)||this.isVisible(a)&&d.callLater(this.centerByLogicalPoint,this,[g.x+g.width/2,g.y+g.height/2])},handleElementBoxChange:function(a){var b=a.data;if(a.kind==="add")this.createElementUI(b),this.invalidateBundleLink(b);else if(a.kind==="remove"){var c=this.getElementUI(b);if(c){var d=this._box.getLayerBox().getLayerByElement(b),e=this._layerMap[d.getId()];c.getView().parentNode===e&&e.removeChild(c.getView()),c.dispose(),delete this._elementUIMap[b.getId()]}b===this._currentSubNetwork&&this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null)}else a.kind==="clear"&&(this.forEachElementUI(function(a){a.dispose()}),this._elementUIMap={},this.updateLayers(),this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null));this.invalidateElementVisibility()},handleElementPropertyChange:function(a){var b=a.source,c=this.getElementUI(b);if(c){c.handlePropertyChange(a);if(a.property==="layerID"){var d=this._box.getLayerBox().getLayerByElement(b),e=this._layerMap[d.getId()];c.getView().parentNode!==e&&(e.appendChild(c.getView()),this.invalidateElementIndex())}}this.invalidateBundleLink(b),this.invalidateElementVisibility()},handleElementBoxPropertyChange:function(a){this.invalidateElementVisibility()},handleIndexChange:function(a){this.invalidateElementIndex()},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(a){if(!a)throw"ElementUIFunction can not be null";if(this._elementUIFunction===a)return;var b=this._elementUIFunction;this._elementUIFunction=a,this.firePropertyChange("elementUIFunction",b,a),this._box.isEmpty()||this.updateLayers()},getIconsNames:function(a){return a.getStyle("icons.names")},getIconsColors:function(a){return a.getStyle("icons.colors")},getLinkHandlerLabel:function(a){return a.isBundleAgent()?"+("+a.getBundleCount()+")":null},getSelectColor:function(a){return a.getStyle("select.color")},getShadowColor:function(a){var b=a.getStyle("shadow.color");return!b&&this.isSelected(a)&&a.getStyle("select.style")==="shadow"?a.getStyle("select.color"):b},getAlarmLabel:function(a){var b=a.getAlarmState().getHighestNewAlarmSeverity();if(b){var c=a.getAlarmState().getNewAlarmCount(b)+b.nickName;return a.getAlarmState().hasLessSevereNewAlarms()&&(c+="+"),c}return null},isRemoveElementUIOnInvisible:function(){return this._removeElementUIOnInvisible},setRemoveElementUIOnInvisible:function(a){var b=this._removeElementUIOnInvisible;this._removeElementUIOnInvisible=a,this.firePropertyChange("removeElementUIOnInvisible",b,a),this.invalidateElementVisibility()},setDefaultInteractions:function(a){this.setInteractions([new c.network.interaction.SelectInteraction(this),new c.network.interaction.MoveInteraction(this,a),new c.network.interaction.DefaultInteraction(this)])},setPanInteractions:function(){this.setInteractions([new c.network.interaction.PanInteraction(this),new c.network.interaction.DefaultInteraction(this)])},setEditInteractions:function(a){this.setInteractions([new c.network.interaction.SelectInteraction(this),new c.network.interaction.EditInteraction(this,a),new c.network.interaction.MoveInteraction(this,a),new c.network.interaction.DefaultInteraction(this)])},setCreateElementInteractions
:function(a){this.setInteractions([new c.network.interaction.CreateElementInteraction(this,a),new c.network.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(a){this.setInteractions([new c.network.interaction.CreateLinkInteraction(this,a),new c.network.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(a){this.setInteractions([new c.network.interaction.CreateShapeLinkInteraction(this,a),new c.network.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(a){this.setInteractions([new c.network.interaction.CreateShapeNodeInteraction(this,a),new c.network.interaction.DefaultInteraction(this)])},setTouchInteractions:function(){this.setInteractions([new c.network.interaction.TouchInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(a){var b=this._hasEditInteraction;this._hasEditInteraction=a,this.firePropertyChange("hasEditInteraction",b,a)},moveSelectedElements:function(a,b,d,e){c.Util.moveElements(this.getMovableSelectedElements(),a,b,d,e,this)},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(a){return this.isMovable(a)},this)},hasMovableSelectedElements:function(){var a=this.getSelectionModel().getSelection();for(var b=0;b<a.size();b++){var c=a.get(b);if(this.isMovable(c))return!0}return!1},getLayerByElement:function(a){return this._box.getLayerBox().getLayerByElement(a)},getPosition:function(a,b,d,e,f){var g,h=b instanceof c.network.ElementUI?b:this.getElementUI(b);if(h)if(a==="from"||a==="to"){if(h.getFromPosition){g=a==="from"?h.getFromPosition(e,f):h.getToPosition(e,f);if(g)return{x:g.x-d.width/2,y:g.y-d.height/2}}}else a==="hotspot"?g=h.getHotSpot():g=o.get(a,h.getBodyRect(),d);!g&&b.getRect&&(g=o.get(a,b.getRect(),d));if(g)return{x:g.x+e,y:g.y+f};throw"position '"+a+"' object '"+b+"'"},getViewRect:function(){return this._viewRect?d.clone(this._viewRect):{x:0,y:0,width:0,height:0}},forEachElementUI:function(a,b,c){b?this._box.forEachReverse(function(d){if(this.getLayerByElement(d)===b){var e=this.getElementUI(d);e&&(c?a.call(c,e):a(e))}},this):this._layerList.forEachReverse(function(b){this.forEachElementUI(a,b,c)},this)},findFirstElement:function(a,b){var c=this._layerList.size()-1,d=this._box.size()-1;for(var e=c;e>=0;e--){var f=this._layerList.get(e);for(var g=d;g>=0;g--){var h=this._box.getDataAt(g);if(this.getLayerByElement(h)===f)if(b){if(a.call(b,h)===!0)return h}else if(a(h)===!0)return h}}return null},getElementAt:function(a,b){arguments.length===1&&(b=!0),a=this._getPoint(a);var c=a.x,d=a.y;return this.findFirstElement(function(a){if(b&&!this.isSelectable(a))return!1;var e=this.getElementUI(a);return e&&e.hitTest(c,d)?!0:!1},this)},_getPoint:function(a){return a?a.target?this.getLogicalPoint(a):a:null},getElementsAtRect:function(a,b,c){var d=new B;return this.forEachElementUI(function(e){e.isVisible()&&(!c||c(e._element))&&(b?e.intersectsTest(a)&&d.add(e._element):l.contains(a,e.getViewRect())&&d.add(e._element))},null,this),d},hitTest:function(a){var b=this.getElementAt(a);if(!b)return null;var c=this.getElementUI(b);return c?(a=this._getPoint(a),c.hitTest(a.x,a.y)):null},addElementByInteraction:function(a){a.getParent()||a.setParent(this._currentSubNetwork),this._box.add(a),this.getSelectionModel().setSelection(a),this.fireInteractionEvent({kind:"createElement",element:a})},toCanvas:function(a,b,c){c||(c=p.createCanvas()),c.setAttribute("width",a),c.setAttribute("height",b),c._viewRect?(c._viewRect.width=a,c._viewRect.height=b):c._viewRect={x:0,y:0,width:a,height:b};var d=c.getContext("2d");d.clearRect(0,0,a,b);if(this._view.clientWidth===0||this._view.clientHeight===0)return c;var e=a/this._view.scrollWidth*this._zoom,f=b/this._view.scrollHeight*this._zoom;return d.scale(e,f),p.forEach(this._view,function(a){if((a.tagName==="CANVAS"||a.tagName==="IMG")&&!a._isIgnored){var b=a._viewRect;if(b)try{d.drawImage(a,b.x,b.y,b.width,b.height)}catch(a){}}}),c},toCanvasByRegion:function(a,b,c){c||(c=p.createCanvas());var d=a.width*b,e=a.height*b;c.setAttribute("width",d),c.setAttribute("height",e),c._viewRect?(c._viewRect.width=d,c._viewRect.height=e):c._viewRect={x:0,y:0,width:d,height:e};var f=c.getContext("2d");return f.clearRect(0,0,d,e),this._view.clientWidth===0||this._view.clientHeight===0?c:(f.scale(b,b),f.fillStyle=this._view.style.backgroundColor||"#FFFFFF",f.fill(),p.forEach(this._view,function(b){if((b.tagName==="CANVAS"||b.tagName==="IMG")&&!b._isIgnored){var c=b._viewRect;if(c&&l.intersects(c,a))try{f.drawImage(b,c.x-a.x,c.y-a.y,c.width,c.height)}catch(b){}}}),c)}}),c.canvas={},c.canvas.interaction={},c.canvas.Network=function(a){c.canvas.Network.superClass.constructor.apply(this,arguments),this._view=p.createView("auto"),this._rootCanvas=p.createCanvas(),this._topCanvas=p.createCanvas(),this._view.appendChild(this._rootCanvas),this._view.appendChild(this._topCanvas),this.realWidth=0,this.realHeight=0,this._zoom=1,this._elementUIMap={},this.viewRect={x:0,y:0,width:0,height:0},this.hScrollBarVisible=!1,this.vScrollBarVisible=!1,this.markerList=new c.List,this._topAttachmentList=new c.List,this.setElementBox(a?a:new c.ElementBox),g.isTouchable?this.setTouchInteractions():this.setDefaultInteractions(!1),this.setToolTipEnabled(c.Defaults.NETWORK_TOOLTIP_ENABLED)},d.ext("twaver.canvas.Network",c.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","scrollBarWidth","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","scrollBarVisible","limitViewInCanvas","autoValidateCanvasSize","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","movingElement","selectingElement","rectSelectEnabled"],_currentSubNetwork:null,_subNetworkAnimate:c.Defaults.NETWORK_SUBNETWORK_ANIMATE,_scrollBarWidth:10,_scrollBarVisible:!0,_limitViewInCanvas:!0,_autoValidateCanvasSize:!0,_makeVisibleOnSelected:c.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:c.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:c.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:D.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_elementUIFunction:c.Defaults.CANVASUI_FUNCTION,_doubleClickToUpSubNetwork:c.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:c.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:c.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:c.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:c.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_selectOutlineColor:c.Defaults.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:c.Defaults.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:c.Defaults.NETWORK_SELECT_FILL_COLOR,_sendToTopOnSelected:c.Defaults.NETWORK_SENDTOTOP_ON_SELECTED,_lazyMoveOutlineColor:c.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:c.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:c.Defaults.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:c.Defaults.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:c.Defaults.NETWORK_LAZYMOVE_ANIMATE,_resizePointFillColor:c.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:c.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:c.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:c.Defaults.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:c.Defaults.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:c.Defaults.NETWORK_RESIZE_ANIMATE,_editPointSize:c.Defaults.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:c.Defaults.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:c.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:c.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:c.Defaults.NETWORK_EDIT_LINE_COLOR,_editLineWidth:c.Defaults.NETWORK_EDIT_LINE_WIDTH,_invalidateElementVisibility:!1,_invalidateViewRectFlag:!1,_repaintTopFlag:!1,_invalidateCanvasSizeFlag:!1,_isEditingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,adjustBounds:function(a){var b=!1,d=this._view.style;d.left==a.x+"px"&&d.top==a.y+"px"&&d.width==a.width+"px"&&d.height==a.height+"px"&&(b=!0),c.canvas.Network.superClass.adjustBounds.apply(this,arguments);if(b==1)return;var e=this._view.offsetWidth,f=this._view.offsetHeight;this._rootCanvas.setAttribute("width",e),this._rootCanvas.setAttribute("height",f),this._topCanvas.setAttribute("width",e),this._topCanvas.setAttribute("height",f),this.setViewRect(this.viewRect.x,this.viewRect.y,e,f),this.invalidateElementVisibility()},getLabel:function(a){return a.getStyle("network.label")||a.getName()},getRootCanvas:function(){return this._rootCanvas},getTopCanvas:function(){return this._topCanvas},validateImpl:function(){if(this._invalidateElementVisibility==1){this._invalidateElementVisibility=!1;var a=this.getElementBox().getDatas(),b=a.size(),c={},d,e,f;for(d=0;d<b;d++)e=a.get(d),c[e.getId()]=this.isVisible(e);if(this._visibleMap)for(d=0;d<b;d++)e=a.get(d),c[e.getId()]!==this._visibleMap[e.getId()]&&(f=this.getElementUI(e),f&&f.invalidate());for(d=0;d<b;d++)e=a.get(d),f=this.getElementUI(e),f&&f.validate();this._visibleMap=c,this.paintRoot()}this._repaintTopFlag==1&&(this._repaintTopFlag=!1,this.paintTopCanvas())},getElementBox:function(){return this._box},setElementBox:function(a){if(!a)throw"ElementBox can not be null";if(this._box===a)return;var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleElementBoxChange,this),b.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),b.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),b.removeIndexChangeListener(this.handleIndexChange,this),b.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),b.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),b.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.firePropertyChange("elementBox",b,this._box)},handleElementBoxChange:function(a){var b=a.data;if(a.kind==="add")this.createElementUI(b),this.invalidateBundleLink(b);else if(a.kind==="remove"){var c=this.getElementUI(b);c&&delete this._elementUIMap[b.getId()],b===this._currentSubNetwork&&this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null)}else a.kind==="clear"&&(this._elementUIMap={},this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null));this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementPropertyChange:function(a){var b=a.source,c=this.getElementUI(b);c&&c.handlePropertyChange(a),this.invalidateBundleLink(b),this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementBoxPropertyChange:function(){this.invalidateElementVisibility()},handleIndexChange:function(a){this.invalidateElementVisibility()},handleLayerBoxChange:function(){this.invalidateElementVisibility()},handleLayerPropertyChange:function(a){a.property==="editable"&&this.invalidateSelectedElementUIs(!0),this.invalidateElementVisibility()},handleLayerHierarchyChange:function(){this.invalidateElementVisibility()},handleSelectionChange:function(a){a.datas.forEach(function(b){var c=this.getElementUI(b);c&&c.handleSelectionChange(a)},this);var b=this.getSelectionModel().getLastData();b&&(a.kind==="append"||a.kind==="set")&&(this.isMakeVisibleOnSelected()&&this.makeVisible(b),this.isSendToTopOnSelected()&&this.sendToTop(b)),this.invalidateElementVisibility()},sendToTop:function(a){if(!this._box.contains(a))return;var b=a;while(this.isVisible(b.getParent())){b=b.getParent();if(!b)break}b!==a&&this._box.adjustElementIndex(b),this._box.adjustElementIndex(a)},getViewRect:function(){return this.viewRect?d.clone(this.viewRect):{x:0,y:0,width:0,height:0}},getCanvasSize:function(){return{width:this.realWidth,height:this.realHeight}},setViewOffSet:function(a,b){var c=this.viewRect.x,d=this.viewRect.y,e=this.viewRect.width,f=this.viewRect.height;this.setViewRect(c+a,d+b,e,f)},setViewRect:function(a,b,c,d){this.isLimitViewInCanvas()==1&&(a<0&&(a=0),c>this.realWidth?a=0:a+c>this.realWidth&&(a=this.realWidth-c),b<0&&(b=0),d>this.realHeight?b=0:b+d>this.realHeight&&(b=this.realHeight-d));var e=this.viewRect;if(this.viewRect!=null&&a==this.viewRect.x&&b==this.viewRect.y&&c==this.viewRect.width&&d==this.viewRect.height)return;this.viewRect={x:a,y:b,width:c,height:d},this.firePropertyChange("viewRect",e,this.viewRect),this.invalidateElementVisibility()},isHScrollBarVisible:function(){return this.hScrollBarVisible},setHScrollBarVisible:function(a){this.hScrollBarVisible=a},isVScrollBarVisible:function(){return this.vScrollBarVisible},setVScrollBarVisible:function(a){this.vScrollBarVisible=a},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},repaintTopCanvas:function(){this._repaintTopFlag||(this._repaintTopFlag=!0,this.invalidate())},invalidateCanvasSize:function(a){a==null&&(a=300),this._invalidateCanvasSizeFlag==0&&(this._invalidateCanvasSizeFlag=!0,d.callLater(this.validateCanvasSize,this,null,a))},validateCanvasSize:function(){if(this._invalidateCanvasSizeFlag==0)return;this._invalidateCanvasSizeFlag=!1,this._validateCanvasSize()},_validateCanvasSize:function(){if(this.isMovingElement())return;if(this.isAutoValidateCanvasSize()==0){this.realWidth=0,this.realHeight=0;return}var a=this.getElementBox().getDatas(),b=a.size();if(b>0){var c={x:0,y:0,width:0,height:0};for(var d=0;d<b;d++){var e=a.get(d);if(this.isVisible(e)){var f=this.getElementUI(e);f&&(c=l.unionRect(c,f.getViewRect()))}}c.x<0&&(c.width+=c.x,c.x=0),c.y<0&&(c.height+=c.y,c.y=0);if(this.realWidth==(c.x+c.width)*this.getZoom()&&this.realHeight==(c.y+c.height)*this.getZoom())return;this.realWidth=(c.x+c.width)*this.getZoom(),this.realHeight=(c.y+c.height)*this.getZoom()}else this.realWidth=0,this.realHeight=0;this.setViewRect(this.viewRect.x,this.viewRect.y,this.viewRect.width,this.viewRect.height),this.firePropertyChange("canvasSizeChange",null,this.viewRect)},getElementUI:function(a){return a==null?null:this._elementUIMap[a.getId()]},createElementUI:function(a){var b=this._elementUIMap[a.getId()];b||(b=this._elementUIFunction(this,a),b&&(this._elementUIMap[a.getId()]=b))},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(a){if(!a)throw"ElementUIFunction can not be null";if(this._elementUIFunction===a)return;var b=this._elementUIFunction;this._elementUIFunction=a,this.firePropertyChange("elementUIFunction",b,a),this._box.isEmpty()||(this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize())},invalidateElementUI:function(a,b){var c=this.getElementUI(a);c&&c.invalidate(b)},invalidateElementUIs:function(a){for(var b in this._elementUIMap){var c=this._elementUIMap[b];c.invalidate(a)}},invalidateSelectedElementUIs:function(a){this.getSelectionModel().getSelection().forEach(function(b){this.invalidateElementUI(b,a)},this)},invalidateBundleLink:function(a){a instanceof c.Link&&a.getBundleLinks()&&a.getBundleLinks().forEachSiblingLink(function(b){if(b!==a){var c=this.getElementUI(b);c&&c.invalidate(!1)}},this)},paintRoot:function(){var a=this._rootCanvas.getContext("2d");a.clearRect(0,0,this._rootCanvas.width,this._rootCanvas.height),this.visibleList=new c.List,this._topAttachmentList=new c.List;if(this.getElementBox()==null)return;var b=this.getElementBox().getDatas(),d=b.size();if(d==0)return;a.save(),a.scale(this.getZoom(),this.getZoom()),a.translate(-this.viewRect.x/this.getZoom(),-this.viewRect.y/this.getZoom());var e={x:this.viewRect.x/this.getZoom(),y:this.viewRect.y/this.getZoom(),width:this.viewRect.width/this.getZoom(),height:this.viewRect.height/this.getZoom()},f=this.getElementBox().getLayerBox(),g=f.getDatas(),h=g.size(),i,j,k,l,m;for(var n=0;n<h;n++){k=g.get(n);for(i=0;i<d;i++)j=b.get(i),f.getLayerByElement(j)===k&&this.isVisible(j)&&(l=this.getElementUI(j),l!=null&&this._isInView(l,e)&&(l.paint(a),this.visibleList.add(j)))}d=this._topAttachmentList.size();for(i=0;i<d;i++)m=this._topAttachmentList.get(i),m.getElementUI().paintAttachment(a,m);a.restore()},_isInView:function(a,b){return l.intersects(b,a.getViewRect())},paintTopCanvas:function(){var a=this._topCanvas.getContext("2d");a.clearRect(0,0,this._topCanvas.width,this._topCanvas.height),this.paintMarker(a)},paintMarker:function(a){var b=this.markerList.size();for(var c=0;c<b;c++){var d=this.markerList.get(c);d.paint(a)}},getLayerByElement:function(a){return this._box.getLayerBox().getLayerByElement(a)},getLogicalPoint:function(a){var b;if(g.isTouchable&&a.changedTouches&&a.changedTouches.length>0){var c=this._view.getBoundingClientRect(),d=a.changedTouches[0],e=g.isAndroid?0:w.scrollLeft(),f=g.isAndroid?0:w.scrollTop();return b={x:(d.clientX+this.viewRect.x-c.left-e)/this._zoom,y:(d.clientY+this.viewRect.y-c.top-f)/this._zoom},b}return g.isFirefox?b={x:(a.layerX+this.viewRect.x)/this.getZoom(),y:(a.layerY+this.viewRect.y)/this.getZoom()}:b={x:(a.offsetX+this.viewRect.x)/this.getZoom(),y:(a.offsetY+this.viewRect.y)/this.getZoom()},b},getElementAt:function(a){if(this.visibleList==null)return null;var b;a.target?b=this.getLogicalPoint(a):b=a;if(this._topAttachmentList!=null){var c=this._topAttachmentList.size();for(var d=c-1;d>=0;d--){var e=this._topAttachmentList.get(d);if(e.hit(b.x,b.y))return e.getElement()}}if(this.visibleList!=null){var f=this.visibleList.size();for(var g=f-1;g>=0;g--){var h=this.visibleList.get(g),i=this.getElementUI(h);if(i&&i.hit(b.x,b.y))return h}}return null},hitTest:function(a){var b=this.getElementAt(a);if(!b)return null;var c=this.getElementUI(b);if(!c)return null;var d;return a.target?d=this.getLogicalPoint(a):d=a,c.hitTest(d.x,d.y)},getElementsAtRect:function(a,b,d){var e=new c.List;if(this.visibleList==null)return e;var f=this.visibleList.size();for(var g=f-1;g>=0;g--){var h=this.visibleList.get(g),i=this.getElementUI(h);i&&(!d||d(i._element))&&(b?i.intersects(a)&&e.add(h):l.contains(a,i.getViewRect())&&e.add(h))}return e},getPosition:function(a,b,d,e,f){var g,h=b instanceof c.canvas.ElementUI?b:this.getElementUI(b);if(h)if(a==="from"||a==="to"){if(h.getFromPosition){g=a==="from"?h.getFromPosition(e,f):h.getToPosition(e,f);if(g)return{x:g.x-d.width/2,y:g.y-d.height/2}}}else a==="hotspot"?g=h.getHotSpot():g=o.get(a,h.getBodyRect(),d);!g&&b.getRect&&(g=o.get(a,b.getRect(),d));if(g)return{x:g.x+e,y:g.y+f};throw"position '"+a+"' object '"+b+"'"},isValidEvent:function(a){if(!a)return!1;var b,c;if(a.currentTarget===this._view){g.isFirefox?(b=a.layerX,c=a.layerY):(b=a.offsetX,c=a.offsetY);if(this.isHScrollBarVisible()==1&&c>=this.viewRect.height-this.getScrollBarWidth())return!1;if(this.isVScrollBarVisible()==1&&b>=this.viewRect.width-this.getScrollBarWidth())return!1}return!0},addMarker:function(a){this.markerList.add(a),this.repaintTopCanvas()},removeMarker:function(a){this.markerList.remove(a),this.repaintTopCanvas()},clearMarker:function(){this.markerList.clear(),this.repaintTopCanvas()},isMovable:function(a){return this._box.contains(a)?a instanceof c.Link?!1:this._movableFunction&&!this._movableFunction(a)?!1:this.getLayerByElement(a).isMovable():!1},hasMovableSelectedElements:function(){var a=this.getSelectionModel().getSelection();for(var b=0;b<a.size();b++){var c=a.get(b);if(this.isMovable(c))return!0}return!1},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(a){return this.isMovable(a)},this)},moveSelectedElements:function(a,b,d,e){c.Util.moveElements(this.getMovableSelectedElements(),a,b,d,e,this)},isVisible:function(a){if(!this._box.contains(a))return!1;if(this._visibleFunction&&!this._visibleFunction(a))return!1;if(!this.getLayerByElement(a).isVisible())return!1;if(s.getSubNetwork(a)!==this._currentSubNetwork)return!1;if(a instanceof c.Link){if(!this.isNoAgentLinkVisible()){if(!a.getFromAgent()||!a.getToAgent())return!1;if(!this.isVisible(a.getFromAgent())||!this.isVisible(a.getToAgent()))return!1}if(a.getBundleIndex()>0&&a.getBundleCount()>1&&!a.getStyle("link.bundle.expanded"))return!1}else{var b=a.getParent();while(b&&!b.ISubNetwork){if(b instanceof c.Group)if(!b.isExpanded()||!this.isVisible(b))return!1;b=b.getParent()}}return a.IDummy?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(a){var b=this._visibleFunction;this._visibleFunction=a,this.firePropertyChange("visibleFunction",b,a),this.invalidateElementVisibility()},isEditable:function(a){return this._box.contains(a)?this._editableFunction&&!this._editableFunction(a)?!1:this.getLayerByElement(a).isEditable():!1},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(a){var b=this._editableFunction;this._editableFunction=a,this.firePropertyChange("editableFunction",b,a),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getShadowColor:function(a){var b=a.getStyle("shadow.color");return!b&&this.isSelected(a)&&a.getStyle("select.style")==="shadow"?a.getStyle("select.color"):b},getSelectColor:function(a){return a.getStyle("select.color")},getAlarmLabel:function(a){var b=a.getAlarmState().getHighestNewAlarmSeverity();if(b){var c=a.getAlarmState().getNewAlarmCount(b)+b.nickName;return a.getAlarmState().hasLessSevereNewAlarms()&&(c+="+"),c}return null},getLinkHandlerLabel:function(a){return a.isBundleAgent()?"+("+a.getBundleCount()+")":null},setInteractions:function(a){var b=this._interactions;b&&b.forEach(function(a){a.tearDown()}),this._interactions=a,a&&a.forEach(function(a){a.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",b,a)},getInteractions:function(){return this._interactions},setDefaultInteractions:function(a){this.setInteractions([new c.canvas.interaction.SelectInteraction(this),new c.canvas.interaction.MoveInteraction(this,a),new c.canvas.interaction.ScrollInteraction(this),new c.canvas.interaction.DefaultInteraction(this)])},setTouchInteractions:function(){this.setInteractions([new c.canvas.interaction.TouchInteraction(this)])},setEditInteractions:function(a){this.setInteractions([new c.canvas.interaction.SelectInteraction(this),new c.canvas.interaction.EditInteraction(this,a),new c.canvas.interaction.MoveInteraction(this,a),new c.canvas.interaction.ScrollInteraction(this),new c.canvas.interaction.DefaultInteraction(this)])},setCreateElementInteractions:function(a){this.setInteractions([new c.canvas.interaction.CreateElementInteraction(this,a),new c.canvas.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(a){this.setInteractions([new c.canvas.interaction.CreateLinkInteraction(this,a),new c.canvas.interaction.ScrollInteraction(this),new c.canvas.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(a){this.setInteractions([new c.canvas.interaction.CreateShapeLinkInteraction(this,a),new c.canvas.interaction.ScrollInteraction(this),new c.canvas.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(a){this.setInteractions([new c.canvas.interaction.CreateShapeNodeInteraction(this,a),new c.canvas.interaction.ScrollInteraction(this),new c.canvas.interaction.DefaultInteraction(this)])},setPanInteractions:function(){this.setInteractions([new c.canvas.interaction.PanInteraction(this),new c.canvas.interaction.ScrollInteraction(this),new c.canvas.interaction.DefaultInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(a){var b=this._hasEditInteraction;this._hasEditInteraction=a,this.firePropertyChange("hasEditInteraction",b,a)},addElementByInteraction:function(a){a.getParent()||a.setParent(this._currentSubNetwork),this._box.add(a),this.getSelectionModel().setSelection(a),this.fireInteractionEvent({kind:"createElement",element:a})},getToolTip:function(a){if(a){var b=a.getToolTip();return b?b:a.getName()}return null},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(a){this._toolTipEnabled=a;if(a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){var c=b.getElementAt(a);if(c){var d=b.getToolTip(c);y.showToolTip(a,d);return}y.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(y.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},setZoom:function(a){var b=this._zoom;if(this._zoom==a)return;var c={x:(this.viewRect.x+this.viewRect.width/2)/this.getZoom()*a,y:(this.viewRect.y+this.viewRect.height/2)/this.getZoom()*a};this._zoom=a,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.validateCanvasSize(),this.setViewRect(c.x-this.viewRect.width/2,c.y-this.viewRect.height/2,this.viewRect.width,this.viewRect.height),this.firePropertyChange("zoom",b,this._zoom)},getZoom:function(){return this._zoom},zoomOverview:function(a){if(this.realWidth<=0||this.realHeight<=0)return;var b=this.realWidth/this.getZoom(),c=this.realHeight/this.getZoom(),d=this.viewRect.width/b,e=this.viewRect.height/c,f=Math.min(d,e);this.setZoom(f)},zoomReset:function(){this.setZoom(1)},zoomIn:function(){this.setZoom(this.getZoom()*1.2)},zoomOut:function(){this.setZoom(this.getZoom()/1.2)},upSubNetwork:function(a,b){this._currentSubNetwork&&this.setCurrentSubNetwork(s.getSubNetwork(this._currentSubNetwork),a,b)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(a,b,d){c.animate.AnimateManager.endAnimate();if(b){if(this._currentSubNetwork===a)return;if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";var e=new c.animate.AnimateSubNetwork(this,a,d);c.animate.AnimateManager.start(e)}else this._setCurrentSubNetwork(a),d&&d()},_setCurrentSubNetwork:function(a){if(this._currentSubNetwork===a)return;if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";var b=this._currentSubNetwork;this._currentSubNetwork=a,this.firePropertyChange("currentSubNetwork",b,a),this.invalidateElementVisibility(),this.invalidateCanvasSize()},makeVisible:function(a){var b=this.getElementUI(a);if(!b)return;var e=s.getSubNetwork(a);if(e!==this._currentSubNetwork){var f=this;this.setCurrentSubNetwork(e,this.isSubNetworkAnimate(),function(){d.callLater(f.makeVisible,f,[a])});return}var g=a;while((g=g.getParent())&&g!==e)g instanceof c.Group&&g.setExpanded(!0);var h=b.getViewRect();if(!h)return;var i={x:h.x*this.getZoom(),y:h.y*this.getZoom(),width:h.width*this.getZoom(),height:h.height*this.getZoom()};l.intersects(this.viewRect,i)||this.isVisible(a)&&d.callLater(this.centerByLogicalPoint,this,[i.x+i.width/2,i.y+i.height/2])},centerByLogicalPoint:function(a,b,c){var d=a-this.viewRect.width/2,e=b-this.viewRect.height/2;this.setViewRect(d,e,this.viewRect.width,this.viewRect.height)},panByOffset:function(a,b){this.setViewOffSet(a,b)},getIconsNames:function(a){return a.getStyle("icons.names")},getIconsColors:function(a){return a.getStyle("icons.colors")},toCanvas:function(a,b,d){d||(d=p.createCanvas()),d.setAttribute("width",a),d.setAttribute("height",b),d._viewRect?(d._viewRect.width=a,d._viewRect.height=b):d._viewRect={x:0,y:0,width:a,height:b};var e=d.getContext("2d");e.clearRect(0,0,a,b);if(this._view.clientWidth===0||this._view.clientHeight===0)return d;var f=a/this.realWidth,g=b/this.realHeight;e.scale(f,g);var h=new c.List,k=this.getElementBox().getDatas(),l=k.size(),m=this.getElementBox().getLayerBox(),o=m.getDatas(),q=o.size();j,layer,i,n,ui,att;for(j=0;j<q;j++){layer=o.get(j);for(i=0;i<l;i++)n=k.get(i),m.getLayerByElement(n)===layer&&this.isVisible(n)&&(ui=this.getElementUI(n),ui!=null&&ui.paint(e))}l=h.size();for(i=0;i<l;i++)att=h.get(i),att.getElementUI().paintAttachment(e,att);return d},_toCanvas:function(a,b,c,d){},toCanvasByRegion:function(a,b,c){}}),c.canvas.ElementUI=function(a,b){this._network=a,this._element=b,this._attachments=new c.List,this._bodyBounds=new c.List,this._hitTest=!1,this._hitTest=!1,this._intersectTest=!1,this.invalidate(!0)},d.ext("twaver.canvas.ElementUI",Object,{getElement:function(){return this._element},getNetwork:function(){return this._network},handlePropertyChange:function(a){this.invalidate(!0)},handleSelectionChange:function(a){this.invalidate(!0)},invalidate:function(a){a===b&&(a=!0),a&&(this._invalidateAttachmentsFlag=!0);if(this._invalidateFlag)return;this._hotSpot=null,this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility()},updateStyle:function(){this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this._wholeAlpha=this._element.getStyle("whole.alpha")},validate:function(){if(this._invalidateFlag==0)return;this._bodyBounds.clear(),this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this.updateStyle(),this.validateImpl(),this._attachments.forEach(function(a){a.validate()});var a;this._bodyBounds.forEach(function(b){a=l.unionRect(a,b)}),this._unionBodyBounds=d.clone(a),this._attachments.forEach(function(b){a=l.unionRect(a,b.getViewRect())}),this._viewRect=a},validateImpl:function(){},setShadow:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;return b.shadowOffsetX===this._shadowXOffset&&b.shadowOffsetY===this._shadowYOffset&&b.shadowBlur===this._shadowBlur?b:(c&&(b.shadowOffsetX=this._shadowXOffset,b.shadowOffsetY=this._shadowYOffset,b.shadowBlur=this._shadowBlur,b.shadowColor=this._shadowColor),b)},clearShadow:function(a){if(a.shadowOffsetX!=0||a.shadowOffsetY!=0||a.shadowBlur!=0)a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0},appendShadowBound:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;return c&&(this._shadowXOffset>0?b.width+=this._shadowXOffset:(b.x+=this._shadowXOffset,b.width+=-this._shadowXOffset),this._shadowYOffset>0?b.height+=this._shadowYOffset:(b.y+=this._shadowYOffset,b.height+=-this._shadowYOffset),l.grow(b,this._shadowBlur,this._shadowBlur)),b},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&this._element.getStyle("select.style")==="shadow"?!0:!1},addAttachment:function(a){this._attachments.add(a),this.invalidate(!1)},removeAttachment:function(a){this._attachments.remove(a),this.invalidate(!1)},getAttachments:function(){return this._attachments},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var a=this._network.getLabel(this._element);a!=null&&a!==""?this._labelAttachment||(this._labelAttachment=new c.canvas.LabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null
)},checkAlarmAttachment:function(){var a=this._network.getAlarmLabel(this._element);a!=null&&a!==""?this._alarmAttachment||(this._alarmAttachment=new c.canvas.AlarmAttachment(this,!0),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var a=this._network.getIconsNames(this._element);a&&a.length>0?this._iconsAttachment||(this._iconsAttachment=new c.canvas.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)&&this.isEditable()?this._editAttachment||(this._editAttachment=new c.canvas.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},isEditable:function(){return!0},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getDyeColor:function(a){return this._innerColor?this._innerColor:this.getStyle(a)},getStyle:function(a){return this._element.getStyle(a)},getFont:function(a){var b=this._element.getStyle(a);return b?b:c.Defaults.FONT},paint:function(a){a.save(),a.globalAlpha=this._wholeAlpha,a.beginPath(),this.paintBody(a),this.clearShadow(a),a.closePath(),a.beginPath(),this.paintAttachments(a),a.closePath(),a.restore()},paintBody:function(a){},paintAttachments:function(a){a.beginPath();var b=this._attachments.size();for(var c=0;c<b;c++){var d=this._attachments.get(c);this._hitTest==1&&d.isShowOnTop()==0&&this.paintAttachment(a,d),this._intersectTest==1&&this.paintAttachment(a,d),this._hitTest==0&&this._intersectTest==0&&(d.isShowOnTop()?this._network._topAttachmentList.add(d):this.paintAttachment(a,d))}},paintAttachment:function(a,b){a.beginPath(),b.paint(a),this.clearShadow(a)},getViewRect:function(){return d.clone(this._viewRect)},getUnionBodyBounds:function(){return d.clone(this._unionBodyBounds)},addBodyBounds:function(a){a&&this._bodyBounds.add(a)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),d.clone(this._bodyRect)},getHotSpot:function(){return this._hotSpot?d.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(a){this._hotSpot=a},hit:function(a,b){return!1},intersects:function(a){return l.contains(a,this.getViewRect())?!0:!1},hitCanvasRectAtBody:function(a){var b=A.getHitCanvas(a.width,a.height),c=A.getCtx(b);c.save(),c.translate(-a.x,-a.y),this.paintBody(c);try{var d=c.getImageData(0,0,a.width,a.height),e=d.data;for(var f=0;f<d.width;f++)for(var g=0;g<d.height;g++){var h=4*(g*d.width+f),i=e[h+3];if(i!==0)return c.restore(),1}}catch(j){A.disposeHitCanvas();if(l.contains(this.getUnionBodyBounds(),a))return 0}return c.restore(),-1},hitCanvasRectAtAttachments:function(a){var b=A.getHitCanvas(a.width,a.height),c=A.getCtx(b);c.save(),c.translate(-a.x,-a.y),this.paintAttachments(c);try{var d=c.getImageData(0,0,a.width,a.height),e=d.data;for(var f=0;f<d.width;f++)for(var g=0;g<d.height;g++){var h=4*(g*d.width+f),i=e[h+3];if(i!==0)return c.restore(),1}}catch(j){A.disposeHitCanvas()}return c.restore(),-1},hitCanvasRect:function(a){this._intersectTest=!0,this._hitTest==1&&(this._intersectTest=!1);var b=l.intersection(a,this._viewRect),c=this.hitCanvasRectAtBody(b);if(c==1)return this._intersectTest=!1,!0;var d=this.hitCanvasRectAtAttachments(b);return d==1?(this._intersectTest=!1,!0):(this._intersectTest=!1,c==0)},hitCanvasPoint:function(a,b){if(!l.containsPoint(this._viewRect,a,b))return!1;this._hitTest=!0;var c=this.hitCanvasRect({x:a-1,y:b-1,width:2,height:2});return this._hitTest=!1,c},hitTest:function(a,b){if(!l.containsPoint(this._viewRect,a,b))return null;var c={x:a-1,y:b-1,width:2,height:2},d=l.intersection(c,this._viewRect),e=this.hitCanvasRectAtBody(d);if(e==1)return this;var f=this._attachments.size();for(var g=0;g<f;g++){var h=this._attachments.get(g);if(h.hit(a,b))return h}return e==0?this:null}}),c.canvas.NodeUI=function(a,b){c.canvas.NodeUI.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.NodeUI",c.canvas.ElementUI,{invalidate:function(){c.canvas.NodeUI.superClass.invalidate.call(this);var a=this._element.getAgentLinks();a&&a.forEach(function(a){this._network.invalidateElementUI(a,!1)},this)},createBodyRect:function(){return this._element.getRect()},validateImpl:function(){c.canvas.NodeUI.superClass.validateImpl.call(this);var a=this.getStyle("vector.shape"),b=this.getBodyRect();this._hotSpot=l.getHotSpot(b.x,b.y,b.width,b.height,a),this.validateBodyBounds()},validate:function(){if(this._invalidateFlag==0)return;c.canvas.NodeUI.superClass.validate.call(this);var a=this._element.getParent();a instanceof c.Group&&this._network.invalidateElementUI(a,!1)},validateBodyBounds:function(){var a=this.getStyle("body.type");a==="default"?this.addBodyBounds(this.getDefaultBodyRect()):a==="vector"?this.addBodyBounds(this.getVectorBody()):a==="default.vector"?(this.addBodyBounds(this.getVectorBody()),this.addBodyBounds(this.getDefaultBodyRect())):a==="vector.default"&&(this.addBodyBounds(this.getDefaultBodyRect()),this.addBodyBounds(this.getVectorBody())),this._outerColor&&this.addBodyBounds(this.getOuterBorderRect()),!this._editAttachment&&this.getStyle("select.style")==="border"&&this._network.isSelected(this._element)&&this.addBodyBounds(this.getSelectBorderRect())},getDefaultBodyRect:function(){var a=this._element,b=d.getImageAsset(a.getImage()),c=this.getBodyRect();if(!b)return c;l.addPadding(c,this._element,"image.padding",1);var e=d.clone(c);return this.appendShadowBound(this,e),c=e,c},getVectorBody:function(){var a=this.getPathRect("vector");return a},getOuterBorderRect:function(){return this._getBorderRect("outer")},getSelectBorderRect:function(){return this._getBorderRect("select")},_getBorderRect:function(a){var b=this._element,c=b.getStyle(a+".width");if(c>0){var e=this.getBodyRect();l.addPadding(e,b,a+".padding",1);var f=d.clone(e);return l.grow(f,c/2,c/2),f}return null},getPathRect:function(a,b){var c=this._element,e=this.getBodyRect();b&&l.addPadding(e,c,a+".padding",1);var f=d.clone(e),g=c.getStyle(a+".outline.width");return g>0&&l.grow(f,g/2,g/2),this.appendShadowBound(this,f),f},paintBody:function(a){var b=this.getStyle("body.type");b==="default"?this.drawDefaultBody(a):b==="vector"?this.drawVectorBody(a):b==="default.vector"?(this.drawVectorBody(a),this.drawDefaultBody(a)):b==="vector.default"&&(this.drawDefaultBody(a),this.drawVectorBody(a)),this._outerColor&&this.drawOuterBorder(a),this.getStyle("select.style")==="border"&&this._network.isSelected(this._element)&&this.drawSelectBorder(a)},drawOuterBorder:function(a){var b=this._element,c=b.getStyle("outer.width");if(c>0){var d=this.getBodyRect();l.addPadding(d,b,"outer.padding",1),a.lineWidth=c,a.lineCap=b.getStyle("outer.cap"),a.lineJoin=b.getStyle("outer.join"),a.strokeStyle=this._outerColor,q.drawVector(a,b.getStyle("outer.shape"),null,d),a.stroke()}},drawDefaultBody:function(a){var b=this._element,c=d.getImageAsset(b.getImage()),e=b.getRect();if(!c)return;l.addPadding(e,this._element,"image.padding",1),c.getImage()&&(this.setShadow(this,a),a.drawImage(c.getImage(this.getInnerColor()),e.x,e.y,e.width,e.height))},drawSelectBorder:function(a){var b=this._element,c=b.getStyle("select.width");if(c>0){var e=this.getBodyRect();l.addPadding(e,b,"select.padding",1);var f=d.clone(e);l.grow(f,c/2,c/2),a.lineWidth=c,a.lineCap=b.getStyle("select.cap"),a.lineJoin=b.getStyle("select.join"),a.strokeStyle=b.getStyle("select.color"),q.drawVector(a,b.getStyle("select.shape"),null,e),a.stroke()}},drawVectorBody:function(a){this.drawPath(a,"vector",!0,this._element.getStyle("vector.outline.pattern"));var b=this.getStyle("vector.deep"),c=this.getStyle("vector.fill.color");b!==0&&c&&this.getStyle("vector.shape")==="rectangle"&&q.draw3DRect(a,c,b,this.getBodyRect())},drawPath:function(a,b,c,d,e,f,g){var h=this._element,i=this.getBodyRect();c&&l.addPadding(i,h,b+".padding",1);var j=h.getStyle(b+".outline.width");this.setShadow(this,a);var k=h.getStyle(b+".fill"),m;if(k){this._innerColor&&!s.hasDefault(this._element)?m=this._innerColor:m=h.getStyle(b+".fill.color");var n=h.getStyle(b+".gradient");n?q.fill(a,m,n,h.getStyle(b+".gradient.color"),i):a.fillStyle=m}var o=h.getStyle(b+".shape");k&&(a.beginPath(),e?q.drawLinePoints(a,e,null,f,g):q.drawVector(a,o,null,i),a.fill()),j>0&&(a.lineWidth=j,a.lineCap=h.getStyle(b+".cap"),a.lineJoin=h.getStyle(b+".join"),a.strokeStyle=h.getStyle(b+".outline.color"),a.beginPath(),e?q.drawLinePoints(a,e,d,f,g):q.drawVector(a,o,d,i),a.stroke())},hit:function(a,b){return l.containsPoint(this.getViewRect(),a,b)?this.hitCanvasPoint(a,b):!1},intersects:function(a){var b=c.canvas.NodeUI.superClass.intersects.apply(this,arguments);return b==1?!0:l.intersects(a,this.getViewRect())?this.hitCanvasRect(a):!1}}),c.network.Overview=function(a){c.network.Overview.superClass.constructor.apply(this,arguments),this._view=p.createView(),this._rootDiv=p.createDiv(),this._imageCanvas=p.createCanvas(),this._imageDiv=p.createDiv(),this._maskCanvas=p.createCanvas(),this._selectDiv=p.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,p.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this.setNetwork(a);var b;g.isTouchable?b=c.network.OverviewTouchInteraction:b=c.network.OverviewInteraction,b&&new b(this)},d.ext("twaver.network.Overview",c.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:D.OVERVIEW_FILL_COLOR,_outlineColor:D.OVERVIEW_OUTLINE_COLOR,_outlineWidth:D.OVERVIEW_OUTLINE_WIDTH,_selectColor:D.OVERVIEW_SELECT_COLOR,_selectWidth:D.OVERVIEW_SELECT_WIDTH,_padding:D.OVERVIEW_PADDING,_animate:D.OVERVIEW_ANIMATE,_maxPackingWidth:D.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:D.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(a){this._invalidateMask()},setNetwork:function(a){if(a===this._network)return;this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),p.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=a,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),p.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate()},_handleNetworkPropertyChange:function(a){(a.property==="zoom"||a.property==="currentSubNetwork"||a.property==="elementBox"||a.property==="dataBox")&&this.invalidate()},_handleNetworkViewChange:function(a){a.kind==="validateEnd"&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(a){if(!this._isNetworkDirty||!this._isMaskDirty)this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),d.callLater(this.validate,this,null,a)},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,d.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&this._network._view.clientWidth!==0&&this._network._view.clientHeight!==0){var a=this._maxPackingWidth>0&&this._maxPackingHeight>0,b;a?b={x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:b={x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},l.grow(b,-this._padding,-this._padding);var c=Math.min(b.width/this._network._view.scrollWidth,b.height/this._network._view.scrollHeight);a&&(p.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),b.width=this._imageDiv._viewRect.width,b.height=this._imageDiv._viewRect.height);var d=this._network._view.scrollWidth*c,e=this._network._view.scrollHeight*c,f=b.x+(b.width-d)/2,g=b.y+(b.height-e)/2;if(this._isNetworkDirty){var h={x:f,y:g,width:d,height:e};this._network.toCanvas(h.width,h.height,this._imageCanvas),p.setDiv(this._imageDiv,h,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var i={x:this._network._view.scrollLeft*c,y:this._network._view.scrollTop*c,width:d*this._network._view.clientWidth/this._network._view.scrollWidth,height:e*this._network._view.clientHeight/this._network._view.scrollHeight},j=p.setCanvas(this._maskCanvas,f,g,d,e);j.lineWidth=0,j.fillStyle=this._fillColor,q.drawVector(j,"rectangle",null,f,g,d,e),j.closePath(),j.fill(),j.stroke(),j.clearRect(f+i.x,g+i.y,i.width,i.height),j.lineWidth=this._outlineWidth,j.strokeStyle=this._outlineColor,q.drawVector(j,"rectangle",null,f+i.x+this._outlineWidth,g+i.y+this._outlineWidth,i.width-this._outlineWidth*2,i.height-this._outlineWidth*2),j.closePath(),j.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(a){return p.getLogicalPoint(this._view,a,1,this._rootDiv)},centerNetwork:function(a,b){var c=this._imageDiv._viewRect;l.containsPoint(c,a)&&(this._network.centerByLogicalPoint((a.x-c.x)/c.width*this._network._view.scrollWidth/this._network.getZoom(),(a.y-c.y)/c.height*this._network._view.scrollHeight/this._network.getZoom(),b),this._invalidateMask())}}),c.network.OverviewTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,p.addEventListener("touchstart","handleTouchstart",this.view,this)},d.ext("twaver.network.OverviewTouchInteraction",Object,{handleTouchstart:function(a){p.preventDefault(a),this.clear(),this.endPoint=this.overview.getLogicalPoint(a),w.isMultiTouch(a)&&(this.distance=w.getDistance(a),this.zoom=this.network.getZoom()),p.addEventListener("touchmove","handleTouchmove",this.view,this),p.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(a);if(w.isSingleTouch(a))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var b=w.getDistance(a)/this.distance;this.network.setZoom(this.zoom*b,!1)}},handleTouchend:function(a){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(a);var b=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;b?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),b?d.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,p.removeEventListener("touchmove",this.view,this),p.removeEventListener("touchend",this.view,this))}}),c.network.OverviewInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,p.addEventListener("mousedown","handleMousedown",this.view,this)},d.ext("twaver.network.OverviewInteraction",Object,{handleMousedown:function(a){this.clear(),this.endPoint=this.overview.getLogicalPoint(a),d.isCtrlDown(a)&&(this.startPoint=this.endPoint,p.setVisible(this.overview._selectDiv,!0)),p.addEventListener("mousemove","handleMousemove",this.view,this),p.addEventListener("mouseup","handleMouseup",this.view,this)},handleMouseup:function(a){this.endPoint=this.overview.getLogicalPoint(a);if("detail"in a&&a.detail===2)d.callLater(this.network.zoomReset,this.network,[this.overview._animate]);else if(p.isVisible(this.overview._selectDiv)&&this.startPoint){var b=this.overview._imageDiv._viewRect,c=this.overview._selectDiv._viewRect.x,e=this.overview._selectDiv._viewRect.y,f=b.width/this.overview._selectDiv._viewRect.width,g=b.height/this.overview._selectDiv._viewRect.height,h=Math.min(f,f),i=this.network._view.scrollWidth/this.network.getZoom()*((c-b.x+this.overview._selectDiv._viewRect.width/2)/b.width),j=this.network._view.scrollHeight/this.network.getZoom()*((e-b.y+this.overview._selectDiv._viewRect.height/2)/b.height);this.network.setZoom(h*Math.min(this.network._view.clientWidth/this.network._view.scrollWidth,this.network._view.clientHeight/this.network._view.scrollHeight)*this.network.getZoom(),!1),d.callLater(this.network.centerByLogicalPoint,this.network,[i,j,this.overview._animate]),p.setVisible(this.overview._selectDiv,!1),p.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(a){var b=this.overview.getLogicalPoint(a);this.endPoint=b;if(p.isVisible(this.overview._selectDiv)&&this.startPoint){var c=b.x>this.startPoint.x?this.startPoint.x:b.x,d=b.x>this.startPoint.x?this.startPoint.y:b.y;b.x>this.startPoint.x&&b.y<this.startPoint.y&&(d=b.y),b.x<this.startPoint.x&&b.y>this.startPoint.y&&(d=this.startPoint.y);var e=this.overview._imageDiv._viewRect;c<e.x&&(c=e.x),c>e.x+e.width&&(c=e.x+e.width),d<e.y&&(d=e.y),d>e.y+e.height&&(d=e.y+e.height);var f=Math.abs(b.x-this.startPoint.x),g=Math.abs(b.y-this.startPoint.y);c+f>e.x+e.width&&(f=e.x+e.width-c),d+g>e.y+e.height&&(g=e.y+e.height-d),p.setDiv(this.overview._selectDiv,{x:c,y:d,width:f,height:g},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(b,!1)},clear:function(){this.endPoint&&(this.endPoint=null,p.removeEventListener("mousemove",this.view,this),p.removeEventListener("mouseup",this.view,this))}}),c.canvas.LinkUI=function(a,b){c.canvas.LinkUI.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.LinkUI",c.canvas.ElementUI,{isEditable:function(){return u.isOrthogonalLink(this._element)&&this.getControlPoint()?!0:!1},invalidate:function(a){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,c.canvas.LinkUI.superClass.invalidate.call(this,a)},validateImpl:function(){this.validateBodyBounds(),c.canvas.LinkUI.superClass.validateImpl.call(this)},validateBodyBounds:function(){var a=this.getLinkPoints();if(!a||a.size()<2)return;var b=this._element,c=l.getLineRect(a),d=b.getStyle("link.width"),e=d;if(this._outerColor){var f=b.getStyle("outer.width");e+=f*2}var g=!this._editAttachment&&b.getStyle("select.style")==="border"&&this._network.isSelected(this._element);if(g){var h=b.getStyle("select.width");e+=h*2}l.grow(c,e/2,e/2),b.getStyle("arrow.from")&&(c=l.unionRect(c,C.getArrowRect(a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),b.getStyle("arrow.from.xoffset"),b.getStyle("arrow.from.yoffset")))),b.getStyle("arrow.to")&&(c=l.unionRect(c,C.getArrowRect(a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),b.getStyle("arrow.to.xoffset"),b.getStyle("arrow.to.yoffset")))),this.appendShadowBound(this,c),this.addBodyBounds(c)},createBodyRect:function(){var a=this.getHotSpot();return a?{x:a.x-1,y:a.y-1,width:2,height:2}:null},paintBody:function(a){var b=this.getLinkPoints();if(!b||b.size()<2)return;var c=this._element,d=c.getStyle("link.width"),e=d;if(this._outerColor){var f=c.getStyle("outer.width");e+=f*2}var g=!this._editAttachment&&c.getStyle("select.style")==="border"&&this._network.isSelected(this._element);if(g){var h=c.getStyle("select.width");e+=h*2}this.setShadow(this,a),a.lineCap=c.getStyle("link.cap"),a.lineJoin=c.getStyle("link.join");var i=c.getStyle("link.pattern");g&&this.drawLinePoints(a,b,e,c.getStyle("select.color"),i),this._outerColor&&this.drawLinePoints(a,b,d+f*2,this._outerColor,i),this.drawLinePoints(a,b,d,this._innerColor||c.getStyle("link.color"),i),C.drawLinkArrow(this,a,b)},drawLinePoints:function(a,b,c,d,e){a.lineWidth=c,a.strokeStyle=d,a.beginPath(),q.drawLinePoints(a,b,e),a.stroke()},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=l.calculateLineLength(this._linkPoints)),this._linkPoints},getFromPosition:function(a,b){var c=this.getFromPoint();return c?{x:c.x+a,y:c.y+b}:null},getToPosition:function(a,b){var c=this.getToPoint();return c?{x:c.x+a,y:c.y+b}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=u.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=u.createToPoint(this)),this._toPoint},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),d=this.getStyle("link.type");if(u.isOrthogonalOrFlexionalLink(this._element))return u.orthogonalAndFlexional(this,d);var e=new c.List;if(this._element.isLooped()){var f=this._network.getElementUI(this._element.getFromAgent());if(f==null)return null;this._hotSpot=u.fillLoopedPoints(this,f.getBodyRect(),e)}else{if(d!=="arc"&&d!=="triangle"&&d!=="parallel")throw"Can not resolve link type '"+d+"'";this._hotSpot=u.fillBundlePoints(this,d,a,b,e)}return e},checkAttachments:function(){c.canvas.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var a=this._network.getLinkHandlerLabel(this._element);a!=null&&a!==""?this._linkHandlerAttachment||(this._linkHandlerAttachment=new c.canvas.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getControlPoint:function(){return u.getControlPoint(this._element,this)},setControlPoint:function(a){if(!a)return;var b=this.getStyle("link.type");if(!u.hasControlPoint(b))return;var c=u.getLinkSourceBounds(this),d=u.getLinkTargetBounds(this);u.setParamsByControlPoint(a,c,d,b,this._element)},getLineLength:function(){return this._lineLength},hit:function(a,b){return l.containsPoint(this.getViewRect(),a,b)?this.hitCanvasPoint(a,b):!1},intersects:function(a){var b=c.canvas.NodeUI.superClass.intersects.apply(this,arguments);if(b==1)return!0;if(l.intersects(a,this.getViewRect())==0)return!1;var d=this.getLinkPoints(),e=d.size();if(e==2)for(var f=0;f<e;f+=2){var g=d.get(f);if(f+1<e){var h=d.get(f+1);if(A.intersectsLine(g.x,g.y,h.x,h.y,a.x,a.y,a.width,a.height))return!0}}return this.hitCanvasRect(a)}}),c.canvas.GroupUI=function(a,b){c.canvas.GroupUI.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.GroupUI",c.canvas.NodeUI,{isEditable:function(){return!this._element.isExpanded()},paintBody:function(a){this._shapeRect?this.drawExpandedGroup(a):c.canvas.GroupUI.superClass.paintBody.apply(this,arguments)},validateBodyBounds:function(){this.getBodyRect(),this._shapeRect?this.addBodyBounds(this.getPathRect("group",!1)):c.canvas.GroupUI.superClass.validateBodyBounds.call(this)},drawExpandedGroup:function(a){this.drawPath(a,"group",!1,this._element.getStyle("vector.outline.pattern"));var b=this.getStyle("group.deep"),c=this.getStyle("group.fill.color");b!==0&&c&&this.getStyle("group.shape")==="rectangle"&&q.draw3DRect(a,c,b,this._bodyRect)},getChildrenRects:function(){var a=new c.List,b=this._network;return this._element.getChildren().forEach(function(d){if(d instanceof c.Node){var e=b.getElementUI(d);if(e){var f=e.getViewRect();f&&a.add(f)}}}),a},createBodyRect:function(){this._shapeRect=null;var a=this._element;if(a.isExpanded()){var b=this.getChildrenRects();if(!b.isEmpty()){var d=a.getStyle("group.shape"),e=m[d];if(!e)throw"Can not resolve group shape '"+d+"'";this._shapeRect=e(b)}}return this._shapeRect?(l.addPadding(this._shapeRect,a,"group.padding",1),this._shapeRect):c.canvas.GroupUI.superClass.createBodyRect.call(this)}}),c.network.ElementUI=function(a,b){this._view=p.createDiv(),this._bodyView=p.createDiv(),this._view.appendChild(this._bodyView),this._network=a,this._element=b,this._attachments=new B,this._bodyBounds=new B,this.invalidate(!0)},d.ext("twaver.network.ElementUI",Object,{_invalidateFlag:!1,_invalidateAttachmentsFlag:!1,getElement:function(){return this._element},getNetwork:function(){return this._network},getAttachments:function(){return this._attachments},getStyle:function(a){return this._element.getStyle(a)},getFont:function(a){var b=this._element.getStyle(a);return b?b:D.FONT},getDyeColor:function(a){return this._innerColor?this._innerColor:this.getStyle(a)},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},getHotSpot:function(){return this._hotSpot?d.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(a){this._hotSpot=a},getUnionBodyBounds:function(){return d.clone(this._unionBodyBounds)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),d.clone(this._bodyRect)},invalidate:function(a){a===b&&(a=!0),a&&(this._invalidateAttachmentsFlag=!0);if(this._invalidateFlag)return;this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility()},updateMeasure:function(){},validate:function(){if(!this._invalidateFlag)return;this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this._bodyBounds.clear(),p.clear(this._bodyView),this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this.updateMeasure();var a=this._element.getStyle("whole.alpha");this._view.style.opacity=a,this._attachments.forEach(function(b){b.updateMeasure();var c=b.getAlpha();b.isShowInAttachmentDiv()?b._view.style.opacity=c*a:b._view.style.opacity=c});var b;this._bodyBounds.forEach(function(a){b=l.unionRect(b,a)}),this._unionBodyBounds=d.clone(b),this._attachments.forEach(function(a){b=l.unionRect(b,a.getViewRect())}),this._viewRect=b},cleanUp:function(a){var b=a.length;for(var c=0;c<b;c++){var d=a[c],e=this[d];e&&!e.parentNode&&(this[d]=null)}},setVisible:function(a){if(this.isVisible()===a)return;p.setVisible(this._view,a),this._attachments.forEach(function(b){b.isShowInAttachmentDiv()&&p.setVisible(b._view,a)}),this.invalidate(!0)},isVisible:function(){return p.isVisible(this._view)},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var a=this._network.getLabel(this._element);a!=null&&a!==""?this._labelAttachment||(this._labelAttachment=new c.network.LabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._network.getAlarmLabel(this._element);a!=null&&a!==""?this._alarmAttachment||(this._alarmAttachment=new c.network.AlarmAttachment(this,!0),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var a=this._network.getIconsNames(this._element);a&&a.length>0?this._iconsAttachment||(this._iconsAttachment=new c.network.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this.isEditable()&&this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)?this._editAttachment||(this._editAttachment=new c.network.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},isEditable:function(){return!0},handlePropertyChange:function(a){this.invalidate(!0)},handleSelectionChange:function(a){this.invalidate(!0)},dispose:function(){this._attachments.forEach(function(a){a.getView().parentNode&&a.getView().parentNode.removeChild(a.getView()),a.dispose()}),this._attachments.clear()},addAttachment:function(a){this._attachments.add(a),a.isShowInAttachmentDiv()?this._network.getAttachmentDiv().appendChild(a.getView()):this._view.appendChild(a.getView()),this.invalidate(!1)},removeAttachment:function(a){this._attachments.remove(a),a.getView().parentNode&&a.getView().parentNode.removeChild(a.getView()),a.dispose(),this.invalidate(!1)},addBodyBounds:function(a){a&&this._bodyBounds.add(a)},addComponent:function(a){this._bodyView.appendChild(a)},getBodyView:function(){return this._bodyView},getView:function(){return this._view},getViewRect:function(){return d.clone(this._viewRect)},setShadow:function(a,b,c){var d=a.isShadowable()&&this._shadowColor&&!this._editAttachment;d&&(this._shadowXOffset>0?c.width+=this._shadowXOffset:(c.x+=this._shadowXOffset,c.width+=-this._shadowXOffset),this._shadowYOffset>0?c.height+=this._shadowYOffset:(c.y+=this._shadowYOffset,c.height+=-this._shadowYOffset),l.grow(c,this._shadowBlur,this._shadowBlur));var e=p.setCanvas(b,c);return d&&(e.shadowOffsetX=this._shadowXOffset,e.shadowOffsetY=this._shadowYOffset,e.shadowBlur=this._shadowBlur,e.shadowColor=this._shadowColor),e},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&this._element.getStyle("select.style")==="shadow"?!0:!1},hit:function(a,b){return!1},hitCanvas:function(a,b,c){var d=c.length;for(var e=0;e<d;e++){var f=c[e],g=this[f];if(q.hit(g,a,b))return!0}return!1},hitComponent:function(a,b,c){var d=c.length;for(var e=0;e<d;e++){var f=c[e],g=this[f];if(g&&l.containsPoint(g._viewRect,a,b))return!0}return!1},hitTest:function(a,b){if(!this.isVisible()||!l.containsPoint(this._viewRect,a,b))return null;var c,d=this._attachments.size(),e;for(c=d-1;c>=0;c--){e=this._attachments.get(c);if(e.isShowInAttachmentDiv()&&e.hit(a,b))return e}for(c=d-1;c>=0;c--){e=this._attachments.get(c);if(!e.isShowInAttachmentDiv()&&e.hit(a,b))return e}return l.containsPoint(this._unionBodyBounds,a,b)&&this.hit(a,b)?this:null},intersects:function(a){return!1},intersectsComponent:function(a,b){var c=b.length;for(var d=0;d<c;d++){var e=b[d],f=this[e];if(f&&l.intersects(f._viewRect,a))return!0}return!1},intersectsCanvas:function(a,b){var c=b.length;for(var d=0;d<c;d++){var e=b[d],f=this[e];if(q.intersects(f,a))return!0}return!1},intersectsTest:function(a){if(!this.isVisible()||!l.intersects(this._viewRect,a))return null;var b=this._attachments.size(),c,d;for(c=b-1;c>=0;c--){d=this._attachments.get(c);if(d.isShowInAttachmentDiv()&&d.intersects(a))return d}for(c=b-1;c>=0;c--){d=this._attachments.get(c);if(!d.isShowInAttachmentDiv()&&d.intersects(a))return d}return l.intersects(this._unionBodyBounds,a)&&this.intersects(a)?this:null}}),c.network.Attachment=function(a,b){this._view=p.createDiv(),this._ui=a,this._element=this._ui.getElement(),this._network=a.getNetwork(),this._isShowInAttachmentDiv=b===!0,this._isShowInAttachmentDiv&&p.setVisible(this._view,a.isVisible())},d.ext("twaver.network.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},getStyle:function(a){return this._ui.getStyle(a)},getFont:function(a){return this._ui.getFont(a)},isShowInAttachmentDiv:function(){return this._isShowInAttachmentDiv},getView:function(){return this._view},getViewRect:function(){return d.clone(this._viewRect)},getAlpha:function(){return 1},updateMeasure:function(){},dispose:function(){},hit:function(a,b){return l.containsPoint(this._viewRect,a,b)},intersects:
function(a){return l.intersects(this._viewRect,a)}}),c.network.BasicAttachment=function(a,b){c.network.BasicAttachment.superClass.constructor.call(this,a,b),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0},this._attachmentCanvas=p.createCanvas(),this._view.insertBefore(this._attachmentCanvas,this._view.firstChild)},d.ext("twaver.network.BasicAttachment",c.network.Attachment,{calculateMeasure:function(){var a=this.getContentWidth(),b=this.getContentHeight(),c=this.getCornerRadius(),d=this.getPointerLength(),e=this.getPointerWidth(),f=this.getPosition(),g=this.getXOffset(),h=this.getYOffset(),i=this._roundRect;i.width=a+c*2,i.height=b;var j;if(d>0){var k=this.getDirection();j=this._network.getPosition(f,this._ui,null,g,h);var m;if(k==="aboveleft")i.y=j.y-d-i.height,i.x=j.x-(i.width-c),m=Math.max(j.x-e,i.x+c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:m,y:j.y-d}];else if(k==="aboveright")i.y=j.y-d-i.height,i.x=j.x-c,m=Math.min(j.x+e,i.x+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:m,y:j.y-d}];else if(k==="belowleft")i.y=j.y+d,i.x=j.x-(i.width-c),m=Math.max(j.x-e,i.x+c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:m,y:j.y+d}];else if(k==="belowright")i.y=j.y+d,i.x=j.x-c,m=Math.min(j.x+e,i.x+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:m,y:j.y+d}];else if(k==="leftabove")i.y=j.y+c-i.height,i.x=j.x-d-i.width,m=Math.max(j.y-e,i.y+c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:m}];else if(k==="leftbelow")i.y=j.y-c,i.x=j.x-d-i.width,m=Math.min(j.y+e,i.y+i.height-c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:m}];else if(k==="rightabove")i.y=j.y+c-i.height,i.x=j.x+d,m=Math.max(j.y-e,i.y+c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:m}];else if(k==="rightbelow")i.y=j.y-c,i.x=j.x+d,m=Math.min(j.y+e,i.y+i.height-c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:m}];else if(k==="above")i.y=j.y-d-i.height,i.x=j.x-i.width/2,m=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-m,y:j.y-d},{x:j.x+m,y:j.y-d}];else if(k==="below")i.y=j.y+d,i.x=j.x-i.width/2,m=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-m,y:j.y+d},{x:j.x+m,y:j.y+d}];else if(k==="left")i.y=j.y-i.height/2,i.x=j.x-d-i.width,m=Math.min(b/2,e/2),this._pointers=[j,{x:j.x-d,y:j.y+m},{x:j.x-d,y:j.y-m}];else{if(k!=="right")throw"Can not resolve '"+k+"' attachment direction";i.y=j.y-i.height/2,i.x=j.x+d,m=Math.min(b/2,e/2),this._pointers=[j,{x:j.x+d,y:j.y+m},{x:j.x+d,y:j.y-m}]}}else j=this._network.getPosition(f,this._ui,{width:i.width,height:i.height},g,h),i.x=j.x,i.y=j.y,this._pointers=null;this._contentRect.x=i.x+(i.width-a)/2,this._contentRect.y=i.y+(i.height-b)/2,this._contentRect.width=a,this._contentRect.height=b;var n=this.getPadding();n!=0&&l.grow(i,n,n),n=this.getPaddingLeft(),n!=0&&(i.x-=n,i.width+=n),n=this.getPaddingRight(),n!=0&&(i.width+=n),n=this.getPaddingTop(),n!=0&&(i.y-=n,i.height+=n),n=this.getPaddingBottom(),n!=0&&(i.height+=n),i.width<0&&(i.width=i.width,i.x-=i.width),i.height<0&&(i.height=-i.height,i.y-=i.height)},updateMeasure:function(){c.network.BasicAttachment.superClass.updateMeasure.call(this),this.calculateMeasure();var a=this.isFill(),b=this.getOutlineWidth();this._viewRect=l.getRect(this._pointers),this._viewRect=l.unionRect(this._viewRect,this._roundRect),b>0&&l.grow(this._viewRect,b/2,b/2);var d=this._ui.setShadow(this,this._attachmentCanvas,this._viewRect);if(b>0||a){d.beginPath(),q.drawRoundRect(d,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(d.moveTo(this._pointers[0].x,this._pointers[0].y),d.lineTo(this._pointers[1].x,this._pointers[1].y),d.lineTo(this._pointers[2].x,this._pointers[2].y)),d.closePath(),b>0&&(d.lineWidth=b,d.strokeStyle=this.getOutlineColor(),d.lineCap=this.getCap(),d.lineJoin=this.getJoin(),d.stroke());if(a){var e=this.getFillColor(),f=this.getGradient();f?q.fill(d,e,f,this.getGradientColor(),this._viewRect):d.fillStyle=e,d.fill()}}return d},getRoundRect:function(){return d.clone(this._roundRect)},getContentRect:function(){return d.clone(this._contentRect)},getContent:function(){return this._content},setContent:function(a){if(this._content===a)return;this._content&&this._view.removeChild(this._content),this._content=a,a&&this._view.appendChild(a)},getContentWidth:function(){return D.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return D.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return D.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return D.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return D.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return D.ATTACHMENT_POSITION},getXOffset:function(){return D.ATTACHMENT_XOFFSET},getYOffset:function(){return D.ATTACHMENT_YOFFSET},getPadding:function(){return D.ATTACHMENT_PADDING},getPaddingLeft:function(){return D.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return D.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return D.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return D.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return D.ATTACHMENT_DIRECTION},isFill:function(){return D.ATTACHMENT_FILL},getFillColor:function(){return D.ATTACHMENT_FILL_COLOR},getGradient:function(){return D.ATTACHMENT_GRADIENT},getGradientColor:function(){return D.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return D.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return D.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return D.ATTACHMENT_CAP},getJoin:function(){return D.ATTACHMENT_JOIN},isShadowable:function(){return D.ATTACHMENT_SHADOWABLE},hit:function(a,b){return l.containsPoint(this._viewRect,a,b)?l.containsPoint(this._contentRect,a,b)?!0:q.hit(this._attachmentCanvas,a,b):!1},intersects:function(a){return l.intersects(this._viewRect,a)?l.intersects(this._contentRect,a)?!0:q.intersects(this._attachmentCanvas,a):!1}}),c.canvas.ShapeNodeUI=function(a,b){c.canvas.ShapeNodeUI.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.ShapeNodeUI",c.canvas.NodeUI,{getDefaultBodyRect:function(){return this._element._points.size()<2?null:this.getPathRect("vector",!0)},drawDefaultBody:function(a){if(this._element._points.size()<2)return;this.drawPath(a,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._element._points,this._element._segments,this._element.getStyle("shapenode.closed")),C.drawLinkArrow(this,a,l.getPointObject(this._element._points,this._element._segments))}}),c.canvas.ShapeLinkUI=function(a,b){c.canvas.ShapeLinkUI.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.ShapeLinkUI",c.canvas.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),e=new c.List,f=this.getStyle("shapelink.type");e.add(a),this._element._points!=null&&e.addAll(this._element._points),e.add(b);var g=e.size(),h=Math.ceil(g/2);if(g%2===0){var i=e.get(h),j=e.get(h-1);this._hotSpot={x:(i.x+j.x)/2,y:(i.y+j.y)/2}}else this._hotSpot=d.clone(e.get(h));var k,l,m;if(f!=="lineto")if(f==="quadto"){k=new c.List(e.get(0));for(l=1,g=e.size();l<g;l++)l<g-1?k.add(new c.List([e.get(l++),e.get(l)])):k.add(e.get(l));e=k}else if(f==="cubicto"){k=new c.List(e.get(0));for(l=1,g=e.size();l<g;l++)l<g-2?k.add(new c.List([e.get(l++),e.get(l++),e.get(l)])):l<g-1?k.add(new c.List([e.get(l++),e.get(l)])):k.add(e.get(l));e=k}else{if(f!=="orthogonalto")throw"Can not resolve shapelink type '"+f+"'";m=e.get(0),k=new c.List(m);for(l=1,g=e.size();l<g;l++)if(l<g-1){var n=d.clone(e.get(l)),o=n.x,p=n.y,q=o-m.x,r=p-m.y;Math.abs(q)>Math.abs(r)?(n.x=o,n.y=m.y):(n.x=m.x,n.y=p),m=n,k.add(m)}else k.add(e.get(l));e=k}return e}}),c.canvas.GridUI=function(a,b){c.canvas.GridUI.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.GridUI",c.canvas.NodeUI,{drawDefaultBody:function(a){this._element.getImage()?c.network.GridUI.superClass.drawDefaultBody.apply(this,arguments):this.drawGridBody(a)},validateBodyBounds:function(){if(this._element.getImage())c.canvas.GridUI.superClass.validateBodyBounds.call(this);else{var a=this.getBodyRect(),b=d.clone(a);this.appendShadowBound(this,b),this.addBodyBounds(b)}},drawGridBody:function(a){var b=this.getStyle("grid.fill"),c=this.getStyle("grid.deep"),d=this.getStyle("grid.cell.deep");if(!b&&c===0&&d===0)return;a.beginPath();var e=this._element.getRect(),f=this.getDyeColor("grid.fill.color");this.setShadow(this,a),b&&(a.fillStyle=f,a.rect(e.x,e.y,e.width,e.height),a.fill()),a.closePath(),this.clearShadow(a),a.beginPath(),c!=0&&q.draw3DRect(a,f,c,e.x,e.y,e.width,e.height),a.closePath();if(d!=0){var g=this.getStyle("grid.row.count"),h=this.getStyle("grid.column.count");for(var i=0;i<g;i++)for(var j=0;j<h;j++){var k=this._element.getCellRect(i,j);k!=null&&(a.beginPath(),q.draw3DRect(a,f,d,k.x,k.y,k.width,k.height),a.closePath())}}}}),c.canvas.RotatableNodeUI=function(a,b){c.canvas.RotatableNodeUI.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.RotatableNodeUI",c.canvas.NodeUI,{isEditable:function(){return!1},getDefaultBodyRect:function(){var a=this._element,b=d.getImageAsset(a.getImage()),c=this.getBodyRect();return b?(l.addPadding(c,this._element,"image.padding",1),c):c},drawDefaultBody:function(a){var b=this._element,c=d.getImageAsset(b.getImage()),e=this.getBodyRect();l.addPadding(e,this._element,"image.padding",1);if(c.getImage()){var f=this._element._getOrignalWidth(),g=this._element._getOrignalHeight(),h=this._element._getRotateRect();a.save(),a.translate(e.x-h.x+f/2,e.y-h.y+g/2),a.rotate(this._element._angle*Math.PI/180),a.drawImage(c.getImage(this._innerColor),-f/2,-g/2,f,g),a.restore()}else if(!c.getSrc()&&!c.getFunction())throw"ImageAsset '"+b.getImage()+" ' is empty"}}),c.network.LabelAttachment=function(a,b){c.network.LabelAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.network.LabelAttachment",c.network.BasicAttachment,{updateMeasure:function(){var a=this.getFont("label.font"),b=this.getLabel();this._textSize=q.getTextSize(a,b);var d=c.network.LabelAttachment.superClass.updateMeasure.call(this);q.drawText(d,b,this._contentRect,a,this.getStyle("label.color"))},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},isShadowable:function(){return this.getStyle("label.shadowable")}}),c.network.AlarmAttachment=function(a,b){c.network.AlarmAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.network.AlarmAttachment",c.network.BasicAttachment,{updateMeasure:function(){var a=this.getFont("alarm.font"),b=this._network.getAlarmLabel(this._element);this._textSize=q.getTextSize(a,b),this._fillColor=this._network.getAlarmFillColor(this._element);var d=c.network.AlarmAttachment.superClass.updateMeasure.call(this);q.drawText(d,b,this._contentRect,a,this.getStyle("alarm.color"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return this._fillColor!=null},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),c.network.LinkHandlerAttachment=function(a,b){c.network.LinkHandlerAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.network.LinkHandlerAttachment",c.network.BasicAttachment,{updateMeasure:function(){var a=this.getFont("link.handler.font"),b=this._network.getLinkHandlerLabel(this._element);this._textSize=q.getTextSize(a,b);var d=c.network.LabelAttachment.superClass.updateMeasure.call(this);q.drawText(d,b,this._contentRect,a,this.getStyle("link.handler.color"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),c.network.EditAttachment=function(a,b){c.network.EditAttachment.superClass.constructor.call(this,a,b),this._attachmentDiv=p.createDiv(),this._view.appendChild(this._attachmentDiv)},d.ext("twaver.network.EditAttachment",c.network.Attachment,{updateMeasure:function(){c.network.EditAttachment.superClass.updateMeasure.call(this),this._element instanceof E&&this._addResizingPoint(this._element),this._element instanceof c.ShapeNode&&this._addShapeNodePoint(this._element),this._ui instanceof c.network.ShapeLinkUI&&this._addShapeLinkPoints(this._ui),this._ui instanceof c.network.LinkUI&&this._addLinkControlPoint(this._ui)},_addResizingPoint:function(a){var b=a.getRect();if(!b)return;if(!this._resizeDivs){this._resizeDivs=new Array;for(var c=0;c<8;c++){var d=p.createDiv();this._attachmentDiv.appendChild(d),this._resizeDivs[c]=d}}var e=new B([{x:b.x,y:b.y},{x:b.x+b.width/2,y:b.y},{x:b.x+b.width,y:b.y},{x:b.x,y:b.y+b.height/2},{x:b.x+b.width,y:b.y+b.height/2},{x:b.x,y:b.y+b.height},{x:b.x+b.width/2,y:b.y+b.height},{x:b.x+b.width,y:b.y+b.height}]),f=this._network.getResizePointOutlineWidth(),g=this._network.getResizePointOutlineColor(),h=this._network.getResizePointFillColor();this._addPoints(b,e,f,g,h,!0)},_addPoints:function(a,b,c,d,e,f){var g=this._network.getEditPointSize(),h=g+c;l.grow(a,h,h),this._viewRect=a;var i=g*2,j=new B,k,m,n,o;for(k=0,m=b.size();k<m;k++)n=b.get(k),o={x:n.x-g,y:n.y-g,width:i,height:i},j.add(o);var q;if(f)q=this._resizeDivs;else{this._controlDivs||(this._controlDivs=new Array);if(this._controlDivs.length<m)for(k=this._controlDivs.length;k<m;k++){var r=p.createDiv();this._attachmentDiv.appendChild(r),this._controlDivs[k]=r}else if(this._controlDivs.length>m){for(k=m;k<this._controlDivs.length;k++)this._attachmentDiv.removeChild(this._controlDivs[k]);this._controlDivs.splice(m)}q=this._controlDivs}for(k=0,m=j.size();k<m;k++)o=j.get(k),p.setDiv(q[k],o,e,c,d),p.setBorderRaidus(q[k],(f?"0":i)+"px")},_addShapeLinkPoints:function(a){this._addEditPoints(a._element.getPoints())},_addShapeNodePoint:function(a){this._addEditPoints(a.getPoints())},_addLinkControlPoint:function(a){if(u.isOrthogonalLink(a._element)){var b=a.getControlPoint();if(b){var c=new B;c.add(b),this._addEditPoints(c)}}},_addEditPoints:function(a){var b=l.getRect(a);if(!b)return;var c=this._network.getEditPointOutlineWidth(),d=this._network.getEditPointOutlineColor(),e=this._network.getEditPointFillColor();this._addPoints(b,a,c,d,e,!1)},hit:function(a,b){if(!l.containsPoint(this._viewRect,a,b))return!1;var c;if(this._resizeDivs)for(c=this._resizeDivs.length-1;c>=0;c--)if(l.containsPoint(this._resizeDivs[c]._viewRect,a,b))return!0;if(this._controlDivs)for(c=this._controlDivs.length-1;c>=0;c--)if(l.containsPoint(this._controlDivs[c]._viewRect,a,b))return!0;return!1},intersects:function(a){if(!l.intersects(this._viewRect,a))return!1;var b;if(this._resizeDivs)for(b=this._resizeDivs.length-1;b>=0;b--)if(l.intersects(this._resizeDivs[b]._viewRect,a))return!0;if(this._controlDivs)for(b=this._controlDivs.length-1;b>=0;b--)if(l.intersects(this._controlDivs[b]._viewRect,a))return!0;return l.intersects(this._viewRect,a)?!1:!1}}),c.canvas.Attachment=function(a,b){this._ui=a,this._element=this._ui.getElement(),this._network=a.getNetwork(),this._showOnTop=b},d.ext("twaver.canvas.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},isShowOnTop:function(){return this._showOnTop===!0},setShowOnTop:function(a){this._showOnTop=a},getStyle:function(a){return this._ui.getStyle(a)},getFont:function(a){return this._ui.getFont(a)},getViewRect:function(){return d.clone(this._viewRect)},getAlpha:function(){return 1},validate:function(){},paint:function(a){},hit:function(a,b){return l.containsPoint(this._viewRect,a,b)?this.hitCanvasRect({x:a-1,y:b-1,width:2,height:2}):!1},hitCanvasRect:function(a){var b=A.getHitCanvas(a.width,a.height),c=A.getCtx(b);c.save(),c.translate(-a.x,-a.y),this.paint(c);try{var d=c.getImageData(0,0,a.width,a.height),e=d.data;for(var f=0;f<d.width;f++)for(var g=0;g<d.height;g++){var h=4*(g*d.width+f),i=e[h+3];if(i!==0)return c.restore(),!0}}catch(j){A.disposeHitCanvas()}return c.restore(),!1}}),c.canvas.BasicAttachment=function(a,b){c.canvas.BasicAttachment.superClass.constructor.call(this,a,b),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0}},d.ext("twaver.canvas.BasicAttachment",c.canvas.Attachment,{paint:function(a){c.canvas.BasicAttachment.superClass.paint.apply(this,arguments);var b=this.isFill(),d=this.getOutlineWidth();this.getElementUI().setShadow(this,a);if(d>0||b){q.drawRoundRect(a,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(a.moveTo(this._pointers[0].x,this._pointers[0].y),a.lineTo(this._pointers[1].x,this._pointers[1].y),a.lineTo(this._pointers[2].x,this._pointers[2].y)),a.closePath(),d>0&&(a.lineWidth=d,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke());if(b){var e=this.getFillColor(),f=this.getGradient();f?q.fill(a,e,f,this.getGradientColor(),this._viewRect):a.fillStyle=e,a.fill()}}},validate:function(){c.canvas.BasicAttachment.superClass.validate.call(this),this.calculateMeasure();var a=this.getOutlineWidth();this._viewRect=l.getRect(this._pointers),this._viewRect=l.unionRect(this._viewRect,this._roundRect),a>0&&l.grow(this._viewRect,a/2,a/2),this._viewRect=this._ui.appendShadowBound(this,this._viewRect)},calculateMeasure:function(){var a=this.getContentWidth(),b=this.getContentHeight(),c=this.getCornerRadius(),d=this.getPointerLength(),e=this.getPointerWidth(),f=this.getPosition(),g=this.getXOffset(),h=this.getYOffset(),i=this._roundRect;i.width=a+c*2,i.height=b;var j;if(d>0){var k=this.getDirection();j=this._network.getPosition(f,this._ui,null,g,h);var m;if(k==="aboveleft")i.y=j.y-d-i.height,i.x=j.x-(i.width-c),m=Math.max(j.x-e,i.x+c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:m,y:j.y-d}];else if(k==="aboveright")i.y=j.y-d-i.height,i.x=j.x-c,m=Math.min(j.x+e,i.x+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:m,y:j.y-d}];else if(k==="belowleft")i.y=j.y+d,i.x=j.x-(i.width-c),m=Math.max(j.x-e,i.x+c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:m,y:j.y+d}];else if(k==="belowright")i.y=j.y+d,i.x=j.x-c,m=Math.min(j.x+e,i.x+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:m,y:j.y+d}];else if(k==="leftabove")i.y=j.y+c-i.height,i.x=j.x-d-i.width,m=Math.max(j.y-e,i.y+c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:m}];else if(k==="leftbelow")i.y=j.y-c,i.x=j.x-d-i.width,m=Math.min(j.y+e,i.y+i.height-c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:m}];else if(k==="rightabove")i.y=j.y+c-i.height,i.x=j.x+d,m=Math.max(j.y-e,i.y+c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:m}];else if(k==="rightbelow")i.y=j.y-c,i.x=j.x+d,m=Math.min(j.y+e,i.y+i.height-c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:m}];else if(k==="above")i.y=j.y-d-i.height,i.x=j.x-i.width/2,m=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-m,y:j.y-d},{x:j.x+m,y:j.y-d}];else if(k==="below")i.y=j.y+d,i.x=j.x-i.width/2,m=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-m,y:j.y+d},{x:j.x+m,y:j.y+d}];else if(k==="left")i.y=j.y-i.height/2,i.x=j.x-d-i.width,m=Math.min(b/2,e/2),this._pointers=[j,{x:j.x-d,y:j.y+m},{x:j.x-d,y:j.y-m}];else{if(k!=="right")throw"Can not resolve '"+k+"' attachment direction";i.y=j.y-i.height/2,i.x=j.x+d,m=Math.min(b/2,e/2),this._pointers=[j,{x:j.x+d,y:j.y+m},{x:j.x+d,y:j.y-m}]}}else j=this._network.getPosition(f,this._ui,{width:i.width,height:i.height},g,h),i.x=j.x,i.y=j.y,this._pointers=null;this._contentRect.x=i.x+(i.width-a)/2,this._contentRect.y=i.y+(i.height-b)/2,this._contentRect.width=a,this._contentRect.height=b;var n=this.getPadding();n!=0&&l.grow(i,n,n),n=this.getPaddingLeft(),n!=0&&(i.x-=n,i.width+=n),n=this.getPaddingRight(),n!=0&&(i.width+=n),n=this.getPaddingTop(),n!=0&&(i.y-=n,i.height+=n),n=this.getPaddingBottom(),n!=0&&(i.height+=n),i.width<0&&(i.width=i.width,i.x-=i.width),i.height<0&&(i.height=-i.height,i.y-=i.height)},getContentWidth:function(){return c.Defaults.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return c.Defaults.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return c.Defaults.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return c.Defaults.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return c.Defaults.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return c.Defaults.ATTACHMENT_POSITION},getXOffset:function(){return c.Defaults.ATTACHMENT_XOFFSET},getYOffset:function(){return c.Defaults.ATTACHMENT_YOFFSET},getPadding:function(){return c.Defaults.ATTACHMENT_PADDING},getPaddingLeft:function(){return c.Defaults.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return c.Defaults.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return c.Defaults.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return c.Defaults.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return c.Defaults.ATTACHMENT_DIRECTION},isFill:function(){return c.Defaults.ATTACHMENT_FILL},getFillColor:function(){return c.Defaults.ATTACHMENT_FILL_COLOR},getGradient:function(){return c.Defaults.ATTACHMENT_GRADIENT},getGradientColor:function(){return c.Defaults.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return c.Defaults.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return c.Defaults.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return c.Defaults.ATTACHMENT_CAP},getJoin:function(){return c.Defaults.ATTACHMENT_JOIN},isShadowable:function(){return c.Defaults.ATTACHMENT_SHADOWABLE},getRoundRect:function(){return d.clone(this._roundRect)},getContentRect:function(){return d.clone(this._contentRect)}}),c.canvas.LabelAttachment=function(a,b){c.canvas.LabelAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.LabelAttachment",c.canvas.BasicAttachment,{paint:function(a){c.canvas.LabelAttachment.superClass.paint.apply(this,arguments),q.drawText(a,this.text,this._contentRect,this.font,this.getStyle("label.color"))},validate:function(){this.font=this.getFont("label.font"),this.text=this.getLabel(),this._textSize=q.getTextSize(this.font,this.text),c.canvas.LabelAttachment.superClass.validate.call(this)},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},isShadowable:function(){return this.getStyle("label.shadowable")}}),c.canvas.AlarmAttachment=function(a,b){c.canvas.AlarmAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.AlarmAttachment",c.canvas.BasicAttachment,{paint:function(a){c.canvas.AlarmAttachment.superClass.paint.apply(this,arguments),q.drawText(a,this.text,this._contentRect,this.font,this.getStyle("alarm.color"))},validate:function(){this.font=this.getFont("alarm.font"),this.text=this._network.getAlarmLabel(this._element),this._textSize=q.getTextSize(this.font,this.text),this._fillColor=this._network.getAlarmFillColor(this._element),c.canvas.LabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return this._fillColor!=null},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),c.network.IconsAttachment=function(a,b){c.network.IconsAttachment.superClass.constructor.call(this,a,b),this._iconsCanvas=null},d.ext("twaver.network.IconsAttachment",c.network.Attachment,{isShadowable:function(){return D.ATTACHMENT_SHADOWABLE},updateMeasure:function(){c.network.IconsAttachment.superClass.updateMeasure.call(this);var a=this._network.getIconsNames(this._element);if(!a||a.length==0)return;var b=this._network.getIconsColors(this._element),e=this._element.getStyle("icons.orientation"),f=this._element.getStyle("icons.position"),g=this._element.getStyle("icons.xoffset"),h=this._element.getStyle("icons.yoffset"),i=this._element.getStyle("icons.xgap"),j=this._element.getStyle("icons.ygap"),k=this._getIconsSize(a,e,i,j);if(!k)return;var l=this._network.getPosition(f,this._ui,k,g,h);this._viewRect={x:l.x,y:l.y,width:k.width,height:k.height},e==="top"?l.y+=k.height:e==="left"&&(l.x+=k.width),this._iconsCanvas||(this._iconsCanvas=p.createCanvas(),this._view.appendChild(this._iconsCanvas));var m=this._ui.setShadow(this,this._iconsCanvas,d.clone(this._viewRect)),n=l.x,o=l.y,q=0;for(var r in a){var s=null,t=null;b&&b.length>q&&(t=b[q++]);var u=d.getImageAsset(a[r]);if(u==null)continue;if(e==="right")s={x:n,y:o,width:u.getWidth(),height:u.getHeight()},n+=s.width+i;else if(e==="left")s={x:n-u.getWidth(),y:o,width:u.getWidth(),height:u.getHeight()},n-=s.width+i;else if(e==="top")s={x:n,y:o-u.getHeight(),width:u.getWidth(),height:u.getHeight()},o-=s.height+j;else{if(e!=="bottom")throw"Can not resolve '"+e+"' orientation";s={x:n,y:o,width:u.getWidth(),height:u.getHeight()},o+=s.height+j}m.drawImage(u.getImage(t),s.x,s.y,s.width,s.height)}},_getIconsSize:function(a,b,c,e){var f=0,g=0,h=null,i=null,j=null;for(var k in a){i=d.getImageAsset(a[k]);if(!i)continue;if(b==="right")h={x:f,y:g,width:i.getWidth(),height:i.getHeight()},f+=h.width+c;else if(b==="left")h={x:f-i.getWidth(),y:g,width:i.getWidth(),height:i.getHeight()},f-=h.width+c;else if(b==="top")h={x:f,y:g-i.getHeight(),width:i.getWidth(),height:i.getHeight()},g-=h.height+e;else{if(b!=="bottom")throw"Can not resolve '"+b+"' orientation";h={x:f,y:g,width:i.getWidth(),height:i.getHeight()},g+=h.height+e}j==null?j=d.clone(h):j=l.unionRect(j,h)}return j?{width:Math.abs(j.width),height:Math.abs(j.height)}:null}}),c.network.NodeUI=function(a,b){c.network.NodeUI.superClass.constructor.call(this,a,b)},d.ext("twaver.network.NodeUI",c.network.ElementUI,{createBodyRect:function(){return this._element.getRect()},invalidate:function(a){c.network.NodeUI.superClass.invalidate.call(this,a);var b=this._element.getAgentLinks();b&&b.forEach(function(a){this._network.invalidateElementUI(a,!1)},this
)},updateMeasure:function(){c.network.NodeUI.superClass.updateMeasure.call(this);var a=this.getStyle("vector.shape"),b=this.getBodyRect();this._hotSpot=l.getHotSpot(b.x,b.y,b.width,b.height,a),this.drawBody(),this._outerColor&&this.drawOuterBorder(),!this._editAttachment&&this.getStyle("select.style")==="border"&&this._network.isSelected(this._element)&&this.drawSelectBorder(),this.cleanUp(["_selectCanvas","_nodeCanvas","_nodeImage","_nodeComponent","_vectorCanvas","_outerCanvas"]);var d=this._element.getParent();d instanceof F&&this._network.invalidateElementUI(d,!1)},drawBody:function(){var a=this.getStyle("body.type");a==="default"?this.drawDefaultBody():a==="vector"?this.drawVectorBody():a==="default.vector"?(this.drawVectorBody(),this.drawDefaultBody()):a==="vector.default"&&(this.drawDefaultBody(),this.drawVectorBody())},drawOuterBorder:function(){var a=this._element,b=a.getStyle("outer.width");if(b>0){var c=this.getBodyRect();l.addPadding(c,a,"outer.padding",1),this._outerCanvas||(this._outerCanvas=p.createCanvas());var e=d.clone(c);l.grow(e,b/2,b/2);var f=p.setCanvas(this._outerCanvas,e);f.lineWidth=b,f.lineCap=a.getStyle("outer.cap"),f.lineJoin=a.getStyle("outer.join"),f.strokeStyle=this._outerColor,q.drawVector(f,a.getStyle("outer.shape"),null,c),f.stroke(),this.addComponent(this._outerCanvas),this.addBodyBounds(e)}},drawSelectBorder:function(){var a=this._element,b=a.getStyle("select.width");if(b>0){var c=this.getBodyRect();l.addPadding(c,a,"select.padding",1),this._selectCanvas||(this._selectCanvas=p.createCanvas());var e=d.clone(c);l.grow(e,b/2,b/2);var f=p.setCanvas(this._selectCanvas,e);f.lineWidth=b,f.lineCap=a.getStyle("select.cap"),f.lineJoin=a.getStyle("select.join"),f.strokeStyle=a.getStyle("select.color"),q.drawVector(f,a.getStyle("select.shape"),null,c),f.stroke(),this.addComponent(this._selectCanvas),this.addBodyBounds(e)}},drawDefaultBody:function(){var a=this._element,b=d.getImageAsset(a.getImage()),c=this.getBodyRect();if(!b){this.addBodyBounds(c),this._currentImageAsset=null;return}l.addPadding(c,this._element,"image.padding",1);if(b.getImage()){this._nodeCanvas||(this._nodeCanvas=p.createCanvas());var e=d.clone(c),f=this.setShadow(this,this._nodeCanvas,e);f.drawImage(b.getImage(this._innerColor),c.x,c.y,c.width,c.height),c=e,this.addComponent(this._nodeCanvas)}else if(b.getSrc())this._nodeImage||(this._nodeImage=p.createImg()),p.setImg(this._nodeImage,b.getSrc(),c),this.addComponent(this._nodeImage);else{if(!b.getFunction())throw"ImageAsset '"+a.getImage()+" ' is empty";this._currentImageAsset!==b?this._nodeComponent=b.getFunction()(this,c):this._nodeComponent=b.getFunction()(this,c,this._nodeComponent),this.addComponent(this._nodeComponent),this._nodeComponent._viewRect=d.clone(c)}this.addBodyBounds(c),this._currentImageAsset=b},hit:function(a,b){return this.hitCanvas(a,b,["_nodeCanvas","_outerCanvas","_vectorCanvas"])?!0:this.hitComponent(a,b,["_nodeImage","_nodeComponent"])},intersects:function(a){return this.intersectsCanvas(a,["_nodeCanvas","_outerCanvas","_vectorCanvas"])?!0:this.intersectsComponent(a,["_nodeImage","_nodeComponent"])},drawVectorBody:function(){this._vectorCanvas||(this._vectorCanvas=p.createCanvas());var a=q.drawPath(this,this._vectorCanvas,"vector",!0,this._element.getStyle("vector.outline.pattern")),b=this.getStyle("vector.deep"),c=this.getStyle("vector.fill.color");b!==0&&c&&this.getStyle("vector.shape")==="rectangle"&&q.draw3DRect(this._vectorCanvas.getContext("2d"),c,b,this._bodyRect),this.addBodyBounds(a),this.addComponent(this._vectorCanvas)}}),c.network.LinkUI=function(a,b){c.network.LinkUI.superClass.constructor.call(this,a,b),this._linkCanvas=p.createCanvas()},d.ext("twaver.network.LinkUI",c.network.ElementUI,{isEditable:function(){return u.isOrthogonalLink(this._element)&&this.getControlPoint()?!0:!1},createBodyRect:function(){var a=this.getHotSpot();return a?{x:a.x-1,y:a.y-1,width:2,height:2}:null},hit:function(a,b){return this.hitCanvas(a,b,["_linkCanvas"])},intersects:function(a){return this.intersectsCanvas(a,["_linkCanvas"])},checkAttachments:function(){c.network.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var a=this._network.getLinkHandlerLabel(this._element);a!=null&&a!==""?this._linkHandlerAttachment||(this._linkHandlerAttachment=new c.network.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=l.calculateLineLength(this._linkPoints)),this._linkPoints},invalidate:function(a){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,c.network.LinkUI.superClass.invalidate.call(this,a)},getFromPosition:function(a,b){var c=this.getFromPoint();return c?{x:c.x+a,y:c.y+b}:null},getToPosition:function(a,b){var c=this.getToPoint();return c?{x:c.x+a,y:c.y+b}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=u.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=u.createToPoint(this)),this._toPoint},updateMeasure:function(){c.network.LinkUI.superClass.updateMeasure.call(this),this.drawBody()},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),c=this.getStyle("link.type");if(u.isOrthogonalOrFlexionalLink(this._element))return u.orthogonalAndFlexional(this,c);var d=new B;if(this._element.isLooped()){var e=this._network.getElementUI(this._element.getFromAgent());if(e==null)return null;this._hotSpot=u.fillLoopedPoints(this,e.getBodyRect(),d)}else{if(c!=="arc"&&c!=="triangle"&&c!=="parallel")throw"Can not resolve link type '"+c+"'";this._hotSpot=u.fillBundlePoints(this,c,a,b,d)}return d},drawLinePoints:function(a,b,c,d,e){a.lineWidth=c,a.strokeStyle=d,a.beginPath(),q.drawLinePoints(a,b,e),a.stroke()},drawBody:function(){var a=this.getLinkPoints();if(!a||a.size()<2)return;var b=this._element,c=l.getLineRect(a),d=b.getStyle("link.width"),e=d;if(this._outerColor){var f=b.getStyle("outer.width");e+=f*2}var g=!this._editAttachment&&b.getStyle("select.style")==="border"&&this._network.isSelected(this._element);if(g){var h=b.getStyle("select.width");e+=h*2}l.grow(c,e/2,e/2),b.getStyle("arrow.from")&&(c=l.unionRect(c,C.getArrowRect(a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),b.getStyle("arrow.from.xoffset"),b.getStyle("arrow.from.yoffset")))),b.getStyle("arrow.to")&&(c=l.unionRect(c,C.getArrowRect(a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),b.getStyle("arrow.to.xoffset"),b.getStyle("arrow.to.yoffset"))));var i=this.setShadow(this,this._linkCanvas,c);i.lineCap=b.getStyle("link.cap"),i.lineJoin=b.getStyle("link.join");var j=b.getStyle("link.pattern");g&&this.drawLinePoints(i,a,e,b.getStyle("select.color"),j),this._outerColor&&this.drawLinePoints(i,a,d+f*2,this._outerColor,j),this.drawLinePoints(i,a,d,this._innerColor||b.getStyle("link.color"),j),this.addBodyBounds(c),this.addComponent(this._linkCanvas),C.drawLinkArrow(this,i,a)},getControlPoint:function(){return u.getControlPoint(this._element,this)},setControlPoint:function(a){if(!a)return;var b=this.getStyle("link.type");if(!u.hasControlPoint(b))return;var c=u.getLinkSourceBounds(this),d=u.getLinkTargetBounds(this);u.setParamsByControlPoint(a,c,d,b,this._element)},getLineLength:function(){return this._lineLength}}),c.canvas.LinkHandlerAttachment=function(a,b){c.canvas.LinkHandlerAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.LinkHandlerAttachment",c.canvas.BasicAttachment,{paint:function(a){c.canvas.LinkHandlerAttachment.superClass.paint.apply(this,arguments),q.drawText(a,this.linkHandlerLabel,this._contentRect,this.linkHandlerFont,this.getStyle("link.handler.color"))},validate:function(){this.linkHandlerFont=this.getFont("link.handler.font"),this.linkHandlerLabel=this._network.getLinkHandlerLabel(this._element),this._textSize=q.getTextSize(this.linkHandlerFont,this.linkHandlerLabel),c.canvas.LinkHandlerAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),c.canvas.IconsAttachment=function(a,b){c.canvas.IconsAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.IconsAttachment",c.canvas.Attachment,{isShadowable:function(){return c.Defaults.ATTACHMENT_SHADOWABLE},validate:function(){c.canvas.IconsAttachment.superClass.validate.call(this),this.iconsNames=this._network.getIconsNames(this._element);if(!this.iconsNames||this.iconsNames.length==0)return;this.iconsColors=this._network.getIconsColors(this._element),this.iconsOrientation=this._element.getStyle("icons.orientation"),this.iconsPosition=this._element.getStyle("icons.position"),this.iconsXoffset=this._element.getStyle("icons.xoffset"),this.iconsYoffset=this._element.getStyle("icons.yoffset"),this.iconsXgap=this._element.getStyle("icons.xgap"),this.iconsYgap=this._element.getStyle("icons.ygap");var a=this._getIconsSize(this.iconsNames,this.iconsOrientation,this.iconsXgap,this.iconsYgap);if(!a)return;this.location=this._network.getPosition(this.iconsPosition,this._ui,a,this.iconsXoffset,this.iconsYoffset),this._viewRect={x:this.location.x,y:this.location.y,width:a.width,height:a.height},this.iconsOrientation==="top"?this.location.y+=a.height:this.iconsOrientation==="left"&&(this.location.x+=a.width)},paint:function(a){c.canvas.IconsAttachment.superClass.paint.apply(this,arguments);if(!this.iconsNames||this.iconsNames.length==0)return;var b=this.location.x,e=this.location.y,f=0;for(var g in this.iconsNames){var h=null,i=null;this.iconsColors&&this.iconsColors.length>f&&(i=this.iconsColors[f++]);var j=d.getImageAsset(this.iconsNames[g]);if(j==null)continue;if(this.iconsOrientation==="right")h={x:b,y:e,width:j.getWidth(),height:j.getHeight()},b+=h.width+this.iconsXgap;else if(this.iconsOrientation==="left")h={x:b-j.getWidth(),y:e,width:j.getWidth(),height:j.getHeight()},b-=h.width+this.iconsXgap;else if(this.iconsOrientation==="top")h={x:b,y:e-j.getHeight(),width:j.getWidth(),height:j.getHeight()},e-=h.height+this.iconsYgap;else{if(this.iconsOrientation!=="bottom")throw"Can not resolve '"+this.iconsOrientation+"' orientation";h={x:b,y:e,width:j.getWidth(),height:j.getHeight()},e+=h.height+this.iconsYgap}a.drawImage(j.getImage(i),h.x,h.y,h.width,h.height)}},_getIconsSize:function(a,b,c,e){var f=0,g=0,h=null,i=null,j=null;for(var k in a){i=d.getImageAsset(a[k]);if(!i)continue;if(b==="right")h={x:f,y:g,width:i.getWidth(),height:i.getHeight()},f+=h.width+c;else if(b==="left")h={x:f-i.getWidth(),y:g,width:i.getWidth(),height:i.getHeight()},f-=h.width+c;else if(b==="top")h={x:f,y:g-i.getHeight(),width:i.getWidth(),height:i.getHeight()},g-=h.height+e;else{if(b!=="bottom")throw"Can not resolve '"+b+"' orientation";h={x:f,y:g,width:i.getWidth(),height:i.getHeight()},g+=h.height+e}j==null?j=d.clone(h):j=l.unionRect(j,h)}return j?{width:Math.abs(j.width),height:Math.abs(j.height)}:null}}),c.canvas.EditAttachment=function(a,b){c.canvas.EditAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.EditAttachment",c.canvas.Attachment,{paint:function(a){c.canvas.EditAttachment.superClass.paint.apply(this,arguments),this.paintResizingPoints(a),this.paintEditPoints(a)},paintResizingPoints:function(a){var b=this.resizingPoints.size();if(b<=0)return;var c=this.editPointSize*2,d=this.editPointSize*2,e=this._network.getResizePointFillColor(),f=this._network.getResizePointOutlineWidth(),g=this._network.getResizePointOutlineColor();a.lineWidth=f;for(var h=0;h<b;h++){var i=this.resizingPoints.get(h);A.rect(a,i.x-this.editPointSize,i.y-this.editPointSize,c,d)}a.fillStyle=e,a.strokeStyle=g,a.fill(),a.stroke()},paintEditPoints:function(a){var b=this.editPoints.size();if(b<=0)return;var c=this._network.getEditPointOutlineColor(),d=this._network.getEditPointFillColor(),e=this._network.getEditPointOutlineWidth();a.beginPath(),a.lineWidth=e;for(var f=0;f<b;f++){var g=this.editPoints.get(f);a.beginPath(),A.circle(a,g.x,g.y,this.editPointSize,d,c),a.closePath()}},validate:function(){c.canvas.EditAttachment.superClass.validate.call(this),this.editPointSize=this._network.getEditPointSize(),this.resizingPoints=new c.List,this.editPoints=new c.List,this._element instanceof c.Node&&this._addResizingPoint(this._element),this._element instanceof c.ShapeNode&&this._addShapeNodePoint(this._element),this._ui instanceof c.canvas.ShapeLinkUI&&this._addShapeLinkPoints(this._element),this._ui instanceof c.canvas.LinkUI&&this._addLinkControlPoint(this._ui)},_addResizingPoint:function(a){var b=a.getRect();if(!b)return;var d=new c.List([{x:b.x,y:b.y},{x:b.x+b.width/2,y:b.y},{x:b.x+b.width,y:b.y},{x:b.x,y:b.y+b.height/2},{x:b.x+b.width,y:b.y+b.height/2},{x:b.x,y:b.y+b.height},{x:b.x+b.width/2,y:b.y+b.height},{x:b.x+b.width,y:b.y+b.height}]),e=this._network.getResizePointOutlineWidth();this._addPoints(b,d,e,!0)},_addShapeNodePoint:function(a){this._addEditPoints(a.getPoints())},_addShapeLinkPoints:function(a){this._addEditPoints(a.getPoints())},_addLinkControlPoint:function(a){if(u.isOrthogonalLink(a._element)){var b=a.getControlPoint();if(b){var d=new c.List;d.add(b),this._addEditPoints(d)}}},_addEditPoints:function(a){var b=l.getRect(a);if(!b)return;var c=this._network.getEditPointOutlineWidth();this._addPoints(b,a,c,!1)},_addPoints:function(a,b,c,d){var e=this.editPointSize+c;l.grow(a,e,e),this._viewRect=a,d==1?this.resizingPoints=b:this.editPoints=b}}),c.canvas.interaction.BaseInteraction=function(a){this.network=a},d.ext("twaver.canvas.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},repaint:function(){this.network.repaintTopCanvas()},convertPointFromView:function(a){var b=a.x*this.network.getZoom()-this.network.getViewRect().x,c=a.y*this.network.getZoom()-this.network.getViewRect().y;return{x:b,y:c}},convertFromUIToMarkerRect:function(a,b,c){var d=this.network.getZoom();return{x:a.x*d-this.network.getViewRect().x+b*d,y:a.y*d-this.network.getViewRect().y+c*d,width:a.width*d,height:a.height*d}},getMarkerPoint:function(a){var b;if(g.isTouchable&&a.changedTouches&&a.changedTouches.length>0){var c=a.changedTouches[0];return b={x:c.clientX,y:c.clientY},b}return g.isFirefox?b={x:a.layerX,y:a.layerY}:b={x:a.offsetX,y:a.offsetY},b},paint:function(a){},addListener:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];p.addEventListener(b,"handle_"+b,this.network.getView(),this)}},removeListener:function(){for(var a=0;a<arguments.length;a++)p.removeEventListener(arguments[a],this.network.getView(),this)}}),c.network.GroupUI=function(a,b){c.network.GroupUI.superClass.constructor.call(this,a,b)},d.ext("twaver.network.GroupUI",c.network.NodeUI,{isEditable:function(){return!this._element.isExpanded()},drawBody:function(){var a=this.getBodyRect();this._shapeRect?this.drawExpandedGroup():c.network.GroupUI.superClass.drawBody.call(this)},drawExpandedGroup:function(){this._nodeCanvas||(this._nodeCanvas=p.createCanvas());var a=q.drawPath(this,this._nodeCanvas,"group",!1,this._element.getStyle("vector.outline.pattern")),b=this.getStyle("group.deep"),c=this.getStyle("group.fill.color");b!==0&&c&&this.getStyle("group.shape")==="rectangle"&&q.draw3DRect(this._nodeCanvas.getContext("2d"),c,b,this._bodyRect),this.addBodyBounds(a),this.addComponent(this._nodeCanvas)},getChildrenRects:function(){var a=new B,b=this._network;return this._element.getChildren().forEach(function(c){if(c instanceof E){var d=b.getElementUI(c);if(d){var e=d.getViewRect();e&&a.add(e)}}}),a},createBodyRect:function(){this._shapeRect=null;var a=this._element;if(a.isExpanded()){var b=this.getChildrenRects();if(!b.isEmpty()){var d=a.getStyle("group.shape"),e=m[d];if(!e)throw"Can not resolve group shape '"+d+"'";this._shapeRect=e(b)}}return this._shapeRect?(l.addPadding(this._shapeRect,a,"group.padding",1),this._shapeRect):c.network.GroupUI.superClass.createBodyRect.call(this)}}),c.network.GridUI=function(a,b){c.network.GridUI.superClass.constructor.call(this,a,b)},d.ext("twaver.network.GridUI",c.network.NodeUI,{drawDefaultBody:function(){this._element.getImage()?c.network.GridUI.superClass.drawDefaultBody.call(this):this.drawGridBody()},drawGridBody:function(){var a=this.getStyle("grid.fill"),b=this.getStyle("grid.deep"),c=this.getStyle("grid.cell.deep");if(!a&&b===0&&c===0)return;var e=this.getBodyRect(),f=this.getDyeColor("grid.fill.color");this._nodeCanvas||(this._nodeCanvas=p.createCanvas());var g=d.clone(e),h=this.setShadow(this,this._nodeCanvas,g);a&&(h.fillStyle=f,h.rect(e.x,e.y,e.width,e.height),h.fill(),this.addComponent(this._nodeCanvas)),b!=0&&q.draw3DRect(h,f,b,e.x,e.y,e.width,e.height);if(c!=0){var i=this.getStyle("grid.row.count"),j=this.getStyle("grid.column.count");for(var k=0;k<i;k++)for(var l=0;l<j;l++){var m=this._element.getCellRect(k,l);m!=null&&q.draw3DRect(h,f,c,m.x,m.y,m.width,m.height)}}this.addBodyBounds(g)}}),c.network.ShapeNodeUI=function(a,b){c.network.ShapeNodeUI.superClass.constructor.call(this,a,b)},d.ext("twaver.network.ShapeNodeUI",c.network.NodeUI,{drawDefaultBody:function(){if(this._element._points.size()<2)return;this._nodeCanvas||(this._nodeCanvas=p.createCanvas());var a=q.drawPath(this,this._nodeCanvas,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._element._points,this._element._segments,this._element.getStyle("shapenode.closed"));this.addBodyBounds(a),this.addComponent(this._nodeCanvas),C.drawLinkArrow(this,this._nodeCanvas.getContext("2d"),l.getPointObject(this._element._points,this._element._segments))}}),c.canvas.interaction.SelectInteraction=function(a){c.canvas.interaction.SelectInteraction.superClass.constructor.call(this,a)},d.ext("twaver.canvas.interaction.SelectInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup"),this.end(),this.network.removeMarker(this)},paint:function(a){if(this.startPoint==null||this.endPoint==null)return;var b=this.convertPointFromView(this.startPoint),c=this.convertPointFromView(this.endPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=l.getRect([{x:d,y:e},{x:f,y:g}]);if(h!=null){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,A.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}},handle_mousedown:function(a){if(!this.network.isValidEvent(a)||this.network.isMovingElement()||this.network.isEditingElement())return;if(a.shiftKey)return;var b=this.network.getElementAt(a),c=this.network.getSelectionModel();b?d.isCtrlDown(a)?c.contains(b)?c.removeSelection(b):c.appendSelection(b):c.contains(b)||c.setSelection(b):(d.isCtrlDown(a)||c.clearSelection(),this.end(a),this.startPoint=this.network.getLogicalPoint(a),this.startPoint&&this.network.isRectSelectEnabled()&&this.addListener("mousemove"))},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(this.network.isMovingElement()||this.network.isEditingElement()){this.end(a);return}var b=this.network.getLogicalPoint(a);if(!b)return;this.network.setSelectingElement(!0),this.endPoint==null?this.network.fireInteractionEvent({kind:"selectStart",event:a}):this.network.fireInteractionEvent({kind:"selectBetween",event:a}),this.endPoint=b,this.repaint()},end:function(a){if(this.startPoint){if(this.endPoint&&this.startPoint.x!==this.endPoint.x&&this.startPoint.y!==this.endPoint.y){var b=l.getRect([this.startPoint,this.endPoint]),c=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(c&&c.size()>0){var d=this.network.getSelectionModel(),e=d.toSelection();c.forEach(function(a){d.contains(a)?e.remove(a):e.add(a)},this),d.setSelection(e)}this.network.fireInteractionEvent({kind:"selectEnd",event:a})}this.network.setSelectingElement(!1),this.removeListener("mousemove"),this.startPoint=null,this.endPoint=null,this.repaint()}},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this.startPoint.x>this.endPoint.x&&this.startPoint.y>this.endPoint.y}}),c.canvas.interaction.MoveInteraction=function(a,b){this.lazyMode=b,c.canvas.interaction.MoveInteraction.superClass.constructor.call(this,a)},d.ext("twaver.canvas.interaction.MoveInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup"),this.end(),this.network.removeMarker(this)},paint:function(a){if(this.lazyMode){if(this.pressPoint==null||this.dragPoint==null)return;a.beginPath();var b=this.dragPoint.x-this.pressPoint.x,c=this.dragPoint.y-this.pressPoint.y,d=this.network.getMovableSelectedElements(),e=d.size(),f=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,g=this.network.getLazyMoveOutlineWidth(),h=this.network.getLazyMoveOutlineColor();a.strokeStyle=h,a.lineWidth=g,a.fillStyle=f;for(var i=0;i<e;i++){var j=d.get(i),k=this.network.getElementUI(j);if(k){var l=this.convertFromUIToMarkerRect(k.getViewRect(),b,c);A.rect(a,l.x,l.y,l.width,l.height)}}a.fill(),a.stroke()}},handle_mousedown:function(a){if(!this.network.isValidEvent(a)||this.network.isSelectingElement()||this.network.isEditingElement())return;var b=this.network.getElementAt(a);if(!this.network.isMovable(b))return;this.end(a),this.lastPoint=this.network.getLogicalPoint(a),this.lazyMode&&(this.pressPoint=this.lastPoint),this.lastPoint&&this.addListener("mousemove")},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements()){this.end(a);return}var b=this.network.getLogicalPoint(a);if(!b)return;this.xoffset=b.x-this.lastPoint.x,this.yoffset=b.y-this.lastPoint.y;if(Math.abs(this.xoffset)<1&&Math.abs(this.yoffset)<1)return;this.lazyMode?this.dragPoint==null?(this.network.fireInteractionEvent({kind:"lazyMoveStart",event:a}),this.network.setMovingElement(!0)):this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:a}):(this.network.moveSelectedElements(this.xoffset,this.yoffset),this.lastPoint=b,this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}))),this.lazyMode&&(this.dragPoint=b,this.repaint())},end:function(a){if(this.lazyMode){if(this.dragPoint!=null&&this.pressPoint!=null){var b=this,c=function(){b.network.fireInteractionEvent({kind:"lazyMoveEnd",event:a}),b.network.setMovingElement(!1)},d=this.dragPoint.x-this.pressPoint.x,e=this.dragPoint.y-this.pressPoint.y;this.network.moveSelectedElements(d,e,this.network.isLazyMoveAnimate(),c)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a}));this.network.invalidateCanvasSize(),this.removeListener("mousemove"),this.lastPoint=null,this.dragPoint=null,this.pressPoint=null}}),c.canvas.interaction.ScrollInteraction=function(a){c.canvas.interaction.ScrollInteraction.superClass.constructor.call(this,a),this.hThumbRect=null,this.vThumbRect=null,this.scrollBarVisible=!1},d.ext("twaver.canvas.interaction.ScrollInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseover","mouseout"),g.isFirefox?p.addEventListener("DOMMouseScroll","handleMouseWheel",this.network.getView(),this):p.addEventListener("mousewheel","handleMouseWheel",this.network.getView(),this),p.addEventListener("mouseup","handleMouseUp",a,this),p.addEventListener("mousemove","handleMouseMove",a,this),this.network.addPropertyChangeListener(this.handleViewRectChange,this),this.validateScrollBar(),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseover","mouseout"),g.isFirefox?p.removeEventListener("DOMMouseScroll",this.network.getView(),this):p.removeEventListener("mousewheel",this.network.getView(),this),p.removeEventListener("mouseup",a,this),p.removeEventListener("mousemove",a,this),this.network.removePropertyChangeListener(this.handleViewRectChange,this),this.end(),this.network.removeMarker(this)},handleViewRectChange:function(a){(a.property=="viewRect"||a.property=="canvasSizeChange")&&this.validateScrollBar()},getScrollBarWidth:function(){return this.network.getScrollBarWidth()},getScrollBarColor:function(){return"#cccccc"},validateScrollBar:function(){this.hThumbRect=null,this.vThumbRect=null;if(this.network.isScrollBarVisible()==0){this.repaint();return}var a=this.network.getViewRect().height,b=this.network.getViewRect().width,c=this.network.getViewRect().x,d=this.network.getViewRect().y,e=this.network.getCanvasSize(),f=e.width,g=e.height;if(f>b)if(c<0||c+b>f){this.repaint();return}if(g>a)if(d<0||d+a>g){this.repaint();return}var h=0,i=a<g,j=b<f,k=this.getScrollBarWidth();if(a<g){j?h=a*(a-k)/g:h=a*a/g;var l=d/(g-a)*(a-h-k);this.vThumbRect={x:b-k,y:l,width:k,height:h}}var m=0;if(b<f){i?m=b*(b-k)/f:m=b*b/f;var n=c/(f-b)*(b-m-k);this.hThumbRect={x:n,y:a-k,width:m,height:k}}this.network.setHScrollBarVisible(this.hThumbRect!=null),this.network.setVScrollBarVisible(this.vThumbRect!=null),this.repaint()},scrollBar:function(a){var b=this.network.getViewRect().height,c=this.network.getViewRect().width,d=this.network.getViewRect().x,e=this.network.getViewRect().y,f=e+30;a==1&&(f=e-30),this.network.setViewRect(d,f,c,b)},handle_mousedown:function(a){if(this.network.isValidEvent(a)==1)return;var b=this.getMarkerPoint(a);this.hBarDownPoint=null,this.vBarDownPoint=null,this.vThumbRect!=null&&l.containsPoint(this.vThumbRect,b.x,b.y)&&(this.vBarDownPoint={x:a.screenX,y:a.screenY},this.vBarDownOffset=this.vBarDownPoint.y-this.vThumbRect.y),this.hThumbRect!=null&&l.containsPoint(this.hThumbRect,b.x,b.y)&&(this.hBarDownPoint={x:a.screenX,y:a.screenY},this.hBarDownOffset=this.hBarDownPoint.x-this.hThumbRect.x)},handle_mouseover:function(a){if(this.scrollBarVisible==1)return;this.scrollBarVisible=!0,this.repaint()},handle_mouseout:function(a){if(this.scrollBarVisible==0)return;this.scrollBarVisible=!1,this.repaint()},handleMouseUp:function(a){this.vBarDownPoint=null,this.hBarDownPoint=null,this.repaint()},handleMouseMove:function(a){var b={x:a.screenX,y:a.screenY},c=this.network.getCanvasSize(),d=this.network.getViewRect().height,e=this.network.getViewRect().width,f=this.getScrollBarWidth();if(this.hBarDownPoint!=null){var g=b.x-this.hBarDownPoint.x;this.hBarDownPoint=b,this.network.setViewOffSet(g*c.width/(e-f),0);return}if(this.vBarDownPoint!=null){var h=b.y-this.vBarDownPoint.y;this.vBarDownPoint=b,this.network.setViewOffSet(0,h*c.height/(d-f));return}},handleMouseWheel:function(a){var b=!1;a.wheelDelta?a.wheelDelta>0&&(b=!0):a.detail<0&&(b=!0),this.scrollBar(b)},paintRoundRect:function(a,b,c,d,e,f,g,h){a.beginPath(),a.globalAlpha=c,a.fillStyle=b,q.drawRoundRect(a,d,e,f,g,h),a.fill()},end:function(){},paint:function(a){if(this.network.isScrollBarVisible()==0)return;if(this.scrollBarVisible==0&&this.hBarDownPoint==null&&this.vBarDownPoint==null)return;var b=this.getScrollBarWidth(),c=this.network.getViewRect().height,d=this.network.getViewRect().width;a.save();var e,f=this.getScrollBarColor();this.hThumbRect!=null&&(e=a.createLinearGradient(this.hThumbRect.x,this.hThumbRect.y,this.hThumbRect.x,this.hThumbRect.y+this.hThumbRect.height),e.addColorStop(0,f),e.addColorStop(1,"#666666"),this.paintRoundRect(a,this.getScrollBarColor(),.5,0,c-b,d-b,b,b/2),this.paintRoundRect(a,e,.9,this.hThumbRect.x,this.hThumbRect.y+1,this.hThumbRect.width,this.hThumbRect.height-2,b/2)),this.vThumbRect!=null&&(e=a.createLinearGradient(this.vThumbRect.x,this.vThumbRect.y,this.vThumbRect.x+this.vThumbRect.width,this.vThumbRect.y),e.addColorStop(0,f),e.addColorStop(1,"#666666"),this.paintRoundRect(a,this.getScrollBarColor(),.5,d-b,0,b,c-b,b/2),this.paintRoundRect(a,e,.9,this.vThumbRect.x+1,this.vThumbRect.y,this.vThumbRect.width-2,this.vThumbRect.height,b/2)),a.restore()}}),c.canvas.interaction.DefaultInteraction=function(a){c.canvas.interaction.DefaultInteraction.superClass.constructor.call(this,a)},d.ext("twaver.canvas.interaction.DefaultInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","keydown")},tearDown:function(){this.removeListener("mousedown","keydown")},handle_mousedown:function(a){if(!this.network.isValidEvent(a))return;this.network.isFocusOnClick()&&c.Util.setFocus(this.network.getView());var b=this.network.getElementAt(a);a.detail===2?this.handleDoubleClicked(a,b):this.handleClicked(a,b)},handleClicked:function(a,b){z.handleClicked(this.network,a,b)},handleDoubleClicked:function(a,b){z.handleDoubleClicked(this.network,a,b)},handle_keydown:function(a){z.handleKeyDown(this.network,a)}}),c.canvas.interaction.PanInteraction=function(a){c.canvas.interaction.PanInteraction.superClass.constructor.call(this,a)},d.ext("twaver.canvas.interaction.PanInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown","mouseup")},handle_mousedown:function(a){if(!this.network.isValidEvent(a))return;this.lastPoint=this.getMarkerPoint(a),this.lastPoint&&(this.addListener("mousemove"),this.network.getView().style.cursor="pointer")},handle_mouseup:function(a){this._clear()},handle_mousemove:function(a){if(!this.lastPoint)return;var b=this.getMarkerPoint(a);if(!b)return;var c=b.x-this.lastPoint.x,d=b.y-this.lastPoint.y;this.network.panByOffset(-c,-d),this.lastPoint=b},_clear:function(a){this.lastPoint&&(this.lastPoint=null,this.network.getView().style.cursor=this._oldCursor,this.removeListener("mousemove"))}}),c.network.ShapeLinkUI=function(a,b){c.network.ShapeLinkUI.superClass.constructor.call(this,a,b)},d.ext("twaver.network.ShapeLinkUI",c.network.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),c=new B,e=this.getStyle("shapelink.type");c.add(a),this._element._points!=null&&c.addAll(this._element._points),c.add(b);var f=c.size(),g=Math.ceil(f/2);if(f%2===0){var h=c.get(g),i=c.get(g-1);this._hotSpot={x:(h.x+i.x)/2,y:(h.y+i.y)/2}}else this._hotSpot=d.clone(c.get(g));var j,k,l;if(e!=="lineto")if(e==="quadto"){j=new B(c.get(0));for(k=1,f=c.size();k<f;k++)k<f-1?j.add(new B([c.get(k++),c.get(k)])):j.add(c.get(k));c=j}else if(e==="cubicto"){j=new B(c.get(0));for(k=1,f=c.size();k<f;k++)k<f-2?j.add(new B([c.get(k++),c.get(k++),c.get(k)])):k<f-1?j.add(new B([c.get(k++),c.get(k)])):j.add(c.get(k));c=j}else{if(e!=="orthogonalto")throw"Can not resolve shapelink type '"+e+"'"
;l=c.get(0),j=new B(l);for(k=1,f=c.size();k<f;k++)if(k<f-1){var m=d.clone(c.get(k)),n=m.x,o=m.y,p=n-l.x,q=o-l.y;Math.abs(p)>Math.abs(q)?(m.x=n,m.y=l.y):(m.x=l.x,m.y=o),l=m,j.add(l)}else j.add(c.get(k));c=j}return c}}),c.network.RotatableNodeUI=function(a,b){c.network.RotatableNodeUI.superClass.constructor.call(this,a,b)},d.ext("twaver.network.RotatableNodeUI",c.network.NodeUI,{isEditable:function(){return!1},drawDefaultBody:function(){var a=this._element,b=d.getImageAsset(a.getImage()),c=this.getBodyRect();if(!b){this.addBodyBounds(c),this._currentImageAsset=null;return}l.addPadding(c,this._element,"image.padding",1);if(b.getImage()){this._nodeCanvas||(this._nodeCanvas=p.createCanvas());var e=d.clone(c),f=this.setShadow(this,this._nodeCanvas,e),g=this._element._getOrignalWidth(),h=this._element._getOrignalHeight(),i=this._element._getRotateRect();f.save(),f.translate(c.x-i.x+g/2,c.y-i.y+h/2),f.rotate(this._element._angle*Math.PI/180),f.drawImage(b.getImage(this._innerColor),-g/2,-h/2,g,h),f.restore(),this.addComponent(this._nodeCanvas)}else if(!b.getSrc()&&!b.getFunction())throw"ImageAsset '"+a.getImage()+" ' is empty";this.addBodyBounds(c),this._currentImageAsset=b}}),c.canvas.interaction.CreateElementInteraction=function(a,b){b||(b=c.Node),c.Util.isTypeOf(b,c.Node)?this.elementFunction=function(a){var d=new b;return d instanceof c.Node&&d.setCenterLocation(a),d}:this.elementFunction=b,c.canvas.interaction.CreateElementInteraction.superClass.constructor.call(this,a)},d.ext("twaver.canvas.interaction.CreateElementInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(b){var c=this.elementFunction(b);c&&this.network.addElementByInteraction(c)}}}),c.canvas.interaction.EditInteraction=function(a,b){this.lazyMode=b,this.pointIndex=-1,c.canvas.interaction.EditInteraction.superClass.constructor.call(this,a)},d.ext("twaver.canvas.interaction.EditInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear(),this.network.removeMarker(this)},paint:function(a){if(this.lazyMode==1&&this.resizingRect!=null){a.lineWidth=this.network.getResizeLineWidth();var b=this.convertFromUIToMarkerRect(this.resizingRect,0,0);A.rect(a,b.x,b.y,b.width,b.height,null,this.network.getResizeLineColor())}},clear:function(){this.network.setEditingElement(!1),this.isStart=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(a){this.cursorID=a,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(a){if(!this.network.isEditingElement())return;this.isStart||(this.node&&this.resizeDirection?(this.isStart=!0,this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:a,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI&&(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.linkUI._element})))},handle_mouseup:function(a){if(this.isStart){var b=this.network.getLogicalPoint(a);if(this.resizingRect)if(this.lazyMode)if(this.network.ResizeAnimate){var d=this,e=new c.animaate.AnimateBounds(this.node,this.resizingRect,function(){d.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:d.node,resizeDirection:d.resizeDirection})});c.animate.AnimateManager.start(e)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.shapeNode&&this.pointIndex>=0&&b?(this.shapeNode.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0&&b?(this.shapeLink.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI&&b&&(this.linkUI.setControlPoint(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.linkUI._element}))}this.clear()},handle_mousemove:function(a){if(!this.network.isValidEvent(a))return;if(this.isStart&&this.shapeNode&&this.pointIndex>=0){this._handleMovingShapeNodePoint(a);return}if(this.isStart&&this.shapeLink&&this.pointIndex>=0){this._handleMovingShapeLinkPoint(a);return}if(this.isStart&&this.node&&this.resizeDirection){this._handleResizing(a);return}if(this.isStart&&this.linkUI){this._handleMovingLinkControlPoint(a);return}if(this.network.isSelectingElement()||this.network.isMovingElement()||this.network.getSelectionModel().size()===0){this.clear();return}var b=this.network.getElementAt(a),d=this.network.getElementUI(b);if(!d||!d.getEditAttachment()){this.clear();return}var e=this.network.getLogicalPoint(a);if(b instanceof c.Node){this.node=b;if(this._isEditingShapeNode(e)||this._isResizingNode(e)){this.network.setEditingElement(!0);return}}else if(b instanceof c.ShapeLink){this.shapeLink=b;if(this._isEditingShapeLink(e)){this.network.setEditingElement(!0);return}}else if(d instanceof c.canvas.LinkUI&&u.isOrthogonalLink(d._element)){this.linkUI=d;var f=this.linkUI.getControlPoint();f&&this._contains(e,f)&&(this._setCrossCursor(),this.network.setEditingElement(!0));return}this.clear()},_handleMovingShapeNodePoint:function(a){var b=this.network.getLogicalPoint(a);this.shapeNode.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(a){var b=this.network.getLogicalPoint(a);this.shapeLink.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(a){this.linkUI.setControlPoint(this.network.getLogicalPoint(a)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.linkUI._element})},_handleResizing:function(a){var b=this.network.getLogicalPoint(a),c=this.node.getRect();this.resizeDirection==="northwest"&&(this.resizingRect=this._getRect(b.x,b.y,c.x+c.width,c.y+c.height)),this.resizeDirection==="north"&&(this.resizingRect=this._getRect(c.x,b.y,c.x+c.width,c.y+c.height)),this.resizeDirection==="northeast"&&(this.resizingRect=this._getRect(c.x,b.y,b.x,c.y+c.height)),this.resizeDirection==="west"&&(this.resizingRect=this._getRect(b.x,c.y,c.x+c.width,c.y+c.height)),this.resizeDirection==="east"&&(this.resizingRect=this._getRect(c.x,c.y,b.x,c.y+c.height)),this.resizeDirection==="southwest"&&(this.resizingRect=this._getRect(b.x,c.y,c.x+c.width,b.y)),this.resizeDirection==="south"&&(this.resizingRect=this._getRect(c.x,c.y,c.x+c.width,b.y)),this.resizeDirection==="southeast"&&(this.resizingRect=this._getRect(c.x,c.y,b.x,b.y)),this.lazyMode?(this.repaint(),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(a){if(this.node instanceof c.ShapeNode){this.shapeNode=this.node;var b=this.shapeNode.getPoints();for(var d=0,e=b.size();d<e;d++){var f=b.get(d);if(this._contains(a,f))return this._setCrossCursor(),this.pointIndex=d,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(a){var b=this.shapeLink.getPoints();for(var c=0,d=b.size();c<d;c++){var e=b.get(c);if(this._contains(a,e))return this._setCrossCursor(),this.pointIndex=c,!0}return this.pointIndex=-1,!1},_isResizingNode:function(a){var b=this.node.getRect();return this._isResizing(a,b.x,b.y,"northwest","nwse-resize")?!0:this._isResizing(a,b.x+b.width/2,b.y,"north","ns-resize")?!0:this._isResizing(a,b.x+b.width,b.y,"northeast","nesw-resize")?!0:this._isResizing(a,b.x,b.y+b.height/2,"west","ew-resize")?!0:this._isResizing(a,b.x+b.width,b.y+b.height/2,"east","ew-resize")?!0:this._isResizing(a,b.x,b.y+b.height,"southwest","nesw-resize")?!0:this._isResizing(a,b.x+b.width/2,b.y+b.height,"south","ns-resize")?!0:this._isResizing(a,b.x+b.width,b.y+b.height,"southeast","nwse-resize")?!0:!1},_isResizing:function(a,b,c,d,e){return this._contains(a,{x:b,y:c})?(this.resizeDirection!==d&&(this._removeCursor(),this._setCursor(e),this.resizeDirection=d),!0):!1},_getRect:function(a,b,c,d){var e=a<c?a:c,f=b<d?b:d,g=Math.abs(a-c),h=Math.abs(b-d);return{x:e,y:f,width:g,height:h}},_contains:function(a,b){var c=this.network.getEditPointSize(),d={x:b.x-c,y:b.y-c,width:c*2,height:c*2};return l.containsPoint(d,a)}}),c.canvas.interaction.CreateLinkInteraction=function(a,b){b||(b=c.Link),c.Util.isTypeOf(b,c.Link)?this.linkFunction=function(a,d){var e=new b;return e instanceof c.Link&&(e.setFromNode(a),e.setToNode(d)),e}:this.linkFunction=b,c.canvas.interaction.CreateLinkInteraction.superClass.constructor.call(this,a)},d.ext("twaver.canvas.interaction.CreateLinkInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this)},paint:function(a){a.beginPath();var b,c;a.lineWidth=this.network.getEditLineWidth();var d=this.network.getEditLineColor();this.currentNode&&this.currentNode!==this.fromNode&&(b=this.network.getElementUI(this.currentNode).getViewRect(),c=this.convertFromUIToMarkerRect(b,0,0),A.rect(a,c.x,c.y,c.width,c.height,null,d)),this.fromNode&&(b=this.network.getElementUI(this.fromNode).getViewRect(),c=this.convertFromUIToMarkerRect(b,0,0),A.rect(a,c.x,c.y,c.width,c.height,null,d)),this.currentPoint&&this.paintLine(a),a.closePath()},paintLine:function(a){var b=this.network.getEditLineColor(),c=this.convertPointFromView(this.fromNode.getCenterLocation()),d=c.x,e=c.y,f=this.currentPoint.x,g=this.currentPoint.y;a.strokeStyle=b,a.beginPath(),a.moveTo(d,e),a.lineTo(f,g),a.stroke()},clear:function(){this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(a){if(!this.network.isValidEvent(a))return;if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var b=this.createLink();b&&this.network.addElementByInteraction(b)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.repaint()},handle_mousemove:function(a){var b=this.getMarkerPoint(a);if(!b)return;if(this.network.isMovingElement()||this.network.isEditingElement()){this.clear();return}var c=null;this.fromNode?(this.currentNode=this.getToNode(a),this.currentPoint=b,this.repaint()):(c=this.getFromNode(a),this.currentNode!==c&&(this.currentNode=c,this.repaint()))},getFromNode:function(a){var b=this.network.getElementAt(a);return b instanceof c.Node?b:null},getToNode:function(a){var b=this.network.getElementAt(a);return b instanceof c.Node?b:null}}),c.canvas.interaction.CreateShapeLinkInteraction=function(a,b){c.canvas.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,a),b||(b=c.ShapeLink),c.Util.isTypeOf(b,c.ShapeLink)?this.linkFunction=function(a,d,e){var f=new b;return f instanceof c.ShapeLink&&(f.setFromNode(a),f.setToNode(d),e&&f.setPoints(e)),f}:this.linkFunction=b},d.ext("twaver.canvas.interaction.CreateShapeLinkInteraction",c.canvas.interaction.CreateLinkInteraction,{clear:function(){this.points=null,c.canvas.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(!b)return;if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var d=this.createLink();d&&this.network.addElementByInteraction(d),this.clear()}else{this.points||(this.points=new c.List);if(this.points.size()>0){var e=this.points.get(this.points.size()-1);if(e.x===b.x&&e.y===b.y)return}this.points.add(b)}}else this.fromNode=this.currentNode,this.points=null,this.currentNode=null,this.currentPoint=null;this.repaint()},paintLine:function(a){if(this.currentPoint){var b=new c.List,d;d=this.convertPointFromView(this.fromNode.getCenterLocation()),b.add(d,0);if(this.points&&this.points.size()>0){var e=this.points.size();for(var f=0;f<e;f++)d=this.convertPointFromView(this.points.get(f)),b.add(d)}d=this.convertPointFromView(this.currentPoint),b.add(d),a.lineWidth=this.network.getEditLineWidth(),a.strokeStyle=this.network.getEditLineColor(),a.beginPath(),q.drawLinePoints(a,b),a.stroke()}}}),c.canvas.interaction.CreateShapeNodeInteraction=function(a,b){b||(b=c.ShapeNode),c.Util.isTypeOf(b,c.ShapeNode)?this.shapeNodeFunction=function(a){var d=new b;return d instanceof c.ShapeNode&&a&&d.setPoints(a),d}:this.shapeNodeFunction=b,c.canvas.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,a)},d.ext("twaver.canvas.interaction.CreateShapeNodeInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this),this.network.setEditingElement(!1)},clear:function(){this.points=null,this.currentPoint=null},paint:function(a){if(this.points&&this.points.size()>0&&this.currentPoint){var b=new c.List,d=this.points.size(),e;for(var f=0;f<d;f++)e=this.convertPointFromView(this.points.get(f)),b.add(e);e=this.convertPointFromView(this.currentPoint),b.add(e),a.lineWidth=this.network.getEditLineWidth(),a.strokeStyle=this.network.getEditLineColor(),a.beginPath(),q.drawLinePoints(a,b),a.stroke()}},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(!b)return;if(a.detail===2){if(this.points){var d=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(d),this.clear();var e=this;setTimeout(function(){e.network.setEditingElement(!1)},0)}}else{this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new c.List);if(this.points.size()>0){var f=this.points.get(this.points.size()-1);if(f.x===b.x&&f.y===b.y)return}this.points.add(b)}this.repaint()},handle_mousemove:function(a){this.points&&(this.currentPoint=this.network.getLogicalPoint(a),this.repaint())}}),c.canvas.interaction.TouchInteraction=function(a){c.canvas.interaction.TouchInteraction.superClass.constructor.call(this,a)},d.ext("twaver.canvas.interaction.TouchInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){p.addEventListener("touchstart","handleTouchstart",this.network.getView(),this)},tearDown:function(){p.removeEventListener("touchstart",this.network.getView(),this)},handleTouchstart:function(a){p.preventDefault(a);if(w.isSingleTouch(a)){this.lastPoint=this.network.getLogicalPoint(a);var b=this.network.getElementAt(this.lastPoint);this.isClickBackground=!b,this.isClickBackground?this.lastPoint=this.getMarkerPoint(a):this.network.getSelectionModel().contains(b)||this.network.getSelectionModel().setSelection(b)}w.isMultiTouch(a)&&(this.distance=w.getDistance(a),this.zoom=this.network.getZoom()),p.addEventListener("touchmove","handleTouchmove",this.network.getView(),this),p.addEventListener("touchend","handleTouchend",this.network.getView(),this)},handleTouchmove:function(a){this.moved||(this.moved=!0);if(w.isSingleTouch(a)){var b=this.getMarkerPoint(a);if(b==null)return;var c,d;if(this.isClickBackground)c=b.x-this.lastPoint.x,d=b.y-this.lastPoint.y,this.network.panByOffset(-c,-d),this.lastPoint=b;else{if(!this.network.hasMovableSelectedElements()){this.touchEnd();return}b=this.network.getLogicalPoint(a),c=b.x-this.lastPoint.x,d=b.y-this.lastPoint.y,this.lastPoint=b,this.network.moveSelectedElements(c,d)}}else if(this.distance){var e=w.getDistance(a)/this.distance;this.network.setZoom(this.zoom*e,!1)}},handleTouchend:function(a){!this.moved&&this.isClickBackground&&this.network.getSelectionModel().clearSelection(),this.touchEnd()},touchEnd:function(){delete this.lastPoint,delete this.isClickBackground,delete this.zoom,delete this.distance,delete this.moved,p.removeEventListener("touchmove",this.network.getView(),this),p.removeEventListener("touchend",this.network.getView(),this)}}),c.network.interaction.BaseInteraction=function(a){this.network=a},d.ext("twaver.network.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},addListener:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];p.addEventListener(b,"handle_"+b,this.network.getView(),this)}},removeListener:function(){for(var a=0;a<arguments.length;a++)p.removeEventListener(arguments[a],this.network.getView(),this)},_handle_mousedown:function(a){this._startLogical=this.network.getLogicalPoint(a),this._startClient=p.getClientPoint(a),this._startLogical&&p.handle_mousedown(this,a)},_handle_mousemove:function(a){this._endLogical={x:this._startLogical.x+(a.clientX-this._startClient.x)/this.network.getZoom(),y:this._startLogical.y+(a.clientY-this._startClient.y)/this.network.getZoom()}},_handle_mouseup:function(a){delete this._startClient,delete this._startLogical,delete this._endLogical}}),c.network.interaction.DefaultInteraction=function(a){c.network.interaction.DefaultInteraction.superClass.constructor.call(this,a)},d.ext("twaver.network.interaction.DefaultInteraction",c.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","keydown")},tearDown:function(){this.removeListener("mousedown","keydown")},handle_mousedown:function(a){if(!this.network.isValidEvent(a))return;this.network.isFocusOnClick()&&c.Util.setFocus(this.network.getView());var b=this.network.getElementAt(a);a.detail===2?this.handleDoubleClicked(a,b):this.handleClicked(a,b)},handleClicked:function(a,b){z.handleClicked(this.network,a,b)},handleDoubleClicked:function(a,b){z.handleDoubleClicked(this.network,a,b)},handle_keydown:function(a){z.handleKeyDown(this.network,a)}}),c.network.interaction.SelectInteraction=function(a){c.network.interaction.SelectInteraction.superClass.constructor.call(this,a)},d.ext("twaver.network.interaction.SelectInteraction",c.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown"),this.end()},handle_mousedown:function(a){if(!this.network.isValidEvent(a)||this.network.isMovingElement()||this.network.isEditingElement())return;if(a.shiftKey)return;var b=this.network.getElementAt(a),c=this.network.getSelectionModel();b?d.isCtrlDown(a)?c.contains(b)?c.removeSelection(b):c.appendSelection(b):c.contains(b)||c.setSelection(b):(d.isCtrlDown(a)||c.clearSelection(),this.end(a),this.network.getLogicalPoint(a)&&this.network.isRectSelectEnabled()&&this._handle_mousedown(a))},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(this.network.isMovingElement()||this.network.isEditingElement()){this.end(a);return}this._handle_mousemove(a),this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):(this.mark=p.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:a}));var b=l.getRect([this._startLogical,this._endLogical]);p.setDiv(this.mark,b,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())},end:function(a){if(this._startLogical){if(this.mark){if(this._endLogical&&this._startLogical.x!==this._endLogical.x&&this._startLogical.y!==this._endLogical.y){var b=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(b&&b.size()>0){var c=this.network.getSelectionModel(),d=c.toSelection();b.forEach(function(a){c.contains(a)?d.remove(a):d.add(a)},this),c.setSelection(d)}this.network.fireInteractionEvent({kind:"selectEnd",event:a})}this.network.getTopDiv().removeChild(this.mark),this.mark=null,this.network.setSelectingElement(!1)}this._handle_mouseup(a)}},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this._startLogical.x>this._endLogical.x&&this._startLogical.y>this._endLogical.y}}),c.network.interaction.MoveInteraction=function(a,b){this.lazyMode=b,this.xoffset=0,this.yoffset=0,c.network.interaction.MoveInteraction.superClass.constructor.call(this,a)},d.ext("twaver.network.interaction.MoveInteraction",c.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown"),this.end()},handle_mousedown:function(a){if(this.network.isSelectingElement()||this.network.isEditingElement())return;var b=this.network.getElementAt(a);if(!this.network.isMovable(b))return;this.end(a),this._handle_mousedown(a)},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements()){this.end(a);return}this._handle_mousemove(a),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y;if(this.lazyMode){if(this.mark)this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:a});else{this.mark=p.createDiv();var b;this.network.getMovableSelectedElements().forEach(function(a){var c=this.getElementUI(a);c&&(b=l.unionRect(b,c.getViewRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),p.setDiv(this.mark,b,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:"lazyMoveStart",event:a})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+"px",this.mark.style.top=this.yoffset+this.mark._viewRect.y+"px"}else this.network.moveSelectedElements(this.xoffset,this.yoffset),this._startLogical=this._endLogical,this._startClient=p.getClientPoint(a),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}))},end:function(a){if(this._startLogical){if(this.lazyMode){if(this.mark){var b=this,c=function(){b.network.fireInteractionEvent({kind:"lazyMoveEnd",event:a}),b.mark&&(b.network.getTopDiv().removeChild(b.mark),b.mark=null,b.network.setMovingElement(!1))};this.network.moveSelectedElements(this.xoffset,this.yoffset,this.network.isLazyMoveAnimate(),c)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a}));this._handle_mouseup(a)}}}),c.network.interaction.PanInteraction=function(a){c.network.interaction.PanInteraction.superClass.constructor.call(this,a)},d.ext("twaver.network.interaction.PanInteraction",c.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){this._startLogical=this.network.getLogicalPoint(a),this._startLogical&&(this._handle_mousedown(a),this.network.getView().style.cursor="pointer")},handle_mouseup:function(a){this._clear()},handle_mousemove:function(a){if(!this._startLogical)return;this._handle_mousemove(a);var b=this._startLogical.x-this._endLogical.x,c=this._startLogical.y-this._endLogical.y,d=this.network.panByOffset(b,c);this._startLogical=this._endLogical,this._startClient=p.getClientPoint(a)},_clear:function(a){this._startLogical&&(this._handle_mouseup(a),this.network.getView().style.cursor=this._oldCursor)}}),c.network.interaction.EditInteraction=function(a,b){this.lazyMode=b,this.pointIndex=-1,c.network.interaction.EditInteraction.superClass.constructor.call(this,a)},d.ext("twaver.network.interaction.EditInteraction",c.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear()},clear:function(){this.network.setEditingElement(!1),this.isStart=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null)},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(a){this.cursorID=a,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(a){if(!this.network.isEditingElement())return;this.isStart||(this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:a,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI&&(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.linkUI._element})))},handle_mouseup:function(a){if(this.isStart){var b=d.clone(this._endLogical);if(this.resizingRect)if(this.lazyMode)if(this.network.ResizeAnimate){var e=this,f=new c.animaate.AnimateBounds(this.node,this.resizingRect,function(){e.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:e.node,resizeDirection:e.resizeDirection})});c.animate.AnimateManager.start(f)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.shapeNode&&this.pointIndex>=0&&b?(this.shapeNode.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0&&b?(this.shapeLink.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI&&b&&(this.linkUI.setControlPoint(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.linkUI._element}))}this._handle_mouseup(a),this.clear()},handle_mousemove:function(a){if(this.isStart){if(this.shapeNode&&this.pointIndex>=0){this._handleMovingShapeNodePoint(a);return}if(this.shapeLink&&this.pointIndex>=0){this._handleMovingShapeLinkPoint(a);return}if(this.node&&this.resizeDirection){this._handleResizing(a);return}if(this.linkUI){this._handleMovingLinkControlPoint(a);return}return}if(!this.network.isValidEvent(a))return;if(this.network.isSelectingElement()||this.network.isMovingElement()||this.network.getSelectionModel().size()===0){this.clear();return}var b=this.network.getElementAt(a),d=this.network.getElementUI(b);if(!d||!d.getEditAttachment()){this.clear();return}var e=this.network.getLogicalPoint(a);if(b instanceof E){this.node=b;if(this._isEditingShapeNode(e)||this._isResizingNode(e)){this.network.setEditingElement(!0);return}}else if(b instanceof c.ShapeLink){this.shapeLink=b;if(this._isEditingShapeLink(e)){this.network.setEditingElement(!0);return}}else if(d instanceof c.network.LinkUI&&u.isOrthogonalLink(d._element)){this.linkUI=d;var f=this.linkUI.getControlPoint();f&&this._contains(e,f)&&(this._setCrossCursor(),this.network.setEditingElement(!0));return}this.clear()},_handleMovingShapeNodePoint:function(a){this._handle_mousemove(a),this.shapeNode.setPoint(this.pointIndex,d.clone(this._endLogical)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(a){this._handle_mousemove(a),this.shapeLink.setPoint(this.pointIndex,d.clone(this._endLogical)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(a){this._handle_mousemove(a),this.linkUI.setControlPoint(d.clone(this._endLogical)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.linkUI._element})},_handleResizing:function(a){this._handle_mousemove(a);var b=d.clone(this._endLogical),c=this.node.getRect();this.resizeDirection==="northwest"&&(this.resizingRect=this._getRect(b.x,b.y,c.x+c.width,c.y+c.height)),this.resizeDirection==="north"&&(this.resizingRect=this._getRect(c.x,b.y,c.x+c.width,c.y+c.height)),this.resizeDirection==="northeast"&&(this.resizingRect=this._getRect(c.x,b.y,b.x,c.y+c.height)),this.resizeDirection==="west"&&(this.resizingRect=this._getRect(b.x,c.y,c.x+c.width,c.y+c.height)),this.resizeDirection==="east"&&(this.resizingRect=this._getRect(c.x,c.y,b.x,c.y+c.height)),this.resizeDirection==="southwest"&&(this.resizingRect=this._getRect(b.x,c.y,c.x+c.width,b.y)),this.resizeDirection==="south"&&(this.resizingRect=this._getRect(c.x,c.y,c.x+c.width,b.y)),this.resizeDirection==="southeast"&&(this.resizingRect=this._getRect(c.x,c.y,b.x,b.y)),this.lazyMode?(this.mark||(this.mark=p.createDiv(),this.network.getTopDiv().appendChild(this.mark)),p.setDiv(this.mark,this.resizingRect,null,this.network.getResizeLineWidth(),this.network.getResizeLineColor()),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(a){if(this.node instanceof c.ShapeNode){this.shapeNode=this.node;var b=this.shapeNode.getPoints();for(var d=0,e=b.size();d<e;d++){var f=b.get(d);if(this._contains(a,f))return this._setCrossCursor(),this.pointIndex=d,!0}
}return this.pointIndex=-1,!1},_isEditingShapeLink:function(a){var b=this.shapeLink.getPoints();for(var c=0,d=b.size();c<d;c++){var e=b.get(c);if(this._contains(a,e))return this._setCrossCursor(),this.pointIndex=c,!0}return this.pointIndex=-1,!1},_isResizingNode:function(a){var b=this.network.getEditPointSize(),c=this.node.getRect();return this._isResizing(a,c.x,c.y,"northwest","nwse-resize")?!0:this._isResizing(a,c.x+c.width/2,c.y,"north","ns-resize")?!0:this._isResizing(a,c.x+c.width,c.y,"northeast","nesw-resize")?!0:this._isResizing(a,c.x,c.y+c.height/2,"west","ew-resize")?!0:this._isResizing(a,c.x+c.width,c.y+c.height/2,"east","ew-resize")?!0:this._isResizing(a,c.x,c.y+c.height,"southwest","nesw-resize")?!0:this._isResizing(a,c.x+c.width/2,c.y+c.height,"south","ns-resize")?!0:this._isResizing(a,c.x+c.width,c.y+c.height,"southeast","nwse-resize")?!0:!1},_isResizing:function(a,b,c,d,e){return this._contains(a,{x:b,y:c})?(this.resizeDirection!==d&&(this._removeCursor(),this._setCursor(e),this.resizeDirection=d),!0):!1},_getRect:function(a,b,c,d){var e=a<c?a:c,f=b<d?b:d,g=Math.abs(a-c),h=Math.abs(b-d);return{x:e,y:f,width:g,height:h}},_contains:function(a,b){var c=this.network.getEditPointSize(),d={x:b.x-c,y:b.y-c,width:c*2,height:c*2};return l.containsPoint(d,a)}}),c.network.interaction.CreateElementInteraction=function(a,b){b||(b=E),c.Util.isTypeOf(b,E)?this.elementFunction=function(a){var c=new b;return c instanceof E&&c.setCenterLocation(a),c}:this.elementFunction=b,c.network.interaction.CreateElementInteraction.superClass.constructor.call(this,a)},d.ext("twaver.network.interaction.CreateElementInteraction",c.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(b){var c=this.elementFunction(b);c&&this.network.addElementByInteraction(c)}}}),c.network.interaction.CreateLinkInteraction=function(a,b){b||(b=c.Link),c.Util.isTypeOf(b,c.Link)?this.linkFunction=function(a,d){var e=new b;return e instanceof c.Link&&(e.setFromNode(a),e.setToNode(d)),e}:this.linkFunction=b,c.network.interaction.CreateLinkInteraction.superClass.constructor.call(this,a)},d.ext("twaver.network.interaction.CreateLinkInteraction",c.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove")},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear()},clear:function(){var a=this;setTimeout(function(){a._fromRectangle&&(a.network.getTopDiv().removeChild(a._fromRectangle),a._fromRectangle=null),a._currentRectangle&&(a.network.getTopDiv().removeChild(a._currentRectangle),a._currentRectangle=null),a._line&&(a.network.getTopDiv().removeChild(a._line),a._line=null)}),this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(a){if(!this.network.isValidEvent(a))return;if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var b=this.createLink();b&&this.network.addElementByInteraction(b)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.updateMark()},handle_mousemove:function(a){var b=this.network.getLogicalPoint(a);if(!b)return;if(this.network.isMovingElement()||this.network.isEditingElement()){this.clear();return}var c=null;this.fromNode?(this.currentNode=this.getToNode(a),this.currentPoint=b,this.updateMark()):(c=this.getFromNode(a),this.currentNode!==c&&(this.currentNode=c,this.updateMark()))},getFromNode:function(a){var b=this.network.getElementAt(a);return b instanceof E?b:null},getToNode:function(a){var b=this.network.getElementAt(a);return b instanceof E?b:null},updateMark:function(){var a;this.fromNode&&!this._fromRectangle&&this._currentRectangle&&(this._fromRectangle=this._currentRectangle,this._currentRectangle=null),!this.fromNode&&this._fromRectangle&&(this.network.getTopDiv().removeChild(this._fromRectangle),this._fromRectangle=null),this.currentNode&&!this._currentRectangle&&(a=this.network.getElementUI(this.currentNode),this._currentRectangle=p.createDiv(),this.network.getTopDiv().appendChild(this._currentRectangle),p.setDiv(this._currentRectangle,a._viewRect,null,this.network.getEditLineWidth(),this.network.getEditLineColor())),!this.currentNode&&this._currentRectangle&&(this.network.getTopDiv().removeChild(this._currentRectangle),this._currentRectangle=null),this.updateLine()},updateLine:function(){if(this.currentPoint){var a=this.fromNode.getCenterLocation(),b=a.x,c=a.y,d=this.currentPoint.x,e=this.currentPoint.y;this._line||(this._line=p.createCanvas(),this.network.getTopDiv().appendChild(this._line));var f=p.setCanvas(this._line,Math.min(b,d),Math.min(c,e),Math.abs(b-d),Math.abs(c-e));f.lineWidth=this.network.getEditLineWidth(),f.strokeStyle=this.network.getEditLineColor(),f.beginPath(),f.moveTo(b,c),f.lineTo(d,e),f.stroke()}else this._line&&(this.network.getTopDiv().removeChild(this._line),this._line=null)}}),c.network.interaction.CreateShapeNodeInteraction=function(a,b){b||(b=c.ShapeNode),c.Util.isTypeOf(b,c.ShapeNode)?this.shapeNodeFunction=function(a){var d=new b;return d instanceof c.ShapeNode&&a&&d.setPoints(a),d}:this.shapeNodeFunction=b,c.network.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,a)},d.ext("twaver.network.interaction.CreateShapeNodeInteraction",c.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove")},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear()},clear:function(){this.network.setEditingElement(!1),this.points=null,this.currentPoint=null,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null)},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(!b)return;if(a.detail===2){if(this.points){var c=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(c),this.clear();var d=this;setTimeout(function(){d.network.setEditingElement(!1)},0)}}else{this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new B);if(this.points.size()>0){var e=this.points.get(this.points.size()-1);if(e.x===b.x&&e.y===b.y)return}this.points.add(b),this.updateMark()}},handle_mousemove:function(a){this.points&&(this.currentPoint=this.network.getLogicalPoint(a),this.updateMark())},updateMark:function(a){if(this.points&&this.points.size()>0&&this.currentPoint){this.mark||(this.mark=p.createCanvas(),this.network.getTopDiv().appendChild(this.mark));var b=new B(this.points);b.add(this.currentPoint);var c=l.getRect(b),d=p.setCanvas(this.mark,c);d.lineWidth=this.network.getEditLineWidth(),d.strokeStyle=this.network.getEditLineColor(),d.beginPath(),q.drawLinePoints(d,b),d.stroke()}}}),c.network.interaction.CreateShapeLinkInteraction=function(a,b){c.network.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,a),b||(b=c.ShapeLink),c.Util.isTypeOf(b,c.ShapeLink)?this.linkFunction=function(a,d,e){var f=new b;return f instanceof c.ShapeLink&&(f.setFromNode(a),f.setToNode(d),e&&f.setPoints(e)),f}:this.linkFunction=b},d.ext("twaver.network.interaction.CreateShapeLinkInteraction",c.network.interaction.CreateLinkInteraction,{clear:function(){this.network.setEditingElement(!1),this.points=null,this.polyline&&(this.network.getTopDiv().removeChild(this.polyline),this.polyline=null),c.network.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(!b)return;if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var c=this.createLink();c&&this.network.addElementByInteraction(c),this.clear()}else{this.points||(this.points=new B);if(this.points.size()>0){var d=this.points.get(this.points.size()-1);if(d.x===b.x&&d.y===b.y)return}this.points.add(b),this.updateMark()}}else this.fromNode=this.currentNode,this.fromNode&&(this.polyline||(this.polyline=p.createCanvas(),this.network.getTopDiv().appendChild(this.polyline))),this.points=null,this.currentNode=null,this.currentPoint=null,this.updateMark()},updateLine:function(){if(this.currentPoint&&this.polyline){var a=new B(this.points);a.add(this.fromNode.getCenterLocation(),0),a.add(this.currentPoint);var b=l.getRect(a),c=p.setCanvas(this.polyline,b);c.lineWidth=this.network.getEditLineWidth(),c.strokeStyle=this.network.getEditLineColor(),c.beginPath(),q.drawLinePoints(c,a),c.stroke()}}}),c.network.interaction.CreateOrthogonalLinkInteraction=function(a,b,d,e,f,g){c.network.interaction.CreateOrthogonalLinkInteraction.superClass.constructor.call(this,a,b),this.linkType=d||"orthogonal",this.isByControlPoint=e,this.splitPercent=f,this.isSplitByPercent=g,this.link=new c.Link,this.link.setStyle("link.type",this.linkType),this.link.setStyle("link.split.by.percent",this.isSplitByPercent),u.isFlexionalTypeLink(this.linkType)||u.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=c.Styles.getStyle("link.extend")),this.link.setStyle("link.extend",this.splitPercent)):u.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=c.Styles.getStyle(this.isSplitByPercent?"link.split.percent":"link.split.value")),this.isSplitByPercent?this.link.setStyle("link.split.percent",this.splitPercent):this.link.setStyle("link.split.value",this.splitPercent))},d.ext("twaver.network.interaction.CreateOrthogonalLinkInteraction",c.network.interaction.CreateLinkInteraction,{clear:function(){this.path&&(this.network.getTopDiv().removeChild(this.path),this.path=null),c.network.interaction.CreateOrthogonalLinkInteraction.superClass.clear.call(this)},createLink:function(){var a=c.network.interaction.CreateOrthogonalLinkInteraction.superClass.createLink.call(this);a.setStyle("link.type",this.linkType),a.setStyle("link.split.by.percent",this.isSplitByPercent);if(this.isByControlPoint){var b=u.getControlPoint(a);if(b)return a.SetStyle("link.control.point",b),a}else u.isFlexionalTypeLink(this.linkType)||u.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=c.Styles.getStyle("link.extend")),a.setStyle("link.extend",this.splitPercent)):u.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=c.Styles.getStyle(this.isSplitByPercent?"link.split.percent":"link.split.value")),this.isSplitByPercent?a.setStyle("link.split.percent",this.splitPercent):a.setStyle("link.split.value",this.splitPercent));return a},updateLine:function(){if(this.currentPoint){if(!this.fromNode||this.currentNode===this.fromNode)return;var a,b=this.network.getElementUI(this.fromNode);if(!b)return;a=b.getBodyRect();if(a==null)return;var c;if(this.currentNode&&this.currentNode!==this.fromNode){var d=this.network.getElementUI(this.currentNode);if(!d)return;c=d.getBodyRect()}else c={x:this.currentPoint.x,y:this.currentPoint.y,width:1,height:1};if(!c)return;var e=u.calculateOrthogonalAndFlexionalLinkPoints(this.linkType,a,c,this.link);u.drawCorner(e,this.link);if(e.size()<2)return;this.line||(this.line=p.createCanvas(),this.network.getTopDiv().appendChild(this.line));var f=p.setCanvas(this.line,l.getLineRect(e));f.lineWidth=this.network.getEditLineWidth(),f.strokeStyle=this.network.getEditLineColor(),f.beginPath(),q.drawLinePoints(f,e),f.stroke()}else this.line&&(this.network.getTopDiv().removeChild(this.line),this.line=null)}}),c.network.interaction.MagnifyInteraction=function(a,b,d,e){c.network.interaction.MagnifyInteraction.superClass.constructor.call(this,a),this.scale=b||2,this.xRadius=d||100,this.yRadius=e||100,this.markCanvas=p.createCanvas(),this.markCanvas._isIgnored=!0},d.ext("twaver.network.interaction.MagnifyInteraction",c.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove")},tearDown:function(){this.removeListener("mousemove"),this._clear()},handle_mousemove:function(a){var b=this.network.getLogicalPoint(a);if(!b)return;this.lastPoint||this.network.getTopDiv().appendChild(this.markCanvas),this.lastPoint=b,this.updateMark()},updateMark:function(){var a=this.xRadius/this.scale/this.network._zoom,b=this.yRadius/this.scale/this.network._zoom,c={x:this.lastPoint.x-a,y:this.lastPoint.y-b,width:a*2,height:b*2};p.setCanvas(this.markCanvas,this.lastPoint.x-this.xRadius/this.network._zoom,this.lastPoint.y-this.yRadius/this.network._zoom,this.xRadius/this.network._zoom*2,this.yRadius/this.network._zoom*2),this.network.toCanvasByRegion(c,this.scale,this.markCanvas)},_clear:function(a){this.lastPoint&&(this.network.getTopDiv().removeChild(this.markCanvas),this.lastPoint=null)}}),c.network.interaction.TouchInteraction=function(a){c.network.interaction.TouchInteraction.superClass.constructor.call(this,a)},d.ext("twaver.network.interaction.TouchInteraction",c.network.interaction.BaseInteraction,{setUp:function(){p.addEventListener("touchstart","handleTouchstart",this.network.getView(),this)},tearDown:function(){p.removeEventListener("touchstart",this.network.getView(),this)},handleTouchstart:function(a){p.preventDefault(a);var b=this.network;if(w.isSingleTouch(a)){this._lastPoint=b.getLogicalPoint(a);var c=b.getElementAt(this._lastPoint);this._isClickBackground=!c,this._isClickBackground||b.getSelectionModel().contains(c)||b.getSelectionModel().setSelection(c);var d=new Date;this._lastTouchStartTime&&d.getTime()-this._lastTouchStartTime.getTime()<=500&&l.getDistance(this._lastTouchStartPoint,this._lastPoint)<=20?(z.handleDoubleClicked(b,a,c),delete this._lastTouchStartTime,delete this._lastTouchStartPoint):(this._lastTouchStartTime=d,this._lastTouchStartPoint={x:this._lastPoint.x,y:this._lastPoint.y},z.handleClicked(b,a,c))}w.isMultiTouch(a)&&(this._distance=w.getDistance(a),this._zoom=b.getZoom());var e=b.getView();p.addEventListener("touchmove","handleTouchmove",e,this),p.addEventListener("touchend","handleTouchend",e,this)},handleTouchmove:function(a){this._moved||(this._moved=!0);var b=this.network;if(w.isSingleTouch(a)){var c=b.getLogicalPoint(a),d,e;if(this._isClickBackground){d=this._lastPoint.x-c.x,e=this._lastPoint.y-c.y;var f=b.panByOffset(d,e);this._lastPoint.x-=d-f.x,this._lastPoint.y-=e-f.y}else{if(!b.hasMovableSelectedElements()){this.touchEnd();return}c=b.getLogicalPoint(a),d=c.x-this._lastPoint.x,e=c.y-this._lastPoint.y,this._lastPoint=c,b.moveSelectedElements(d,e),b.isMovingElement()?b.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(b.setMovingElement(!0),b.fireInteractionEvent({kind:"liveMoveStart",event:a}))}}else if(this._distance){var g=w.getDistance(a)/this._distance;b.setZoom(this._zoom*g,!1)}},handleTouchend:function(a){!this._moved&&this._isClickBackground&&this.network.getSelectionModel().clearSelection(),this.touchEnd()},touchEnd:function(){var a=this.network;a.isMovingElement()&&(a.setMovingElement(!1),a.fireInteractionEvent({kind:"liveMoveEnd",event:e})),delete this._lastPoint,delete this._isClickBackground,delete this._zoom,delete this._distance,delete this._moved;var b=a.getView();p.removeEventListener("touchmove",b,this),p.removeEventListener("touchend",b,this)}}),c.XmlSerializer=function(a,b,d){this.dataBox=a,this.settings=b?b:new c.SerializationSettings,this.filterFunction=d,this.ref=0,this.refMap={},this.idMap={},this.xmlString=""},d.ext("twaver.XmlSerializer",Object,{serialize:function(){return this.xmlString="<twaver version='"+c.Util.getVersion()+"' platform='html5'>\n",this.serializeBody(),this.xmlString+="</twaver>\n",this.xmlString},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable&&(this.xmlString+="<dataBox class='"+this.dataBox.getClassName()+"'>\n",this.dataBox.serializeXml(this,this.dataBox.newInstance()),this.xmlString+="</dataBox>\n"),this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(a){this.refMap[a.getId()]=this.ref++,a.getChildren().forEach(this.initRefs,this)},isSerializable:function(a){return this.dataBox.contains(a)?this.filterFunction&&!this.filterFunction(a)?!1:!0:!1},serializeData:function(a){if(this.isSerializable(a)){var b=a.newInstance(),c=this.refMap[a.getId()];this.xmlString+="<data class='"+a.getClassName()+"' ref='"+c+"'",this.settings.getPropertyType("id")!=null&&(this.xmlString+=" id='"+a.getId()+"'"),this.xmlString+=">\n",a.serializeXml(this,b),this.xmlString+="</data>\n"}a.getChildren().forEach(this.serializeData,this)},serializePropertyXml:function(a,b,c){var e=this.settings.getPropertyType(b);if(e){var f=d.getValue(a,b,e),g=d.getValue(c,b,e);f!==g&&this.serializeValue("p",b,f,g,e)}},serializeStyleXml:function(a,b,c){var d=this.settings.getStyleType(b);if(d){var e=a.getStyle(b),f=c.getStyle(b);e!=f&&this.serializeValue("s",b,e,f,d)}},serializeClientXml:function(a,b,c){var d=this.settings.getClientType(b);if(d!=null){var e=a.getClient(b),f=c.getClient(b);e!=f&&this.serializeValue("c",b,e,f,d)}},serializeValue:function(a,b,c,d,e){if(c==null)this.xmlString+="	<"+a+" n='"+b+"' none=''/>\n";else if(e==="cdata")this.xmlString+="	<"+a+" n='"+b+"'><![CDATA["+c+"]]></"+a+">\n";else if(e==="data"){var f=this.refMap[c.getId()];f!=null&&(this.xmlString+="	<"+a+" n='"+b+"' ref='"+f+"'/>\n")}else if(e==="point"){if(!d||c.x!==d.x||c.y!==d.y)this.xmlString+="	<"+a+" n='"+b+"' x='"+c.x+"' y='"+c.y+"'/>\n"}else e==="list.point"?(this.xmlString+="	<"+a+" n='"+b+"'>\n",c.forEach(function(a){this.xmlString+="		<p x='"+a.x+"' y='"+a.y+"'/>\n"},this),this.xmlString+="	</"+a+">\n"):e==="list.string"||e==="list.number"?(this.xmlString+="	<"+a+" n='"+b+"'>\n",c.forEach(function(a){this.xmlString+="		<s>"+a+"</s>\n"},this),this.xmlString+="	</"+a+">\n"):e==="rectangle"?this.xmlString+="	<"+a+" n='"+b+"' x='"+c.x+"' y='"+c.y+"' w='"+c.width+"' h='"+c.height+"'/>\n":this.xmlString+="	<"+a+" n='"+b+"'>"+c+"</"+a+">\n"},deserialize:function(a,b){d.isDeserializing=!0,this.xmlString=a;var c=d.xml(a).documentElement;this.refMap={},this.idMap={};var e=new B,f=new B,g,h,i,j=c.getElementsByTagName("data"),k=j.length;for(i=0;i<k;i++){h=j[i];var l=h.getAttribute("class"),m=this.settings.getPropertyType("id");if(m&&h.hasAttribute("id")){var n=null;if(m==="string")n=h.getAttribute("id");else if(m==="int")n=parseInt(h.getAttribute("id"));else{if(m!=="number")throw"Unsupported id type '"+m+"'";n=parseFloat(h.getAttribute("id"))}if(h.getAttribute("action")==="remove"){this.dataBox.removeById(n);continue}g=this.dataBox.getDataById(n),g||(g=d.newInstance(l,n))}else g=d.newInstance(l);if(h.hasAttribute("ref")){var o=h.getAttribute("ref");this.refMap[o]=g}e.add(g),f.add(h),this.idMap[g.getId()]=g}this.dataBox.forEach(function(a){this.idMap[a.getId()]=a},this),k=e.size();for(i=0;i<k;i++)g=e.get(i),h=f.get(i),g.deserializeXml(this,h);for(i=0;i<k;i++){g=e.get(i);if(this.dataBox.containsById(g.getId()))continue;b&&!g.getParent()&&g.setParent(b),this.dataBox.add(g)}this.settings.isDataBoxSerializable&&c.getElementsByTagName("dataBox").length===1&&this.dataBox.deserializeXml(this,c.getElementsByTagName("dataBox")[0]),d.isDeserializing=!1},deserializePropertyXml:function(a,b,c){var e=this.settings.getPropertyType(c);e&&d.setValue(a,c,this.deserializeValue(b,e))},deserializeStyleXml:function(a,b,c){var d=this.settings.getStyleType(c);d&&a.setStyle(c,this.deserializeValue(b,d))},deserializeClientXml:function(a,b,c){var d=this.settings.getClientType(c);d&&a.setClient(c,this.deserializeValue(b,d))},deserializeValue:function(a,b){if(a.hasAttribute("@none"))return null;if(b==="string")return a.textContent;if(b==="number")return parseFloat(a.textContent);if(b==="boolean")return a.textContent==="true";if(b==="int")return parseInt(a.textContent);if(b==="point")return{x:parseFloat(a.getAttribute("x")),y:parseFloat(a.getAttribute("y"))};if(b==="data"){var c=a.getAttribute("ref"),d=this.refMap[c];return d?d:this.idMap[c]}var e,f,g,h;if(b==="list.point"){var i=new B,j=a.getElementsByTagName("p");e=j.length;for(h=0;h<e;h++){var k=j[h];i.add({x:parseFloat(k.getAttribute("x")),y:parseFloat(k.getAttribute("y"))})}return i}if(b==="list.string"){var l=new B;g=a.getElementsByTagName("s"),e=g.length;for(h=0;h<e;h++)l.add(g[h].textContent);return l}if(b==="list.number"){f=new B,g=a.getElementsByTagName("s"),e=g.length;for(h=0;h<e;h++)f.add(parseFloat(g[h].textContent));return f}if(b==="array.string")return a.textContent.split(",");if(b==="array.number"){f=a.textContent.split(","),e=f.length;for(h=0;h<e;h++)f[h]=parseFloat(f[h]);return f}return b==="rectangle"?{x:parseFloat(a.getAttribute("x")),y:parseFloat(a.getAttribute("y")),width:parseFloat(a.getAttribute("w")),height:parseFloat(a.getAttribute("h"))}:a.textContent}}),d.addMethod(c.Data,{serializeXml:function(a,b){if(a.settings.isClientSerializable&&this._clientMap)for(var c in this._clientMap)this.serializeClientXml(a,c,b);this.serializePropertyXml(a,"name",b),this.serializePropertyXml(a,"icon",b),this.serializePropertyXml(a,"toolTip",b),this.serializePropertyXml(a,"parent",b)},serializePropertyXml:function(a,b,c){a.serializePropertyXml(this,b,c)},serializeClientXml:function(a,b,c){a.serializeClientXml(this,b,c)},deserializeXml:function(a,b){var c=b.getElementsByTagName("p"),d=c.length,e,f,g,h;for(e=0;e<d;e++)f=c[e],f.hasAttribute("n")&&this.deserializePropertyXml(a,f,f.getAttribute("n"));if(a.settings.isClientSerializable){g=b.getElementsByTagName("c"),d=g.length;for(e=0;e<d;e++)h=g[e],h.hasAttribute("n")&&this.deserializeClientXml(a,h,h.getAttribute("n"))}},deserializePropertyXml:function(a,b,c){a.deserializePropertyXml(this,b,c)},deserializeClientXml:function(a,b,c){a.deserializeClientXml(this,b,c)}}),d.addMethod(c.Element,{serializeXml:function(a,b){if(a.settings.isStyleSerializable&&this._styleMap)for(var d in this._styleMap)this.serializeStyleXml(a,d,b);c.Element.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"layerId",b),this._alarmState.getHighestNativeAlarmSeverity()&&a.settings.getPropertyType("alarmState")==="alarmstate"&&(a.xmlString+="	<p n='alarmState'>\n",c.AlarmSeverity.forEach(function(b){var c=this.getNewAlarmCount(b);c>0&&(a.xmlString+="		<n n='"+b.name+"' c='"+c+"'/>\n")},this._alarmState),c.AlarmSeverity.forEach(function(b){var c=this.getAcknowledgedAlarmCount(b);c>0&&(a.xmlString+="		<a n='"+b.name+"' c='"+c+"'/>\n")},this._alarmState),a.xmlString+="	</p>\n")},serializeStyleXml:function(a,b,c){a.serializeStyleXml(this,b,c)},deserializeXml:function(a,b){c.Element.superClass.deserializeXml.call(this,a,b);if(a.settings.isStyleSerializable){var d=b.getElementsByTagName("s"),e=d.length,f,g;for(f=0;f<e;f++)g=d[f],g.hasAttribute("n")&&this.deserializeStyleXml(a,g,g.getAttribute("n"))}},deserializeStyleXml:function(a,b,c){a.deserializeStyleXml(this,b,c)},deserializePropertyXml:function(a,b,d){if(d==="alarmState"){if(a.settings.getPropertyType("alarmState")==="alarmstate"){var e,f,g,h,i=b.getElementsByTagName("n");for(g=0;g<i.length;g++)h=i[g],f=c.AlarmSeverity.getByName(h.getAttribute("n")),this._alarmState.setNewAlarmCount(f,parseInt(h.getAttribute("c")));i=b.getElementsByTagName("a");for(g=0;g<i.length;g++)h=i[g],f=c.AlarmSeverity.getByName(h.getAttribute("n")),this._alarmState.setAcknowledgedAlarmCount(f,parseInt(h.getAttribute("c")))}}else c.Element.superClass.deserializePropertyXml.call(this,a,b,d)}}),d.addMethod(E,{serializeXml:function(a,b){E.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"image",b),this.serializePropertyXml(a,"location",b),d.num(this._width)&&this._width>=0&&this.serializePropertyXml(a,"width",b),d.num(this._height)&&this._height>=0&&this.serializePropertyXml(a,"height",b)}}),d.addMethod(c.Link,{serializeXml:function(a,b){c.Link.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"fromNode",b),this.serializePropertyXml(a,"toNode",b)}}),d.addMethod(c.Follower,{serializeXml:function(a,b){c.Follower.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"host",b)}}),d.addMethod(F,{serializeXml:function(a,b){F.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"expanded",b)}}),d.addMethod(c.ShapeNode,{serializeXml:function(a,b){c.ShapeNode.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"points",b),this.serializePropertyXml(a,"segments",b)}}),d.addMethod(c.ShapeLink,{serializeXml:function(a,b){c.ShapeLink.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"points",b)}}),d.addMethod(c.RotatableNode,{serializeXml:function(a,b){c.RotatableNode.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"angle",b)}}),d.addMethod(c.DataBox,{serializeXml:function(a,b){if(a.settings.isClientSerializable&&this._clientMap)for(var c in this._clientMap)this.serializeClientXml(a,c,b);this.serializePropertyXml(a,"name",b),this.serializePropertyXml(a,"icon",b),this.serializePropertyXml(a,"toolTip",b)},serializePropertyXml:function(a,b,c){a.serializePropertyXml(this,b,c)},serializeClientXml:function(a,b,c){a.serializeClientXml(this,b,c)},deserializeXml:function(a,b){var c=b.getElementsByTagName("p"),d=c.length,e,f,g,h;for(e=0;e<d;e++)f=c[e],f.hasAttribute("n")&&this.deserializePropertyXml(a,f,f.getAttribute("n"));if(a.settings.isClientSerializable){g=b.getElementsByTagName("c"),d=g.length;for(e=0;e<d;e++)h=g[e],h.hasAttribute("n")&&this.deserializeClientXml(a,h,h.getAttribute("n"))}},deserializePropertyXml:function(a,b,c){a.deserializePropertyXml(this,b,c)},deserializeClientXml:function(a,b,c){a.deserializeClientXml(this,b,c)}}),d.addMethod(c.ElementBox,{serializeXml:function(a,b){a.settings.isLayerBoxSerializable&&(a.xmlString+="	<layerBox>\n",this._layerBox.forEachByDepthFirst(function(b){this._layerBox.getDefaultLayer()===b?a.xmlString+="		<layer ":a.xmlString+="		<layer id='"+b.getId()+"' ",b.getName()&&(a.xmlString+="name='"+b.getName()+"' "),a.xmlString+="visible='"+b.isVisible()+"' editable='"+b.isEditable()+"' movable='"+b.isMovable()+"'/>\n"},null,this),a.xmlString+="	</layerBox>\n");if(a.settings.isStyleSerializable&&this._styleMap)for(var d in this._styleMap)this.serializeStyleXml(a,d,b);c.ElementBox.superClass.serializeXml.call(this,a,b)},serializeStyleXml:function(a,b,c){a.serializeStyleXml(this,b,c)},deserializeStyleXml:function(a,b,c){a.deserializeStyleXml(this,b,c)},deserializeXml:function(a,b){c.ElementBox.superClass.deserializeXml.call(this,a,b);if(a.settings.isLayerBoxSerializable&&b.getElementsByTagName("layerBox").length==1){this._layerBox.clear();var d=b.getElementsByTagName("layerBox")[0].getElementsByTagName("layer");for(var e=0;e<d.length;e++){var f=d[e],g;if(f.hasAttribute("id")){var h=a.settings.getPropertyType("layerId");if(h==="string")g=new c.Layer(f.getAttribute("id"));else if(h==="int")g=new c.Layer(parseInt(f.getAttribute("id")));else{if(h!=="number")throw"Unsupported layer id type '"+h+"'";g=new c.Layer(parseFloat(f.getAttribute("id")))}this._layerBox.add(g)}else g=this._layerBox.getDefaultLayer(),this._layerBox.moveToBottom(g);f.hasAttribute("name")&&g.setName(f.getAttribute("name")),f.hasAttribute("visible")&&g.setVisible(f.getAttribute("visible")==="true"),f.hasAttribute("editable")&&g.setEditable(f.getAttribute("editable")==="true"),f.hasAttribute("movable")&&g.setMovable(f.getAttribute("movable")==="true")}}if(a.settings.isStyleSerializable){var i=b.getElementsByTagName("s"),j=i.length;for(var e=0;e<j;e++){var k=i[e];k.hasAttribute("n")&&this.deserializeStyleXml(a,k,k.getAttribute("n"))}}}}),c.JsonSerializer=function(a,b,d){this.dataBox=a,this.settings=b?b:new c.SerializationSettings,this.filterFunction=d,this.ref=0,this.refMap={},this.idMap={},this.jsonObject={}},d.ext("twaver.JsonSerializer",Object,{serialize:function(){return this.jsonObject={version:c.Util.getVersion(),platform:"html5"},this.serializeBody(),Json.stringify(this.jsonObject)},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this);if(this.settings.isDataBoxSerializable){var a={"class":this.dataBox.getClassName(),p:{},s:{},c:{}};this.jsonObject.dataBox=a,this.dataBox.serializeJson(this,this.dataBox.newInstance(),a),d.isEmptyObject(a.p)&&delete a.p,d.isEmptyObject(a.s)&&delete a.s,d.isEmptyObject(a.c)&&delete a.c}this.jsonObject.datas=[],this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(a){this.refMap[a.getId()]=this.ref++,a.getChildren().forEach(this.initRefs,this)},isSerializable:function(a){return this.dataBox.contains(a)?this.filterFunction&&!this.filterFunction(a)?!1:!0:!1},serializeData:function(a){if(this.isSerializable(a)){var b=a.newInstance(),c=this.refMap[a.getId()],e={"class":a.getClassName(),ref:c,p:{},s:{},c:{}};this.settings.getPropertyType("id")&&(this.jsonObject.id=a.getId()),this.jsonObject.datas.push(e),a.serializeJson(this,b,e),d.isEmptyObject(e.p)&&delete e.p,d.isEmptyObject(e.s)&&delete e.s,d.isEmptyObject(e.c)&&delete e.c}a.getChildren().forEach(this.serializeData,this)},serializePropertyJson:function(a,b,c,e){var f=this.settings.getPropertyType(b);if(f){var g=d.getValue(a,b,f),h=d.getValue(c,b,f);g!==h&&this.serializeValue(b,g,h,f,e.p)}},serializeStyleJson:function(a,b,c,d){var e=this.settings.getStyleType(b);if(e){var f=a.getStyle(b),g=c.getStyle(b);f!=g&&this.serializeValue(b,f,g,e,d.s)}},serializeClientJson:function(a,b,c,d){var e=this.settings.getClientType(b);if(e!=null){var f=a.getClient(b),g=c.getClient(b);f!=g&&this.serializeValue(b,f,g,e,d.c)}},serializeValue:function(a,b,c,d,e){if(b==null)e[a]=null;else if(b instanceof B)e[a]=b._as;else if(d==="data"){var f=this.refMap[b.getId()];f!=null&&(e[a]=f)}else e[a]=b},deserialize:function(a,b){d.isDeserializing=!0,this.jsonObject=Json.parse(a),this.refMap={},this.idMap={};var c=new B,e=new B,f,g=this.jsonObject.datas.length;for(var h=0;h<g;h++){var i=this.jsonObject.datas[h],j=i["class"],k=this.settings.getPropertyType("id");if(k&&i.id!=null){if(i.action==="remove"){this.dataBox.removeById(i.id);continue}f=this.dataBox.getDataById(i.id),f||(f=d.newInstance(j,i.id))}else f=d.newInstance(j);i.ref!=null&&(this.refMap[i.ref]=f),c.add(f),e.add(i),this.idMap[f.getId()]=f}this.dataBox.forEach(function(a){this.idMap[a.getId()]=a},this),g=c.size();for(h=0;h<g;h++)f=c.get(h),f.deserializeJson(this,e.get(h));for(h=0;h<g;h++){f=c.get(h);if(this.dataBox.containsById(f.getId()))continue;b&&!f.getParent()&&f.setParent(b),this.dataBox.add(f)}this.settings.isDataBoxSerializable&&this.jsonObject.dataBox&&this.dataBox.deserializeJson(this,this.jsonObject.dataBox),d.isDeserializing=!1},deserializePropertyJson:function(a,b,c){var e=this.settings.getPropertyType(c);e&&d.setValue(a,c,this.deserializeValue(b,e))},deserializeStyleJson:function(a,b,c){var d=this.settings.getStyleType(c);d&&a.setStyle(c,this.deserializeValue(b,d))},deserializeClientJson:function(a,b,c){var d=this.settings.getClientType(c);d&&a.setClient(c,this.deserializeValue(b,d))},deserializeValue:function(a,b){if(b==="data"){var c=this.refMap[a];return c?c:this.idMap[a]}return a instanceof Array?new B(a):a}}),d.addMethod(c.Data,{serializeJson:function(a,b,c){if(a.settings.isClientSerializable&&this._clientMap)for(var d in this._clientMap)this.serializeClientJson(a,d,b,c);this.serializePropertyJson(a,"name",b,c),this.serializePropertyJson(a,"icon",b,c),this.serializePropertyJson(a,"toolTip",b,c),this.serializePropertyJson(a,"parent",b,c)},serializePropertyJson:function(a,b,c,d){a.serializePropertyJson(this,b,c,d)},serializeClientJson:function(a,b,c,d){a.serializeClientJson(this,b,c,d)},deserializeJson:function(a,b){var c;for(c in b.p)this.deserializePropertyJson(a,b.p[c],c);if(a.settings.isClientSerializable)for(c in b.c)this.deserializeClientJson(a,b.c[c],c)},deserializePropertyJson:function(a,b,c){a.deserializePropertyJson(this,b,c)},deserializeClientJson:function(a,b,c){a.deserializeClientJson(this,b,c)}}),d.addMethod(c.Element,{serializeJson:function(a,b,e){if(a.settings.isStyleSerializable&&this._styleMap)for(var f in this._styleMap)this.serializeStyleJson(a,f,b,e);c.Element.superClass.serializeJson.call(this,a,b,e),this.serializePropertyJson(a,"layerId",b,e);if(this._alarmState.getHighestNativeAlarmSeverity()&&a.settings.getPropertyType("alarmState")==="alarmstate"){var g={n:{},a:{}};e.p.alarmState=g,c.AlarmSeverity.forEach(function(a){var b=this.getNewAlarmCount(a);b>0&&(g.n[a.name]=b)},this._alarmState),c.AlarmSeverity.forEach(function(a){var b=this.getAcknowledgedAlarmCount(a);b>0&&(g.a[a.name]=b)},this._alarmState),d.isEmptyObject(g.n)&&delete g.n,d.isEmptyObject(g.a)&&delete g.a,d.isEmptyObject(g)&&delete e.p.alarmState}},serializeStyleJson:function(a,b,c,d){a.serializeStyleJson(this,b,c,d)},deserializeJson:function(a,b){c.Element.superClass.deserializeJson.call(this,a,b);if(a.settings.isStyleSerializable)for(var d in b.s)this.deserializeStyleJson(a,b.s[d],d)},deserializeStyleJson
:function(a,b,c){a.deserializeStyleJson(this,b,c)},deserializePropertyJson:function(a,b,d){if(d==="alarmState"){if(a.settings.getPropertyType("alarmState")==="alarmstate"){var e;for(e in b.n)this._alarmState.setNewAlarmCount(c.AlarmSeverity.getByName(e),b.n[e]);for(e in b.a)this._alarmState.setAcknowledgedAlarmCount(c.AlarmSeverity.getByName(e),b.a[e])}}else c.Element.superClass.deserializePropertyJson.call(this,a,b,d)}}),d.addMethod(E,{serializeJson:function(a,b,c){E.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"image",b,c),this.serializePropertyJson(a,"location",b,c),d.num(this._width)&&this._width>=0&&this.serializePropertyJson(a,"width",b,c),d.num(this._height)&&this._height>=0&&this.serializePropertyJson(a,"height",b,c)}}),d.addMethod(c.Link,{serializeJson:function(a,b,d){c.Link.superClass.serializeJson.call(this,a,b,d),this.serializePropertyJson(a,"fromNode",b,d),this.serializePropertyJson(a,"toNode",b,d)}}),d.addMethod(c.Follower,{serializeJson:function(a,b,d){c.Follower.superClass.serializeJson.call(this,a,b,d),this.serializePropertyJson(a,"host",b,d)}}),d.addMethod(F,{serializeJson:function(a,b,c){F.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"expanded",b,c)}}),d.addMethod(c.ShapeNode,{serializeJson:function(a,b,d){c.ShapeNode.superClass.serializeJson.call(this,a,b,d),this.serializePropertyJson(a,"points",b,d),this.serializePropertyJson(a,"segments",b,d)}}),d.addMethod(c.ShapeLink,{serializeJson:function(a,b,d){c.ShapeLink.superClass.serializeJson.call(this,a,b,d),this.serializePropertyJson(a,"points",b,d)}}),d.addMethod(c.RotatableNode,{serializeJson:function(a,b,d){c.RotatableNode.superClass.serializeJson.call(this,a,b,d),this.serializePropertyJson(a,"angle",b,d)}}),d.addMethod(c.DataBox,{serializeJson:function(a,b,c){if(a.settings.isClientSerializable&&this._clientMap)for(var d in this._clientMap)this.serializeClientJson(a,d,b,c);this.serializePropertyJson(a,"name",b,c),this.serializePropertyJson(a,"icon",b,c),this.serializePropertyJson(a,"toolTip",b,c)},serializePropertyJson:function(a,b,c,d){a.serializePropertyJson(this,b,c,d)},serializeClientJson:function(a,b,c,d){a.serializeClientJson(this,b,c,d)},deserializeJson:function(a,b){var c;for(c in b.p)this.deserializePropertyJson(a,b.p[c],c);if(a.settings.isClientSerializable)for(c in b.c)this.deserializeClientJson(a,b.c[c],c)},deserializePropertyJson:function(a,b,c){a.deserializePropertyJson(this,b,c)},deserializeClientJson:function(a,b,c){a.deserializeClientJson(this,b,c)}}),d.addMethod(c.ElementBox,{serializeJson:function(a,b,d){a.settings.isLayerBoxSerializable&&(d.layers=[],this._layerBox.forEachByDepthFirst(function(a){var b={};d.layers.push(b),this._layerBox.getDefaultLayer()!==a&&(b.id=a.getId()),a.getName()&&(b.name=a.getName()),b.visible=a.isVisible(),b.editable=a.isEditable(),b.movable=a.isMovable()},null,this));if(a.settings.isStyleSerializable&&this._styleMap)for(var e in this._styleMap)this.serializeStyleJson(a,e,b,d);c.ElementBox.superClass.serializeJson.call(this,a,b,d)},serializeStyleJson:function(a,b,c,d){a.serializeStyleJson(this,b,c,d)},deserializeStyleJson:function(a,b,c){a.deserializeStyleJson(this,b,c)},deserializeJson:function(a,b){c.ElementBox.superClass.deserializeJson.call(this,a,b);if(a.settings.isLayerBoxSerializable&&b.layers){this._layerBox.clear();if(b.layers){var d=b.layers.length;for(var e=0;e<d;e++){var f,g=b.layers[e];g.id!=null?(f=new c.Layer(g.id),this._layerBox.add(f)):(f=this._layerBox.getDefaultLayer(),this._layerBox.moveToBottom(f)),g.name&&f.setName(g.name),g.visible!=null&&f.setVisible(g.visible),g.editable!=null&&f.setEditable(g.editable),g.movable!=null&&f.setMovable(g.movable)}}}if(a.settings.isStyleSerializable)for(var h in b.s)this.deserializeStyleJson(a,b.s[h],h)}}),c.Column=function(a){c.Column.superClass.constructor.call(this,a)},d.ext("twaver.Column",c.Data,{IColumn:!0,__property:1,__accessor:["width","horizontalAlign","valueType","propertyType","propertyName","editable","visible","sortable","resizable","movable","sortDirection","sortFunction","enumInfo"],_width:D.COLUMN_WIDTH,_horizontalAlign:D.COLUMN_HORIZONTAL_ALIGN,_propertyName:null,_propertyType:D.COLUMN_PROPERTY_TYPE,_valueType:D.COLUMN_VALUE_TYPE,_editable:D.COLUMN_EDITABLE,_sortable:D.COLUMN_SORTABLE,_visible:D.COLUMN_VISIBLE,_resizable:D.COLUMN_RESIZABLE,_movable:D.COLUMN_MOVABLE,_sortDirection:"asc",_sortFunction:D.SORT_FUNCTION,_enumInfo:null,renderCell:D.COLUMN_RENDER_CELL,renderHeader:D.COLUMN_RENDER_HEADER,setParent:function(a){throw"parent not supported"}}),c.ColumnBox=function(a){c.ColumnBox.superClass.constructor.apply(this,arguments)},d.ext("twaver.ColumnBox",c.DataBox,{_name:"ColumnBox",add:function(a,b){if(!a.IColumn)throw"Only IColumn can be added into ColumnBox";c.ColumnBox.superClass.add.apply(this,arguments)}}),c.Property=function(a){c.Property.superClass.constructor.call(this,a)},d.ext("twaver.Property",c.Data,{IProperty:!0,__property:1,__accessor:["horizontalAlign","valueType","editable","propertyType","propertyName","categoryName","enumInfo"],_horizontalAlign:D.PROPERTY_HORIZONTAL_ALIGN,_propertyName:null,_propertyType:D.PROPERTY_PROPERTY_TYPE,_valueType:D.PROPERTY_VALUE_TYPE,_editable:D.PROPERTY_EDITABLE,_categoryName:D.PROPERTY_CATEGORY_NAME,_enumInfo:null,renderName:D.PROPERTY_RENDER_NAME,renderValue:D.PROPERTY_RENDER_VALUE,isVisible:null,setParent:function(a){throw"parent not supported"},setPropertyName:function(a){var b=this._propertyName;this._propertyName=a,this.firePropertyChange("propertyName",b,a)},setPropertyType:function(a){var b=this._propertyType;this._propertyType=a,this.firePropertyChange("propertyType",b,a)}}),c.PropertyBox=function(a){c.PropertyBox.superClass.constructor.apply(this,arguments)},d.ext("twaver.PropertyBox",c.DataBox,{_name:"PropertyBox",add:function(a,b){if(!a.IProperty)throw"Only IProperty can be added into PropertyBox";c.PropertyBox.superClass.add.apply(this,arguments)}}),c.Tab=function(a){c.Tab.superClass.constructor.call(this,a)},d.ext("twaver.Tab",c.Data,{ITab:!0,__accessor:["view","width","closable","resizable","movable","disabled","visible"],_icon:null,_width:D.TAB_WIDTH,_closable:D.TAB_CLOSABLE,_resizable:D.TAB_RESIZABLE,_movable:D.TAB_MOVABLE,_disabled:D.TAB_DISABLED,_visible:D.TAB_VISIBLE,setParent:function(a){throw"parent not supported"}}),c.TabBox=function(a){c.TabBox.superClass.constructor.apply(this,arguments),this.getSelectionModel().setSelectionMode("singleSelection")},d.ext("twaver.TabBox",c.DataBox,{_name:"TabBox",add:function(a,b){if(!a.ITab)throw"Only ITab can be added into TabBox";c.TabBox.superClass.add.apply(this,arguments)}}),c.controls.List=function(a){c.controls.List.superClass.constructor.apply(this,arguments)},d.ext("twaver.controls.List",c.controls.ListBase,{__accessor:["rowHeight","indent","rowLineWidth","rowLineColor","sortFunction","visibleFunction"],__bool:["checkMode","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_rowHeight:D.LIST_ROW_HEIGHT,_indent:D.LIST_INDENT,_rowLineWidth:D.LIST_ROW_LINE_WIDTH,_rowLineColor:D.LIST_ROW_LINE_COLOR,_makeVisibleOnSelected:D.LIST_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:D.LIST_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:D.LIST_KEYBOARD_SELECT_ENABLED,isCheckable:function(a){return this._checkMode===!0},renderData:function(a,b,c,d){var e;this._indent>0&&(e=this.__spanPool.get(),e.style.width=this._indent+"px",e.style.display="inline-block",a.appendChild(e));var f=this.isCheckable(b);f&&this._addCheckBox(a,b,d);var g=this.getIcon(b);g&&this._addIcon(a,b,g);var h=this.getLabel(b);h&&(e=this.__textPool.get(),e.style.whiteSpace="nowrap",e.style.verticalAlign="middle",e.style.padding="1px 2px 1px 2px",e.style.display="inline-block",e.innerHTML=h,this.onLabelRendered(e,b,h,c,d),a.appendChild(e)),a.style.backgroundColor=d?this.getSelectColor(b):""},onLabelRendered:function(a,b,c,d,e){}}),c.controls.ListBaseInteraction=function(a){this.listBase=a,this.view=a._view;var b=this;this.view.addEventListener("scroll",function(a){b.handleScroll(a)},!1),this.view.addEventListener("mousedown",function(a){a.button===0&&b.handleMouseDown(a)},!1),this.view.addEventListener("keydown",function(a){b.handleKeyDown(a)},!1)},d.ext("twaver.controls.ListBaseInteraction",Object,{handleMouseDown:function(a){var b=this.listBase;if(a.target===b._currentEditor||a.target.parentNode===b._currentEditor)return;b._handleClick(a)},handleKeyDown:function(a){var b=this.listBase;if(b._currentEditor)return;if(d.isCtrlDown(a)&&a.keyCode==65)b.isKeyboardSelectEnabled()&&b.selectAll().size()>0&&b.fireInteractionEvent({kind:"selectAll"}),p.preventDefault(a);else if(a.keyCode==46)b.isKeyboardRemoveEnabled()&&b.removeSelection()&&b.fireInteractionEvent({kind:"removeElement"}),p.preventDefault(a);else if(!!b.isCheckMode()||a.keyCode!==38&&a.keyCode!==40&&a.keyCode!==37&&a.keyCode!==39)d.showVersion(a);else{var c=b.getSelectionModel().getLastData();if(c)if(a.keyCode===38||a.keyCode===40){var e=b.getRowDatas(),f=b.getRowIndexByData(c);f>=0&&(a.keyCode===38?f!==0&&(c=e.get(f-1),b.getSelectionModel().setSelection(c)):f!==e.size()-1&&(c=e.get(f+1),b.getSelectionModel().setSelection(c)))}else b.expand&&(a.keyCode===37||a.keyCode===39)&&c.hasChildren()&&(a.keyCode===37?b.collapse(c):b.expand(c));else b.getRowDatas().size()>0&&(c=b.getRowDatas().get(0),b.getSelectionModel().setSelection(c))}},handleScroll:function(a){this.listBase.invalidate()}}),c.controls.ListBaseTouchInteraction=function(a){this.listBase=a,this.view=a._view,p.addEventListener("touchstart","handleTouchstart",this.view,this)},d.ext("twaver.controls.ListBaseTouchInteraction",Object,{handleTouchstart:function(a){p.preventDefault(a),this.lastPoint=this.listBase.getLogicalPoint(a),p.addEventListener("touchmove","handleTouchmove",this.view,this),p.addEventListener("touchend","handleTouchend",this.view,this),w.isMultiTouch(a)&&(this.distance=w.getDistance(a),this.zoom=this.listBase._zoom)},handleTouchmove:function(a){this.moved||(this.moved=!0);if(w.isSingleTouch(a)){if(this.lastPoint){var b=this.listBase.getLogicalPoint(a),c=this.lastPoint.x-b.x,d=this.lastPoint.y-b.y,e=this.listBase.panByOffset(c,d);this.listBase.invalidate(),this.lastPoint.x-=c-e.x,this.lastPoint.y-=d-e.y}}else if(this.distance){var f=w.getDistance(a)/this.distance;this.listBase.setZoom(this.zoom*f,!1)}},handleTouchend:function(a){this.moved||this.listBase._handleClick(a),delete this.lastPoint,delete this.moved,delete this.distance,delete this.zoom,p.removeEventListener("touchmove",this.view,this),p.removeEventListener("touchend",this.view,this)}}),c.controls.Tree=function(a){this._interactionDispatcher=new c.EventDispatcher,this._initTree(a),c.controls.Tree.superClass.constructor.apply(this,arguments)},d.ext("twaver.controls.Tree",c.controls.ListBase,{__tree:1,__accessor:["checkMode","rootData","sortFunction","visibleFunction","indent","rowHeight","rowLineWidth","rowLineColor","expandIcon","collapseIcon","uncheckableStyle"],__bool:["rootVisible","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_indent:D.TREE_INDENT,_rowHeight:D.TREE_ROW_HEIGHT,_rowLineWidth:D.TREE_ROW_LINE_WIDTH,_rowLineColor:D.TREE_ROW_LINE_COLOR,_makeVisibleOnSelected:D.TREE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:D.TREE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:D.TREE_KEYBOARD_SELECT_ENABLED,_expandIcon:D.TREE_EXPAND_ICON,_collapseIcon:D.TREE_COLLAPSE_ICON,_uncheckableStyle:"none",renderData:function(a,b,c,d){this._renderTree(a,b,c,d)}}),c.controls.Table=function(a){this._checkColumn=new c.Column,this._checkColumn.setName("check"),this._checkColumn.setEditable(!0),this._checkColumn.setWidth(40),this._checkColumn.setHorizontalAlign("center"),this._checkColumn.renderCell=this.renderCheckCell;var b=this;this._checkColumn.getValue=function(a,c){return b.isSelected(a)},c.controls.Table.superClass.constructor.apply(this,arguments)},d.ext("twaver.controls.Table",c.controls.TableBase,{__accessor:["rowHeight","rowLineWidth","rowLineColor","columnLineWidth","columnLineColor","sortFunction","visibleFunction","sortColumn"],__bool:["editable","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_editable:D.TABLE_EDITABLE,_rowHeight:D.TABLE_ROW_HEIGHT,_rowLineWidth:D.TABLE_ROW_LINE_WIDTH,_rowLineColor:D.TABLE_ROW_LINE_COLOR,_columnLineWidth:D.TABLE_COLUMN_LINE_WIDTH,_columnLineColor:D.TABLE_COLUMN_LINE_COLOR,_makeVisibleOnSelected:D.TABLE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:D.TABLE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:D.TABLE_KEYBOARD_SELECT_ENABLED,getCheckColumn:function(){return this._checkColumn},isCheckMode:function(){return this._columnBox.contains(this._checkColumn)},setCheckMode:function(a){if(a===this.isCheckMode())return;a?this._columnBox.add(this._checkColumn,0):this._columnBox.remove(this._checkColumn),this.firePropertyChange("checkMode",!a,a)},renderCheckCell:function(a){var b=a.view._booleanPool.get();b.disabled=!1,b.type="checkbox",b.style.margin="0px 2px",b.style.verticalAlign="middle",b.checked=a.selected;var c=a.div;c.appendChild(b),c.style.textAlign===""&&(c.style.textAlign="center"),b._checkData=a.data}}),c.controls.TableHeader=function(a){c.controls.TableHeader.superClass.constructor.apply(this,arguments),this._invalidateScroll=!1,this._invalidateDisplay=!1,this._divPool=new c.Pool("div"),this._imagePool=new c.Pool("img"),this._textPool=new c.Pool("span"),this._resizePool=new c.Pool("div"),this._pools.add(this._divPool),this._pools.add(this._imagePool),this._pools.add(this._textPool),this._pools.add(this._resizePool),this._table=a,this._tableView=a.getView(),this._columnBox=a.getColumnBox(),this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange,this),this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange,this),this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange,this);var b=this;a.getView().addEventListener("scroll",function(a){b.invalidateScroll()},!1),a.addPropertyChangeListener(function(a){b.invalidateDisplay()},this),this._view=p.createView("hidden"),this._view.tabIndex=-1,this._view.style.background=D.TABLEHEADER_BACKGROUND,this._rootDiv=p.createDiv(),this._view.appendChild(this._rootDiv),this.invalidateDisplay();var d;g.isTouchable?d=c.controls.TableHeaderTouchInteraction:d=c.controls.TableHeaderInteraction,d&&new d(this)},d.ext("twaver.controls.TableHeader",c.controls.ControlBase,{__accessor:["height","moveBackground","insertBackground","columnLineColor","resizeTolerance","sortDescIcon","sortAscIcon","sortIconPosition"],_height:D.TABLEHEADER_HEIGHT,_moveBackground:D.TABLEHEADER_MOVE_BACKGROUND,_insertBackground:D.TABLEHEADER_INSERT_BACKGROUND,_columnLineColor:D.TABLEHEADER_COLUMN_LINE_COLOR,_resizeTolerance:D.TABLEHEADER_RESIZE_TOLERANCE,_sortDescIcon:D.TABLEHEADER_SORT_DESC_ICON,_sortAscIcon:D.TABLEHEADER_SORT_ASC_ICON,_sortIconPosition:D.TABLEHEADER_SORT_ICON_POSITION,getRootDiv:function(){return this._rootDiv},handleColumnBoxChange:function(a){this.invalidateDisplay()},handleColumnPropertyChange:function(a){this.invalidateDisplay()},handleColumnHierarchyChange:function(a){this.invalidateDisplay()},onPropertyChanged:function(a){this.invalidateDisplay()},invalidateScroll:function(){if(this._invalidateScroll)return;this._invalidateScroll=!0,this.invalidate()},invalidateDisplay:function(){if(this._invalidateDisplay)return;this._invalidateDisplay=!0,this._invalidateScroll=!0,this.invalidate()},validate:function(){if(!this._invalidate)return;this._invalidate=!1,this._invalidateDisplay&&(this._invalidateDisplay=!1,this.validateDisplay()),this._invalidateScroll&&(this._invalidateScroll=!1,this._rootDiv.style.left=-this._tableView.scrollLeft+"px")},validateDisplay:function(){p.release(this._rootDiv);var a=this._table.getZoom(),b=this.getHeight()+"px",c=this.getHeight()-2+"px",d=this._table.getColumnBox().getRoots(),e=d.size(),f=0,g=this._table._columnLineWidth*a;for(var h=0;h<e;h++){var i=d.get(h);if(i.isVisible()){var j=i.getWidth()*a;j<0&&(j=0);var k=Math.min(g,j),l=this._divPool.get();l._column=i;var m=l.style;m.position="absolute",m.whiteSpace="nowrap",m.lineHeight=c,m.overflow="hidden",m.textOverflow="ellipsis",m.backgroundPosition=this._sortIconPosition?this._sortIconPosition:"",m.backgroundRepeat="no-repeat",m.backgroundImage="",m.textAlign=i.getHorizontalAlign(),m.borderStyle="solid",m.borderWidth="0px",m.borderRightWidth=k+"px",m.borderRightColor=this._columnLineColor,m.left=f+"px",m.width=j-k+"px",m.height=b,l._x=f,l._width=j-k,this._rootDiv.insertBefore(l,this._rootDiv.firstChild),this.renderColumn(l,i),this.onColumnRendered(l,i),f+=j,i.isResizable()&&(l=this._resizePool.get(),l._resizeColumn=i,m=l.style,m.position="absolute",m.backgroundColor="white",m.opacity=0,m.left=f-k-this._resizeTolerance+"px",m.width=k+this._resizeTolerance*2+"px",m.height=b,this._rootDiv.appendChild(l))}}this._pools.forEach(function(a){a.clear()}),this._rootDiv.style.width=f+"px",this._rootDiv.style.height=b},renderColumn:function(a,b){if(b.renderHeader)b.renderHeader(a);else{var c=this._textPool.get();c.style.whiteSpace="nowrap",c.style.verticalAlign="middle",c.style.padding="1px 2px 1px 2px",c.innerHTML=b.getName()?b.getName():b.getPropertyName(),c.setAttribute("title",c.innerHTML),a.appendChild(c);if(g.isOpera){var e=a.cloneNode(!1);e.style.left="0px",e.style.top="0px",e.style.opacity=0,a.appendChild(e)}}if(this._table.getSortColumn()===b&&b.isSortable()){var f=b.getSortDirection()==="asc"?this._sortAscIcon:this._sortDescIcon,h=d.getImageSrc(f);if(!this._sortIconPosition||this._sortIconPosition===""){var i=this._imagePool.get();i.setAttribute("src",h),i.style.verticalAlign="middle",a.appendChild(i)}else a.style.backgroundImage="url("+h+")"}},onColumnRendered:function(a,b){}}),c.controls.TableHeaderInteraction=function(a){this.header=a,this.table=a._table,this.view=a._view;var b=this;this.view.addEventListener("mousedown",function(a){b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},d.ext("twaver.controls.TableHeaderInteraction",Object,{handleMouseDown:function(a){if(a.button!==0)return;if(this.movableDiv){this.handleMouseUp(a);return}this.resizeColumn=a.target._resizeColumn,this.resizeColumn||(this.movableDiv=this.getMovableDivAt(a)),this.changeCursor(a),this._startClient=p.getClientPoint(a),this.lastX=this.getX(a),this._startLogicalX=this.lastX,p.handle_mousedown(this,a)},changeCursor:function(a){var b="";if(a.target._resizeColumn)b="ew-resize";else{var c=this.getColumnAt(a);c&&(c.isMovable()||c.isSortable())&&(b="pointer")}this.view.style.cursor=b},handleMouseMove:function(a){if(this.lastX==null){this.changeCursor(a);return}if(p.target!==this)return;var b=this._startLogicalX+a.clientX-this._startClient.x;if(this.resizeColumn){if(this.stopX!=null){if(b<this.stopX)return;delete this.stopX}var c=this.resizeColumn.getWidth()+(b-this.lastX)/this.table.getZoom();c<10&&(c=10,this.stopX=b),this.resizeColumn.setWidth(c),this.lastX=b}else if(this.movableDiv){var d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.header.getMoveBackground(),this.insertDiv=p.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.header.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.columnInfo=this.getColumnInfoAt(a),this.columnInfo&&(this.insertDiv.style.left=this.columnInfo.position)}},handleMouseUp:function(a){if(a.button!==0)return;var b;if(!this.resizeColumn)if(this.movableDiv&&this.columnInfo){b=this.movableDiv._column;var c=this.columnInfo.index;this.table.getColumnBox().moveTo(b,c)}else{b=this.getColumnAt(a);if(b&&b.isSortable()){var d=b.getSortDirection();this.table.getSortColumn()===b?(d==="desc"&&this.table.setSortColumn(null),b.setSortDirection(d==="asc"?"desc":"asc")):this.table.setSortColumn(b),this.table.onColumnSorted(this.table.getSortColumn())}}this.clear()},clear:function(){this.view.style.cursor="",this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.columnInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeColumn,delete this.stopX,delete this.lastX,delete this._startClient,delete this._startLogicalX},getColumnAt:function(a){a=a.target;var b;while(a&&a!==this.view&&!(b=a._column))a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;var b;while(a&&a!==this.view&&!(b=a._column))a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=p.getLogicalPoint(this.view,a);return b?b.x:null},getColumnInfoAt:function(a){var b=this._startLogicalX+a.clientX-this._startClient.x+this.table.getView().scrollLeft,c=this.table.getColumnBox().getRoots(),d=c.size(),e=this.table.getZoom(),f=0,g=!1;for(var h=0;h<d;h++){var i=c.get(h);i===this.movableDiv._column&&(g=!0);if(i.isVisible()){var j=i.getWidth()*e;if(j<=0)continue;if(b>=f&&b<=f+j){var k=b<f+j/2;g&&(i!==this.movableDiv._column||!k)&&h--;var l=k?Math.max(0,h):Math.min(h+1,d),m=k?f:f+j;return m=Math.max(0,m-1),{index:l,column:i,position:m+"px"}}f+=j}}return this.columnInfo}}),c.controls.TableHeaderTouchInteraction=function(a){this.header=a,this.table=a._table,this.view=a._view,p.addEventListener("touchstart","handleTouchstart",this.view,this)},d.ext("twaver.controls.TableHeaderTouchInteraction",Object,{handleTouchstart:function(a){p.preventDefault(a);if(this.movableDiv){this.handleTouchend(a);return}this.resizeColumn=a.target._resizeColumn,this.resizeColumn||(this.movableDiv=this.getMovableDivAt(a)),this.lastX=this.getX(a),p.addEventListener("touchmove","handleTouchmove",this.view,this),p.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){if(this.lastX==null)return;var b;if(this.resizeColumn){b=this.getX(a);if(this.stopX!=null){if(b<this.stopX)return;delete this.stopX}var c=this.resizeColumn.getWidth()+(b-this.lastX)/this.table.getZoom();c<0&&(c=0,this.stopX=b),this.resizeColumn.setWidth(c),this.lastX=b}else if(this.movableDiv){b=this.getX(a);var d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.header.getMoveBackground(),this.insertDiv=p.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.header.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.columnInfo=this.getColumnInfoAt(a),this.columnInfo&&(this.insertDiv.style.left=this.columnInfo.position)}},handleTouchend:function(a){var b;if(!this.resizeColumn)if(this.movableDiv&&this.columnInfo){b=this.movableDiv._column;var c=this.columnInfo.index;this.table.getColumnBox().moveTo(b,c)}else{b=this.getColumnAt(a);if(b&&b.isSortable()){var d=b.getSortDirection();this.table.getSortColumn()===b?(d==="desc"&&this.table.setSortColumn(null),b.setSortDirection(d==="asc"?"desc":"asc")):this.table.setSortColumn(b)}}this.clear(),p.removeEventListener("touchmove",this.view,this),p.removeEventListener("touchend",this.view,this)},clear:function(){this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.columnInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeColumn,delete this.stopX,delete this.lastX},getColumnAt:function(a){a=a.target;var b;while(a&&a!==this.view&&!(b=a._column))a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;var b;while(a&&a!==this.view&&!(b=a._column))a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=p.getLogicalPoint(this.view,a);return b?b.x:null},getColumnInfoAt:function(a){var b=this.getX(a)+this.table.getView().scrollLeft,c=this.table.getColumnBox().getRoots(),d=c.size(),e=this.table.getZoom(),f=0,g=!1;for(var h=0;h<d;h++){var i=c.get(h);i===this.movableDiv._column&&(g=!0);if(i.isVisible()){var j=i.getWidth()*e;if(j<=0)continue;if(b>=f&&b<=f+j){var k=b<f+j/2;g&&(i!==this.movableDiv._column||!k)&&h--;var l=k?Math.max(0,h):Math.min(h+1,d),m=k?f:f+j;return m=Math.max(0,m-1),{index:l,column:i,position:m+"px"}}f+=j}}return this.columnInfo}}),c.controls.TablePane=function(a,b){c.controls.TablePane.superClass.constructor.apply(this,arguments),this.invalidate(),this._table=a,this._tableHeader=b?b:new c.controls.TableHeader(a),this._view=p.createView("hidden"),this._view.tabIndex=-1,this._view.appendChild(this._tableHeader.getView()),this._view.appendChild(this._table.getView());var d=this;this._tableHeader.addPropertyChangeListener(function(a){a.property==="height"&&d.invalidate()})},d.ext("twaver.controls.TablePane",c.controls.ControlBase,{onPropertyChanged:function(a){this.invalidate()},getTable:function(){return this._table},getTableHeader:function(){return this._tableHeader},validateImpl:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight,c=this._tableHeader.getHeight();this._tableHeader.adjustBounds({x:0,y:0,width:a,height:c}),this._table.adjustBounds({x:0,y:c,width:a,height:Math.max(0,b-c)})}}),c.controls.TreeTable=function(a){this._treeColumn=new c.Column,this._treeColumn.setName("tree"),this._treeColumn.setWidth(120),this._treeColumn.renderCell=this.renderTreeCell,this._treeColumn.getValue=this.getTreeValue,this._treeColumn.setValue=this.setTreeValue,this._initTree(a),c.controls.TreeTable.superClass.constructor.apply(this,arguments),this._columnBox.add(this._treeColumn)},d.ext("twaver.controls.TreeTable",c.controls.TableBase,{__tree:1,__accessor:["sortFunction","visibleFunction","checkMode","rootData","sortColumn","indent","rowHeight","rowLineWidth","rowLineColor","columnLineWidth","columnLineColor","expandIcon","collapseIcon","uncheckableStyle"],__bool:["editable","rootVisible","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_editable:D.TREETABLE_EDITABLE,_indent:D.TREETABLE_INDENT,_rowHeight:D.TREETABLE_ROW_HEIGHT,_rowLineWidth:D.TREETABLE_ROW_LINE_WIDTH,_rowLineColor:D.TREETABLE_ROW_LINE_COLOR,_columnLineWidth:D.TREETABLE_COLUMN_LINE_WIDTH,_columnLineColor:D.TREETABLE_COLUMN_LINE_COLOR,_makeVisibleOnSelected:D.TREETABLE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:D.TREETABLE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:D.TREETABLE_KEYBOARD_SELECT_ENABLED,_expandIcon:D.TREETABLE_EXPAND_ICON,_collapseIcon:D.TREETABLE_COLLAPSE_ICON,getTreeColumn:function(){return this._treeColumn},renderTreeCell:function(a){a.view._renderTree(a.div,a.data,a.rowIndex,a.selected)},getTreeValue:function(a,b){return b.getLabel(a)},setTreeValue:function(a,b,c){a.setName(b)}}),c.controls.PropertySheet=function(a){c.controls.PropertySheet.superClass.constructor.apply(this,arguments),this._currentRowIndex=-1,this._currentEditor=null,this._currentData=null,this._invalidate=!1,this._resizeDiv=p.createDiv(),this._resizeDiv.style.backgroundColor="white",this._resizeDiv.style.opacity=0,this._resizeDiv.style.top="0px",this._categoryList=new B,this._categoryMap={},this._rowList=new B,this._propertyBox=new c.PropertyBox,this._propertyBox.addDataBoxChangeListener(this.invalidatePropertyBox,this),this._propertyBox.addDataPropertyChangeListener(this.invalidatePropertyBox,this),this._propertyBox.addHierarchyChangeListener(this.invalidatePropertyBox,this),this.__divPool=new c.Pool("div",2),this.__cellPool=new c.Pool("div",2),this.__imagePool=new c.Pool("img",2),this.__textPool=new c.Pool("span",2),this._stringPool=new c.Pool("span",2),this._booleanPool=new c.Pool("input",2),this._colorPool=new c.Pool("div",2),this._pools.add(this.__divPool),this._pools.add(this.__cellPool),this._pools.add(this.__imagePool),this._pools.add(this.__textPool),this._pools.add(this._stringPool),this._pools.add(this._booleanPool),this._pools.add(this._colorPool),this._view=p.createView("auto"),this._rootDiv=p.createDiv(),this._dataDiv=p.createDiv(),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._dataDiv),this.setDataBox(a?a:new c.DataBox);var b=this;this._view.addEventListener("change",function(a){b.handleChange(a)},!1);var d;g.isTouchable?d=c.controls.PropertySheetTouchInteraction:d=c.controls.PropertySheetInteraction,d&&new d(this)},d.ext("twaver.controls.PropertySheet",c.controls.View,{__accessor:["indent","rowHeight","sumWidth","propertyNameWidth","propertyNameHorizontalAlign","autoAdjustable","rowLineWidth","columnLineWidth","borderColor","categorizable","resizeTolerance","editable","selectColor","expandIcon","collapseIcon","sortFunction","visibleFunction"],_autoAdjustable:D.PROPERTYSHEET_AUTO_ADJUSTABLE,_selectColor:D.SELECT_COLOR,_categorizable:D.PROPERTYSHEET_CATEGORIZABLE,_editable:D.PROPERTYSHEET_EDITABLE,_propertyNameWidth:D.PROPERTYSHEET_PROPERTY_NAME_WIDTH,_propertyNameHorizontalAlign:D.PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN,_sumWidth:D.PROPERTYSHEET_SUM_WIDTH,_indent:D.PROPERTYSHEET_INDENT,_rowHeight:D.PROPERTYSHEET_ROW_HEIGHT,_rowLineWidth:D.PROPERTYSHEET_ROW_LINE_WIDTH,_columnLineWidth:D.PROPERTYSHEET_COLUMN_LINE_WIDTH,_borderColor:D.PROPERTYSHEET_BORDER_COLOR,_expandIcon:D.PROPERTYSHEET_EXPAND_ICON,_collapseIcon:D.PROPERTYSHEET_COLLAPSE_ICON,_resizeTolerance:D.PROPERTYSHEET_RESIZE_TOLERANCE,getPropertyBox:function(){return this._propertyBox},getCurrentData:function(){return this._currentData},getDataDiv:function(){return this._dataDiv},getDataBox:function(){return this._box},setDataBox:function(a){if(!a)throw"DataBox can not be null";if(this._box===a)return;var b=this._box;b&&(b.removeDataPropertyChangeListener(this.handlePropertyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidate(),this.firePropertyChange("dataBox",b,this._box)},invalidatePropertyBox:function(){this._isValidating||this.invalidate()},onPropertyChanged:function(a){a.property!=="zoom"&&this.invalidate()},isVisible:function(a){return a.isVisible&&!a.isVisible(this._currentData,this)?!1:this._visibleFunction?this._visibleFunction(a):!0},handlePropertyChange:function(a){this._currentData===a.source&&this.invalidate()},handleSelectionChange:function(a){this._currentData!==this.getSelectionModel().getLastData()&&(this._currentRowIndex=-1,this.invalidate())},isExpanded:function(a){if(!a)return!0;var b=this._categoryMap[a];return b?b.isExpanded:D.PROPERTYSHEET_EXPAND_CATEGORY},expand:function(a){if(!a)return;var b=this._categoryMap[a];if(!b||b.isExpanded)return;b.isExpanded=!0,this.invalidate()},expandAll:function(){for(var a in this._categoryMap){var b=this._categoryMap[a];b&&(b.isExpanded=!0)}this.invalidate()},collapse:function(a){if(!a)return;var b=this._categoryMap[a];if(!b||!b.isExpanded)return;b.isExpanded=!1,this.invalidate()},collapseAll:function(){for(var a in this._categoryMap){var b=this._categoryMap[a];b&&(b.isExpanded=!1)}this.invalidate()},getCategoryName:function(a){if(!this.isCategorizable())return"null";var b=a.getCategoryName();return b?b:"null"},validateModel:function(){this._rowList.clear(),this._categoryList.clear();var a={},b=new B,c=this._currentData?this._propertyBox.getRoots():new B,d,e,f,g,h;g=c.size();for(d=0;d<g;d++)h=c.get(d),this.isVisible(h)&&(b.add(h),f=this.getCategoryName(h),a[f]||(this._categoryList.add(f),a[f]={isExpanded:this.isExpanded(f),properties:new B}));this._sortFunction&&b.sort(this._sortFunction),this._categoryMap=a,g=b.size();for(d=0;d<this._categoryList.size();d++){f=this._categoryList.get(d),f!=="null"&&this._rowList.add(f);var i=a[f];if(i.isExpanded)for(e=0;e<g;e++)h=b.get(e),this.getCategoryName(h)===f&&(i.properties.add(h),this._rowList.add({view:this,data:this._currentData,property:h,value:this._currentData?this.getValue(this._currentData,h):null}))}},adjustWidth:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight;if(a<=this._indent||b<=0)return;a-=this._indent;if(this._rowList.size()*this._rowHeight>b){a-=D.SCROLL_BAR_WIDTH;if(a<=0)return}this._sumWidth===0||this._propertyNameWidth>this._sumWidth?this._propertyNameWidth=
a/2:this._propertyNameWidth=a*(this._propertyNameWidth/this._sumWidth),this._sumWidth=a,this._view.style.overflowX="hidden",this._view.style.overflowY="auto"},validateDisplay:function(){var a=this._rowList.size(),b=this._borderColor,c=this._indent,e=this._rowHeight,f=this._propertyNameWidth,g=Math.max(0,this._sumWidth-f),h=this._rowLineWidth,i=this._columnLineWidth,j=e-h+"px",k=e-h-2+"px",l=c+"px",m=f-i+"px",n=g-i+"px",o=f+g+"px",p=h+"px",q=i+"px",r=f+"px",s=this._dataDiv,t=s.style;t.height=a*e+"px",t.width=c+f+g+"px";var u=this.__divPool.get();t=u.style,t.position="absolute",t.left="0px",t.top="0px",t.width=l,t.height=s.style.height,t.borderWidth="0px",t.backgroundColor=b,s.appendChild(u);for(var v=0;v<a;v++){var w=this._rowList.get(v),x=v*e+"px",y=this.__divPool.get();w.rowDiv=y,t=y.style,t.position="absolute",t.whiteSpace="nowrap",t.overflow="hidden",t.textOverflow="ellipsis",t.left=l,t.top=x,t.width=o,t.height=j,t.lineHeight=k,t.borderStyle="solid",t.borderWidth="0px",t.borderBottomWidth=p,t.borderBottomColor=b,s.appendChild(y);if(typeof w=="string"){t.backgroundColor=b,u=this.__divPool.get(),t=u.style,t.position="absolute",t.left="0px",t.top=x,t.width=l,t.height=j,t.lineHeight=k,t.borderWidth="0px",s.appendChild(u);var z=this.__imagePool.get(),A=this.isExpanded(w)?this._expandIcon:this._collapseIcon;z.setAttribute("src",d.getImageSrc(A)),t=z.style,t.verticalAlign="middle",z._expandData=w,u.appendChild(z),this.renderCategory(y,w),this.onCategoryRendered(y,w)}else{var B=w.property,C=this.__cellPool.get();w.nameRender=C,t=C.style,this._currentRowIndex===v&&(t.backgroundColor=this.getSelectColor()),t.position="absolute",t.verticalAlign="middle",t.textAlign=this._propertyNameHorizontalAlign,t.overflow="hidden",t.textOverflow="ellipsis",t.whiteSpace="nowrap",t.left="0px",t.top="0px",t.width=m,t.height=j,t.borderStyle="solid",t.borderWidth="0px",t.borderRightWidth=q,t.borderRightColor=b,y.appendChild(C),this.renderName(w),this.onNameRendered(w),C=this.__cellPool.get(),w.valueRender=C,t=C.style,t.position="absolute",t.verticalAlign="middle",t.textAlign=B.getHorizontalAlign(),t.whiteSpace="nowrap",t.overflow="hidden",t.textOverflow="ellipsis",t.left=r,t.top="0px",t.width=n,t.height=j,t.borderStyle="solid",t.borderWidth="0px",t.borderRightWidth=q,t.borderRightColor=b,y.appendChild(C),this.renderValue(w),this.onValueRendered(w)}}t=this._resizeDiv.style,t.left=c+f-i-this._resizeTolerance+"px",t.width=i+this._resizeTolerance*2+"px",t.height=s.style.height,s.appendChild(this._resizeDiv)},renderCategory:function(a,b){var c=this.__textPool.get();style=c.style,style.fontWeight="bold",style.whiteSpace="nowrap",style.overflow="hidden",style.textOverflow="ellipsis",style.verticalAlign="middle",style.padding="1px 2px 1px 2px",c.innerHTML=b,c.setAttribute("title",b),a.appendChild(c)},onCategoryRendered:function(a,b){},renderName:function(a){if(a.property.renderName){a.property.renderName(a);return}var b=this.__textPool.get();style=b.style,style.fontWeight="",style.whiteSpace="nowrap",style.verticalAlign="middle",style.padding="1px 2px 1px 2px";var c=a.property.getName();c||(c=a.property.getPropertyName()),b.innerHTML=c,b.setAttribute("title",c),a.nameRender.appendChild(b)},onNameRendered:function(a){},renderValue:function(a){var b=a.property;if(b.renderValue){b.renderValue(a);return}var c=a.value,d=b.getEnumInfo();d&&d.values&&(c=d.map[c]),a.view.isCellEditable(a.data,b)&&(a.enumInfo=d,a.valueRender._editInfo=a),x.render(b.getValueType(),c,a.valueRender,a.view)},onValueRendered:function(a){},updateCurrentData:function(){this._currentData=this.getSelectionModel().getLastData()},validateImpl:function(){var a=this._view.scrollLeft,b=this._view.scrollTop;p.release(this._dataDiv),this.updateCurrentData(),this.validateModel(),this.isAutoAdjustable()&&this.adjustWidth(),this.validateDisplay(),this._pools.forEach(function(a){a.clear()}),this._view.scrollLeft!==a&&(this._view.scrollLeft=a),this._view.scrollTop!==b&&(this._view.scrollTop=b)},getValue:function(a,b){return a?b.getValue(a,this):null},setValue:function(a,b,c){if(!a)return;b.setValue(a,c,this)},isCellEditable:function(a,b){return a?this.isEditable()&&b.isEditable():!1},getRowIndexAt:function(a){var b=this.getLogicalPoint(a);if(!b)return-1;var c=parseInt(b.y/this._rowHeight);return c>=0&&c<this._rowList.size()?c:-1},handleChange:function(a){if(this._isCommitting||this._isCanceling||this._isValidating)return;a.target._editInfo&&this.commitEditValue&&this.commitEditValue(a.target._editInfo,a.target)},commitEditValue:function(a,b){var d;b.type==="checkbox"?d=b.checked:d=b.value;var e=a.property,f=e.getValueType();if(f==="int"&&typeof d=="string")d=parseInt(d);else if(f==="number"&&typeof d=="string")d=parseFloat(d);else if(f==="array.string")d=d.split(",");else if(f==="array.number"){d=d.split(",");for(var g=0,h=d.length;g<h;g++)d[g]=parseFloat(d[g])}this.setValue(a.data,e,d),c.Util.setFocus(this._view),this._currentEditor&&(this._rootDiv.removeChild(this._currentEditor),delete this._currentEditor),delete this._isCommitting},cancelEditing:function(){this._currentEditor&&(this._rootDiv.removeChild(this._currentEditor),delete this._currentEditor,delete this._isCanceling)},updateCurrentRowIndex:function(a){var b=this._rowList.size();if(a<0||a>=b)a=-1;var d=this._currentRowIndex,e;a!==d&&(d>=0&&d<b&&(e=this._rowList.get(d),e.nameRender&&(e.nameRender.style.backgroundColor="")),this._currentRowIndex=a);if(a>=0){e=this._rowList.get(a);if(e.nameRender){e.nameRender.style.backgroundColor=this.getSelectColor();if(!this._currentEditor&&e.valueRender&&e.valueRender._editInfo){var f=e.valueRender._editInfo;f.enumInfo?this._currentEditor=p.createSelect(f.enumInfo,f.value):(this._currentEditor=document.createElement("input"),f.value!=null&&(this._currentEditor.value=f.value));if(this._currentEditor){this._currentEditor.addEventListener("keydown",function(a){var b=a.target._editInfo.view;if(a.keyCode===13){if(b._isCommitting)return;b._isCommitting=!0,b.commitEditValue(a.target._editInfo,a.target)}else a.keyCode===27&&(b._isCanceling=!0,b.cancelEditing())},!1),this._currentEditor.addEventListener("blur",function(a){var b=a.target._editInfo.view;if(b._isCommitting||b._isCanceling)return;b._isCommitting=!0,b.commitEditValue(a.target._editInfo,a.target)},!1),this._currentEditor.keepDefault=!0,this._currentEditor._editInfo=f;var g=this._currentEditor.style;g.position="absolute",g.margin="0px",g.border="0px",g.padding="0px",g.left=this._indent+this._propertyNameWidth+"px",g.top=e.rowDiv.style.top,g.width=e.valueRender.style.width,g.height=e.valueRender.style.height,this._rootDiv.appendChild(this._currentEditor),c.Util.setFocus(this._currentEditor)}}}}}}),c.controls.PropertySheetInteraction=function(a){this.sheet=a,this.view=a._view,this.resizeDiv=a._resizeDiv;var b=this;this.view.addEventListener("mousedown",function(a){a.button===0&&b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},d.ext("twaver.controls.PropertySheetInteraction",Object,{minGap:10,handleMouseDown:function(a){if(a.target===this.sheet._currentEditor||a.target.parentNode===this.sheet._currentEditor)return;this.sheet.isFocusOnClick()&&c.Util.setFocus(this.view);if(this.sheet._isValidating)return;if(a.target._expandData){var b=a.target._expandData;this.sheet.isExpanded(b)?this.sheet.collapse(b):this.sheet.expand(b)}else if(a.target===this.resizeDiv)this.lastX=this.getX(a),p.handle_mousedown(this,a);else{this.sheet._currentEditor&&!this.sheet._isCommitting&&(this.sheet._isCommitting=!0,this.sheet.commitEditValue(this.sheet._currentEditor._editInfo,this.sheet._currentEditor));var d=this.sheet.getRowIndexAt(a);this.sheet.updateCurrentRowIndex(d)}},handleMouseMove:function(a){if(this.lastX==null&&!p.target){this.changeCursor(a);return}if(p.target!==this||this.lastX==null)return;var b=this.getX(a);if(this.stopLeft!=null){if(b<this.stopLeft)return;delete this.stopLeft}if(this.stopRight!=null){if(b>this.stopRight)return;delete this.stopRight}var c=this.sheet.getPropertyNameWidth()+(b-this.lastX);c<this.minGap?(c=this.minGap,this.stopLeft=b):c>this.sheet.getSumWidth()-this.minGap&&(c=this.sheet.getSumWidth()-this.minGap,this.stopRight=b),this.sheet.setPropertyNameWidth(c),this.lastX=b},handleMouseUp:function(a){if(a.button!==0)return;this.view.style.cursor="default",delete this.stopLeft,delete this.stopRight,delete this.lastX},changeCursor:function(a){this.view.style.cursor=a.target===this.resizeDiv?"ew-resize":"default"},getX:function(a){return a.clientX/this.sheet.getZoom()}}),c.controls.PropertySheetTouchInteraction=function(a){this.sheet=a,this.view=a._view,this.resizeDiv=a._resizeDiv,p.addEventListener("touchstart","handleTouchstart",this.view,this)},d.ext("twaver.controls.PropertySheetTouchInteraction",Object,{minGap:10,handleTouchstart:function(a){p.preventDefault(a);if(a.target===this.sheet._currentEditor||a.target.parentNode===this.sheet._currentEditor)return;this.sheet.isFocusOnClick()&&c.Util.setFocus(this.view);if(this.sheet._isValidating)return;a.target===this.resizeDiv&&(this.lastX=this.getX(a)),this.lastPoint=this.sheet.getLogicalPoint(a),w.isMultiTouch(a)&&(this.distance=w.getDistance(a),this.zoom=this.sheet.getZoom()),p.addEventListener("touchmove","handleTouchmove",this.view,this),p.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){this.moved||(this.moved=!0);if(this.lastX==null){if(w.isSingleTouch(a)){if(this.lastPoint){var b=this.sheet.getLogicalPoint(a),c=this.lastPoint.x-b.x,d=this.lastPoint.y-b.y,e=this.sheet.panByOffset(c,d);this.lastPoint.x-=c-e.x,this.lastPoint.y-=d-e.y}}else if(this.distance){var f=w.getDistance(a)/this.distance;this.sheet.setZoom(this.zoom*f,!1)}return}var g=this.getX(a);if(this.stopLeft!=null){if(g<this.stopLeft)return;delete this.stopLeft}if(this.stopRight!=null){if(g>this.stopRight)return;delete this.stopRight}var h=this.sheet.getPropertyNameWidth()+(g-this.lastX);h<this.minGap?(h=this.minGap,this.stopLeft=g):h>this.sheet.getSumWidth()-this.minGap&&(h=this.sheet.getSumWidth()-this.minGap,this.stopRight=g),this.sheet.setPropertyNameWidth(h),this.lastX=g},handleTouchend:function(a){if(!this.moved)if(a.target._expandData){var b=a.target._expandData;this.sheet.isExpanded(b)?this.sheet.collapse(b):this.sheet.expand(b)}else if(a.target!==this.resizeDiv){var c=this.sheet.getRowIndexAt(a);this.sheet.updateCurrentRowIndex(c)}delete this.stopLeft,delete this.stopRight,delete this.lastX,delete this.lastPoint,delete this.distance,delete this.zoom,delete this.moved,p.removeEventListener("touchmove",this.view,this),p.removeEventListener("touchend",this.view,this)},getX:function(a){var b=a.changedTouches[0];return b.clientX}}),c.controls.SplitPane=function(a,b,d,e){c.controls.SplitPane.superClass.constructor.apply(this,arguments),this._view=p.createView("hidden",!0),this._view.tabIndex=-1,this._dividerDiv=p.createDiv(),this._dividerDiv.tabIndex=-1,this._view.appendChild(this._dividerDiv),a&&this.setFirstView(a),b&&this.setNextView(b),d&&this.setOrientation(d),e!=null&&this.setPosition(e),this.invalidate();var f;g.isTouchable?f=c.controls.SplitPaneTouchInteraction:f=c.controls.SplitPaneInteraction,f&&new f(this)},d.ext("twaver.controls.SplitPane",c.controls.ControlBase,{__accessor:["orientation","dividerWidth","dividerBackground","dividerOpacity","maskBackground"],_position:D.SPLITPANE_POSITION,_orientation:D.SPLITPANE_ORIENTATION,_dividerWidth:D.SPLITPANE_DIVIDER_WIDTH,_dividerBackground:D.SPLITPANE_DIVIDER_BACKGROUND,_dividerOpacity:D.SPLITPANE_DIVIDER_OPACITY,_maskBackground:D.SPLITPANE_MASK_BACKGROUND,onPropertyChanged:function(a){this.invalidate()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(a){a<0&&(a=0),a>1&&(a=1);if(a===this._position)return;var b=this._position;this._position=a,this.firePropertyChange("position",b,a)},setFirstView:function(a){if(this._firstView===a)return;var b=this._firstView;b&&(b.getView?this._view.removeChild(b.getView()):this._view.removeChild(b)),this._firstView=a,a&&(a.getView?this._view.insertBefore(a.getView(),this._dividerDiv):this._view.insertBefore(a,this._dividerDiv)),this.firePropertyChange("firstView",b,a)},getFirstView:function(){return this._firstView},setNextView:function(a){if(this._nextView===a)return;var b=this._nextView;b&&(b.getView?this._view.removeChild(b.getView()):this._view.removeChild(b)),this._nextView=a,a&&(a.getView?this._view.insertBefore(a.getView(),this._dividerDiv):this._view.insertBefore(a,this._dividerDiv)),this.firePropertyChange("nextView",b,a)},getNextView:function(){return this._nextView},validateImpl:function(){var a=this._position,b=this._view.offsetWidth,c=this._view.offsetHeight,e=this._dividerWidth;e>=8||e===0?this._coverDiv&&(this._dividerDiv.removeChild(this._coverDiv),delete this._coverDiv):this._coverDiv||(this._coverDiv=p.createDiv(),this._coverDiv.tabIndex=-1,this._dividerDiv.appendChild(this._coverDiv));if(this._orientation==="horizontal"){e>b&&(e=b);var f=(b-e)*a,g=b-e-f+1;d.setViewBounds(this._firstView,{x:0,y:0,width:f,height:c}),d.setViewBounds(this._nextView,{x:f+e,y:0,width:g,height:c}),d.setViewBounds(this._dividerDiv,{x:f,y:0,width:e,height:c}),this._dividerDiv.position=f,this._coverDiv&&d.setViewBounds(this._coverDiv,{x:e/2-4,y:0,width:8,height:c})}else{e>c&&(e=c);var h=(c-e)*a,i=c-e-h;d.setViewBounds(this._firstView,{x:0,y:0,width:b,height:h}),d.setViewBounds(this._nextView,{x:0,y:h+e,width:b,height:i}),d.setViewBounds(this._dividerDiv,{x:0,y:h,width:b,height:e}),this._dividerDiv.position=h,this._coverDiv&&d.setViewBounds(this._coverDiv,{x:0,y:e/2-4,width:b,height:8})}var j=this._dividerDiv.style;j.background=this._dividerBackground}}),c.controls.SplitPaneInteraction=function(a){this.splitPane=a,this.view=a._view,this.dividerDiv=a._dividerDiv;var b=this;this.view.addEventListener("mousedown",function(a){a.button===0&&b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},d.ext("twaver.controls.SplitPaneInteraction",Object,{handleMouseDown:function(a){if(this.resizeDiv)this.clear(a);else if(a.target===this.dividerDiv||a.target===this.splitPane._coverDiv){this.resizeDiv=p.createDiv();var b=this.resizeDiv.style;b.left=this.dividerDiv.style.left,b.top=this.dividerDiv.style.top,b.width=this.dividerDiv.style.width,b.height=this.dividerDiv.style.height,b.opacity=this.splitPane.getDividerOpacity(),b.background=this.splitPane.getDividerBackground(),this.resizeDiv.lastPosition=this.splitPane._orientation==="horizontal"?a.clientX:a.clientY,this.resizeDiv.maskDiv=p.createDiv(),b=this.resizeDiv.maskDiv.style,b.left="0px",b.top="0px",b.width=this.view.clientWidth+"px",b.height=this.view.clientHeight+"px",b.background=this.splitPane.getMaskBackground(),this.view.appendChild(this.resizeDiv.maskDiv),this.view.appendChild(this.resizeDiv),p.handle_mousedown(this,a),a.preventDefault()}},handleMouseMove:function(a){if(!this.resizeDiv&&!p.target){var b=this.splitPane._orientation==="horizontal"?"ew-resize":"ns-resize";this.view.style.cursor=a.target===this.dividerDiv||a.target===this.splitPane._coverDiv?b:"default"}else this.resizeDiv&&p.target===this&&(this.splitPane._orientation==="horizontal"?this.resizeDiv.style.left=this.dividerDiv.position+a.clientX-this.resizeDiv.lastPosition+"px":this.resizeDiv.style.top=this.dividerDiv.position+a.clientY-this.resizeDiv.lastPosition+"px")},handleMouseUp:function(a){a.button===0&&this.clear(a)},clear:function(a){if(this.resizeDiv){var b=this.splitPane._dividerWidth,c;if(this.splitPane._orientation==="horizontal"){var d=this.view.clientWidth;b>d&&(b=d),c=this.dividerDiv.position+a.clientX-this.resizeDiv.lastPosition,this.splitPane.setPosition(c/(d-b))}else{var e=this.view.clientHeight;b>e&&(b=e),c=this.dividerDiv.position+a.clientY-this.resizeDiv.lastPosition,this.splitPane.setPosition(c/(e-b))}this.view.removeChild(this.resizeDiv.maskDiv),this.view.removeChild(this.resizeDiv),delete this.resizeDiv}}}),c.controls.SplitPaneTouchInteraction=function(a){this.splitPane=a,this.view=a._view,this.dividerDiv=a._dividerDiv,p.addEventListener("touchstart","handleTouchstart",this.view,this)},d.ext("twaver.controls.SplitPaneTouchInteraction",Object,{handleTouchstart:function(a){p.preventDefault(a);if(this.resizeDiv)this.clear(a);else if(a.target===this.dividerDiv||a.target===this.splitPane._coverDiv){this.resizeDiv=p.createDiv();var b=this.resizeDiv.style;b.left=this.dividerDiv.style.left,b.top=this.dividerDiv.style.top,b.width=this.dividerDiv.style.width,b.height=this.dividerDiv.style.height,b.opacity=this.splitPane.getDividerOpacity(),b.background=this.splitPane.getDividerBackground();var c=a.changedTouches[0];this.resizeDiv.lastPosition=this.splitPane._orientation==="horizontal"?c.clientX:c.clientY,this.resizeDiv.maskDiv=p.createDiv();var b=this.resizeDiv.maskDiv.style;b.left="0px",b.top="0px",b.width=this.view.clientWidth+"px",b.height=this.view.clientHeight+"px",b.background=this.splitPane.getMaskBackground(),this.view.appendChild(this.resizeDiv.maskDiv),this.view.appendChild(this.resizeDiv)}p.addEventListener("touchmove","handleTouchmove",this.view,this),p.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){if(!!this.resizeDiv){var b=a.changedTouches[0];this.splitPane._orientation==="horizontal"?this.resizeDiv.style.left=this.dividerDiv.position+b.clientX-this.resizeDiv.lastPosition+"px":this.resizeDiv.style.top=this.dividerDiv.position+b.clientY-this.resizeDiv.lastPosition+"px"}},handleTouchend:function(a){p.removeEventListener("touchmove",this.view,this),p.removeEventListener("touchend",this.view,this),this.clear(a)},clear:function(a){var b=a.changedTouches[0];if(this.resizeDiv){var c=this.splitPane._dividerWidth;if(this.splitPane._orientation==="horizontal"){var d=this.view.clientWidth;c>d&&(c=d);var e=this.dividerDiv.position+b.clientX-this.resizeDiv.lastPosition;this.splitPane.setPosition(e/(d-c))}else{var f=this.view.clientHeight;c>f&&(c=f);var e=this.dividerDiv.position+b.clientY-this.resizeDiv.lastPosition;this.splitPane.setPosition(e/(f-c))}this.view.removeChild(this.resizeDiv.maskDiv),this.view.removeChild(this.resizeDiv),delete this.resizeDiv}}}),c.controls.TabPane=function(){c.controls.TabPane.superClass.constructor.apply(this,arguments),this._tabBox=new c.TabBox,this._tabBox.addDataBoxChangeListener(this.handleTabChange,this),this._tabBox.addDataPropertyChangeListener(this.handleTabChange,this),this._tabBox.addHierarchyChangeListener(this.handleTabChange,this),this._tabBox.getSelectionModel().addSelectionChangeListener(this.handleTabChange,this),this._view=p.createView("hidden",!0),this._tabDiv=p.createDiv(),this._tabDiv.onmousedown=p.preventDefault,this._tabDiv.onkeydown=p.preventDefault,this._contentDiv=p.createDiv(),this._view.appendChild(this._tabDiv),this._view.appendChild(this._contentDiv),this._divPool=new c.Pool("div"),this._iconPool=new c.Pool("img"),this._closePool=new c.Pool("img"),this._textPool=new c.Pool("span"),this._resizePool=new c.Pool("div"),this._pools.add(this._divPool),this._pools.add(this._iconPool),this._pools.add(this._closePool),this._pools.add(this._textPool),this._pools.add(this._resizePool),this.invalidateTab();var a;g.isTouchable?a=c.controls.TabPaneTouchInteraction:a=c.controls.TabPaneInteraction,a&&new a(this)},d.ext("twaver.controls.TabPane",c.controls.ControlBase,{__accessor:["tabGap","tabRadius","tabHeight","horizontalAlign","tabOrientation","resizeTolerance","tabBackground","selectBackground","moveBackground","insertBackground","closeIcon","disabledColor"],__bool:["selectNextOnClose","selectNextOnInVisible"],_tabGap:D.TABPANE_TAB_GAP,_tabRadius:D.TABPANE_TAB_RADIUS,_tabHeight:D.TABPANE_TAB_HEIGHT,_resizeTolerance:D.TABPANE_RESIZE_TOLERANCE,_tabOrientation:D.TABPANE_TAB_ORIENTATION,_tabBackground:D.TABPANE_TAB_BACKGROUND,_disabledColor:D.TABPANE_DISABLED_COLOR,_selectBackground:D.TABPANE_SELECT_BACKGROUND,_moveBackground:D.TABPANE_MOVE_BACKGROUND,_insertBackground:D.TABPANE_INSERT_BACKGROUND,_horizontalAlign:D.TABPANE_HORIZONTAL_ALIGN,_closeIcon:D.TABPANE_CLOSE_ICON,_selectNextOnClose:D.TABPANE_SELECT_NEXT_ON_CLOSE,_selectNextOnInVisible:D.TABPANE_SELECT_NEXT_ON_INVISIBLE,onPropertyChanged:function(a){this.invalidateTab()},getTabBox:function(){return this._tabBox},getTabDiv:function(){return this._tabDiv},getContentDiv:function(){return this._contentDiv},handleTabChange:function(a){if(this._selectNextOnInVisible&&a.property==="visible"&&!a.newValue&&this._tabBox.getSelectionModel().contains(a.source)){var b=a.source,c=this._tabBox.getRoots().indexOf(b),d=this._tabBox.getRoots(),e=d.size(),f=c,g,h;while(f<e-1){g=d.get(++f);if(g.isVisible()&&!g.isDisabled()){h=g;break}}if(!h){f=c;while(f>0){g=d.get(--f);if(g.isVisible()&&!g.isDisabled()){h=g;break}}}this._tabBox.getSelectionModel().setSelection(h)}this.invalidateTab()},invalidateTab:function(a){this._invalidateTab||(this._invalidateTab=!0,this.invalidate(a))},validateImpl:function(){this._invalidateTab&&(this._invalidateTab=!1,this.validateTab());var a=this._view.offsetWidth,b=this._view.offsetHeight,c;this._tabOrientation==="top"?(this._tabDiv.style.top="0px",c={x:0,y:this._tabHeight,width:a,height:Math.max(0,b-this._tabHeight)}):(this._tabDiv.style.top=b-this._tabHeight+"px",c={x:0,y:0,width:a,height:Math.max(0,b-this._tabHeight)}),this._currentView&&d.setViewBounds(this._currentView,c)},getCurrentTab:function(){return this._currentTab},getCurrentView:function(){return this._currentView},onViewRemoved:function(a){},onViewAdded:function(a){},validateTab:function(){this._currentTab=this._tabBox.getSelectionModel().getLastData();var a=this._currentTab?this._currentTab.getView():null;if(a!==this._currentView){var b,c;this._currentView&&(b=this._currentView.getView?this._currentView.getView():this._currentView,b.style.visibility="hidden",this.onViewRemoved(this._currentView)),a&&(c=a.getView?a.getView():a,c.style.visibility="visible",c.parentNode||this._contentDiv.appendChild(c),this.onViewAdded(a)),this._currentView=a}p.release(this._tabDiv);var d=this._tabBox.getRoots(),e=this._tabHeight+"px",f=this._tabHeight-2+"px",g=this._tabRadius+"px",h=d.size(),i=0;for(var j=0;j<h;j++){var k=d.get(j);if(k.isVisible()){var l=this._currentTab===k,m=k.getWidth();m<0&&(m=0);var n=Math.min(this._tabGap,m),o=this._divPool.get();o._tab=k;var q=o.style;q.position="absolute",q.whiteSpace="nowrap",q.lineHeight=f,q.overflow="hidden",q.textOverflow="ellipsis",q.background=l?this._selectBackground:this._tabBackground,q.textAlign=this._horizontalAlign,this._tabOrientation==="top"?(q.borderTopLeftRadius=g,q.borderTopRightRadius=g,q.borderBottomLeftRadius="0px",q.borderBottomRightRadius="0px"):(q.borderTopLeftRadius="0px",q.borderTopRightRadius="0px",q.borderBottomLeftRadius=g,q.borderBottomRightRadius=g),q.left=i+"px",q.width=m-n+"px",q.height=e,o._x=i,o._width=m-n,this.renderTab(o,k),this.onTabRendered(o,k),this._tabDiv.insertBefore(o,this._tabDiv.firstChild),i+=m,k.isResizable()&&(o=this._resizePool.get(),o._resizeTab=k,q=o.style,q.position="absolute",q.backgroundColor="white",q.opacity=0,q.left=i-n-this._resizeTolerance+"px",q.width=n+this._resizeTolerance*2+"px",q.height=e,this._tabDiv.appendChild(o))}}this._tabDiv.style.left="0px",this._tabDiv.style.width=i+"px",this._tabDiv.style.height=this._tabHeight+"px",this._pools.forEach(function(a){a.clear()})},renderTab:function(a,b){if(b.renderTab)b.renderTab(a);else{var c=b.getIcon();if(c){var e=this._iconPool.get();e.setAttribute("src",d.getImageSrc(c)),e.style.paddingLeft="4px",e.style.verticalAlign="middle",a.appendChild(e)}var f=b.getName();if(f){var h=this._textPool.get();h.style.whiteSpace="nowrap",h.style.verticalAlign="middle",h.style.padding="2px 4px",h.innerHTML=f,a.appendChild(h)}if(g.isOpera){var i=a.cloneNode(!1);i.style.left="0px",i.style.top="0px",i.style.opacity=0,a.appendChild(i)}}if(b.isClosable()){var j=this._tabRadius/4+2,e=this._closePool.get();e._closeTab=b,e.setAttribute("src",d.getImageSrc(this._closeIcon)),e.style.position="absolute",e.style.top=j+"px",e.style.right=j+"px",a.appendChild(e)}b.isDisabled()?a.style.color=this.getDisabledColor():a.style.color=""},onTabRendered:function(a,b){}}),c.controls.TabPaneInteraction=function(a){this.tabPane=a,this.view=a.getTabDiv();var b=this;this.view.addEventListener("mousedown",function(a){b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},d.ext("twaver.controls.TabPaneInteraction",Object,{handleMouseDown:function(a){if(a.button!==0)return;if(this.movableDiv){this.handleMouseUp(a);return}this.resizeTab=a.target._resizeTab,this.resizeTab||(this.movableDiv=this.getMovableDivAt(a)),this.changeCursor(a),this.lastX=this.getX(a),this._startClient=p.getClientPoint(a),this._startLogicalX=this.lastX,p.handle_mousedown(this,a)},changeCursor:function(a){var b="";if(a.target._resizeTab)b="ew-resize";else{var c=this.getTabAt(a);c&&(!c.isDisabled()||c.isMovable())&&(b="pointer")}this.view.style.cursor=b},handleMouseMove:function(a){if(this.lastX==null){this.changeCursor(a);return}if(p.target!==this)return;var b=this._startLogicalX+a.clientX-this._startClient.x;if(this.resizeTab){if(this.stopX!=null){if(b<this.stopX)return;delete this.stopX}var c=this.resizeTab.getWidth()+(b-this.lastX);c<10&&(c=10,this.stopX=b),this.resizeTab.setWidth(c),this.lastX=b}else if(this.movableDiv){var d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.tabPane.getMoveBackground(),this.insertDiv=p.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.tabPane.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.tabInfo=this.getTabInfoAt(a),this.tabInfo&&(this.insertDiv.style.left=this.tabInfo.position)}},handleMouseUp:function(a){if(a.button!==0)return;if(!this.resizeTab)if(this.movableDiv&&this.tabInfo){var b=this.movableDiv._tab,c=this.tabInfo.index;this.tabPane.getTabBox().moveTo(b,c)}else{var d=this.tabPane.getTabBox(),b=a.target._closeTab;if(b)if(this.tabPane.isSelectNextOnClose()&&this.tabPane.getCurrentTab()===b){var e=d.getRoots(),c=e.indexOf(b);d.remove(b),e.size()>0&&(c>=e.size()&&(c=e.size()-1),d.getSelectionModel().setSelection(e.get(c)))}else d.remove(b);else{var b=this.getTabAt(a);b&&!b.isDisabled()&&d.getSelectionModel().setSelection(b)}}this.clear()},clear:function(){this.view.style.cursor="",this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.tabInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeTab,delete this.stopX,delete this.lastX,delete this._startLogicalX,delete this._startClient},getTabAt:function(a){a=a.target;var b;while(a&&a!==this.view&&!(b=a._tab))a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;var b;while(a&&a!==this.view&&!(b=a._tab))a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=p.getLogicalPoint(this.view,a);return b?b.x:null},getTabInfoAt:function(a){var b=this._startLogicalX+a.clientX-this._startClient.x,c=this.tabPane.getTabBox().getRoots(),d=c.size(),e=0,f=!1;for(var g=0;g<d;g++){var h=c.get(g);h===this.movableDiv._tab&&(f=!0);if(h.isVisible()){var i=h.getWidth();if(i<=0)continue;if(b>=e&&b<=e+i){var j=b<e+i/2;f&&(h!==this.movableDiv._tab||!j)&&g--;var k=j?Math.max(0,g):Math.min(g+1,d),l=j?e:e+i;return l=Math.max(0,l-1),{index:k,tab:h,position:l+"px"}}e+=i}}return this.tabInfo}}),c.controls.TabPaneTouchInteraction=function(a){this.tabPane=a,this.view=a.getTabDiv(),p.addEventListener("touchstart","handleTouchstart",this.view,this)},d.ext("twaver.controls.TabPaneTouchInteraction",Object,{handleTouchstart:function(a){p.preventDefault(a);if(this.movableDiv){this.handleTouchend(a);return}this.resizeTab=a.target._resizeTab,this.resizeTab||(this.movableDiv=this.getMovableDivAt(a)),this.lastX=this.getX(a),p.addEventListener("touchmove","handleTouchmove",this.view,this),p.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){if(this.lastX==null)return;if(this.resizeTab){var b=this.getX(a);if(this.stopX!=null){if(b<this.stopX)return;delete this.stopX}var c=this.resizeTab.getWidth()+(b-this.lastX);c<0&&(c=0,this.stopX=b),this.resizeTab.setWidth(c),this.lastX=b}else if(this.movableDiv){var b=this.getX(a),d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.tabPane.getMoveBackground(),this.insertDiv=p.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.tabPane.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.tabInfo=this.getTabInfoAt(a),this.tabInfo&&(this.insertDiv.style.left=this.tabInfo.position)}},handleTouchend:function(a){if(!this.resizeTab)if(this.movableDiv&&this.tabInfo){var b=this.movableDiv._tab,c=this.tabInfo.index;this.tabPane.getTabBox().moveTo(b,c)}else{var d=this.tabPane.getTabBox(),b=a.target._closeTab;if(b)if(this.tabPane.isSelectNextOnClose()&&this.tabPane.getCurrentTab()===b){var e=d.getRoots(),c=e.indexOf(b);d.remove(b),e.size()>0&&(c>=e.size()&&(c=e.size()-1),d.getSelectionModel().setSelection(e.get(c)))}else d.remove(b);else{var b=this.getTabAt(a);b&&!b.isDisabled()&&d.getSelectionModel().setSelection(b)}}this.clear(),p.removeEventListener("touchmove",this.view,this),p.removeEventListener("touchend",this.view,this)},clear:function(){this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.tabInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeTab,delete this.stopX,delete this.lastX},getTabAt:function(a){a=a.target;var b;while(a&&a!==this.view&&!(b=a._tab))a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;var b;while(a&&a!==this.view&&!(b=a._tab))a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=p.getLogicalPoint(this.view,a);return b?b.x:null},getTabInfoAt:function(a){var b=this.getX(a),c=this.tabPane.getTabBox().getRoots(),d=c.size(),e=0,f=!1;for(var g=0;g<d;g++){var h=c.get(g);h===this.movableDiv._tab&&(f=!0);if(h.isVisible()){var i=h.getWidth();if(i<=0)continue;if(b>=e&&b<=e+i){var j=b<e+i/2;f&&(h!==this.movableDiv._tab||!j)&&g--;var k=j?Math.max(0,g):Math.min(g+1,d),l=j?e:e+i;return l=Math.max(0,l-1),{index:k,tab:h,position:l+"px"}}e+=i}}return this.tabInfo}}),c.controls.TitlePane=function(a,b,d){c.controls.TitlePane.superClass.constructor.apply(this,arguments),this.invalidate(),this._titleDiv=p.createDiv(),this._titleDiv.tabIndex=-1,this._titleDiv.style.verticalAlign="middle",this._titleDiv.style.fontWeight="bold",this._titleDiv.style.textOverflow="ellipsis",this._titleDiv.style.overflow="hidden",this._titleDiv.style.whiteSpace="nowrap",this._titleDiv.onmousedown=p.preventDefault,this._span=document.createElement("span"),this._span.style.verticalAlign="middle",this._span.style.paddingLeft="4px",this._span.style.paddingRight="4px",this._img=document.createElement("img"),this._img.style.verticalAlign="middle",this._img.style.paddingLeft="4px",this._view=p.createView("hidden",!0),this._view.tabIndex=-1,this._view.appendChild(this._titleDiv),b&&this.setTitle(b),a&&this.setContent(a),d&&this.setIcon(d)},d.ext("twaver.controls.TitlePane",c.controls.ControlBase,{__accessor:["icon","title","titleHeight","titleHorizontalAlign","titleBackground"],_titleHeight:D.TITLEPANE_TITLE_HEIGHT,_titleBackground:D.TITLEPANE_TITLE_BACKGROUND,_titleHorizontalAlign:D.TITLEPANE_TITLE_HORIZONTAL_ALIGN,onPropertyChanged:function(a){this.invalidate()},getTitleDiv:function(){return this._titleDiv},getContent:function(){return this._content},setContent:function(a){if(this._content===a)return;var b=this._content;b&&(b.getView?this._view.removeChild(b.getView()):this._view.removeChild(b)),this._content=a,a&&(a.getView?this._view.appendChild(a.getView()):this._view.appendChild(a)),this.firePropertyChange("content",b,a)},validateImpl:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight
,c=this._titleDiv.style;c.textAlign=this._titleHorizontalAlign,c.lineHeight=this._titleHeight-2+"px",c.background=this._titleBackground,p.clear(this._titleDiv),this._icon&&(this._img.setAttribute("src",d.getImageSrc(this._icon)),this._titleDiv.appendChild(this._img)),this._title&&(this._span.innerHTML=this._title,this._span.setAttribute("title",this._title),this._titleDiv.appendChild(this._span));var c=this._titleDiv.style;c.left="0px",c.top="0px",c.width=a+"px",c.height=this._titleHeight+"px",d.setViewBounds(this._content,{x:0,y:this._titleHeight,width:a,height:Math.max(b-this._titleHeight,0)})}}),c.controls.Accordion=function(){c.controls.Accordion.superClass.constructor.apply(this,arguments),this._titleMap={},this._titleList=new B,this._currentTitle=null,this._currentView=null,this._view=p.createView("hidden",!0),this.invalidate();var a=this;this._view.addEventListener("mousedown",function(b){a.handleMouseDown(b)},!1)},d.ext("twaver.controls.Accordion",c.controls.ControlBase,{__accessor:["expandIcon","collapseIcon","titleHeight","titleBackground","borderBottomColor"],_expandIcon:D.ACCORDION_EXPAND_ICON,_collapseIcon:D.ACCORDION_COLLAPSE_ICON,_titleHeight:D.ACCORDION_TITLE_HEIGHT,_titleBackground:D.ACCORDION_TITLE_BACKGROUND,_borderBottomColor:D.ACCORDION_BORDER_BOTTOM_COLOR,onPropertyChanged:function(a){this.invalidate()},handleMouseDown:function(a){if(a.button!==0)return;var b=a.target._title;b||(b=a.target.parentNode._title),b&&(this._currentTitle===b?this.collapse():this.expand(b))},getTitles:function(){return this._titleList},getCurrentTitle:function(){return this._currentTitle},add:function(a,b){if(this._titleMap[a])throw"Title ' + title + ' already exists";var c=p.createDiv();c._title=a,c.onmousedown=p.preventDefault,c.style.cursor="pointer",c.style.textAlign="left",c.style.textOverflow="ellipsis",c.style.whiteSpace="nowrap",c.style.overflow="hidden",c.style.borderBottomWidth="1px",c.style.borderBottomStyle="solid";var d=document.createElement("img");d.style.verticalAlign="middle",d.style.paddingLeft="4px";var e=document.createElement("span");e.style.verticalAlign="middle",e.style.paddingLeft="4px",e.innerHTML=a,e.setAttribute("title",a),this._view.appendChild(c),c.appendChild(d),c.appendChild(e),this._titleMap[a]={content:b,titleDiv:c,span:e,img:d},this._titleList.add(a),this.invalidate()},remove:function(a){delete this._titleMap[a],this._titleList.remove(a),this.invalidate()},clear:function(){this._titleMap={},this._titleList.clear(),this.invalidate()},expand:function(a){this._titleMap[a]&&this._currentTitle!==a&&(this._currentTitle=a,this.onExpanded(a),this.invalidate())},onExpanded:function(a){},collapse:function(){this._currentTitle&&(this.onCollapsed(this._currentTitle),this._currentTitle=null,this.invalidate())},onCollapsed:function(a){},validateImpl:function(){var a=this._currentView;this._currentView=null;var b=this._view.offsetWidth,c=this._view.offsetHeight,e=this._titleList.size(),f=0;for(var g=0;g<e;g++){var h=this._titleList.get(g),i=this._titleMap[h],j=i.titleDiv.style;j.lineHeight=this._titleHeight-3+"px",j.background=this._titleBackground,j.borderBottomColor=this._borderBottomColor,j.left="0px",j.top=f+"px",j.width=b+"px",j.height=this._titleHeight-1+"px";var k=this._currentTitle===h,l=k?this._expandIcon:this._collapseIcon;i.img.setAttribute("src",d.getImageSrc(l));if(k){var m=Math.max(0,c-e*this._titleHeight);i.content&&(this._currentView=i.content.getView?i.content.getView():i.content,d.setViewBounds(i.content,{x:0,y:f+this._titleHeight,width:b,height:m})),f+=this._titleHeight+m}else f+=this._titleHeight}this._currentView&&this._currentView!==a&&this._view.appendChild(this._currentView),a&&a!==this._currentView&&this._view.removeChild(a)}}),c.controls.BorderPane=function(a,b,d,e,f){c.controls.BorderPane.superClass.constructor.apply(this,arguments),this.invalidate(),this._view=p.createView("hidden",!0),this._view.tabIndex=-1,a&&this.setCenter(a),b&&this.setTop(b),d&&this.setRight(d),e&&this.setBottom(e),f&&this.setLeft(f)},d.ext("twaver.controls.BorderPane",c.controls.ControlBase,{__accessor:["hGap","vGap","topHeight","bottomHeight","leftWidth","rightWidth"],_hGap:D.BORDERPANE_HGAP,_vGap:D.BORDERPANE_VGAP,_topHeight:0,_bottomHeight:0,_leftWidth:0,_rightWidth:0,onPropertyChanged:function(a){this.invalidate()},getCenter:function(){return this._center},setCenter:function(a){this._setContent("center",a)},getTop:function(){return this._top},setTop:function(a){this._setContent("top",a)},getRight:function(){return this._right},setRight:function(a){this._setContent("right",a)},getBottom:function(){return this._bottom},setBottom:function(a){this._setContent("bottom",a)},getLeft:function(){return this._left},setLeft:function(a){this._setContent("left",a)},_setContent:function(a,b){var c=this["_"+a];if(c===b)return;c&&(c.getView?this._view.removeChild(c.getView()):this._view.removeChild(c)),this["_"+a]=b,b&&(b.getView?this._view.appendChild(b.getView()):this._view.appendChild(b)),this.firePropertyChange(a,c,b)},validateImpl:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight,c=0,e=0,f=a,g=b,h=0,i=0,j=0,k=0;this._top&&(h=this._topHeight||(this._top.getView?this._top.getView().offsetHeight:this._top.offsetHeight),e=h+this._vGap),this._bottom&&(i=this._bottomHeight||(this._bottom.getView?this._bottom.getView().offsetHeight:this._bottom.offsetHeight),g=b-i-this._vGap),this._left&&(j=this._leftWidth||(this._left.getView?this._left.getView().offsetWidth:this._left.offsetWidth),c=j+this._hGap),this._right&&(k=this._rightWidth||(this._right.getView?this._right.getView().offsetWidth:this._right.offsetWidth),f=a-k-this._hGap);var l=Math.max(0,f-c),m=Math.max(0,g-e);this._top&&d.setViewBounds(this._top,{x:0,y:0,width:a,height:h}),this._bottom&&d.setViewBounds(this._bottom,{x:0,y:g,width:a,height:i}),this._left&&d.setViewBounds(this._left,{x:0,y:e,width:j,height:m}),this._right&&d.setViewBounds(this._right,{x:f,y:e,width:k,height:m}),this._center&&d.setViewBounds(this._center,{x:c,y:e,width:l,height:m})}}),c.charts.PieChart=function(a){this._sum=0,this._map={},c.charts.PieChart.superClass.constructor.apply(this,arguments)},d.ext("twaver.charts.PieChart",c.charts.ChartBase,{__accessor:["type","selectOffset","startAngle","shadowColor","shadowOffset","lineRate","donutRate","valuePosition"],_type:D.PIECHART_TYPE,_lineRate:D.PIECHART_LINE_RATE,_donutRate:D.PIECHART_DONUT_RATE,_startAngle:D.PIECHART_START_ANGLE,_shadowColor:D.PIECHART_SHADOW_COLOR,_shadowOffset:D.PIECHART_SHADOW_OFFSET,_selectOffset:D.PIECHART_SELECT_OFFSET,_valuePosition:D.PIECHART_VALUE_POSITION,getSum:function(){return this._sum},validateModel:function(){this._sum=0,this._map={},this._publishedDatas.forEach(function(a){var b=this.getValue(a);this._map[a.getId()]={data:a,value:b,color:this.getUniqueColor(this.getColor(a),a)},this._sum+=b},this);var a=this._startAngle;this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];c.proportion=this._sum===0?0:c.value/this._sum,this._type!=="line"&&(c.startAngle=a,c.arc=c.proportion*Math.PI*2,a+=c.arc)},this)},validateDisplay:function(a,b,c){var d={x:this._xGap,y:this._yGap,width:b-this._xGap*2,height:c-this._yGap*2};this.drawBackground(a,d),l.grow(d,-4,-4);if(d.width<=0||d.height<=0)return;var e=this._shadowOffset;e>0&&(a.shadowOffsetX=e,a.shadowOffsetY=e,a.shadowBlur=e*1.5,a.shadowColor=this._shadowColor);if(this._type==="oval"||this._type==="circle"){var f=d.x+d.width/2,g=d.y+d.height/2,h=d.width/2,i=d.height/2;this._type==="circle"&&(h=i=Math.min(h,i)),this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];if(c.arc===0)return;var d=0,e=0;if(this.isSelected(b)){var j=c.startAngle+c.arc/2;d=Math.cos(j)*this._selectOffset,e=Math.sin(j)*this._selectOffset*i/h}a.fillStyle=c.color,a.beginPath(),a.moveTo(f+d,g-e),q.drawArc(a,f+d,g-e,c.startAngle,c.arc,h,i,!0),a.closePath(),a.fill();var k=this._getValueTextInfo(b,c.value);if(k){var j=c.startAngle+c.arc/2;k.x=f+d+Math.cos(j)*h*this._valuePosition,k.y=g-e-Math.sin(j)*i*this._valuePosition}},this)}else if(this._type==="donut"||this._type==="ovalDonut"){var f=d.x+d.width/2,g=d.y+d.height/2,h=d.width/2,i=d.height/2;this._type==="donut"&&(h=i=Math.min(h,i)),this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];if(c.arc===0)return;var d=0,e=0;if(this.isSelected(b)){var j=c.startAngle+c.arc/2;d=Math.cos(j)*this._selectOffset,e=Math.sin(j)*this._selectOffset*i/h}var k=f+Math.cos(c.startAngle)*h*this._donutRate,l=g-Math.sin(c.startAngle)*i*this._donutRate,m=f+Math.cos(c.startAngle+c.arc)*h*this._donutRate,n=g-Math.sin(c.startAngle+c.arc)*i*this._donutRate;a.fillStyle=c.color,a.beginPath(),a.moveTo(k+d,l-e),q.drawArc(a,f+d,g-e,c.startAngle,c.arc,h,i,!0),a.lineTo(m+d,n-e),q.drawArc(a,f+d,g-e,c.startAngle+c.arc,-c.arc,h*this._donutRate,i*this._donutRate,!0),a.closePath(),a.fill();var o=this._getValueTextInfo(b,c.value);if(o){var j=c.startAngle+c.arc/2,p=this._donutRate+(1-this._donutRate)*this._valuePosition;o.x=f+d+Math.cos(j)*h*p,o.y=g-e-Math.sin(j)*i*p}},this)}else if(this._type==="line"){var j=d.height*this._lineRate;d.y=d.y+d.height/2-j/2,d.height=j;var k=d.x;this._publishedDatas.forEach(function(b){var c=this._map[b.getId()],e=d.width*c.proportion;if(e===0)return;a.beginPath(),a.fillStyle=c.color;var f=this.isSelected(b)?-this._selectOffset:0;a.rect(k,d.y+f,e,d.height),a.closePath(),a.fill();var g=this._getValueTextInfo(b,c.value);g&&(g.x=k+e/2,g.y=d.y+d.height+f-d.height*this._valuePosition),k+=e},this)}this._shadowOffset>0&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0),this.drawValueTexts(a)}}),c.charts.BarChart=function(a){c.charts.BarChart.superClass.constructor.apply(this,arguments)},d.ext("twaver.charts.BarChart",c.charts.ScaleChart,{__accessor:["type"],_upperLimit:D.BARCHART_UPPER_LIMIT,_lowerLimit:D.BARCHART_LOWER_LIMIT,_type:D.BARCHART_TYPE,_xAxisText:null,_xAxisTextColor:D.BARCHART_XAXIS_TEXT_COLOR,_xAxisTextFont:D.BARCHART_XAXIS_TEXT_FONT,_xAxisLineColor:D.BARCHART_XAXIS_LINE_COLOR,_xAxisLineWidth:D.BARCHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:D.BARCHART_YAXIS_TEXT_COLOR,_yAxisTextFont:D.BARCHART_YAXIS_TEXT_FONT,_yAxisLineColor:D.BARCHART_YAXIS_LINE_COLOR,_yAxisLineWidth:D.BARCHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:D.BARCHART_XSCALE_TEXT_FONT,_xScaleTextColor:D.BARCHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:D.BARCHART_XSCALE_TEXT_ORIENTATION,_yScaleTextVisible:D.BARCHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:D.BARCHART_YSCALE_TEXT_COLOR,_yScaleTextFont:D.BARCHART_YSCALE_TEXT_FONT,_yScaleLineColor:D.BARCHART_YSCALE_LINE_COLOR,_yScaleLineWidth:D.BARCHART_YSCALE_LINE_WIDTH,_yScaleValueGap:D.BARCHART_YSCALE_VALUE_GAP,_yScalePixelGap:D.BARCHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:D.BARCHART_YSCALE_MIN_TEXT_VISIBLE,validateModel:function(){var a=this._type+"ValidateModel";this[a]&&(this._reset(),this[a]())},defaultValidateModel:function(){this._columnCount=this._publishedDatas.size(),this._publishedDatas.forEach(function(a){var b=this.getValue(a);this._upperLimit==null&&b>this._max&&(this._max=b),this._lowerLimit==null&&b<this._min&&(this._min=b),this._map[a.getId()]={data:a,value:b,color:this.getUniqueColor(this.getColor(a),a)}},this),this._initRange(),this._publishedDatas.forEach(function(a){var b=this._map[a.getId()];b.proportion=this._range==0?0:b.value/this._range},this)},layerValidateModel:function(){this._commonValidateModel()},groupValidateModel:function(){this._commonValidateModel()},stackValidateModel:function(){this._publishedDatas.forEach(function(a){var b=new B(this.getValues(a));b.size()>this._columnCount&&(this._columnCount=b.size());var c={data:a,values:b,proportions:new B,color:this.getUniqueColor(this.getColor(a),a)};this._map[a.getId()]=c},this);if(this._upperLimit==null||this._lowerLimit==null)for(var a=0;a<this._columnCount;a++){var b=0,c=0;this._publishedDatas.forEach(function(d){var e=this._map[d.getId()];if(e.values.size()>a){var f=e.values.get(a);f!=null&&(f>=0?b+=f:c+=f)}},this),this._upperLimit==null&&b>this._max&&(this._max=b),this._lowerLimit==null&&c<this._min&&(this._min=c)}this._initRange(),this._initValuesProportion()},percentValidateModel:function(){this._publishedDatas.forEach(function(a){var b=new B(this.getValues(a));b.size()>this._columnCount&&(this._columnCount=b.size());var c={data:a,values:b,proportions:new B,color:this.getUniqueColor(this.getColor(a),a)};this._map[a.getId()]=c},this);var a=new B;for(var b=0;b<this._columnCount;b++){var c=0;this._publishedDatas.forEach(function(a){var d=this._map[a.getId()];if(d.values.size()>b){var e=d.values.get(b);e!=null&&(c+=e)}},this),a.add(c)}for(var b=0;b<this._columnCount;b++)this._publishedDatas.forEach(function(c){var d=this._map[c.getId()],e=a.get(b);if(e!==0&&d.values.size()>b){var f=d.values.get(b);if(f!=null){d.proportions.add(f/e);return}}d.proportions.add(null)},this);this._min=0,this._max=1,this._range=1},drawRect:function(a,b,c,d,e,f,g){a.fillStyle=b,c&&this._selectInfos.add({x:d,y:e,w:f,h:g,color:this.getUniqueColor(q.darker(b))}),a.beginPath(),a.rect(d,e,f,g),a.closePath(),a.fill()},drawContent:function(a,b,c,d){this._selectInfos=new B,this._toolTipInfos=this.isToolTipEnabled()?new B:null,this._type==="default"?this.drawDefaultContent(a,b,c,d):this._type==="group"?this.drawGroupContent(a,b,c,d):this._type==="percent"?this.drawPercentContent(a,b,c,d):this._type==="stack"?this.drawStackContent(a,b,c,d):this._type==="layer"&&this.drawLayerContent(a,b,c,d),this.drawValueTexts(a),this._selectInfos.forEach(function(b){a.lineWidth=2,a.strokeStyle=b.color,a.beginPath(),a.rect(b.x,b.y,b.w,b.h),a.closePath(),a.stroke()},this),delete this._selectInfos},drawDefaultContent:function(a,b,c,d){var e=this._publishedDatas.size(),f=this._columnWidth;for(var g=0;g<e;g++){var h=this._publishedDatas.get(g),i=this._map[h.getId()],j=b.x+f*(.5+g*1.5),k=Math.abs(c*i.proportion),l=i.proportion>0?d-k:d;this.drawRect(a,i.color,this.isSelected(h),j,l,f,k),this.addToolTipInfo(j,l,f,k,i.value,h);var m=this._getValueTextInfo(h,i.value);if(m){var n=this.getTextSize(m.font,m.text);m.x=j+f/2,m.y=l-n.height/2+1}}},drawPercentContent:function(a,b,c,d){this.drawStackContent(a,b,c,d)},drawStackContent:function(a,b,c,d){var e=this._columnCount,f=this._columnWidth;for(var g=0;g<e;g++){var h=d,i=b.x+f*(.5+g*1.5);this._publishedDatas.forEach(function(b){var d=this._map[b.getId()];if(g<d.proportions.size()){var e=d.proportions.get(g);if(e!=null){var j=c*e;h-=j,this.drawRect(a,d.color,this.isSelected(b),i,h,f,j),this.addToolTipInfo(i,h,f,j,d.values.get(g),b);var k=this._getValueTextInfo(b,d.values.get(g));k&&(k.x=i+f/2,k.y=h+j/2)}}},this)}},drawLayerContent:function(a,b,c,d){var e=this._publishedDatas.size(),f=this._columnCount,g=this._columnWidth,h=g*3/8/e;for(var i=0;i<f;i++){var j=b.x+g*(.5+i*1.5),k=0;this._publishedDatas.forEach(function(b){var f=this._map[b.getId()];if(i<f.proportions.size()){var l=f.proportions.get(i);if(l!=null){var m=c*l,n=d-m,o=j+g/2-g/8-h*(e-k),p=(g/8+h*(e-k))*2;this.drawRect(a,f.color,this.isSelected(b),o,n,p,m),this.addToolTipInfo(o,n,p,m,f.values.get(i),b);var q=this._getValueTextInfo(b,f.values.get(i));if(q){var r=this.getTextSize(q.font,q.text);q.x=o+p/2,q.y=n-r.height/2+1}}}k++},this)}},drawGroupContent:function(a,b,c,d){var e=this._publishedDatas.size(),f=this._columnCount,g=this._columnWidth,h=g/e;for(var i=0;i<f;i++){var j=b.x+g*(.5+i*1.5),k=0;this._publishedDatas.forEach(function(b){var e=this._map[b.getId()];if(i<e.proportions.size()){var f=e.proportions.get(i);if(f!=null){var g=c*f,l=d-g;this.drawRect(a,e.color,this.isSelected(b),j+h*k,l,h,g),this.addToolTipInfo(j+h*k,l,h,g,e.values.get(i),b);var m=this._getValueTextInfo(b,e.values.get(i));if(m){var n=this.getTextSize(m.font,m.text);m.x=j+h*k+h/2,m.y=l-n.height/2+1}}}k++},this)}}}),c.charts.LineChart=function(a){c.charts.LineChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},d.ext("twaver.charts.LineChart",c.charts.ScaleChart,{__accessor:["xScaleLineColor","xScaleLineWidth","interruptable"],_interruptable:D.LINECHART_INTERRUPTABLE,_upperLimit:D.LINECHART_UPPER_LIMIT,_lowerLimit:D.LINECHART_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:D.LINECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:D.LINECHART_XAXIS_TEXT_FONT,_xAxisLineColor:D.LINECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:D.LINECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:D.LINECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:D.LINECHART_YAXIS_TEXT_FONT,_yAxisLineColor:D.LINECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:D.LINECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:D.LINECHART_XSCALE_TEXT_FONT,_xScaleTextColor:D.LINECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:D.LINECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:D.LINECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:D.LINECHART_XSCALE_LINE_WIDTH,_yScaleTextVisible:D.LINECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:D.LINECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:D.LINECHART_YSCALE_TEXT_FONT,_yScaleLineColor:D.LINECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:D.LINECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:D.LINECHART_YSCALE_VALUE_GAP,_yScalePixelGap:D.LINECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:D.LINECHART_YSCALE_MIN_TEXT_VISIBLE,getLineWidth:function(a){return a.getStyle?a.getStyle("chart.line.width"):c.Styles.getStyle("chart.line.width")},getMarkerShape:function(a){return a.getStyle?a.getStyle("chart.marker.shape"):c.Styles.getStyle("chart.marker.shape")},getMarkerSize:function(a){return a.getStyle?a.getStyle("chart.marker.size"):c.Styles.getStyle("chart.marker.size")},_initInfo:function(a,b){b.markerShape=this.getMarkerShape(a),b.markerSize=this.getMarkerSize(a),b.lineWidth=this.getLineWidth(a),this.isSelected(a)&&(b.lineWidth+=2)},validateModel:function(){this._reset(),this._commonValidateModel()},getPointIndexAt:function(){var a=this._getPoint.apply(this,arguments),b=this.tryGetDataAt(a);if(!b)return-1;var c=this._map[b.getId()],d=c.points,e=c.markerSize;for(var f=0,g=d.size(),h;f<g;f++){h=d.get(f);if(h&&l.getDistance(a,h)<=e)return f}return-1},drawContent:function(a,b,c,d){this._toolTipInfos=this.isToolTipEnabled()?new B:null,this._publishedDatas.forEach(function(e){var f=this._map[e.getId()],g=f.markerSize>0?new B:null;a.strokeStyle=f.color,a.lineWidth=f.lineWidth,a.beginPath();var h=f.proportions,i=null,j=h.size(),k=new B;f.points=k;for(var l=0;l<j;l++){var m=h.get(l);if(m!=null){var n={x:b.x+this._columnWidth*(1+l*1.5),y:d-c*m};k.add(n),i==null?a.moveTo(n.x,n.y):a.lineTo(n.x,n.y);var o=f.values.get(l),p=this._getValueTextInfo(e,o);if(p){var r=this.getTextSize(p.font,p.text);p.x=n.x,p.y=n.y-r.height/2+2}g&&g.add({point:n,value:o,data:e,index:l}),i=n}else this._interruptable&&(i=null,k.add(null))}a.stroke();if(g){var s=f.markerSize/2;g.forEach(function(b){a.fillStyle=f.color;var c=b.point.x-s,d=b.point.y-s,e=f.markerSize,g=f.markerSize;q.drawVector(a,f.markerShape,null,c,d,e,g),a.fill(),this.addToolTipInfo(c,d,e,g,b.value,b.data,b.index)},this)}},this),this.drawValueTexts(a)}}),c.charts.BubbleChart=function(a){c.charts.BubbleChart.superClass.constructor.apply(this,arguments)},d.ext("twaver.charts.BubbleChart",c.charts.ScaleChart,{__accessor:["xAxisUpperLimit","xAxisLowerLimit","xScaleLineColor","xScaleLineWidth","selectShadowColor","selectShadowOffset"],_upperLimit:D.BUBBLECHART_UPPER_LIMIT,_lowerLimit:D.BUBBLECHART_LOWER_LIMIT,_xAxisUpperLimit:D.BUBBLECHART_XAXIS_UPPER_LIMIT,_xAxisLowerLimit:D.BUBBLECHART_XAXIS_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:D.BUBBLECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:D.BUBBLECHART_XAXIS_TEXT_FONT,_xAxisLineColor:D.BUBBLECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:D.BUBBLECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:D.BUBBLECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:D.BUBBLECHART_YAXIS_TEXT_FONT,_yAxisLineColor:D.BUBBLECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:D.BUBBLECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:D.BUBBLECHART_XSCALE_TEXT_FONT,_xScaleTextColor:D.BUBBLECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:D.BUBBLECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:D.BUBBLECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:D.BUBBLECHART_XSCALE_LINE_WIDTH,_yScaleTextVisible:D.BUBBLECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:D.BUBBLECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:D.BUBBLECHART_YSCALE_TEXT_FONT,_yScaleLineColor:D.BUBBLECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:D.BUBBLECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:D.BUBBLECHART_YSCALE_VALUE_GAP,_yScalePixelGap:D.BUBBLECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:D.BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE,_selectShadowColor:D.BUBBLECHART_SELECT_SHADOW_COLOR,_selectShadowOffset:D.BUBBLECHART_SELECT_SHADOW_OFFSET,_resetX:function(){this._xMax=0,this._xMin=0,this._xAxisUpperLimit!=null&&(this._xMax=this._xAxisUpperLimit),this._xAxisLowerLimit!=null&&(this._xMin=this._xAxisLowerLimit)},getXMin:function(){return this._xMin},getXMax:function(){return this._xMax},getXRange:function(){return this._xRange},getShape:function(a){return a.getStyle?a.getStyle("chart.bubble.shape"):c.Styles.getStyle("chart.bubble.shape")},getSize:function(a,b){return b},getNames:function(a){return a.getStyle?a.getStyle("chart.names"):c.Styles.getStyle("chart.names")},getXAxisValues:function(a){return a.getStyle?a.getStyle("chart.xaxis.values"):c.Styles.getStyle("chart.xaxis.values")},getYAxisValues:function(a){return a.getStyle?a.getStyle("chart.yaxis.values"):c.Styles.getStyle("chart.yaxis.values")},_initXRange:function(){this._xAxisLowerLimit==null&&(this._xMin>=this._xMax&&(this._xMin=this._xMax-Math.abs(this._xMax)*.1),this._xMin=this._xMin-(this._xMax-this._xMin)*.1),this._xRange=this._xMax-this._xMin},_initXYValuesProportion:function(){this._publishedDatas.forEach(function(a){var b=this._map[a.getId()];b.xAxisValues.forEach(function(a){a==null?b.xAxisProportions.add(null):b.xAxisProportions.add(this._xRange==0?0:a/this._xRange)},this),b.yAxisValues.forEach(function(a){a==null?b.yAxisProportions.add(null):b.yAxisProportions.add(this._range==0?0:a/this._range)},this)},this)},validateModel:function(){this._reset(),this._resetX(),this._columnCount=this._xScaleTexts==null?0:this._xScaleTexts.size(),this._publishedDatas.forEach(function(a){var b=new B(this.getYAxisValues(a)),c=new B(this.getXAxisValues(a)),d=new B(this.getValues(a));d.size()>this._columnCount&&(this._columnCount=d.size());var e={data:a,values:d,yAxisValues:b,xAxisValues:c,yAxisProportions:new B,xAxisProportions:new B,color:this.getUniqueColor(this.getColor(a),a),anchorShape:this.getShape(a)};this._map[a.getId()]=e,(this._upperLimit==null||this._lowerLimit==null)&&b.forEach(function(a){a!=null&&(this._upperLimit==null&&a>this._max&&(this._max=a),this._lowerLimit==null&&a<this._min&&(this._min=a))},this),(this._upperLimit==null||this._lowerLimit==null)&&c.forEach(function(a){a!=null&&(this._xAxisUpperLimit==null&&a>this._xMax&&(this._xMax=a),this._xAxisLowerLimit==null&&a<this._xMin&&(this._xMin=a))},this)},this),this._initRange(),this._initXRange(),this._initXYValuesProportion()},drawContent:function(a,b,c,d){this._toolTipInfos=this.isToolTipEnabled()?new B:null,this._publishedDatas.forEach(function(e){var f=this._map[e.getId()],g=f.yAxisProportions,h=f.xAxisProportions,i=f.values,j=f.yAxisProportions.size(),k=this._selectShadowOffset;this.isSelected(e)&&k>0?(a.shadowOffsetX=k,a.shadowOffsetY=k,a.shadowBlur=k*2,a.shadowColor=this._selectShadowColor):(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,a.shadowColor=f.color),a.fillStyle=f.color;for(var l=0;l<j;l++){var m=g.get(l),n=h.get(l);if(m!=null){var o={x:b.x+b.width*n,y:d-c*m},p=i.get(l),r=this.getSize(e,p),k=r/2,s=o.x-k,t=o.y-k,u=r,v=r;q.drawVector(a,f.anchorShape,null,s,t,u,v),a.fill(),this.addToolTipInfo(s,t,u,v,p,e,l);var w=this._getValueTextInfo(e,p);if(w){var r=this.getTextSize(w.font,w.text);w.x=o.x,w.y=o.y}}}},this),this.drawValueTexts(a)}}),c.charts.DialChart=function(a){c.charts.DialChart.superClass.constructor.apply(this,arguments)},d.ext("twaver.charts.DialChart",c.charts.ChartBase,{__accessor:["upperLimit","lowerLimit","startAngle","endAngle","innerRadius","colorRangeFillColor","outlineWidth","outlineColor","majorScaleCount","majorScaleLineWidth","majorScaleLineLength","majorScaleLineColor","minorScaleCount","minorScaleLineWidth","minorScaleLineLength","minorScaleLineColor","scaleTextVisible","scaleUpperLimitTextVisible","scaleLowerLimitTextVisible","scaleTextFont","scaleTextColor","pivotRadius","pivotFillColor","pivotOutlineWidth","pivotOutlineColor","pivotGradient","pivotGradientColor","valuePosition","colorRangeList","innerDarkerRadius","outerBrighterRadius","selectShadowColor","selectShadowOffset"],__bool:["scaleInside","pivotFill"],_upperLimit:D.DIALCHART_UPPER_LIMIT,_lowerLimit:D.DIALCHART_LOWER_LIMIT,_startAngle:D.DIALCHART_START_ANGLE,_endAngle:D.DIALCHART_END_ANGLE,_innerRadius:D.DIALCHART_INNER_RADIUS,_colorRangeFillColor:D.DIALCHART_COLOR_RANGE_FILL_COLOR,_outlineWidth:D.DIALCHART_OUTLINE_WIDTH,_outlineColor:D.DIALCHART_OUTLINE_COLOR,_scaleInside:D.DIALCHART_SCALE_INSIDE,_majorScaleCount:D.DIALCHART_MAJOR_SCALE_COUNT,_majorScaleLineWidth:D.DIALCHART_MAJOR_SCALE_LINE_WIDTH,_majorScaleLineLength:D.DIALCHART_MAJOR_SCALE_LINE_LENGTH,_majorScaleLineColor:D.DIALCHART_MAJOR_SCALE_LINE_COLOR,_minorScaleCount:D.DIALCHART_MINOR_SCALE_COUNT,_minorScaleLineWidth:D.DIALCHART_MINOR_SCALE_LINE_WIDTH,_minorScaleLineLength:D.DIALCHART_MINOR_SCALE_LINE_LENGTH,_minorScaleLineColor:D.DIALCHART_MINOR_SCALE_LINE_COLOR,_scaleTextVisible:D.DIALCHART_SCALE_TEXT_VISIBLE,_scaleUpperLimitTextVisible:D.DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE,_scaleLowerLimitTextVisible:D.DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE,_scaleTextFont:D.DIALCHART_SCALE_TEXT_FONT,_scaleTextColor:D.DIALCHART_SCALE_TEXT_COLOR,_pivotRadius:D.DIALCHART_PIVOT_RADIUS,_pivotFill:D.DIALCHART_PIVOT_FILL,_pivotFillColor:D.DIALCHART_PIVOT_FILL_COLOR,_pivotOutlineWidth:D.DIALCHART_PIVOT_OUTLINE_WIDTH,_pivotOutlineColor:D.DIALCHART_PIVOT_OUTLINE_COLOR,_pivotGradient:D.DIALCHART_PIVOT_GRADIENT,_pivotGradientColor:D.DIALCHART_PIVOT_GRADIENT_COLOR,_valuePosition:D.DIALCHART_VALUE_POSITION,_innerDarkerRadius:D.DIALCHART_INNER_DARKER_RADIUS,_outerBrighterRadius:D.DIALCHART_OUTER_BRIGHTER_RADIUS,_selectShadowColor:D.DIALCHART_SELECT_SHADOW_COLOR,_selectShadowOffset:D.DIALCHART_SELECT_SHADOW_OFFSET,formatScaleText:function(a){return a.toFixed(2)},validateModel:function(){this._map={},this._valueRange=this._upperLimit-this._lowerLimit;var a=this._startAngle;a!=0&&(a=(a%360+360)%360,a==0&&(a=360)),this._positiveStartAngle=a;var b=this._endAngle;b!=0&&(b=(b%360+360)%360,b==0&&(b=360)),this._positiveEndAngle=b,this._whole=Math.abs(a-b)==360,this._startAngleByRadian=a*Math.PI/180,this._endAngleByRadian=b*Math.PI/180,this._clockwise=this._startAngleByRadian>this._endAngleByRadian,this._angleRange=Math.abs(this._startAngleByRadian-this._endAngleByRadian),this._publishedDatas.forEach(function(a){var b=this.getValue(a);this._map[a.getId()]={data:a,value:b,color:this.getUniqueColor(this.getColor(a),a),angle:this._startAngleByRadian+(this._clockwise?-1:1)*b/this._valueRange*this._angleRange}},this)},validateDisplay:function(a,b,c){var d={x:this._xGap,y:this._yGap,width:b-this._xGap*2,height:c-this._yGap*2};this.drawBackground(a,d);if(this._startAngleByRadian==this._endAngleByRadian)return;var e,f=this._lowerLimit,g=this._majorScaleCount>1?this._valueRange/(this._majorScaleCount-1):0,h=0,i=0,j,k=null,m=null;if(this._scaleTextVisible){k=new B;for(e=0;e<this._majorScaleCount;e++)e==0&&!this._scaleLowerLimitTextVisible||e==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible?(j=null,k.add({text:"",size:{width:0,height:0}})):(m=this.formatScaleText(f),j=this.getTextSize(this._scaleTextFont,m),k.add({text:m,size:j})),!this._scaleInside&&j!=null&&(j.width>h&&(h=j.width),j.height>i&&(i=j.height)),f+=g}this._angleRange<=Math.PI&&(h=Math.max(h,this._pivotRadius),i=Math.max(i,this._pivotRadius)),l.grow(d,-h,-i),this._calcluateCenterAndRadius(d),a.lineWidth=0;if(this._colorRangeList==null||this._colorRangeList.size()==0)this._drawArcGroup(a,this._startAngleByRadian,this._endAngleByRadian,this.getUniqueColor(this._colorRangeFillColor)),this._drawArcOutLine(a,this._startAngleByRadian,this._endAngleByRadian,!0,!0);else{var n=this._angleRange/this._colorRangeList.size(),o=this._startAngleByRadian;for(e=0;e<this._colorRangeList.size();e++){var p=this.getUniqueColor(this._colorRangeList.get(e)),r=o+(this._clockwise?-1:1)*n;this._drawArcGroup(a,o,r,p),this._drawArcOutLine(a,o,o+(this._clockwise?-1:1)*n,e==0,e==this._colorRangeList.size()-1),o+=(this._clockwise?-1:1)*n}}var s=this._startAngleByRadian,t=this._majorScaleCount>1?this._angleRange/(this._majorScaleCount-1):0,u,v,w,x,y,z,A,C;z=this._scaleInside?this._innerRadiusByPixel:this._outerRadius,A=z+this._majorScaleLineLength*(this._scaleInside?1:-1),C=z+this._minorScaleLineLength*(this._scaleInside?1:-1);for(e=0;e<this._majorScaleCount;e++){v=this._center.x+Math.cos(s)*z,w=this._center.y+Math.sin(-s)*z,x=this._center.x+Math.cos(s)*A,y=this._center.y+Math.sin(-s)*A,a.lineWidth=this._majorScaleLineWidth,a.strokeStyle=this.getUniqueColor(this._majorScaleLineColor),a.beginPath(),a.moveTo(v,w),a.lineTo(x,y),a.closePath(),a.stroke();if(this._scaleTextVisible&&!(e==0&&!this._scaleLowerLimitTextVisible||e==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible)){var D=k.get(e);if(D){var E=this.getScaleTextPosition(s/Math.PI*180,v,w,D.size.width,D.size.height);D.x=E.x,D.y=E.y}}if(this._whole||!this._whole&&e<this._majorScaleCount-1){var F=s,G=this._minorScaleCount>0?t/(this._minorScaleCount+1):0;for(u=0;u<this._minorScaleCount;u++)F+=(this._clockwise?-1:1)*G,v=this._center.x+Math.cos(F)*z,w=this._center.y+Math.sin(-F)*z,x=this._center.x+Math.cos(F)*C,y=this._center.y+Math.sin(-F)*C,a.lineWidth=this._minorScaleLineWidth,a.strokeStyle=this.getUniqueColor(this._minorScaleLineColor),a.beginPath(),a.moveTo(v,w),a.lineTo(x,y),a.closePath(),a.stroke()}s+=(this._clockwise?-1:1)*t}this._pivotFill&&q.fill(a,this.getUniqueColor(this._pivotFillColor),this._pivotGradient,this._pivotGradientColor,this._center.x-this._pivotRadius,this._center.y-this._pivotRadius,this._pivotRadius*2,this._pivotRadius*2),a.lineWidth=this._pivotOutlineWidth,a.strokeStyle=this.getUniqueColor(this._pivotOutlineColor),a.beginPath(),a.arc(this._center.x,this._center.y,this._pivotRadius,0,Math.PI*2,!0),a.closePath(),this._pivotFill&&a.fill(),k&&k.forEach(function(b){b&&q.drawText(a,b.text,b,this._scaleTextFont,this._scaleTextColor)},this),this._publishedDatas.forEach(function(b){var c=this._map[b.getId()],d=this._getDataStyle("dialchart.rear.extension",b),e=this._getDataStyle("dialchart.base.width",b),f=this._getDataStyle("dialchart.top.width",b),g=this._getDataStyle("dialchart.radius",b);g>=-1&&g<=1&&(g*=this._innerRadiusByPixel),a.fillStyle=c.color,a.lineWidth=0;var h=l.createMatrix(-c.angle,this._center.x,this._center.y),i=h.transform(this._center.x+g,this._center.y+f/2),j=h.transform(this._center.x+g,this._center.y-f/2),k=h.transform(this._center.x-d,this._center.y-e/2),m=h.transform(this._center.x-d,this._center.y+e/2),n=this._selectShadowOffset;this.isSelected(b)&&n>0?(a.shadowOffsetX=n,a.shadowOffsetY=n,a.shadowBlur=n*2,a.shadowColor=this._selectShadowColor):(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,a.shadowColor=c.color),a.beginPath(),a.moveTo(i.x,i.y),a.lineTo(j.x,j.y),a.lineTo(k.x,k.y),a.lineTo(m.x,m.y),a.lineTo(i.x,i.y),a.closePath(),a.fill();var o=this._getValueTextInfo(b,c.value);if(o){var p=h.transform(this._center.x+g*this._valuePosition,this._center.y);o.x=p.x,o.y=p.y}},this),this.drawValueTexts(a)},_getDataStyle:function(a,b){return b.getStyle?b.getStyle(a):b.getClient(a)},_calcluateCenterAndRadius:function(a){var b=this._clockwise?this._positiveEndAngle:this._positiveStartAngle,c=this._clockwise?this._positiveStartAngle:this._positiveEndAngle,d=Math.abs(this._positiveEndAngle-this._positiveStartAngle);0<=b&&b<90?0<=c&&c<=90?(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width-this._outerRadius)/2,y:a.y+(a.height+this._outerRadius)/2}):90<c&&c<=180?(this._outerRadius=Math.min(a.width/2,a.height),this._center={x:a.x+a.width/2,y:a.y+(a.height+this._outerRadius)/2}):(this._center={x:a.x+a.width/2,y:a.y+a.height/2},this._outerRadius=Math.min(a.width,a.height)/2):90<=b&&b<180?90<=c&&c<=180?(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width+this._outerRadius)/2,y:a.y+(a.height+this._outerRadius)/2}):180<c&&c<=270?(this._outerRadius=Math.min(a.width,a.height/2),this._center={x:a.x+(a.width+this._outerRadius)/2,y:a.y+a.height/2}):(this._center={x:a.x+a.width/2,y:a.y+a.height/2},this._outerRadius=Math.min(a.width,a.height)/2):180<=b&&b<270?180<=c&&c<=270?(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width+this._outerRadius)/2,y:a.y+(a.height-this
._outerRadius)/2}):(this._outerRadius=Math.min(a.width/2,a.height),this._center={x:a.x+a.width/2,y:a.y+(a.height-this._outerRadius)/2}):(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width-this._outerRadius)/2,y:a.y+(a.height-this._outerRadius)/2}),this._innerRadiusByPixel=this._innerRadius>1?this._innerRadius:this._outerRadius*this._innerRadius,this._innerDarkerRadiusByPixel=this._innerDarkerRadius>1?this._innerDarkerRadius:this._outerRadius*this._innerDarkerRadius,this._outerBrighterRadiusByPixel=this._outerBrighterRadius>1?this._outerBrighterRadius:this._outerRadius*this._outerBrighterRadius},_drawArcOutLine:function(a,b,c,d,e){if(this._outlineWidth<=0)return;var f=Math.abs(b-c),g=this._center.x+Math.cos(b)*this._innerRadiusByPixel,h=this._center.y+Math.sin(-b)*this._innerRadiusByPixel,i=this._center.x+Math.cos(b)*this._outerRadius,j=this._center.y+Math.sin(-b)*this._outerRadius,k=this._center.x+Math.cos(c)*this._innerRadiusByPixel,l=this._center.y+Math.sin(-c)*this._innerRadiusByPixel,m=this._center.x+Math.cos(c)*this._outerRadius,n=this._center.y+Math.sin(-c)*this._outerRadius;this._clockwise?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.beginPath(),a.moveTo(this._center.x,this._center.y),q.drawArc(a,this._center.x,this._center.y,c,f,this._outerRadius,this._outerRadius,!1),a.stroke(),!this._whole&&d?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(g,h),a.stroke(),a.beginPath(),a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.moveTo(this._center.x,this._center.y),q.drawArc(a,this._center.x,this._center.y,b,-f,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),a.stroke(),!this._whole&&e?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(m,n),a.stroke()):(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.beginPath(),a.moveTo(this._center.x,this._center.y),q.drawArc(a,this._center.x,this._center.y,b,f,this._outerRadius,this._outerRadius,!1),a.stroke(),!this._whole&&e?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(k,l),a.stroke(),a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.beginPath(),a.moveTo(this._center.x,this._center.y),q.drawArc(a,this._center.x,this._center.y,c,-f,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),a.stroke(),!this._whole&&d?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(i,j),a.stroke())},_drawArcGroup:function(a,b,c,d){this._outerBrighterRadiusByPixel!=0&&this._drawArc(a,b,c,this._outerRadius-this._outerBrighterRadiusByPixel,this._outerRadius,q.brighter(d)),this._drawArc(a,b,c,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,this._outerRadius-this._outerBrighterRadiusByPixel,d),this._innerDarkerRadiusByPixel!=0&&this._drawArc(a,b,c,this._innerRadiusByPixel,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,q.darker(d,20))},_drawArc:function(a,b,c,d,e,f){var g=Math.abs(b-c);a.lineWidth=0,a.fillStyle=f;var h=this._center.x+Math.cos(b)*d,i=this._center.y+Math.sin(-b)*d,j=this._center.x+Math.cos(b)*e,k=this._center.y+Math.sin(-b)*e,l=this._center.x+Math.cos(c)*d,m=this._center.y+Math.sin(-c)*d,n=this._center.x+Math.cos(c)*e,o=this._center.y+Math.sin(-c)*e;a.beginPath(),this._clockwise?(a.moveTo(l,m),q.drawArc(a,this._center.x,this._center.y,c,g,e,e,!0),a.lineTo(h,i),q.drawArc(a,this._center.x,this._center.y,b,-g,d,d,!0),a.closePath()):(a.moveTo(h,i),q.drawArc(a,this._center.x,this._center.y,b,g,e,e,!0),a.lineTo(l,m),q.drawArc(a,this._center.x,this._center.y,c,-g,d,d,!0),a.closePath()),a.fill()},getScaleTextPosition:function(a,b,c,d,e){a=(a%360+360)%360;var f={x:b,y:c};return a==0&&(f=this._scaleInside?{x:b-d/2,y:c}:{x:b+d/2,y:c}),a==180&&(f=this._scaleInside?{x:b+d/2,y:c}:{x:b-d/2,y:c}),a==90&&(f=this._scaleInside?{x:b,y:c+e/2}:{x:b,y:c-e/2}),a==270&&(f=this._scaleInside?{x:b,y:c-e/2}:{x:b,y:c+e/2}),a>270&&a<360&&(f=this._scaleInside?{x:b-d/2,y:c-e/2}:{x:b+d/2,y:c+e/2}),a>180&&a<270&&(f=this._scaleInside?{x:b+d/2,y:c-e/2}:{x:b-d/2,y:c+e/2}),a>90&&a<180&&(f=this._scaleInside?{x:b+d/2,y:c+e/2}:{x:b-d/2,y:c-e/2}),a>0&&a<90&&(f=this._scaleInside?{x:b-d/2,y:c+e/2}:{x:b+d/2,y:c-e/2}),f}}),c.charts.RadarChart=function(a){c.charts.RadarChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},d.ext("twaver.charts.RadarChart",c.charts.ChartBase,{__accessor:["axisTextVisible","axisTextFont","axisTextColor","scaleTextVisible","scaleTextFont","scaleTextColor","axisVisible","axisLineColor","axisLineWidth","axisStartAngle","ringVisible","ringType","ringLineColor","ringLineWidth","scaleCount","scaleMaxValue","scaleMinValue","anchorVisible","areaFillAlpha","areaSelectFillAlpha","axisList"],__bool:["areaFill"],_axisTextVisible:D.RADARCHART_AXIS_TEXT_VISIBLE,_axisTextFont:D.RADARCHART_AXIS_TEXT_FONT,_axisTextColor:D.RADARCHART_AXIS_TEXT_COLOR,_scaleTextVisible:D.RADARCHART_SCALE_TEXT_VISIBLE,_scaleTextFont:D.RADARCHART_SCALE_TEXT_FONT,_scaleTextColor:D.RADARCHART_SCALE_TEXT_COLOR,_axisVisible:D.RADARCHART_AXIS_VISIBLE,_axisLineColor:D.RADARCHART_AXIS_LINE_COLOR,_axisLineWidth:D.RADARCHART_AXIS_LINE_WIDTH,_axisStartAngle:D.RADARCHART_AXIS_START_ANGLE,_ringVisible:D.RADARCHART_RING_VISIBLE,_ringType:D.RADARCHART_RING_TYPE,_ringLineColor:D.RADARCHART_RING_LINE_COLOR,_ringLineWidth:D.RADARCHART_RING_LINE_WIDTH,_scaleCount:D.RADARCHART_SCALE_COUNT,_scaleMaxValue:D.RADARCHART_SCALE_MAXVALUE,_scaleMinValue:D.RADARCHART_SCALE_MINVALUE,_anchorVisible:D.RADARCHART_ANCHOR_VISIBLE,_areaFill:D.RADARCHART_AREA_FILL,_areaFillAlpha:D.RADARCHART_AREA_FILL_ALPHA,_areaSelectFillAlpha:D.RADARCHART_AREA_SELECT_FILL_ALPHA,getAxisCount:function(){return this._axisCount},formatScaleText:function(a,b){return a.toFixed(2)},getAnchorSize:function(a){return a.getStyle?a.getStyle("chart.marker.size"):c.Styles.getStyle("chart.marker.size")},getAnchorShape:function(a){return a.getStyle?a.getStyle("chart.marker.shape"):c.Styles.getStyle("chart.marker.shape")},getLineWidth:function(a){return a.getStyle?a.getStyle("chart.line.width"):c.Styles.getStyle("chart.line.width")},getValues:function(a){return a.getStyle?a.getStyle("chart.values"):null},tryGetDataAt:function(a,b){if(b==null||b<0)b=this._selectTolerance;a.target&&(a=p.getLogicalPoint(this._canvas,arguments[0],1));if(!a)return null;if(!this._areaFill){var c=a.x-b,d=a.y-b,e=b*2+1,f=b*2+1;try{var g=this._canvas.getContext("2d").getImageData(c,d,e,f).data;for(var h=0;n=g.length,h<n;h+=4)if(g[h+3]===255){var i="rgb("+g[h]+","+g[h+1]+","+g[h+2]+")",j=this._uniqueColors[i];if(j)return j}}catch(k){}return null}if(!this._center)return null;a={x:a.x-this._xTranslate,y:a.y-this._yTranslate};for(var h=this._publishedDatas.size()-1;h>=0;h--){var j=this._publishedDatas.get(h),m=this._map[j.getId()],o=l.isPointInPolygon(m.points,a);if(o)return j}return null},getDataAt:function(){var a,b;if(arguments.length===2)a=arguments[0],b=arguments[1];else if(arguments[0].target){var c=p.getLogicalPoint(this._canvas,arguments[0],1);if(!c)return;a=c.x,b=c.y}else a=arguments[0].x,b=arguments[0].y;if(a<0||b<0||a>this._canvasWidth||b>this._canvasHeight)return null;if(!this._areaFill){try{var d=this._canvas.getContext("2d").getImageData(a,b,1,1).data;if(d[3]===255){var e="rgb("+d[0]+","+d[1]+","+d[2]+")",f=this._uniqueColors[e];if(f)return f}}catch(g){}return null}for(var h=this._publishedDatas.size()-1;h>=0;h--){var f=this._publishedDatas.get(h),i=this._map[f.getId()],j=l.isPointInPolygon(i.points,{x:a-this._xTranslate,y:b-this._yTranslate});if(j)return f}return null},validateModel:function(){this._map={},this._axisTexts=new B,this._axisMaxValues=new B,this._axisMinValues=new B,this._axisRangeValues=new B,this._axisCount=this._axisList==null?0:this._axisList.size();if(this._axisCount==0)return;this._averageAngleByRadian=Math.PI*2/this._axisCount,this._averageAngle=360/this._axisCount,this._axisList.forEach(function(a){if(typeof a=="string")this._axisTexts.add(a),this._axisMaxValues.add(this._scaleMaxValue),this._axisMinValues.add(this._scaleMinValue),this._axisRangeValues.add(this._scaleMaxValue-this._scaleMinValue);else{this._axisTexts.add(a.text);var b=isNaN(a.max)?this._scaleMaxValue:a.max,c=isNaN(a.min)?this._scaleMinValue:a.min;this._axisMaxValues.add(b),this._axisMinValues.add(c),this._axisRangeValues.add(b-c)}},this),this._publishedDatas.forEach(function(a){var b=new B(this.getValues(a)),c={data:a,values:b,proportions:new B,color:this.getUniqueColor(this.getColor(a),a),anchorShape:this.getAnchorShape(a),anchorSize:this.getAnchorSize(a),lineWidth:this.getLineWidth(a),points:new B};this.isSelected(a)&&(c.lineWidth+=2),this._map[a.getId()]=c},this);for(var a=0;a<this._axisCount;a++)this._publishedDatas.forEach(function(b){var c=this._map[b.getId()],d=0;if(c.values.size()>a){var e=c.values.get(a),f=this._axisMinValues.get(a),g=this._axisRangeValues.get(a);g>0&&(d=(e-f)/g)}c.proportions.add(d)},this)},validateDisplay:function(a,b,c){var d={x:this._xGap,y:this._yGap,width:b-this._xGap*2,height:c-this._yGap*2};this.drawBackground(a,d);if(d.width<=0||d.height<=0||this._axisCount<3)return;var e=0,f=0,g=0,h=null,i=null,j=null,k=null;if(this._axisTextVisible){k=new B;for(g=0;g<this._axisCount;g++)j=this._axisTexts.get(g),h=this.getTextSize(this._axisTextFont,j),k.add({text:j,size:h}),h.width>e&&(e=h.width),h.height>f&&(f=h.height)}var l=d.width/2-e>d.height/2-f?d.height/2-f*2:d.width/2-e,m={x:d.x+d.width/2,y:d.y+d.height/2};this._center={x:m.x+this._xTranslate,y:m.y+this._yTranslate};var n=null;this._scaleTextVisible&&(n=new B);var o=this._axisStartAngle/180*Math.PI;for(g=0;g<this._axisCount;g++){var p=o*180/Math.PI,r=m.x+Math.cos(o)*l,s=m.y+Math.sin(-o)*l,t=null;n&&(t=new B,n.add(t)),this._ringVisible&&this._ringLineWidth>0&&(a.lineWidth=this._ringLineWidth,a.strokeStyle=this._ringLineColor);for(var u=1;u<=this._scaleCount;u++){var v=u/this._scaleCount,w=l*v,x=m.x+Math.cos(o)*w,y=m.y+Math.sin(-o)*w;if(this._ringVisible&&this._ringLineWidth>0){var z=m.x+Math.cos(o+this._averageAngleByRadian)*w,A=m.y+Math.sin(-o-this._averageAngleByRadian)*w;this._ringType=="line"?this.drawLine(a,this._ringLineColor,this._ringLineWidth,x,y,z,A):this._ringType=="arc"&&(a.beginPath(),a.moveTo(m.x,m.y),q.drawArc(a,m.x,m.y,o,this._averageAngleByRadian,w,w,!0),a.closePath(),a.stroke())}t&&(j=this.formatScaleText(this._axisMinValues.get(g)+this._axisRangeValues.get(g)*v,g),h=this.getTextSize(this._scaleTextFont,j),i=this.getScaleTextPosition(p,x,y,h.width,h.height),t.add({text:j,x:i.x,y:i.y}))}this._axisVisible&&this.drawLine(a,this._axisLineColor,this._axisLineWidth,m.x,m.y,r,s);if(k){var C=k.get(g);i=this.getAxisTextPosition(p,r,s,C.size.width,C.size.height),C.x=i.x,C.y=i.y}o+=this._averageAngleByRadian}this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];c.points.clear();var d=c.anchorSize>0?new B:null,e=c.proportions;a.lineWidth=0,a.globalAlpha=this.isSelected(b)?this._areaSelectFillAlpha:this._areaFillAlpha,this._areaFill&&(a.fillStyle=c.color),this._drawItem(a,e,m,l,d,c),this._areaFill&&a.fill(),a.lineWidth=c.lineWidth,a.strokeStyle=c.color,a.globalAlpha=1,this._drawItem(a,e,m,l),a.lineWidth=0;if(d!=null&&d.size()>0){var f=c.anchorSize/2;d.forEach(function(b){a.fillStyle=c.color,q.drawVector(a,c.anchorShape,null,b.x-f,b.y-f,c.anchorSize,c.anchorSize),a.fill()})}},this),n&&n.forEach(function(b){b.forEach(function(b){q.drawText(a,b.text,b,this._scaleTextFont,this._scaleTextColor)},this)},this),k&&k.forEach(function(b){q.drawText(a,b.text,b,this._axisTextFont,this._axisTextColor)},this)},_drawItem:function(a,b,c,d,e,f){var g=this._axisStartAngle/180*Math.PI,h=null;a.beginPath();for(i=0;i<this._axisCount;i++){var j=b.get(i),k={x:c.x+Math.cos(g)*d*j,y:c.y+Math.sin(-g)*d*j};h==null?a.moveTo(k.x,k.y):a.lineTo(k.x,k.y),e!=null&&this._anchorVisible&&e.add(k),f&&f.points.add(k),i==0&&(h=k),g+=this._averageAngleByRadian}h!=null&&a.lineTo(h.x,h.y),a.closePath(),a.stroke()},getAxisTextPosition:function(a,b,c,d,e){a=(a%360+360)%360;var f={x:b,y:c};return a==0&&(f={x:b+d/2,y:c}),a==180&&(f={x:b-d/2,y:c}),a==90&&(f={x:b,y:c-e/2}),a==270&&(f={x:b,y:c+e/2}),a>270&&a<360&&(f={x:b+d/2,y:c+e/2}),a>180&&a<270&&(f={x:b-d/2,y:c+e/2}),a>90&&a<180&&(f={x:b-d/2,y:c-e/2}),a>0&&a<90&&(f={x:b+d/2,y:c-e/2}),f},getScaleTextPosition:function(a,b,c,d,e){a=(a%360+360)%360;var f={x:b,y:c};return a==0&&(f={x:b,y:c+e/2}),a==180&&(f={x:b-d/2,y:c+e/2}),a==90&&(f={x:b+d/2,y:c}),a==270&&(f={x:b+d/2,y:c}),a>270&&a<360&&(f={x:b+d/2,y:c-e/2}),a>180&&a<270&&(f={x:b-d/2,y:c-e/2}),a>90&&a<180&&(f={x:b-d/2,y:c+e/2}),a>0&&a<90&&(f={x:b+d/2,y:c+e/2}),f}}),c.charts.LegendPane=function(a){c.charts.LegendPane.superClass.constructor.apply(this,arguments),this._divPool=new c.Pool("div"),this._iconPool=new c.Pool("div"),this._textPool=new c.Pool("span"),this._pools.add(this._divPool),this._pools.add(this._iconPool),this._pools.add(this._textPool),this._chart=a,this._chart.addViewListener(this.handleViewChange,this),this._view=p.createView("hidden"),this._view.style.verticalAlign="middle",this._legendDiv=p.createDiv(),this._legendDiv.style.whiteSpace="nowrap",this._legendDiv.style.verticalAlign="middle",this._legendDiv.style.position="",this._view.appendChild(this._legendDiv),this._hiddenMap={};var b=this;this._chart._internalVisibleFunction=function(a){return!b.isHidden(a)};var d;g.isTouchable?d=c.charts.LegendPaneTouchInteraction:d=c.charts.LegendPaneInteraction,d&&new d(this)},d.ext("twaver.charts.LegendPane",c.controls.ControlBase,{__accessor:["iconWidth","iconHeight","iconRadius","rowHeight","orientation","hiddenColor","selectBackgroundColor","selectForegroundColor"],_iconWidth:D.LEGENDPANE_ICON_WIDTH,_iconHeight:D.LEGENDPANE_ICON_HEIGHT,_iconRadius:D.LEGENDPANE_ICON_RADIUS,_rowHeight:D.LEGENDPANE_ROW_HEIGHT,_orientation:D.LEGENDPANE_ORIENTATION,_hiddenColor:D.LEGENDPANE_HIDDEN_COLOR,_selectBackgroundColor:D.LEGENDPANE_SELECT_BACKGROUND_COLOR,_selectForegroundColor:D.LEGENDPANE_SELECT_FOREGROUND_COLOR,onPropertyChanged:function(a){this.invalidate()},getChart:function(){return this._chart},isHidden:function(a){return this._hiddenMap[a.getId()]!=null},handleViewChange:function(a){a.kind==="validateEnd"&&(this._invalidate=!0,this.validate())},validate:function(){if(!this._invalidate)return;this._invalidate=!1,p.release(this._legendDiv),d.keys(this._hiddenMap).forEach(function(a){this._chart.getDataBox().containsById(a)||delete this._hiddenMap[a]},this);var a=new B(this._chart.getUnfilteredDatas());for(var b=0;b<a.size();b++){var c=a.get(b);!this._chart.isVisible(c)&&!this.isHidden(c)&&(a.removeAt(b),b--)}var e=a.size(),f=this._view.style,g=this._orientation==="horizontal";g?(f.textAlign="center",f.height=this._rowHeight+"px"):(f.textAlign="",f.height=this._rowHeight*e+"px"),f.lineHeight=this._rowHeight-2+"px";for(b=0;b<e;b++){var c=a.get(b),h=this._divPool.get();h._data=c,h.style.cursor="pointer",h.style.height=this._rowHeight+"px",g?h.style.display="inline-block":h.style.display="block",this._legendDiv.appendChild(h),this.renderLegend(h,c),this.onLegendRendered(h,c)}this._pools.forEach(function(a){a.clear()})},renderLegend:function(a,b){var c=!this.isHidden(b),d=this._chart.isSelected(b),e=this._iconPool.get(),f=e.style;f.display="inline-block",f.verticalAlign="middle",f.marginLeft="4px",f.width=this.getIconWidth()+"px",f.height=this.getIconHeight()+"px",c?f.backgroundColor=this._chart.getColor(b):f.backgroundColor=this.getHiddenColor(),a.appendChild(e);var g=this._textPool.get();f=g.style,f.paddingLeft="2px",f.paddingRight="4px",f.display="inline-block",f.verticalAlign="middle",c?f.color=d?this._selectForegroundColor:"":f.color=this.getHiddenColor(),g.innerHTML=this._chart.getName(b),a.appendChild(g),c&&d?a.style.backgroundColor=this._selectBackgroundColor:a.style.backgroundColor=""},onLegendRendered:function(a,b){}}),c.charts.ChartPane=function(a,b,d,e){c.charts.ChartPane.superClass.constructor.apply(this,arguments),this.invalidate(),this._chart=a,this._legendPane=new c.charts.LegendPane(a),this._titleDiv=p.createDiv(),this._titleDiv.style.verticalAlign="middle",this._titleDiv.style.whiteSpace="nowrap",this._view=p.createView("hidden"),this._view.appendChild(this._titleDiv),this._view.appendChild(this._legendPane.getView()),this._view.appendChild(this._chart.getView());var f=this;this._legendPane.addPropertyChangeListener(function(a){(a.property==="rowHeight"||a.porperty==="orientation")&&f.invalidate()}),arguments.length>1&&this.setTitle(b),arguments.length>2&&this.setLegendOrientation(d),arguments.length>3&&this.setLegendWidth(e)},d.ext("twaver.charts.ChartPane",c.controls.ControlBase,{__accessor:["title","titleHorizontalAlign","titleHeight","legendWidth"],_title:null,_titleHeight:D.CHARTPANE_TITLE_HEIGHT,_titleHorizontalAlign:D.CHARTPANE_TITLE_HORIZONTAL_ALIGN,_legendOrientation:D.CHARTPANE_LEGEND_ORIENTATION,_legendWidth:D.CHARTPANE_LEGEND_WIDTH,getLegendOrientation:function(){return this._legendOrientation},setLegendOrientation:function(a){if(this._legendOrientation===a)return;var b=this._legendOrientation;this._legendOrientation=a,this.firePropertyChange("orientation",b,a),this._adjustLegendOrientation()},_adjustLegendOrientation:function(){this._legendOrientation==="left"||this._legendOrientation==="right"?this._legendPane.setOrientation("vertical"):this._legendPane.setOrientation("horizontal")},onPropertyChanged:function(a){this.invalidate()},getTitleDiv:function(){return this._titleDiv},getChart:function(){return this._chart},getLegendPane:function(){return this._legendPane},validateImpl:function(){this._adjustLegendOrientation();var a=this._view.offsetWidth,b=this._view.offsetHeight,c=this._legendPane.getRowHeight(),d;this._title&&this._title!==""?(d=this._titleHeight,this._titleDiv.innerHTML=this._title):(d=0,this._titleDiv.innerHTML=""),this._titleDiv.innerHTML=this._title?this._title:"",this._titleDiv.style.textAlign=this._titleHorizontalAlign,this._titleDiv.style.lineHeight=this._titleHeight-2+"px";var e=this._titleDiv.style;e.left="0px",e.top="0px",e.width=a+"px",e.height=d+"px";var f,g;this._legendOrientation==="bottom"?(f={x:0,y:d,width:a,height:Math.max(b-d-c,0)},g={x:0,y:Math.max(b-c,0),width:a,height:c}):this._legendOrientation==="right"?(f={x:0,y:d,width:Math.max(a-this._legendWidth,0),height:Math.max(b-d,0)},g={x:Math.max(a-this._legendWidth,0),y:d,width:this._legendWidth,height:Math.max(b-d,0)}):this._legendOrientation==="top"?(f={x:0,y:d+c,width:a,height:Math.max(b-d-c,0)},g={x:0,y:d,width:a,height:c}):this._legendOrientation==="left"&&(f={x:this._legendWidth,y:d,width:Math.max(a-this._legendWidth,0),height:Math.max(b-d,0)},g={x:0,y:d,width:this._legendWidth,height:Math.max(b-d,0)}),f&&this._chart.adjustBounds(f),g&&this._legendPane.adjustBounds(g)}}),c.charts.ChartInteraction=function(a){this.chart=a,this.canvas=a._canvas;var b=this;this.canvas.addEventListener("mousedown",function(a){a.button===0&&b.handleMouseDown(a),a.preventDefault()},!1);var c=g.isFirefox?"DOMMouseScroll":"mousewheel";this.canvas.addEventListener(c,function(a){b.handleMouseWheel(a)},!1)},d.ext("twaver.charts.ChartInteraction",Object,{handleMouseDown:function(a){this.chart.isFocusOnClick()&&c.Util.setFocus(this.canvas),this.lastPoint=this.chart.getLogicalPoint(a);var b=this.chart.tryGetDataAt(a);a.detail===2&&b==null?this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0)):(this._startLogical=this.lastPoint,this._startClient=p.getClientPoint(a),p.handle_mousedown(this,a))},handleMouseMove:function(a){if(this.lastPoint){var b={x:this._startLogical.x+a.clientX-this._startClient.x,y:this._startLogical.y+a.clientY-this._startClient.y};!this.startPan&&l.getDistance(this.lastPoint,b)>3&&(this.startPan=!0,this.lastPoint=b),this.startPan&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+b.x-this.lastPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+b.y-this.lastPoint.y),this.lastPoint=b)}},handleMouseUp:function(a){if(!this.startPan&&a.detail===1){var b=this.chart.tryGetDataAt(a),c=this.chart.getSelectionModel();b?d.isCtrlDown(a)?c.contains(b)?c.removeSelection(b):c.appendSelection(b):c.contains(b)||c.setSelection(b):d.isCtrlDown(a)||c.clearSelection()}delete this.lastPoint,delete this.startPan,delete this._startClient,delete this._startLogical},handleMouseWheel:function(a){p.preventDefault(a);var b=g.isFirefox?-a.detail:a.wheelDelta;b>0?(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()*1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()*1.1,!1)):b<0&&(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()/1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()/1.1,!1))}}),c.charts.ChartTouchInteraction=function(a){this.chart=a,this.canvas=a._canvas,p.addEventListener("touchstart","handleTouchstart",this.canvas,this)},d.ext("twaver.charts.ChartTouchInteraction",Object,{handleTouchstart:function(a){p.preventDefault(a),this.chart.isFocusOnClick()&&c.Util.setFocus(this.canvas),this.endPoint=this.chart.getLogicalPoint(a),w.isMultiTouch(a)&&(this.distance=w.getDistance(a),this.xZoom=this.chart.getXZoom(),this.yZoom=this.chart.getYZoom()),p.addEventListener("touchmove","handleTouchmove",this.canvas,this),p.addEventListener("touchend","handleTouchend",this.canvas,this)},handleTouchmove:function(a){if(!this.endPoint)return;var b=this.chart.getLogicalPoint(a);!this.moved&&l.getDistance(this.endPoint,b)>10&&(this.moved=!0,this.lastPoint=b);if(!this.moved)return;if(w.isSingleTouch(a))this.endPoint&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+b.x-this.endPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+b.y-this.endPoint.y),this.endPoint=b);else if(this.distance){var c=w.getDistance(a)/this.distance,d=this.xZoom*c,e=this.yZoom*c;this.chart.isXZoomEnabled()&&this.chart.setXZoom(d,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(e,!1)}},handleTouchend:function(a){if(!this.moved){this.endPoint=this.chart.getLogicalPoint(a);var b=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;b?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date);var c=this.chart.tryGetDataAt(a);if(b&&c==null)this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0));else{var d=this.chart.getSelectionModel();c?d.contains(c)||d.setSelection(c):d.clearSelection()}}delete this.endPoint,delete this.distance,delete this.xZoom,delete this.yZoom,delete this.moved,p.removeEventListener("touchmove",this.canvas,this),p.removeEventListener("touchend",this.canvas,this)}}),c.charts.LegendPaneInteraction=function(a){this.legendPane=a;var b=this;this.legendPane._legendDiv.addEventListener("mousedown",function(a){b.handleMouseDown(a)},!1)},d.ext("twaver.charts.LegendPaneInteraction",Object,{handleMouseDown:function(a){if(a.button!==0)return;var b=a.target._data;b||(b=a.target.parentNode._data),b&&(this.legendPane._hiddenMap[b.getId()]?delete this.legendPane._hiddenMap[b.getId()]:this.legendPane._hiddenMap[b.getId()]=b,this.legendPane._chart.invalidateModel())}}),c.charts.LegendPaneTouchInteraction=function(a){this.legendPane=a,p.addEventListener("touchstart","handleTouchstart",this.legendPane._legendDiv,this)},d.ext("twaver.charts.LegendPaneTouchInteraction",Object,{handleTouchstart:function(a){p.preventDefault(a);var b=a.target._data;b||(b=a.target.parentNode._data),b&&(this.legendPane._hiddenMap[b.getId()]?delete this.legendPane._hiddenMap[b.getId()]:this.legendPane._hiddenMap[b.getId()]=b,this.legendPane._chart.invalidateModel())}}),function(){var a=function(a,b,d,e){var f=document.createElement("img");f.src=e,c.Util.registerImage(a,f,b,d)};a("subnetwork_image",64,46,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAuCAYAAACYlx/0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB1JJREFUeNrkWmtQk1cafr4vUQhEiNeBpkWwXitCqK1WaiU4tCMjlmCnrU4rmE4v2v1Rmf7q7M6is/uj7e4OurMz7fSyiXXVddsasBa0xQawoqiFFPBWJATkVpQSLPdLTt/zkTCgSHVNuISXeZLvnC8JeZ7zvu8578kBRs/UhB0EE6GZwIaBmbCToIEXWSjBcAfCI4GLoZ3QzIX+0RwgpYnUsPT0dGY2m5nDwYagqKiYGQwGlpiYeKsQJvoc1UQjriKYCYwjJiaG5eScYN09fXeF8qsVLDk5hbneT2gWJkpYyARBJQpCMYFNV6nYRx9/wtq7uv8vnD57jkVGRjL+WYRmgsYDg+U+U0ydoiJvNpPjagICA2E6moVlERH39Zkt9hboEuJxobSUN+2iKMR2dPdYxkSAQD+FhoJSxxiLAY9LNsgtBeS6+qYFBuC/piNYGr7MLV/yZksLXkx6FpfKynjTRiJEtbR32EdFgNmB01REeAdjSHFm9N8146Ev8fgTq9zqqr/evImN8XGoq6nhzd1Nv7amelwA9awZOsrQBjizsHLaNCxf8YSEhUseue0L/nT5IgICArAp5RWP5Jeis2fwxpbN0jX3gtobv1g8IkCYOkjFiDiNvI63gx5QQ7/tD1i9Ng5KZcCYJtl3095BdqaJf3NjVX2j3u0CLA4LUTkcDjNzxvfLr24jbIdDmpLH3q7X1yMlKb5/xpGJSTwxOm9ZLldW2+9LgIhF8/vJ05zr76/EO399H0siHh1vawykvf0mSi1Fw9220/1cQRDyCBklV67a7kmA5eFLTNzt/ZVK/Ond3VCHPjwu1xqWwlM4lvnFQLvKehVtra23kyMRKFfsOVdyMfd3BYheHrmV3J4nPPz57/9CcEgoxqsRMdBADbRFQaQ+4HJZCWqrrDhtzkG1zTr49UZC6qnzxfZhBVj75EqVo89RybN9/MZNWLvhuYldg5AaDTVVOPnNURTmmwfCQxTF2O8KCi23CbBO+xQVLSxt+szZSP3LP9DrcHhFGSrQX431CrI/34+6a1VOcUR9tjnfOESAxHVxvD5XPbtZjwWRj8HbzNHTjexDeylELM41hBhlyvpGagibdBv40tYUOGMmknf8ET19ffBGk4si8r76H0rPF0rhIJPJww4czrDLfXx9+bqeprsodHR1w1utF31YGZeAlqYbaGyo4yvbdIJe2KZPLuZbUNoNz2O6ei683dqbfsbxz/e5QiFMrlD4SSs+1aw5cHhJ8hvJlLOCMG/hYtRfq+YZ8C25r59CujHVz9+rQ8Bl3TTIcxeHo7npOp8BtHI/Ig7XBhzDpDDV7GA4eWvkhn37pc650esmRQg4Yx8u3nJrZaV00dbZjclkLt5yV0e1tRwPjtPix6PrA14+0rO2zlaBkHkLJgXpcloROqtAO/eAPC5AydkCPBkXPykE4FydlivnNTOpkVZCNXZXZwf8/JXevRBqa8UZ83EqoQU+8+2V0UODzxS5TibKgnx8fLAoQiOVk96KzH2foOJCKWSiYOvpc2yXkuAUuXwP3TaczMrA07oXoPBSL+Be/n1WJqbK5TT6LLWzpxcyaXXU22tRKnx1zNEbdL2uBo89tVZyEW9CXVUFDO/vAnHkW+pGe1vHe0O2xIJUARpBFHlhhKSt27AmYaPXjHz+14dhMnzY32Ast765JdZ1T+a6aO3sapih9K+Sy2S68pIizJwTBHXo/Akd7/XVVhz453sozMmmmBe5Jxhrm5qTht0Uddl8dbCB3ruVX6+O1yFhy2sTbsQvnj+D77MzYb1UMtDHHCz1al3D7mE3RW+1R8JC0klBfpwFwSFhWP/yqwijCmpckCsqRENVJYLnhsGXCprO9jbUU7ujvRUN1ZVEumzI6xljRsKuS7ZrtuH3De9gkQvn6URBHPhdMJQEWPVMAhZHrRgz8vYbjfgg7W2J9EhGGd5GDxlEfM+P5VbbyBunI9jjSxepyBO4N2wd3B+6aCkio7USRss6O9rw2d92oqF/IG1E7lZiedTH9/1zz124ctc/mt7V+YBoTXgoifAWQUcIdfVvSNmOiFVrRkWAr/Z+iJLTeZIjUNkedaq41OaOz73nEyKxK5drnGJIXrF+y+tYtnK1B0e+HSe+3I/SMyelNidvLvxhbE6IDLb4mGiDS4SlK1YjVrcZvgo/t5JvrK3GsYOfSs/95Jn+WH6B0Z3/477OCCU+rd1JIqTx68AZs6DVbcKCcI0bRr0DRfnfouD4kYH8RyMfeyQnz+JuD7vvQ1LPr39GSyIYXLlhzgMP4dE1cZIQ9+oRLb/cQNm5Avxw8gS6yPWd01gukdd/kfWtzRMh5pZTYi/p1vPZYoczNwwcapxPIoQ8vFASZY76IRJEMeR9P9fWSESvVfyE8rJiNNbVDJ6/eabf9R/TUSM8aG49Jqd/IUkliiIXImXwbHEvRqQtNOJ7/n3osEeJe0SAwbY9ebOGxOBnjGKcYtxJEAsnTfiRkPHBZwdtGEX7TYABAPgBTYK366ChAAAAAElFTkSuQmCC"),a("bus_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAINJREFUeNqkU0EOgCAMo2Y/1P8Y/6NvnBADwTnGzHYiGetKW8DMKVJLChbVAwCNCrrzp5/Zg/4MaH0JMBOEh08o6OtxtgvXvkFuV/vFBeGEm0WZo8GgF+QlIkI2OrZq5WLAFjuy4DvVWXHl2VodyElMjkxAJNFm4EjmFGAqLKLf+RZgAKkFNRwzv7gHAAAAAElFTkSuQmCC"),a("data_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAMZJREFUeNqkU8ENwjAM9KEwWwaAKVA3iMQDtRtUTAEDdLZWMkkhIUljU4n7RInP9p3dgoiYBAzDgHAyfykA1rtzbr2bmpDDk5uBvu+ROO98pvs4FqRL10nCogokBS3UBaXCZg9JQ7JQY5qmZoK1trCQCuQJnoS9CsQZHKsNcOyWvS1ehdGqz8xyZ0BXEHG+PTdvj+uJkFsASsusdN5sQSKHGWgWfDxY1GcQfEIYIn4p+HuN+SqXRtL8+ZAOinwm5V+P8ZcAAwC0T1T5kpEqewAAAABJRU5ErkJggg=="),a("databox_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwMjI+N/BiIBUD0jMp8FpDm4cQ2DvYEiw8EL9/FqBqkBqUc3BGT7/0kbz/6HsXHhS/eewtWBXA7CYAMOX75PlCEgA9ANYYQaADbJVleRAShJ0Csw7+T5G2MaQCpgQReAuQAWqPhokAuYGCgEowZQwwBQuiYn/mGAEZaeYTkSlA6IBeCUCDMA2RBSsjZAgAEAOyp6/CYHWkwAAAAASUVORK5CYII="),a("grid_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFdJREFUeNpi/P//PwMlgImBQsACIhgZGUl2BtDljCguAHkFhIMb1xBkU9ULjCATQV4A2UAsWFsfAvcCzEn/YQBoEEE2VD1Y76gXhpcXyM0LjJRmZ4AAAwCoyOJjz29PsAAAAABJRU5ErkJggg=="),a("group_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOFJREFUeNqUUwsOwjAILa67i2fwEMbEnUej55mJO4Rn8DBtglAh6YfOSdJkBfregwEgottiHiAlQuZjh68TQRJzI5L07nSbC//zOrUAmkxAJXBP2VgxRjpDK818z06gZIwrfSACF0iVVZrLiab7ownOl7PTV0QESsRgWqoHt80oD0fpy/BVhuZfsOpkC8LYxAkBw4YedOdDhuRny1UyZEPE334NvbZ6kBYeJGFPKFgp4HsUAqtI9u1AYipJgfQ+GjtQlPvPMkGlBHrLdFjeBeHruE+hYAxSo6C3jb4zyh8BBgBVL19PZ27iaAAAAABJRU5ErkJggg=="),a("group_image",32,29,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAdCAYAAADLnm6HAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABHNJREFUeNqsV1ts21QY/uy4zc1ZnZY2bdbSLMlKxUWkaBJMgJY9gARIax/2NokVofLARWjiBYRY2QMdCGlI440H1ok3btsQ0wAxNdvKpnYdyyYK7UZHVK1L2rRZLo3j2InDOaZD60psp+WXrDjO93/nO7/PfwkDAwu0Nh8jH30wZwc6/f43X9jVJ5gBn/zueJozgaNkUXLtMwLyLt4XDG4Vtj+/B8lMQRf7QLsb079PCpzJnaVnEsmIEeiZgD/Mu5yYT4uYiWd1sW1NTlCsWQGmzC00gOd5lFQVkqLoYiuViobVBNzf3BRaCfUaUyuV2AomXI1sNrmkRUeUZBRlBXJJRVFRdQUoZVXDclvbvUeImn6j3VmAqpjg5ra0xcL2nDwdwW1JQeP2HJLLki7frVQOo+OXwNnttv5fp65vKPSvvLhHmBgf77fV10XqWBaLZPGEgYC0KIFiOYfdBoY8OH72D8QS6ZoX3x1+CFarFZSnxS1gk9OBeUJ+00BAimAolnM6nQDDEDVAHVOpWQBD/Ow2GyhPoyDHWKjYkr+GVrv+GWBmE6BYIsChRYCz0Kt2AWR92GxWUJ7TFy7GWltb9l368ZteM77lcukE53A4tC91VAC7jggwVIANd3h+OHM+Qlj2ktvQv9U0EIAkSZibm7vbNUpcIxxPQsfQV2BhwDHrE2C320F5qPnaPCMkdVel9EdDQ8iLeex/5+27H4dYljnGnRo5B1EUMT1fwI2lUs0CHs9JOD9xGeNjY9i7u9dXkKTovZgvv/j8H+y2njX+3FxiHmKhgHiGhCir1CwgKxawsLgEynP06xO0aO2sxV+rhAopm9migrRUuwCJVDMS8nXXEE2ALMtIF2UskVJaqxWIgIqqrl8ATUGFkNDaLKu174RGjzYWykO9A17P+6pa2WEqhVnmDOfmnUgmk+gN2vBsZ33NAng1DxspIpTH1+H1Pdrz2OCHn34GpaQfFYe1Dm+9+nKY62jzpIcG3xU20gukXAZtzU0Rkoo+mo6/TMZxI6E/Dzz9sFdLXc7jad6pSIW+jQho2OSKjl2djOyiAwmdB8jrLMj6Ka3emQd+Gh2jeUvTp7/aTGBgwyv+cJNm5HLx2plQSmX9AkYuiuXqOUuorKoj1RZ/7fU34PcHMLj/PSwv5/4LMsgy7EtKuTz887kLyMoq7CERi/miroD5TB4Xr/wGrsPT8omqqlV3PjAwgIYGAd9/+xVmrledG46QjhiZjs0iSYtSehk3M6KugAUigGK5rqA/rAc89MEBOJy81qq7u4LVJyYL27eYSkV50hkXxCLmDCKQIhiK5do3e3VL59TUNdrZ0N3dddTgLMQ89zX5XKQtP+m14kGB1QVv4VVMrIwCRn9M6PkAGctN1fjnwk9ddjc2hcxgb6eWov/rWE7tVGS0ZyWjfEYRoxlkVoBAIhE2gYst5vKDpVJ51QR96PBhxONxfHzw4Oo+wFl2mBFAJ1W6+IgR0OGwD2/zda4Z32/99ScpTiU80fPIvT/1/y3AAMOmtJl1Hv9IAAAAAElFTkSuQmCC"),a("link_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHVJREFUeNqkkwEOgCAIRaEr6nlqdR49I4XTzcqUn39jE5xP1C+LCPkjCl0Kq2NC5fYgRXlMSCw0K6Xozhqaol3ckj+QVwGFNIsI5HPCCunSLZDhGUcQ0033IOb3riE1CLJty/bTVubUBqDyc+Pm01oY8NQpwAAbUwhLBQIWcAAAAABJRU5ErkJggg=="),a("linksubnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAU5JREFUeNqUUi1Tw0AQ3cukEY0AwdlDM8XRD41ARAAi/RHoCmQ7/QNofkTQFQh8W9kOOtgiQIBImTnuXbs3udAvduZms5t9b/fdrUiHGW2z0cOdLsdJ71GU46yfUrgL/PWx8HLxsUTOI3EE98mp9ZdXie0K8HgydYXtVtN6znHsTQAwdy2DOcY/TMFytkqogqskLIf6qQhYL7q/PI8cOIoiiuO69bvIRf3o5M/YANVqIZ03GjSbz2m5/KGiKDxgp90irbUINzEz2BSQEMKSwJiEwfgONmlFR4AAhg2yV0talWNfAbfJN4s7KHcCCcBPgy7WhobdM7q9uXbd3TPyhvEOwL4/30kpRVJKwrYySZ7nWABlzpsthM49R5lzYUhAruERr/P7CdZNPJJVakUiuOgAw9jSXOyUX8f4ZkCHGzQvAGIw4v9M4E0CMEh/BRgAwM37IYxGnbkAAAAASUVORK5CYII="),a("node_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAGBJREFUeNpiZGBg+M9AJvj//z8jC5RBsmZGRkYwzQITCGlaS7TmNXXBcDYTA4Vg1IDBYAAjJB2Rl5DgKRGWqshyATm2o3uBgcwMBbacBZdmZJfh8CJIASMLodxGCAAEGACTAB0gDBYjygAAAABJRU5ErkJggg=="),a("node_image",30,32,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAgCAYAAAAFQMh/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAO0SURBVHjavJZJaF1lGIaffzzn3pvbxAyYJulgNKJIF7WkuhEHFCy40LpRBLdFcFi4ciOCC9dmU910WbduBEEoRhFEarJw2UaLJXFImya5ubln+AcX5+YG3ZjCaT44cDb/+5zv/Ybzi7npo7Mhhi+886c5hFBaLUshX9dKq8tW2bPjExOHweXW+vpZ7/1lrZWanz52jK+//f5QwC8+8xSrN2/Oa2OM10pJgKwoWd/cRQpRKyzEyMRIk9QatFIYY7xOEou1BoD1zS6ff/kTqbW1grtZyVsvz3N8cgRrDUli0dZabB+kpGSkYdHWUGfOSkT6prLH04m1GFOBBaAkKBkQsU5wACpBYyyJtfSt1hVYVGDZf68rpNjXs1b3rU72rZaAlhFJRMj6wJUm+1bv1diYqrmEFCgJQtaf8Z6gMaaqcbPRpJGmgxprCYhYK1iL/YwbaUqz0UTneUFeusG8uRARNYPLEAn95spLR54X6K+uLDI1NQ3A7e0ey3+UtBJDnfO004vc6WRMjg3zzeIPrK2toje3O6StLWII7GYFt7qOPNS7uTo9x25WEENgY2uLze0Oem9xhOBwwZM5j3WyVnDmPC54QnAoWWlrgBgj3nuc9+yWHq3rBe+Wlbb3nhjjPhiowM7TdQ7t6rW66xzOVeBBpw/AzlM4z3bpkTVnvF1W2t79B1xZXVI4x3bpUfcE7PC+/LfVUgic80giY6lhJDG1gmUESawY/QWhG0aLxBh2dnoMqcBrpyawNWdcuMCQCuzs9EiMoWG00GPDR2QrMVxdWqIsch5L1cCOukJowerKn/x9M6GVGMaGj0hx+uEHrypjzzwwN0cI4Z7et6SU/HbtGr4sftbNVvN9a5NP1m78elpK6a0x9wRalCUhBNUeai0Xhf5ASykXh4fbbxo9+nin2y2v3/i9B3jq29YRUA+dPN5ot1qmdOXS7dvldfHIiRky5wBJt9djfePONHA/4Or6KwJ/TYzet9pqNIBAqjVianSEtY1NgCeBd4FTQBuoq+AS6AC/AAvAj1OjIzAzPoqS8pyAFQHx/x4gzs7OxosXP4ufLizEkydORA5wrv+sKCnPzYyPooFHh5vppQiTB/n8PMt47523Of/qebIsY7fT4eOPPiRJkoMcnxVwCXhOH2kPXWi3WpMH7s48J5Ql1tpq3p3j6Pj44MJ4gJgUUlwQzz5xpgMMHbhFYyRNU55+/gWC93x35Qp5niHu7q60I9545aUeoO5qPkJAqupICOFuoQD+nwEAIKWd899qAZAAAAAASUVORK5CYII="
),a("shapelink_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIJJREFUeNqkUwsOgCAIxeYN5Ty1Og+ekUarzRwQ5tsYDpTPExIzgwY86uWgtSTwIAF6KTvxg/sMliwwCy27mEVr2Xu7+TjaWm4JqxvKpW/iWowQprX2i8RXhS0xXv+WL0xiKIAVxKssa/0hEMuPiB4epNFxnh7lZG1jdCPdABGcAgwAc06H0rgwLSIAAAAASUVORK5CYII="),a("shapenode_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAI9JREFUeNq0UtsNgDAILI0jdZN2Ho3O027SnRA+MNb0QTWS8EPuLncAIKL5UvY5CEdC7h7pjrEtEABgqwucRCBFk7aAfo9uZJtwmXhQCLDyLJlrkSxaMuGgu8QZ8hVhYD8LVgZx9fMO1H9QKXbm+EJvBYwsuSYyFaEmUvyBUkQWCYUDfg5NV8/49xW6dQowAIJydCoPajIHAAAAAElFTkSuQmCC"),a("shapesubnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATBJREFUeNpiDG5cw4ALbO/L+I/M9yyawYjMX1MXzMCCT/PXD69RxLgFREFiKIbADSjzlAfTjq6eYFtBmk+dPgNXaGZqAqZhYjA+igtAmmG2ImuG8UFyIFfAvIPTC+ia0Q2BeYehLpiRCeZfkO37d2/HqRmX4Yxc/CJwZ9+6fYeBEPjw4QOYNjczZfj//z8j3AuMjIjAvXnrNoomdTVVFDkonxEjEIEmgg1C1oAuhw5YQKEZGhHzH9kVbcuPoiiqirSGy5UUF8FtBwFwIK5esYQRaIMfyE/Y/A0yEGbopk2b/FACEeQ0mO1Ati+UvQndFciuAVkG5W5GMQDqV1+QAci2oxuAFC5+4MCBGQIzAEKBBbFimBxILc7MhOQiPzTxTcixwYhsOxLwRWJvxicHEGAAkPKxzyGuYWgAAAAASUVORK5CYII="),a("subnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOJJREFUeNqkUjsOwjAMzavSBQYY4FDM7SGYOUARHICZQ5SBiUPBAAMLIJk8aFASkoDgSVFlu/68Z6NatCqF3Woqrj2ZreHabVMpnUs+H/eerz8c0+cV0amuTK6XG69bDEWsa5hM0KafU/DZeJRCmBwWsXRUUwEU0Y5tRFLfgHRMARYDeoPRSyy383Zee0nsgO5rcROBzo19FUlOoYG0Bp/0IAW7y4LHQT5GB/UL4F6ie3mX0yFLoTQUTByQxE8lQ51wMRHx1Chd4FtkReQUj3VFktj97ZSDNYkK9h6L/03hLsAAjRx4oMVjqkMAAAAASUVORK5CYII="),a=function(a,b,d,e){c.Util.registerImage(a,e,b,d)},a("expand_icon",16,18,"data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrnK5MbGxsbW69jh8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhfAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNDjgi8GgQ40YGCwyQLDjAAYCXL1UeFBAS5QIFBVYSFMBxwU0EOWcyUIDAQIGjOgcegMnUYsOnUKMiDAgAOw=="),a("collapse_icon",16,18,"data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrXI48bGxsbS59Te8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhhAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNADgq8GgQY0YADBYYIFlwgAMAMGGuPCjAAUcACxQUYElQAMcFABQg2EmTgVADBZLyHHggplOLDaNKnYowIAA7"),a("close_icon",11,11,"data:image/gif;base64,R0lGODlhCwALAIcAAHd3d319fUD/QIODg4iIiI6Ojq6urri4uNnZ2eHh4eTk5Ofn5/Dw8PT09Pj4+Pn5+fz8/P39/f///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAIALAAAAAALAAsAAAhdAAUIOECw4AGBAyUoXCjh4AEJDBA4mIiAQcMDERAUKOBgI4IIBCE0IECSZAMIBB8wYDCg5coHBBkkCECTZgIGMQ0AAKBgpwGcBxgsMLCgKFGcA1cqXXlQoMGCAgMCADs="),a("sort_desc",9,5,"data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMDI4QYrnC0INxUnYLADs="),a("sort_asc",9,5,"data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMlAWnwIrcDJwi2HsLADs=")}(),function(a,b){c.layout.SpringLayouter=function(a){this._network=a,this._damper=1,this._maxMotion=0,this._motionRatio=0,this._isAdjusting=!1,this._timer=null,this._snodeMap={},this._snodes=new B,this._slinks=new B,this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange,this),this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange,this),this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this)},d.ext("twaver.layout.SpringLayouter",Object,{_nodeRepulsionFactor:.6,_linkRepulsionFactor:.6,_limitBounds:null,_interval:50,_stepCount:10,_motionLimit:.01,start:function(){if(this._timer)return;var b=this,c=function(){b.relax.call(b)};this._timer=a.setInterval(c,this._interval),this._damper=1},stop:function(){this._timer&&(a.clearInterval(this._timer),this._timer=null)},relax:function(){if(this._damper<.1&&this._maxMotion<this._motionLimit)return;this._rebuild();var a=this._snodes.size();for(var b=0;b<this._stepCount;b++){this._slinks.forEach(this._relaxLink,this);for(var c=0;c<a;c++)for(var d=0;d<a;d++){var e=this._snodes.get(c),f=this._snodes.get(d);e!=f&&this._relaxNodePair(e,f)}this._moveNodes()}this._isAdjusting=!0;for(var b=0;b<a;b++){var g=this._snodes.get(b);g.fix||g.element.setLocation(g.x,g.y)}this._isAdjusting=!1},isRunning:function(){return!!this._timer},getNetwork:function(){return this._network},isVisible:function(a){return this._network.isVisible(a)},isMovable:function(a){return this._network.isMovable(a)?this._network.getSelectionModel().contains(a)?!1:a instanceof F?!1:!0:!1},getNodeRepulsionFactor:function(){return this._nodeRepulsionFactor},setNodeRepulsionFactor:function(a){a<.02&&(a=.02),this._nodeRepulsionFactor=a,this._damper=1},getLinkRepulsionFactor:function(){return this._linkRepulsionFactor},setLinkRepulsionFactor:function(a){a<.02&&(a=.02),this._linkRepulsionFactor=a,this._damper=1},getStepCount:function(){return this._stepCount},setStepCount:function(a){this._stepCount=a,this._damper=1},getInterval:function(){return this._interval},setInterval:function(b){if(this._interval===b)return;this._interval=b;if(this._timer){a.clearInterval(this._timer);var c=this,d=function(){c.relax.call(c)};this._timer=a.setInterval(d,this._interval)}},getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(a){this._limitBounds=a,this._damper=1},_handleDataPropertyChange:function(a){this._isAdjusting||(this._damper=1)},_handleDataBoxChange:function(a){this._network.getElementBox().size()===0?this._damper=0:this._damper=1},_handleNetworkPropertyChange:function(a){if(a.property==="elementBox"){var b=a.oldValue;b!=null&&(b.removeDataBoxChangeListener(this._handleDataBoxChange,this),b.removeDataPropertyChangeListener(this._handleDataPropertyChange,this)),this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange,this),this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange,this)}},_relaxLink:function(a){var b=a.toNode.x-a.fromNode.x,c=a.toNode.y-a.fromNode.y,d=Math.sqrt(b*b+c*c),e=b*.25,f=c*.25;e/=a.length*100;var g=a.length,h=g*100,i=f;f/=h,i/=a.length*100,a.toNode.dx=a.toNode.dx-e*d,a.toNode.dy=a.toNode.dy-f*d,a.fromNode.dx=a.fromNode.dx+e*d,a.fromNode.dy=a.fromNode.dy+f*d},_relaxNodePair:function(a,b){var c=0,d=0,e=a.x-b.x,f=a.y-b.y,g=e*e+f*f;g===0?(c=Math.random(),d=Math.random()):g<36e4&&(c=e/g,d=f/g);var h=a.repulsion*b.repulsion/100,i=h*.25;a.dx+=c*i,a.dy+=d*i,b.dx-=c*i,b.dy-=d*i},_moveNodes:function(){var a=this._maxMotion,b=0;for(var c=0,d=this._snodes.size();c<d;c++){var e=this._snodes.get(c),f=e.dx,g=e.dy;f*=this._damper,g*=this._damper,e.dx=f/2,e.dy=g/2;var h=Math.sqrt(f*f+g*g);if(!e.fix){e.x=e.x+Math.max(-30,Math.min(30,f)),e.y=e.y+Math.max(-30,Math.min(30,g));if(!this._limitBounds)e.x<1&&this._adjustLocation(1,0),e.y<1&&this._adjustLocation(0,1);else{e.x<this._limitBounds.x&&(e.x=this._limitBounds.x,this._adjustLocation(1,0)),e.y<this._limitBounds.y&&(e.y=this._limitBounds.y,this._adjustLocation(0,1));var i,j=this._network.getElementUI(e.element);j?i=j._viewRect:i=e.element.getRect(),i&&(e.x+i.width>this._limitBounds.x+this._limitBounds.width&&(e.x=this._limitBounds.x+this._limitBounds.width-i.width,this._adjustLocation(-1,0)),e.y+i.height>this._limitBounds.y+this._limitBounds.height&&(e.y=this._limitBounds.y+this._limitBounds.height-i.height,this._adjustLocation(0,-1)))}}b=Math.max(h,b)}this._maxMotion=b,this._maxMotion>0?this._motionRatio=a/this._maxMotion-1:this._motionRatio=0,this._damp()},_damp:function(){this._motionRatio<=.001&&((this._maxMotion<.2||this._maxMotion>1&&this._damper<.9)&&this._damper>.01?this._damper-=.01:this._maxMotion<.4&&this._damper>.003?this._damper-=.003:this._damper>1e-4&&(this._damper-=1e-4)),this._maxMotion<this._motionLimit&&(this._damper=0)},_rebuild:function(){this._snodeMap={},this._snodes.clear(),this._slinks.clear(),this._network.getElementBox().forEach(function(a){this.isVisible(a)&&(a instanceof c.Link?this._addLink(a):a instanceof E&&this._addNode(a))},this)},_addNode:function(a){var b=this._snodeMap[a.getId()];return b?b:(b={},b.element=a,b.repulsion=this._getRepulsion(a),b.x=a.getX(),b.y=a.getY(),b.dx=0,b.dy=0,b.fix=!this.isMovable(a),this._snodeMap[a.getId()]=b,this._snodes.add(b),b)},_addLink:function(a){var b={};b.fromNode=this._addNode(a.getFromNode()),b.toNode=this._addNode(a.getToNode()),b.element=a;var c=this._network.getElementUI(a.getToNode()),d=this._network.getElementUI(a.getFromNode()),e,f;c&&c._viewRect&&d&&d._viewRect?(e=c._viewRect.width+d._viewRect.width,f=c._viewRect.height+d._viewRect.height):(e=a.getToNode().getWidth()+a.getFromNode().getWidth(),f=a.getToNode().getHeight()+a.getFromNode().getHeight()),b.length=Math.floor(Math.sqrt(e*e+f*f)*this._linkRepulsionFactor),b.length<=0&&(b.length=100),this._slinks.add(b)},_getRepulsion:function(a){var b=this._network.getElementUI(a),c;if(b&&b._viewRect){var d=b._viewRect;c=Math.floor(Math.sqrt(d.width*d.width+d.height*d.height)*this._nodeRepulsionFactor)}else c=100;return c<=0&&(c=100),c},_adjustLocation:function(a,b){for(var c=0,d=this._snodes.size();c<d;c++){var e=this._snodes.get(c),f,g=this._network.getElementUI(e.element);g?f=g._viewRect:f=e.element.getRect();if(!f)return;if(a>0){if(!this._limitBounds||e.x+f.width+a<this._limitBounds.x+this._limitBounds.width)e.x+=a}else if(!this._limitBounds||e.x+a>this._limitBounds.x)e.x+=a;if(b>0){if(!this._limitBounds||e.y+f.height+b<this._limitBounds.y+this._limitBounds.height)e.y+=b}else if(!this._limitBounds||e.y+b>this._limitBounds.y)e.y+=b}}}),c.layout.CloudLayouter=function(a){c.layout.CloudLayouter.superClass.constructor.apply(this,arguments),this._network=a,this._centerX=0,this._centerY=0,this._radius=1,this._rect=null,this._localPoint=null,this._lastWidth=-1e3,this._lastHeight=-1e3,this._nodes=new B,this._sa=0,this._ca=0,this._sb=0,this._cb=0,this._sc=0,this._cc=0,this._lasta=0,this._lastb=0,this._active=!1,this._horizontalElliptical=1,this._verticalElliptical=1,this._timer=null,this._centering=!1,this._centeringNode=null,this._freeze=!1,this._network.getClassName()==="twaver.network.Network"?this._network.setInteractions([new c.network.interaction.SelectInteraction(this._network)]):this._network.setInteractions([new c.canvas.interaction.SelectInteraction(this._network)])},d.ext("twaver.layout.CloudLayouter",c.PropertyChangeDispatcher,{__accessor:["updateNodeFunction","mouseMoveFunction","mouseOverFunction","percentPadding","ceaseRate","ceaseLimit"],__bool:["elliptical","active","updateLayoutRectOnResized","reloadOnDataBoxChanged"],_moveSpeed:2,_ceaseRate:.9,_ceaseLimit:.01,_percentPadding:.2,_elliptical:!0,_interval:50,_reloadOnDataBoxChanged:!0,_updateLayoutRectOnResized:!0,getNetwork:function(){return this._network},isLayoutable:function(a){return this._network.isVisible(a)&&this._network.isMovable(a)},start:function(b){arguments.length===0&&(b=!0);if(this._timer)return;this._installListeners(),b&&this.updateLayoutRect(!0);var c=this,d=function(){c._update.call(c)};this._timer=a.setInterval(d,this._interval),this._update()},stop:function(){this._timer&&(a.clearInterval(this._timer),this._timer=null)},isRunning:function(){return!!this._timer},getInterval:function(){return this._interval},setInterval:function(b){if(this._interval===b)return;var c=this._interval;this._interval=b;if(this._timer){a.clearInterval(this._timer);var d=this,e=function(){d._update.call(d)};this._timer=a.setInterval(e,this._interval)}this.firePropertyChange("interval",c,b)},getMoveSpeed:function(){return this._moveSpeed},setMoveSpeed:function(a){var b=this._moveSpeed;this._moveSpeed=a,this.firePropertyChange("moveSpeed",b,a)},getLayoutRect:function(){var a=this._network.getView().offsetWidth/this._network.getZoom(),b=this._network.getView().offsetHeight/this._network.getZoom(),c=a*this._percentPadding,d=b*this._percentPadding;return{x:c,y:d,width:a-2*c,height:b-2*d}},getCount:function(){return this._nodes.size()},updateLayoutRect:function(a){var b=this._radius;this._rect=this.getLayoutRect(),this._rect.width<=2&&(this._rect.width=2),this._rect.height<=2&&(this._rect.height=2),this._radius=Math.min(this._rect.width/2,this._rect.height/2),this.isElliptical()?(this._horizontalElliptical=this._rect.width/2/this._radius,this._verticalElliptical=this._rect.height/2/this._radius):(this._horizontalElliptical=1,this._verticalElliptical=1),this._centerX=this._rect.x+this._rect.width/2,this._centerY=this._rect.y+this._rect.height/2;if(a)this.reload();else{this._lasta=1,this._lastb=1;var c=this._nodes.size();for(var d=0;d<c;d++){var e=this._nodes.get(d);e.cx*=this._radius/b,e.cy*=this._radius/b,e.cz*=this._radius/b}this._freeze?this._updateNodes(0,0,0):this._update()}this._lastWidth=this._network.getView().offsetWidth,this._lastHeight=this._network.getView().offsetHeight},reload:function(){this._freeze=!1,this._centeringNode=null,this._localPoint=null,this._centering=!1,this._nodes=new B,this._box.forEach(function(a){if(a&&this.isLayoutable(a)){var b={};b.node=a,this._nodes.add(b)}},this),this._sineCosine(0,0,0),this._active=!1,this._lasta=1,this._lastb=1;var a=0,b=0,c=this._nodes.size();for(i=0;i<c;i++){a=Math.acos(-1+(2*(i+1)-1)/c),b=Math.sqrt(c*Math.PI)*a;var d=this._nodes.get(i);d.cx=this._radius*Math.cos(b)*Math.sin(a),d.cy=this._radius*Math.sin(b)*Math.sin(a),d.cz=this._radius*Math.cos(a)}},_sineCosine:function(a,b,c){var d=Math.PI/180;this._sa=Math.sin(a*d),this._ca=Math.cos(a*d),this._sb=Math.sin(b*d),this._cb=Math.cos(b*d),this._sc=Math.sin(c*d),this._cc=Math.cos(c*d)},handleSelectionChange:function(a){this.centerNode(this._network.getSelectionModel().getLastData())},handleDataBoxChange:function(a){(this._reloadOnDataBoxChanged||a.kind==="clear")&&this.reload()},handleMouseMove:function(a){this._centering||this._updateLogicalPoint(a),this._mouseMoveFunction?this._active=this._mouseMoveFunction(a):this._active=!0},handleMouseOver:function(a){this._centering||this._updateLogicalPoint(a),this._mouseOverFunction?this._active=this._mouseOverFunction(a):this._active=!0},_updateLogicalPoint:function(a){this._localPoint=this._network.getLogicalPoint(a)},handleRollOut:function(a){this._active=!1},handleResize:function(a){if(a.kind==="validateEnd"){if(!this._updateLayoutRectOnResized)return;if(Math.abs(this._network.getView().offsetWidth-this._lastWidth)<=2&&Math.abs(this._network.getView().offsetHeight-this._lastHeight)<=2)return;this.updateLayoutRect()}},handleNetworkPropertyChange:function(a){a.property==="elementBox"&&(this._box.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._box=this._network.getElementBox(),this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this.reload()),a.property==="zoom"&&(this._localPoint=null,this.updateLayoutRect())},_adjustIndex:function(){this._nodes.sort(this._sortFunction);var a=this._nodes.size();for(var b=0;b<a;b++){var c=this._nodes.get(b).node,d=this._box.getDatas().indexOf(c);this._box.getDatas().removeAt(d),this._box.getDatas().add(c,b),this._box.fireIndexChange(c,d,b),this.updateNode(c,b,a,this._nodes.get(b).alpha)}},_sortFunction:function(a,b){return b.cz>a.cz?1:b.cz<a.cz?-1:0},updateNode:function(a,b,c,d){this._updateNodeFunction&&this._updateNodeFunction(a,b,c,d)},_update:function(){if(this._freeze)return;var a,b;if(this._centering&&this._centeringNode){var c=this.isAtCenter(this._centeringNode.node,this._centeringNode.perspective,this._centeringNode.cx,this._centeringNode.cy,this._centeringNode.cz);if(c){this._freeze=!0,this._centering=!1,this._centeringNode=null;return}}!this._freeze&&(this._active||this._centering)&&this._localPoint?this.isElliptical()?(a=(this._centerY-this._localPoint.y)/(this._rect.height/2)*this._moveSpeed,b=(this._localPoint.x-this._centerX)/(this._rect.width/2)*this._moveSpeed):(a=(this._centerY-this._localPoint.y)/this._radius*this._moveSpeed,b=(this._localPoint.x-this._centerX)/this._radius*this._moveSpeed):(a=this._lasta*this._ceaseRate,b=this._lastb*this._ceaseRate),this._lasta=a,this._lastb=b;if(Math.abs(a)>this._ceaseLimit||Math.abs(b)>this._ceaseLimit){var d=0;this._sineCosine(a,b,d);for(var e=0,f=this._nodes.size();e<f;e++){var g=this._nodes.get(e),h=g.cx,i=g.cy*this._ca+g.cz*-this._sa,j=g.cy*this._sa+g.cz*this._ca,k=h*this._cb+j*this._sb,l=i,m=h*-this._sb+j*this._cb,n=k*this._cc+l*-this._sc,o=k*this._sc+l*this._cc,p=m;g.cx=n,g.cy=o,g.cz=p;var q=this._radius*2;q/=q+p,g.perspective=q,g.alpha=(this._radius-p)/(this._radius*2);var r=this._horizontalElliptical*n*q-this._horizontalElliptical*2+this._centerX,s=o*q*this._verticalElliptical+this._centerY;g.node.setCenterLocation(r,s)}this._adjustIndex()}},centerNode:function(a){if(a&&this.isLayoutable(a)){if(this._centeringNode&&a===this._centeringNode.node&&this._freeze)return;for(var b=0,c=this._nodes.size();b<c;b++){var d=this._nodes.get(b);if(d&&a===d.node){this._centering=!0,this._freeze=!1,this._active=!0,this._centeringNode=d,this._localPoint=this.createControlPoint(this._centeringNode.node);break}}}else this._centering=!1,this._freeze=!1,this._active=!1,this._localPoint=null},createControlPoint:function(a){var b=a.getCenterLocation(),c=this.getLayoutRect(),d=c.x+c.width/2,e=c.y+c.height/2,f=Math.atan2(b.y-e,b.x-d),g=c.width+c.height;return{x:d+g*Math.cos(f),y:e+g*Math.sin(f)}},isAtCenter:function(a,b,c,d,e){if(this._moveSpeed<=0)return!0;var f=16/this._moveSpeed;return f>20?f=20:f<2&&(f=2),-e/Math.sqrt(c*c+d*d)>f},_updateNodes:function(a,b,c){this._sineCosine(a,b,c);for(var d=0,e=this._nodes.size();d<e;d++){var f=this._nodes.get(d),g=f.cx,h=f.cy*this._ca+f.cz*-this._sa,i=f.cy*this._sa+f.cz*this._ca,j=g*this._cb+i*this._sb,k=h,l=g*-this._sb+i*this._cb,m=j*this._cc+k*-this._sc,n=j*this._sc+k*this._cc,o=l;f.cx=m,f.cy=n,f.cz=o;var p=this._radius*2;p/=p+o,f.perspective=p;var q=this._horizontalElliptical*m*p-this._horizontalElliptical*2+this._centerX,r=n*p*this._verticalElliptical+this._centerY;f.node.setCenterLocation(q,r)}this._adjustIndex()},_installListeners:function(){this._box=this._network.getElementBox(),this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._network.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._network.addViewListener(this.handleResize,this),p.addEventListener("mouseout","handleRollOut",this._network.getView(),this),p.addEventListener("mousemove","handleMouseMove",this._network.getView(),this),p.addEventListener("mouseover","handleMouseOver",this._network.getView(),this),this._network.addPropertyChangeListener(this.handleNetworkPropertyChange,this)},_uninstallListeners:function(){this._box.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._network.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this),this._network.removeViewListener(this.handleResize,this),p.removeEventListener("mouseout",this._network.getView(),this),p.removeEventListener("mousemove",this._network.getView(),this),p.removeEventListener("mouseover",this._network.getView(),this),this._network.removePropertyChangeListener(this.handleNetworkPropertyChange,this)}}),c.layout.AutoLayouter=function(a){this._box=a},d.ext("twaver.layout.AutoLayouter",Object,{_expandGroup:!1,_repulsion:1,_type:null,_animate:!0,_explicitXOffset:Number.NaN,_explicitYOffset:Number.NaN,_xOffset:0,_yOffset:0,isExpandGroup:function(){return this._expandGroup},setExpandGroup:function(a){this._expandGroup=a},getRepulsion:function(){return this._repulsion},setRepulsion:function(a){this._repulsion=a},getType:function(){return this._type},isAnimate:function(){return this._animate},setAnimate:function(a){this._animate=a},getElementBox:function(){return this._box},getExplicitXOffset:function(){return this._explicitXOffset},setExplicitXOffset:function(a){this._explicitXOffset=a},getExplicitYOffset:function(){return this._explicitYOffset},setExplicitYOffset:function(a){this._explicitYOffset=a},getDimension:function(a){if(a instanceof F&&a.getChildrenSize()>0){var b=null;for(var c=0,d=a.getChildrenSize();c<d;c++){var e=a.getChildAt(c);e instanceof E&&(b?b=l.unionRect(b,e.getRect()):b=e.getRect())}return b?{width:b.width,height:b.height}:null}return{width:a.getWidth(),height:a.getHeight()}},isVisible:function(a){return!0},isMovable:function(a){return!0},getGroupLayoutType:function(a){return this._type},getElements:function(){var a,b=this._box,d=b.getSelectionModel().size()>1;d?a=b.getSelectionModel().getSelection():(a=new B,b.forEachByBreadthFirst(a.add,null,a)),this._xOffset=-1,this._yOffset=-1;var e=new B;for(var f=0,g=a.size();f<g;f++){var h=a.get(f);if(this.isVisible(h))if(h instanceof c.Link)e.add(h);else if(this.isMovable(h)&&h instanceof E){e.add(h);if(d){if(this._xOffset<0||h.getX()<this._xOffset)this._xOffset=h.getX();if(this._yOffset<0||h.getY()<this._yOffset)this._yOffset=h.getY()}}}return d||(isNaN(this._explicitXOffset)?this._xOffset=50/this._repulsion:this._xOffset=this._explicitXOffset,isNaN(this._explicitYOffset)?this._yOffset=50/this._repulsion:this._yOffset=this._explicitYOffset),e},getLayoutResult:function(a){var b={};return this.doLayoutImpl(a,null,b),b},doLayout:function(a,b){return this.doLayoutImpl(a,b)},doLayoutImpl:function(a,b,d){this._type=a;var e=null;if("round"===a)e=new xb;else if("symmetry"===a)e=new Lb;else if("hierarchic"===a)e=new Vb;else if(a==="topbottom"||a==="bottomtop"||a==="rightleft"||a==="leftright")e=new jb;if(e==null)return!1;var f={},g=this.getElements(),h=new Mb(this,g,!0,null);g=h.process();var i=new Gb(this,g,a,!0,null);try{e.i2(i)}catch(j){return h.resetGroup(),b!=null&&b(),!1}var k,l;for(k in i._a){l=i._a[k];var m=i.g4(l);f[k]={x:m.x+this._xOffset,y:m.y+this._yOffset}}var n;if(a==="rightleft"||a==="leftright"||a==="bottomtop"){var o=Mb.createMatrix(a),p=Number.MAX_VALUE,q=Number.MAX_VALUE;for(k in f){l=i._a[k],n=f[k];var r=o.transform(n);n.x=r.x,n.y=r.y;var s;a==="rightleft"||a==="leftright"?(s=r.x-i.g9(l)/2/this._repulsion,s<p&&(p=s),s=r.y-i.gj(l)/2/this._repulsion,s<q&&(q=s)):(s=r.x-i.gj(l)/2/this._repulsion,s<p&&(p=s),s=r.y-i.g9(l)/2/this._repulsion,s<q&&(q=s))}for(k in f)l=i._a[k],n=f[k],n.x=n.x-p+this._xOffset,n.y=n.y-q+this._yOffset}if(d==null&&this._animate){var t=new B,u=new B;for(k in f)t.add(i._a[k].node),u.add(f[k]);c.animate.AnimateManager.endAnimate(),c.animate.AnimateManager.start(new c.animate.AnimateCenterLocation(t,u,function(){h.resetGroup(),b!=null&&b()}))}else{for(k in f)l=i._a[k],n=f[k],d==null?l.node.setCenterLocation(n.x,n.y):d[l.node.getId()]=n;h.resetGroup(),b!=null&&b()}return!0}});var e=function(a,b){this.x=a,this.y=b};d.ext(e,Object,{equals:function(a){return this===a?!0:a instanceof e?a.x==this.x&&a.y==this.y:!1}});var f=function(a,b){this.width=a,this.height=b};d.ext(f,Object,{});var g=function(a,b){this.x=a,this.y=b};d.ext(g,Object,{});var h=function(){arguments.length===2?(h.superClass.constructor.call(this,arguments[1].width,arguments[1].height),this.x=arguments[0].x,this.y=arguments[0].y):(h.superClass.constructor.call(this,arguments[2],arguments[3]),this.x=arguments[0],this.y=arguments[1])};d.ext(h,f,{});var j=function(a,b){if(j.a2(a.x,b.x))this._a=1,this._b=0,this._c=-a.x;else{this._b=-1;var c=(b.y-a.y)/(b.x-a.x),d=a.y-a.x*c;this._a=c,this._c=d}};d.ext(j,Object,{a3:function(){return this._a},a4:function(){return this._b},a5:function(){return this._c}}),j.a6=function(a,b){if(j.a1(a.a3())&&j.a1(b.a3()))return null;if(j.a1(a.a4())&&j.a1(b.a4()))return null;if(j.a1(b.a4())){var c=a;a=b,b=c}var d=a.a3(),f=a.a4(),g=-a.a5(),h,i;j.a1(a.a3())?(h=b.a4(),i=-b.a5()):(h=b.a4()-b.a3()/a.a3()*a.a4(),i=-b.a5()-b.a3()/a.a3()*-a.a5());var k=i/h,l=(g-k*f)/d;return new e(l,k)},j.a1=function(a){return j.a2(a,0)},j.a2=function(a,b){return Math.abs(a-b)<1e-5};var k=function(a){this._a=new K;if(a)for(var b=0;b<a.size();b++)this._a.aa(a.get(b))};d.ext(k,Object,{c:function(){return this._a.ah()},d:function(){return this._a.ah()},a:function(){var a=new B;for(var b=this.c();b.i1();b.i2())a.add(b.i6(),0);return new k(a)},b:function(){return this._a.ay()}});var m=function(a,b){this.x=a,this.y=b};d.ext(m,Object,{a:function(a,b){this.x=a,this.y=b}});var n=function(a,b){this.x=a||0,this.y=b||0};d.ext(n,Object,{b:function(){return new n(this.x,this.y)},a:function(a){this.z=a},c:function(){return this.x},d:function(){return this.y},f:function(a,b){this.x=a,this.y=b}});var o=function(a){this._c=new K,a?(this.ac(a.a8().b()),this.ad(a.a9().b())):(this.ac(new n),this.ad(new n))};d.ext(o,Object,{a6:function(){return this.a5(this)},ac:function(a){a.a(this),this._a=a},ad:function(a){a.a(this),this._b=a},a8:function(){return this._a},a9:function(){return this._b},a1:function(a,b){return this.a4(a,b,this.aa())},a2:function(){return this._c.ay()},a7:function(a){return this._c.ak(a)},aa:function(){return this._c.ay()===0?null:this._c.as()},a3:function(){this._c.af()},i2:function(a){var b=this.a7(a);return b!=null?new e(b.x,b.y):null},i1:function(){return this.a2()},i6:function(){var a=this.a8();return new e(a.c(),a.d())},i7:function(){var a=this.a9();return new e(a.c(),a.d())},i8:function(a){this.a8().f(a.x,a.y)},i9:function(a){this.a9().f(a.x,a.y)},i3:function(a,b,c){var d=this.a7(a);d!=null&&d.a(b,c)},i4:function(a,b){this.a1(a,b)},i5:function(){this.a3()}});var q=function(a){q.superClass.constructor.call(this,a)};d.ext(q,o,{a5:function(a){return new q(a)},a4:function(a,b,c){var d=new m(a,b);return this.ab(d,c),d},ab:function(a,b){this._c.an(a,this._c.al(b))}});var r=function(){if(arguments.length===2){var a=arguments[0],b=arguments[1];this._s=!1,this._w=30,this._h=30,this._x=a-this._w/2,this._y=b-this._h/2}else{var c=arguments[0];this._s=c._s,this._w=c._w,this._h=c._h,this._x=c._x,this._y=c._y}};d.ext(r,Object,{m3:function(){return this.m2(this)},m4:function(){return this._x+this._w/2},m5:function(){return this._y+this._h/2},m6:function(a,b){this._x=a-this._w/2,this._y=b-this._h/2},i1:function(){return this._x},i2:function(){return this._y},i5:function(a,b){this._x=a,this._y=b},i3:function(){return this._w},i4:function(){return this._h},i6:function(a,b){var c=(this._w-a)/2,d=(this._h-b)/2;this._x+=c,this._y+=d,this._w=a,this._h=b},m1:function(a){var b,c,d,e;a.width<=0?(b=this._x,c=this._x+this._w,d=this._y,e=this._y+this._h):(b=Math.min(this._x,a.x),c=Math.max(this._x+this._w,a.x+a.width),d=Math.min(this._y,a.y),e=Math.max(this._y+this._h,a.y+a.height)),a.x=b,a.y=d,a.width=c-b,a.height=e-d}});var s=function(a){a?s.superClass.constructor.call(this,a):s.superClass.constructor.call(this,0,0)};d.ext(s,r,{m2:function(a){return new s(a)}});var t={};t.a2=function(a){var b=fb.a2($b.a(a.xa()));return t.a4(a,b,t.a3(a,b))},t.a3=function(a,b){for(var c=a.x9();c.i1();c.i2())b.i7(c.i9(),-1);var d=0,e=new Q(a.xa());for(var f=a.x9();f.i1();f.i2()){var g=f.i9();b.i2(g)===-1&&t.a(g,e,b,d++)}return d},t.a6=function(a){var b=new L,c=t.a2(a);for(var d=0;d<c.length-1;d++){var e=a.xo(c[d].x2(),c[d+1].x3());b.aa(e)}return b},t.a4=function(a,b,c){var d=[];for(var e=0;e<c;e++)d[e]=new bb;for(var f=a.x9();f.i1();f.i2())d[b.i2(f.i9())].ae(f.i9());return d},t.a=function(a,b,c,d){b.c(a),c.i7(a,d);while(!b.a()){a=b.b();for(var e=a.ag();e!=null;e=e.a8()){var f=e.a3();c.i2(f)===-1&&(c.i7(f,d),b.c(f))}for(var g=a.ae();g!=null;g=g.a7()){var h=g.a2();c.i2(h)===-1&&(c.i7(h,d),b.c(h))}}},t.a1=function(a,b,c){var d=new D(b,c);return d.a8(a),d._i},t.a5=function(a,b,c){var d=[];for(var e=0;e<c;e++)d[e]=new L;for(var f=a.xf();f.i1();f.i2())d[b.i2(f.i8())].aa(f.i8());return d},t.a7=function(a){var b=new L,c=fb.a3($b.b(a.xa())),d=fb.a4($b.a(a.xh())),e=t.a1(a,d,c),f=t.a5(a,d,e);if(f.length>1){var g=new bb;for(var h=0;h<f.length;h++){var i=f[h],j=null;if(i.ay()===1){var k=i.c2();k.a2().ad()===1?j=k.a2():k.a3().ad()===1&&(j=k.a3())}else{for(var l=i.c1();l.i1();l.i2()){var m=l.i8();if(c.i4(m.a2()))if(j==null)j=m.a2();else if(j!==m.a2()){j=null;break}if(!c.i4(m.a3()))continue;if(j==null){j=m.a3();continue}if(j===m.a3())continue;j=null;break}if(j!=null){var n=i.c2();n.a2()!==j?j=n.a2():j=n.a3()}}j!=null&&g.aa(j)}var o;for(var p=g.x4();!g.ar();p=o)o=g.x4(),b.ac(a.xo(p,o))}return b};var u=function(){this._c=0,this._d=0,this._e=0,this._b=!0,this._f=!1};d.ext(u,Object,{a6:function(a){this._f=a},a7:function(a){this._b=a},a8:function(a){a.x0()!==0&&this.a9(a,a.x9().i9())},a9:function(a,b){this._xx=a.xk(),this._c=a.xl(),this._d=0,this._e=0,this.a0(b);if(this._b)for(var c=a.x9();c.i1();c.i2()){var d=c.i9();this._xx.i1(d)==null&&(this.a1(d),this.a0(d))}a.xi(this._xx),a.xj(this._c)},a0:function(a){var b=++this._d;this._xx.z1(a,u._B),this.a5(a,b);for(var c=this._f?a.ap():a.af();c.i1();c.i2()){var d=c.i8();if(!this._c.i4(d)){this._c.i7(d,!0);var e=d.a1(a);this._xx.i1(e)==null?(this.a3(d,e,!0),this.a0(e),this.a2(d,e)):this.a3(d,e,!1)}}this.a4(a,b,++this._e),this._xx.z1(a,u._C)},a5:function(a,b){},a4:function(a,b,c){},a3:function(a,b,c){},a2:function(a,b){},a1:function(a){}}),u._B={},u._C={};var v=function(a){this._a=a};d.ext(v,u,{a5:function(a,b){var c=this._a._ah.i2(a);this._a._ad[c].ae(a)}});var w=function(a){this._a=a};d.ext(w,u,{a2:function(a,b){var c=a.a1(b),d=this._a[c.al()],e=this._a[b.al()];e._a+1>d._a?(d._c=d._a,d._b=d._d,d._a=e._a+1,d._d=a):e._a+1>d._c&&(d._c=e._a+1,d._b=a)}});var x=function(a){this._a=a};d.ext(x,u,{a3:function(a,b,c){c&&a.a2()===b&&this._a.ac(a)}});var y=function(){this._a=0,this._c=0};d.ext(y,Object,{});var z=function(){this._a=0};d.ext(z,Object,{a1:function(a,b){this._a=0;for(var c=b.length-1;c>=0;c--)b[c]=-1;for(var d=a.x9();d.i1();d.i2()){var e=d.i9();if(e.ak()!==0)continue;this.a2(e,e.al(),b);break}for(var f=a.x9();f.i1();f.i2()){var g=f.i9(),h=g.al();b[h]===-1&&this.a2(g,h,b)}},a2:function(a,b,c){c[b]=-2;for(var d=a.ag();d!=null;){var e=d.a3(),f=e.al();switch(c[f]){case-1:this.a2(e,f,c);case-2:default:d=d.a8()}}c[b]=this._a++}});var A={};A.a1=function(a){var b=new C;return b.a8(a),b._n},A.a2=function(a){var b=a.x9(),c=null,d=0;b.i4();for(;b.i1();b.i2())b.i9().ak()===0&&(c=b.i9(),d++);if(d===1)return c;d=0,b.i4();for(;b.i1();b.i2
())b.i9().ao()===0&&(c=b.i9(),d++);return d===1?c:A.a8(a)},A.a8=function(a){var b=$b.a(a.x0()),c=fb.a2(b);return A.a6(a,c)},A.a6=function(a,b){var c=a.xd(),d=$b.d(1),e=$b.a(a.x0(),-1),f=A.a4(a,c);A.a7(c,b,d,e,-1);for(var g=f.c1();g.i1();g.i2())a.x3(g.i8());return d[0]},A.a7=function(a,b,c,d,e){var f=0;for(var g=a.ag();g!=null;g=g.a8()){var h=g.a3(),i=A.a7(h,b,c,d,e);i>e&&(e=i),f+=d[h.al()]}var j=f*(a._g.xa()-1-f);for(var k=a.ag();k!=null;k=k.a8()){var l=k.a3();for(var m=k.a8();m!=null;m=m.a8()){var n=m.a3();j+=d[l.al()]*d[n.al()]}}return b.i7(a,j),d[a.al()]=f+1,j>e&&(e=j,c[0]=a),e},A.a4=function(a,b){var c=new L,d=new x(c);d.a6(!1),d.a9(a,b);for(var e=c.c1();e.i1();e.i2())a.x3(e.i8());return c},A.a3=function(a){return A.a4(a,A.a2(a))};var C=function(){this._n=!0,this.a6(!1)};d.ext(C,u,{a3:function(a,b,c){c||(this._n=!1)},a1:function(a){this._n=!1}});var D=function(a,b){this._i=0,this._m=b,this._j=a,this._l=!1};d.ext(D,u,{a8:function(a){this._h=$b.a(a.x0()),this._k=$b.a(a.x0()),this._g=new Q(a.xh()),D.superClass.a8.call(this,a)},a5:function(a,b){this._k[a.al()]=this._h[a.al()]=b},a3:function(a,b,c){this._g.c(a);if(!c){var d=a.a1(b);this._h[d.al()]=Math.min(this._h[d.al()],this._k[b.al()])}},a1:function(a){this._l=!1},a2:function(a,b){var c=a.a1(b);if(this._h[b.al()]>=this._k[c.al()]){for(;this._g.d()!==a;this._j.i5(this._g.b(),this._i));this._j.i5(this._g.b(),this._i),this._i++,this._g.a()?this._l?this._m.i5(c,!0):this._l=!0:this._m.i5(c,!0)}this._h[c.al()]=Math.min(this._h[c.al()],this._h[b.al()])}});var G=function(a,b){this._h=!1,this._i=a,this._g=b};d.ext(G,Object,{z1:function(a,b){a._c[this._i]=b},i1:function(a){return a._c[this._i]},i5:function(a,b){a._c[this._i]=b},i4:function(a){return a._c[this._i]},i7:function(a,b){a._c[this._i]=b},i2:function(a){var b=a._c[this._i];return b==null?0:b},i6:function(a,b){a._c[this._i]=b},i3:function(a){var b=a._c[this._i];return b==null?0:b},c:function(){return this._h},d:function(){this._h=!0}});var H=function(a,b){this._c=!1,this._d=a,this._b=b};d.ext(H,Object,{i8:function(a,b){a._c[this._d]=b},i1:function(a){return a._c[this._d]},i7:function(a,b){a._c[this._d]=b},i4:function(a){var b=a._c[this._d];return b==null?!1:b},i5:function(a,b){a._c[this._d]=$b.a(b)},i2:function(a){var b=a._c[this._d];return b==null?0:b},i6:function(a,b){a._c[this._d]=$b.a(b)},i3:function(a){var b=a._c[this._d];return b==null?0:b},a:function(){return this._c},b:function(){this._c=!0}});var I=function(a){this._bb=a,this.i4()};d.ext(I,Object,{i1:function(){return this._aa!=null},i2:function(){this._aa=this._aa._a},i3:function(){this._aa=this._aa._b},i4:function(){this._aa=this._bb._b},i5:function(){this._aa=this._bb._c},i7:function(){return this._bb.ay()},i6:function(){return this._aa._c}});var J=function(a){J.superClass.constructor.call(this,a)};d.ext(J,I,{i8:function(){return this.i6()}});var K=function(a){this._id=d.id(),this._a=0;if(a){a.i4();for(;a.i1();a.i2())this.ae(a.i6())}};d.ext(K,Object,{ac:function(a){var b=this.ag(a);return this._b==null?this._b=this._c=b:(this._b._b=b,b._a=this._b,this._b=b),this._a++,b},ae:function(a){var b=this.ag(a);return this._c==null?this._b=this._c=b:(this._c._a=b,b._b=this._c,this._c=b),this._a++,b},z1:function(a){a._b=null,a._a=null,this._c==null?this._b=this._c=a:(this._c._a=a,a._b=this._c,this._c=a),this._a++},ad:function(a){a._b=null,a._a=null,this._b==null?this._b=this._c=a:(this._b._b=a,a._a=this._b,this._b=a),this._a++},aa:function(a){return this.ae(a),!0},ab:function(a){for(;a.i1();a.i2())this.ae(a.i6())},ao:function(a,b){if(b===this._b)return this.ac(a);if(b==null)return this.ae(a);var c=this.ag(a);return this.aq(c,b),c},aq:function(a,b){if(b==null)this.ad(a);else if(b===this._b)this.ad(a);else{if(this._c==null)a._b=null,a._a=null,this._b=this._c=a;else{var c=b._b;b._b=a,a._a=b,c._a=a,a._b=c}this._a++}},ap:function(a,b){if(b==null)this.z1(a);else if(b===this._c)this.z1(a);else{if(this._b==null)a._b=null,a._a=null,this._b=this._c=a;else{var c=b._a;b._a=a,a._a=c,c._b=a,a._b=b}this._a++}},an:function(a,b){if(b===this._c)return this.ae(a);if(b==null)return this.ac(a);var c=this.ag(a);return this.ap(c,b),c},ay:function(){return this._a},ar:function(){return this._a===0},af:function(){this._b=this._c=null,this._a=0},am:function(){return this._b._c},at:function(){var a=this.am();return this.aw(this._b),a},as:function(){return this._c._c},au:function(){return this.aw(this._c)},ak:function(a){var b=0;for(var c=this._b;c!=null;){if(a===b)return c._c;c=c._a,b++}return null},aj:function(a){return a._a==null?this._b:a._a},ai:function(a){return a._b==null?this._c:a._b},aw:function(a){return a!==this._b?a._b._a=a._a:this._b=a._a,a!==this._c?a._a._b=a._b:this._c=a._b,this._a--,a._c},av:function(a){return this.aw(a._aa)},ah:function(){return new I(this)},al:function(a){var b=this._b;while(b!=null){if(b._c==null&&a==null)return b;if(b._c===a)return b;b=b._a}return null},a0:function(){var a=$b.d(this._a),b=0;for(var c=this._b;c!=null;)a[b]=c._c,c=c._a,b++;return a},ax:function(){for(var a=this._b;a!=null;a=a._b){var b=a._a;a._a=a._b,a._b=b}var c=this._b;this._b=this._c,this._c=c},a1:function(a){var b=this.a0();b.sort(a);var c=0;for(var d=this._b;d!=null;)d._c=b[c],d=d._a,c++},a2:function(){var a=this.a0();a.sort($b.c);var b=0;for(var c=this._b;c!=null;)c._c=a[b],c=c._a,b++},az:function(a){this._b==null?(this._b=a._b,this._c=a._c):a._b!=null&&(this._c._a=a._b,a._b._b=this._c,this._c=a._c),this._a+=a._a,a._b=a._c=null,a._a=0},ag:function(a){return new O(a)}});var L=function(a){L.superClass.constructor.call(this,a)};d.ext(L,K,{c1:function(){return new J(this)},c2:function(){return this.am()},c3:function(){return this.at()}});var M=function(){this._c=0};d.ext(M,Object,{a:function(a){this._c++,a._b=this._b,a._a=null,this._b!=null?(this._b._a=a,this._b=a):this._b=this._a=a},b:function(a,b){if(b==null){this.a(a);return}var c=b._b;c!=null?c._a=a:this._a=a,a._b=c,a._a=b,b._b=a,this._c++},c:function(a){var b=a._a,c=a._b;this._c--,b!=null?b._b=c:this._b=c,c!=null?c._a=b:this._a=b}});var N=function(a,b){this._p=a,this._j=b,this._o=a._o[b]};d.ext(N,Object,{i1:function(){return this._o!=null},i2:function(){this._o=this._o._k[this._j]},i3:function(){this._o=this._o._f[this._j]},i4:function(){this._o=this._p._o[this._j]},i5:function(){this._o=this._p._q[this._j]},i7:function(){return this._p._n[this._j]},i6:function(){return this._o},i8:function(){return this._o}});var O=function(a){this._c=a};d.ext(O,Object,{a:function(){return this._a},b:function(){return this._b},c:function(a){this._c=a},d:function(){return this._c}});var P=function(a,b,c,d){this._r=a,this._s=b,this._q=c,this._p=d};d.ext(P,Object,{i1:function(a){return this._p[a.a5()]},i3:function(a){return this._r[a.a5()]},i2:function(a){return this._s[a.a5()]},i4:function(a){return this._q[a.a5()]},i8:function(a,b){this._p[a.a5()]=b},i6:function(a,b){this._r[a.a5()]=b},i5:function(a,b){this._s[a.a5()]=b},i7:function(a,b){this._q[a.a5()]=b}});var Q=function(a){this._a=$b.d(a),this._b=-1};d.ext(Q,Object,{d:function(){return this._a[this._b]},b:function(){return this._a[this._b--]},c:function(a){this._a[++this._b]=a},a:function(){return this._b<0}});var R=function(){};d.ext(R,Object,{a0:function(a){this._c=$b.d(a)}});var S=function(a,b,c,d,e,f,g){this._g=0,a.xt(this,b,c,d,e,f,g)};d.ext(S,R,{a5:function(){return this._h._u&&this._h.b1(),this._g},a2:function(){return this._d},a3:function(){return this._e},a1:function(a){return this._d!==a?this._d:this._e},a4:function(){for(var a=0;a<=1;a++)this._k[a]=null,this._f[a]=null},a8:function(){return this._k[0]},a7:function(){return this._k[1]},a6:function(a,b,c,d){this.a0(d),this._h=a,this._k=$b.d(2),this._f=$b.d(2),this._d=b,this._e=c}});var T=function(a){this._j=0,this._h=a,this.i4()};d.ext(T,Object,{i2:function(){this._k=this._k._k[this._j],this._k==null&&this._j===0&&(this._k=this._h._o[1],this._j=1)},i3:function(){this._k=this._k._f[this._j],this._k==null&&this._j===1&&(this._k=this._h._q[0],this._j=0)},i4:function(){this._k=this._h._o[0],this._k==null?(this._k=this._h._o[1],this._j=1):this._j=0},i5:function(){this._k=this._h._q[1],this._k==null?(this._k=this._h._q[0],this._j=0):this._j=1},i1:function(){return this._k!=null},i6:function(){return this._k},i8:function(){return this._k},i7:function(){return this._h.ad()}});var U=function(){this._a=zb._A,this._b=zb._A,this._c=new B};d.ext(U,Object,{i1:function(){return this._c.size()},i2:function(a){return this._c.get(a)},i3:function(a,b,c){this._c.set(a,new e(b,c))},i4:function(a,b){this._c.add(new e(a,b))},i5:function(){this._c.clear()},i6:function(){return this._a},i7:function(){return this._b},i8:function(a){this._a=a},i9:function(a){this._b=a}});var V=function(){this._x=0,this._y=0,this._w=0,this._h=0};d.ext(V,Object,{i5:function(a,b){this._x=a,this._y=b},i6:function(a,b){this._w=a,this._h=b},i4:function(){return this._h},i3:function(){return this._w},i1:function(){return this._x},i2:function(){return this._y}});var W=function(a,b,c,d){this._m=a,this._n=b,this._l=c,this._k=d};d.ext(W,Object,{i1:function(a){return this._k[a.al()]},i3:function(a){return this._m[a.al()]},i2:function(a){return this._n[a.al()]},i4:function(a){return this._l[a.al()]},z1:function(a,b){this._k[a.al()]=b},i6:function(a,b){this._m[a.al()]=b},i7:function(a,b){this._n[a.al()]=b},i5:function(a,b){this._l[a.al()]=b}});var X=function(a,b){this._b=a,this._r=b,this._a=[];for(var c=this._b-1;c>=0;c--)this._a.push(c);this._c=new B};d.ext(X,Object,{a1:function(a){var b;if(this._a.length===0){this.a2(a,this._b,this._b+this._r);for(var c=this._b+this._r-1;c>this._b;c--)this._a.push(c);b=this._b,this._b+=this._r}else b=this._a.pop();return b},b:function(a){var b=this.a1(a),c=new G(b,this);return this._c.add(c),this.a4(a,b),c},c:function(a){var b=this.a1(a),c=new H(b,this);return this._c.add(c),this.a4(a,b),c},a2:function(a,b,c){for(var d=a._a;d!=null;d=d._a){var e=$b.d(c);$b.f(d._c,e,b),d._c=e}},a3:function(a,b,c){var d=$b.d(c);$b.f(a._c,d,b),a._c=d},a4:function(a,b){for(var c=a._a;c!=null;c=c._a)c._c[b]=null},a5:function(a,b){if(a instanceof G){var c=a;if(c.c())throw"Error";c.d();var d=a._i;this._a.indexOf(d)<0&&(this.a4(b,d),this._a.push(d),this._c.remove(a))}},a6:function(a,b){if(a instanceof H){var c=a;if(c.a())throw"Error";c.b();var d=c._d;this._a.indexOf(d)<0&&(this.a4(b,d),this._a.push(d),this._c.remove(a))}}});var Y=function(a){this._id=d.id(),this._p=0,a.xs(this)};d.ext(Y,R,{ad:function(){return this._n[0]+this._n[1]},ak:function(){return this._n[1]},ao:function(){return this._n[0]},al:function(){return this._g._y&&this._g.c(),this._p},ag:function(){return this._o[0]},ae:function(){return this._o[1]},af:function(){return new T(this)},am:function(){return new N(this,1)},ap:function(){return new N(this,0)},an:function(){return new $(this)},aq:function(){return new Z(this,1)},aw:function(){return new Z(this,0)},ah:function(a){for(var b=this._o[0];b!=null;b=b._k[0])if(b.a3()===a)return b;return null},ai:function(a){for(var b=this._o[1];b!=null;b=b._k[1])if(b.a2()===a)return b;return null},aj:function(a){var b=this.ah(a);return b==null&&(b=this.ai(a)),b},au:function(a){this.at(a,1,$b.d(this.ak()))},av:function(a){this.at(a,0,$b.d(this.ao()))},as:function(a,b){this.a0(b),this._g=a,this._o=$b.d(2),this._q=$b.d(2),this._n=$b.a(2)},ab:function(a,b,c,d,e){if(b==null){this.aa(a,c,d);return}var f;b._d===b._e?f=d:f=this!==b._d?1:0;if(e===0){var g=b._k[f];a._f[d]=b,a._k[d]=g,b._k[f]=a,g==null?this._q[c]=a:g._d===g._e?g._f[d]=a:g._f[this!==g._d?1:0]=a}else{var h=b._f[f];a._k[d]=b,a._f[d]=h,b._f[f]=a,h==null?this._o[c]=a:h._d===h._e?h._k[d]=a:h._k[this!==h._d?1:0]=a}this._n[c]++},aa:function(a,b,c){var d=this._q[b];a._k[c]=null,d==null?(this._o[b]=a,a._f[c]=null):(a._f[c]=d,d._d===d._e?d._k[c]=a:d._k[this!==d._d?1:0]=a),this._q[b]=a,this._n[b]++},ar:function(a,b,c){var d,e;d=a._k[c],e=a._f[c],d==null?this._q[b]=e:d._f[d._d!==this?1:0]=e,e==null?this._o[b]=d:e._k[e._d!==this?1:0]=d,this._n[b]--},ac:function(){for(var a=0;a<=1;a++)this._o[a]=null,this._q[a]=null,this._n[a]=0},at:function(a,b,c){if(this._n[b]<2)return;var d=this._n[b],e=0,f;for(f=this._o[b];f!=null;f=f._k[b])c[e]=f,e++;$b.s(c,d,a);var g=this._o[b]=c[0];g._f[b]=null;for(var h=1;h<d;)f=c[h],f._f[b]=g,g._k[b]=f,h++,g=f;this._q[b]=f,f._k[b]=null}});var Z=function(a,b){Z.superClass.constructor.call(this,a,b),this._h=b!==1?1:0};d.ext(Z,N,{i6:function(){return this.i9()},i9:function(){return this._h!==0?this._o._e:this._o._d}});var $=function(a){$.superClass.constructor.call(this,a)};d.ext($,T,{i6:function(){return this._k.a1(this._h)},i9:function(){return this._k.a1(this._h)}});var _=function(a){_.superClass.constructor.call(this,a)};d.ext(_,I,{i9:function(){return this.i6()}});var ab=function(a){this._o=a,this._c=a._a};d.ext(ab,Object,{i1:function(){return this._c!=null},i2:function(){this._c=this._c._a},i3:function(){this._c=this._c._b},i5:function(){this._c=this._o._b},i4:function(){this._c=this._o._a},i7:function(){return this._o._c},i6:function(){return this._c},i9:function(){return this._c},i8:function(){return this._c}});var bb=function(a){if(a&&a.length){bb.superClass.constructor.call(this);for(var b=0;b<a.length;b++)this.ae(a[b])}else bb.superClass.constructor.call(this,a)};d.ext(bb,K,{x1:function(){return new _(this)},x2:function(){return this.am()},x3:function(){return this.as()},x4:function(){return this.at()}});var cb=function(a){this._d=a,cb.superClass.constructor.call(this)};d.ext(cb,bb,{});var db=function(a){this._a=a,this._b=new L,this._c=new bb};d.ext(db,Object,{a:function(){for(var a=this._a.x9();a.i1();a.i2())this.e(a.i9())},b:function(){this.c(),this.d()},c:function(){while(!this._c.ar()){var a=this._c.x4();this._a.xq(a)||this.g(a)}},d:function(){while(!this._b.ar()){var a=this._b.c3();this._a.xp(a)||this.f(a)}},e:function(a){for(var b=a.af();b.i1();b.i2())this._b.ac(b.i8()),this._a.h1(b.i8());this._c.ac(a),this._a.h2(a)},f:function(a){this._a.u1(a)},g:function(a){this._a.h3(a)}}),db.h=function(a,b){b.i4();for(;b.i1();b.i2()){var c=b.i8();a.xq(c.a2())||a.h3(c.a2()),a.xq(c.a3())||a.h3(c.a3()),a.xp(c)||a.u1(c)}},db.i=function(a,b){b.i4();for(;b.i1();b.i2()){var c=b.i8();a.xp(c)&&a.h1(c),c.a2().ad()===0&&a.h2(c.a2()),c.a3().ad()===0&&a.h2(c.a3())}};var eb=function(){this._g=arguments[0],this._f=graph.xk(),this._h=graph.xk(),this._d=new K,this._e=0,arguments.length!==1&&this.a(arguments[1],arguments[2],arguments[3],arguments[4])};d.ext(eb,Object,{a:function(a,b,c,d){var e=$b.d(c-b+1);for(var f=b;f<=c;f++)e[f]=new cb(f);for(var g=this._g.x9();g.i1();g.i2()){var h=g.i9();if(d==null||d.i4(h))this._f.z1(h,e[a.i2(h)-b].ac(h)),this._e++}for(var i=0;i<e.length;i++){var j=e[i],k=this._d.ae(j);for(var l=j.x1();l.i1();l.i2())this._h.z1(l.i9(),k)}},c:function(){this._g.xi(this._h),this._g.xi(this._f)},e:function(){return this._e===0},g:function(){for(;this._d.am().ar();this._d.at());this._e--;var a=this._d.am().x4();return this._h.z1(a,null),this._f.z1(a,null),a},f:function(){for(;this._d.as().ar();this._d.au());this._e--;var a=this._d.as().x4();return this._h.z1(a,null),this._f.z1(a,null),a},d:function(a){var b=this._f.i1(a),c=this._h.i1(a),d=c.d(),e=null,f=c.a();f!=null?(e=f.d(),this._h.z1(a,f)):(e=new cb(d._d+1),this._h.z1(a,this._d.ae(e))),d.aw(b),this._f.z1(a,e.ac(a))},b:function(a){var b=this._f.i1(a),c=this._h.i1(a),d=c.d(),e=null,f=c.b();f!=null?(e=f.d(),this._h.z1(a,f)):(e=new cb(d._d-1),this._h.z1(a,this._d.ac(e))),d.aw(b),this._f.z1(a,e.ac(a))}});var fb={};fb.a1=function(a){return new W(a,null,null,null)},fb.a2=function(a){return new W(null,a,null,null)},fb.a3=function(a){return new W(null,null,a,null)},fb.a4=function(a){return new P(null,a,null,null)},fb.a5=function(a){return new P(null,null,a,null)},fb.a6=function(a){return new P(null,null,null,a)};var gb=function(){if(arguments.length===2){this._a=new K,this._b=new K,this._c=0;var a=arguments[0],b=arguments[1],c=new hb(a._j2.gj(b)/2,0);this._a.ac(c),c=new hb(a._j2.gj(b)/2,0),this._b.ac(c)}else this._a=arguments[1],this._b=arguments[2],this._c=arguments[3]};d.ext(gb,Object,{});var hb=function(a,b){this._b=a,this._a=b};d.ext(hb,Object,{});var ib=function(){this._cx=!0,this._cs=new ub,this._ct=new sb,this._cw=new tb};d.ext(ib,Object,{i5:function(a){this._cx=a},k:function(){var a=new vb(this);return this._cx&&(this._cs.w1(a),a=this._cs),this._cw.w1(a),a=this._cw,this._ct.w1(a),a=this._ct,a},i2:function(a){this.k().i2(a)},i1:function(a){return this.k().i1(a)}});var jb=function(){jb.superClass.constructor.call(this),this._jv=20,this._jw=40,this._jx=function(a,b){var c=a.a3(),d=b.a3(),e=c._g;return Math.floor(100*(e.g5(c)-e.g5(d)))}};d.ext(jb,ib,{i4:function(a){return A.a1(a)},i3:function(a){if(!this.i4(a))throw"Error";var b=A.a3(a);this._j2=a,this._j3=new kb(a),Hb.c(a),this._jy=a.xk();if(!a.xb()){this.bu();var c=this._j3.c1();this.f(c),this.b(this._j3),this.c(this._j3)}var d;for(;!b.ar();a.x3(d))d=b.c3(),Hb.b(a.g2(d))},bu:function(){if(this._jx!=null)for(var a=this._j2.x9();a.i1();a.i2())a.i9().av(this._jx)},c:function(a){var b=this.a2(a),c=$b.a(b.length);for(var d=0;d<b.length;d++){var e=b[d],f=0;for(var g=e.ah();g.i1();g.i2()){var h=g.i6();f=Math.max(f,this._j2.g9(h))}c[d]=f}var i=-this._jw;for(var j=0;j<b.length;j++){i+=this._jw+c[j];var k=b[j];for(var l=k.ah();l.i1();l.i2()){var m=l.i6();this._j2.s2(m,this._j2.g5(m),i-c[j]/2)}}},a2:function(a){var b=$b.d(a.b());for(var c=0,d=a.b();c<d;c++)b[c]=new K;return a.c1(),this.a1(a.c1(),0,b),b},a1:function(a,b,c){c[b].ae(a);for(var d=a.aw();d.i1();d.i2())this.a1(d.i9(),b+1,c)},b:function(a){var b=a.c1();this._j2.s2(b,0,this._j2.g6(b)),this.g(b)},g:function(a){for(var b=a.aw();b.i1();b.i2()){var c=b.i9(),d=this._jy.i1(c);this._j2.s2(c,this._j2.g5(a)+d._c,this._j2.g6(c)),this.g(c)}},f:function(a){if(this._j3.c2(a)){this._jy.z1(a,new gb(this,a));return}var b=a.aw(),c=b.i9();b.i2(),this.f(c);var d=this._jy.i1(c),e=new gb(this,d._a,d._b,0);if(!b.i1()){e._a.ac(new hb(this._j2.gj(a)/2,0)),e._b.ac(new hb(this._j2.gj(a)/2,0)),this._jy.z1(a,e);return}while(b.i1()){c=b.i9(),b.i2(),this.f(c),d=this._jy.i1(c);var f=e._b.ah(),g=d._a.ah(),h=2147483647,i=0,j=0;while(f.i1()&&g.i1()){var k=f.i6();f.i2();var l=g.i6();g.i2(),j+=k._a,i+=l._a,h=Math.min(h,i-j-k._b-l._b)}d._c=this._jv-h,i+=d._c;var m=d._b.am();m._a=d._c;if(f.i1()&&!g.i1())for(var n=j-this.a3(d._b);f.i1();n=0){var o=f.i6();f.i2(),d._b.ae(new hb(o._b,o._a+n))}else if(!f.i1()&&g.i1()){var p=this.a3(e._a);for(p=i-p;g.i1();p=0){var q=g.i6();g.i2(),e._a.ae(new hb(q._b,q._a+p))}}e._b=d._b}this._jy.z1(a,e);var r=-d._c/2;for(var s=a.aw();s.i1();){var t=s.i9();s.i2();var u=this._jy.i1(t);u._c+=r;var v=u._b.am();v._a+=r,v=u._a.am(),v._a+=r}e._a.ac(new hb(this._j2.gj(a)/2,0)),e._b.ac(new hb(this._j2.gj(a)/2,0))},a3:function(a){var b=0;for(var c=a.ah();c.i1();c.i2()){var d=c.i6();b+=d._a}return b}});var kb=function(a){this._b=a,this.a()};d.ext(kb,Object,{c1:function(){return this._a==null&&this.a(),this._a},b:function(){return this._a==null?-1:this.d(this._a)},d:function(a){var b=0;for(var c=a.aw();c.i1();c.i2())b=Math.max(b,this.d(c.i9()));return b+1},c2:function(a){return a.ao()===0},a:function(){for(var a=this._b.x9();a.i1();a.i2())if(a.i9().ak()===0){this._a=a.i9();return}}});var lb=function(a){this._d=0,this._e=0,this._f=0,this._a=0,this._b=0,this._g=a,this._c=new K};d.ext(lb,Object,{a:function(){return this._d+this._e+this._f}});var mb=function(){mb.superClass.constructor.call(this),this._kl=340,this._km=360,this._kk=40,this._ko=.5};d.ext(mb,ib,{ic:function(){return this._km},ia:function(){return this._kl},i9:function(){return this._ko},i3:function(a){if(!A.a1(a))throw"Error";this._a=a;var b=this.i8(),c=A.a4(a,b);Hb.c(a),this._kn=$b.d(a.x0());for(var d=a.x9();d.i1();d.i2()){var e=d.i9();e!==b?this.aa(e,new lb(this._kk+this.q(e.aq().i9()))):this.aa(e,new lb(this._kk))}this.s(b),a.s2(b,0,0),this.t(b);var f;for(;!c.ar();a.x3(f))f=c.c3()},i4:function(a){return A.a1(a)},i0:function(a){return this._kn[a.al()]},i8:function(){return A.a2(this._a)},i7:function(a){var b=this.ib(a),c;do{c=this.i6(a);if(c<=b)break;for(var d=a.aw();d.i1();d.i2()){var e=d.i9();this.i0(e)._g*=1+this._ko}}while(!0);var f=(b-c)/(2*a.ao());c=0;for(var g=a.aw();g.i1();g.i2()){var h=this.i0(g.i9());h._d+=f,h._e+=f,c+=h._d+h._e}this.id(a)},id:function(a){var b=$b.d(a.ao()),c=0;for(var d=a.ap();d.i1();)b[c]=d.i8(),d.i2(),c++;var e=this;b.sort(function(a,b){var c=a.a3(),d=b.a3(),f=e.i0(c).a()-e.i0(d).a();return f>0?1:f>=0?0:-1});for(var f=0;f<b.length;f++)this._a.h1(b[f]);for(var g=0;g<b.length;g+=2)this._a.u1(b[g]);c=b.length-1,c%2===0&&c--;for(;c>0;c-=2)this._a.u1(b[c])},ib:function(a){return a.ak()===0?this._km:a.ao()===2?Math.min(180,this._kl):this._kl},i6:function(a){var b=0;for(var c=a.ap();c.i1();c.i2()){var d=c.i8(),e=d.a3(),f=this.i0(e),g=-f._g,h=f._b,i=f._c,j=0,k=j+1,l=i._b,m=l.d(),n;for(;k>j;k=(n.y-h)/(n.x-g))n=m,l=i.ai(l),m=l.d(),j=(m.y-n.y)/(m.x-n.x);f._d=-Math.atan(k)*180/Math.PI,j=0,k=j-1,l=i._b;for(m=l.d();l.a().d().x===m.x;m=l.d())l=l.a();var o;for(;k<j;k=(o.y-h)/(o.x-g))o=m,l=i.aj(l),m=l.d(),j=(m.y-o.y)/(m.x-o.x);f._e=Math.atan(k)*180/Math.PI,b+=f._d+f._e}return b},aa:function(a,b){this._kn[a.al()]=b},p:function(a){var b=this.i0(a),c=new K,d=2*this.q(a);c.aa(new e(0,0)),c.aa(new e(0,d)),c.aa(new e(d,d)),c.aa(new e(d,0)),b._c=c,b._a=d/2,b._b=d/2},r:function(a){if(a.ao()===0)this.p(a);else{var b=this.i0(a),c=this.q(a),d=new K;d.aa(new e(-c,-c)),d.aa(new e(-c,c)),d.aa(new e(c,-c)),d.aa(new e(c,c));for(var f=a.aw();f.i1();f.i2()){var g=this.i0(f.i9());d.az(g._c)}var h=zb.h(d),i=Number.MAX_VALUE,j=Number.MAX_VALUE,k=Number.MIN_VALUE,l=Number.MIN_VALUE;for(var m=h.ah();m.i1();m.i2()){var n=m.i6();n.x<i&&(i=n.x),n.x>k&&(k=n.x),n.y<j&&(j=n.y),n.y>l&&(l=n.y)}var o=new K;for(var p=h.ah();p.i1();p.i2()){var q=p.i6();o.aa(new e(q.x-i,q.y-j))}b._c=o,b._a=-i,b._b=-j}},s:function(a){if(a.ao()===0)this.r(a);else{for(var b=a.aw();b.i1();b.i2())this.s(b.i9());this.i7(a);var c=0;for(var d=a.aw();d.i1();d.i2()){var f=d.i9(),g=this.i0(f),h=180-(360-this.ib(a))/2-c-(g._e+g._f);c+=g.a(),h=h/180*Math.PI;var i=Math.sin(h),j=Math.cos(h);for(var k=g._c._b;k!=null;k=k.a()){var l=k.d(),m=l.x+g._g,n=l.y-g._b,o=new e(m*j-i*n,m*i+j*n);k.c(o)}var p=g._a+g._g;g._a=p*j,g._b=p*i}this.r(a)}},t:function(a){var b=this._a.g4(a),c=0;if(a.ak()>0){var d=a.aq().i9(),e=this._a.g4(d);c=Math.PI+Math.atan2(e.y-b.y,e.x-b.x)}for(var f=a.aw();f.i1();f.i2()){var g=f.i9(),h=this.i0(g);if(c!==0){var i=Math.cos(c),j=Math.sin(c),k=h._a*i-j*h._b,l=h._a*j+i*h._b;h._a=k,h._b=l}this._a.s2(g,b.x+h._a,b.y+h._b),this.t(g)}},q:function(a){return 1.41*(Math.max(this._a.gj(a),this._a.g9(a))/2)}});var nb=function(){};d.ext(nb,Object,{i2:function(a){return a.ad()},i1:function(a){throw"Error"},i3:function(a){throw"Error"},i4:function(a){throw"Error"}});var ob=function(a){this._a=a};d.ext(ob,Object,{i2:function(a){var b=0;for(var c=a.an();c.i1();c.i2())this._a.i1(c.i9())!=null&&b++;return b},i4:function(a){return this._a.i1(a)==null},i1:function(a){throw"Error"},i3:function(a){throw"Error"}});var pb=function(){pb.superClass.constructor.call(this),this._kq=!1,this._kp=90};d.ext(pb,mb,{a:function(a,b){this._kr=b,this._ks=a,this._kq=!0},i7:function(a){if(!this.u(a)){pb.superClass.i7.call(this,a);return}var b=this.i9(),c=this.ib(a),d=(360-c)/2+c,e=new L(a.ap());do{var f=this.i6(a);f=(360-c)/2;var g=null,h=null;for(var i=e._b;i!=null;i=i.a()){var j=i.d(),k=j.a3(),l=this.i0(k),m=this._ks.i3(j),n=m-(f+l._e);n>=0&&m+l._d>=d&&(f+l.a()<=d?n=d-f-l.a():n=2*(d-(m+l._d))),l._f=0;if(n>=0)l._f=n,g=i,h=l;else{-n>l._d+l._e?n=(l._d+l._e)/2:n/=-2,f-=n,f<=d&&f+l.a()>d&&(f+=n,n=f+l.a()-d,f-=n);for(;g!=null&&n>h._f;h=this.i0(g.d().a3())){n-=h._f,h._f=0,g=g.b();if(g!=null)continue;h=null;break}g!=null?h._f-=n:f+=n}f+=l.a()}if(f<=d){var o=0,p=(360-c)/2;for(var q=a.ap();q.i1();q.i2()){var r=q.i8(),s=r.a3(),t=this._ks.i3(r),u=this.i0(s),v=p+u._f+u._e;o<Math.abs(v-t)&&(o=Math.abs(v-t)),p+=u.a()}if(o<=this._kp)break}for(var w=a.aw();w.i1();w.i2()){var x=w.i9();this.i0(x)._g*=1+b}}while(!0)},ib:function(a){return this.u(a)?a.ak()===0?this.ic():this.ia():pb.superClass.ib.call(this,a)},u:function(a){return!this._kq||a.ao()===0?!1:this._ks.i1(a.ag())!=null}});var qb=function(a){this._a=a};d.ext(qb,Object,{i1:function(a){return this._a.i1(a)},i2:function(a){throw"Error"},i3:function(a){throw"Error"},i4:function(a){throw"Error"}});var rb=function(){};d.ext(rb,Object,{w1:function(a){this._bb=a},w2:function(){return this._bb},w4:function(a){this._bb!=null&&this._bb.i2(a)},w3:function(a){return this._bb!=null?this._bb.i1(a):!0}});var sb=function(){this._cg=45,this._ce=400,this._ch=400,this._cf=0};d.ext(sb,rb,{i1:function(a){if(this.w2()!=null){var b=!0,c=a.xk(),d=t.a3(a,c),e=$b.d(d),f=$b.d(d);for(var g=0;g<d;g++)e[g]=new bb,f[g]=new L;for(var h=a.xf();h.i1();h.i2()){var i=h.i8();f[c.i2(i.a2())].aa(i),a.h1(i)}for(var j=a.x9();j.i1();j.i2()){var k=j.i9();e[c.i2(k)].aa(k),a.h2(j.i9())}for(var l=0;l<d;l++){for(var m=e[l].x1();m.i1();m.i2())a.h3(m.i9());for(var n=f[l].c1();n.i1();n.i2())a.u1(n.i8());b=this.w3(a);for(var o=f[l].c1();o.i1();o.i2())a.h1(o.i8());for(var p=e[l].x1();p.i1();p.i2())a.h2(p.i9());if(!b)break}for(var q=0;q<d;q++)for(var r=e[q].x1();r.i1();r.i2())a.h3(r.i9());for(var s=0;s<d;s++)for(var u=f[s].c1();u.i1();u.i2())a.u1(u.i8());return a.xi(c),b}return!0},i2:function(a){if(a.xb())return;var b=a.xk(),c=t.a3(a,b),d=$b.d(c),f=$b.d(c),g=$b.d(c),i=$b.d(c);for(var j=0;j<c;j++)d[j]=new bb,f[j]=new L;for(var k=a.xf();k.i1();k.i2()){var l=k.i8();f[b.i2(l.a2())].aa(l),a.h1(l)}for(var m=a.x9();m.i1();m.i2()){var n=m.i9();d[b.i2(n)].aa(n),a.h2(m.i9())}for(var o=0;o<c;o++){for(var p=d[o].x1();p.i1();p.i2())a.h3(p.i9());for(var q=f[o].c1();q.i1();q.i2())a.u1(q.i8());this.w4(a);var r=a.g3();g[o]=new h(r.x,r.y,r.width,r.height);var s={};i[o]=s;if(this._cf>0){var u=this._cg+Math.ceil((r.width+1)/this._cf)*this._cf,v=this._cg+Math.ceil((r.height+1)/this._cf)*this._cf;s.x=r.x,s.y=r.y,s.width=u,s.height=v}else s.x=r.x,s.y=r.y,s.width=r.width+this._cg,s.height=r.height+this._cg;for(var w=f[o].c1();w.i1();w.i2())a.h1(w.i8());for(var x=d[o].x1();x.i1();x.i2())a.h2(x.i9())}for(var y=0;y<c;y++)for(var z=d[y].x1();z.i1();z.i2())a.h3(z.i9());for(var A=0;A<c;A++)for(var B=f[A].c1();B.i1();B.i2())a.u1(B.i8());Hb.a(i,null,this._ce/this._ch);if(this._cf<=0)for(var C=0;C<i.length;C++)this.w5(a,d[C],f[C],new e(i[C].x,i[C].y),g[C]);else for(var D=0;D<i.length;D++){var E=Math.floor((i[D].x-g[D].x)/this._cf)*this._cf,F=Math.floor((i[D].y-g[D].y)/this._cf)*this._cf,G=g[D].x+E,H=g[D].y+F;this.w5(a,d[D],f[D],new e(G,H),g[D])}a.xi(b)},w5:function(a,b,c,d,f){var g=-f.x+d.x,h=-f.y+d.y;for(var i=b.x1();i.i1();i.i2()){var j=a.ga(i.i9());a.s4(i.i9(),new e(j.x+g,j.y+h))}for(var l=c.c1();l.i1();l.i2()){var m=l.i8(),n=new B;for(var o=a.gp(m).c();o.i1();o.i2()){var p=o.i6();n.add(new e(p.x+g,p.y+h))}a.s5(m,new k(n))}}});var tb=function(){};d.ext(tb,rb,{i1:function(a){return this.w3(a)},i2:function(a){this.w7(a),this.w2()!=null&&this.w4(a),this.w6(a)},w7:function(a){this.e(a),this.k(a),this.i(a)},e:function(a){for(var b=a.x9();b.i1();b.i2()){var c=a.g4(b.i9());a.s1(b.i9(),c)}},w6:function(a){this.l(a),this.j(a),this.f(a)},l:function(a){for(var b=a.x9();b.i1();b.i2()){var c=a.g4(b.i9());a.s1(b.i9(),c)}},j:function(a){for(var b=a.xf();b.i1();b.i2()){var c=a.g7(b.i8()),d=c.i6();c.i8(d),d=c.i7(),c.i9(d);for(var e=0;e<c.i1();e++){var f=c.i2(e);c.i3(e,f.x,f.y)}}},k:function(a){for(var b=a.xf();b.i1();b.i2()){var c=a.g7(b.i8()),d=c.i6();c.i8(d),d=c.i7(),c.i9(d);for(var e=0;e<c.i1();e++){var f=c.i2(e);c.i3(e,f.x,f.y)}}},f:function(a){this._ca!=null&&(a.x1("A",this._ca),this._ca=null,this._b6=null),this._b8!=null&&(a.x1("B",this._b8),this._b8=null,this._b9=null)},i:function(a){this._ca=a.xc("A"),this._ca!=null&&(this._b6=new qb(this._ca),a.x1("A",this._b6)),this._b8=a.xc("B"),this._b8!=null&&(this._b9=new qb(this._b8),a.x1("B",this._b9))}});var ub=function(){this._a=new L,this._c=10};d.ext(ub,rb,{i2:function(a){this._b=a.xl(),this.w9(a),this.w4(a),this.c(a),this.w8(a,this._b),a.xj(this._b)},i1:function(a){if(this.w2()==null)return!0;this._b=a.xl(),this.w9(a);var b=this.w3(a);return this.c(a),a.xj(this._b),b},w8:function(a,b){for(var c=a.xf();c.i1();c.i2()){var d=c.i8();if(b.i1(d)!=null){var e=b.i1(d);Hb.g(a,d,e,this._c)}}},w9:function(a){var b=a.xk();for(var c=a.x9();c.i1();c.i2()){var d=c.i9();for(var e=d.af();e.i1();e.i2()){var f=e.i8(),g=f.a1(d),h=b.i1(g);if(h!==f)if(h==null)b.z1(g,f);else{this._b.i1(h)==null&&this._b.i8(h,new L);var i=this._b.i1(h);i.aa(f),this._a.ac(f),a.h1(f)}}for(var j=d.af();j.i1();j.i2()){var k=j.i8(),l=k.a1(d);b.z1(l,null)}}a.xi(b)},c:function(a){for(;!this._a.ar();a.u1(this._a.c3()));}});var vb=function(a){this._a=a};d.ext(vb,Object,{i2:function(a){this._a.i3(a)},i1:function(a){return this._a.i4(a)}});var wb=function(){wb.superClass.constructor.call(this),this._jo=30,this._jp=new Ab,this._jt=5};d.ext(wb,ib,{i4:function(a){return!0},i3:function(a){this._ju=a,Hb.c(a);var b=this._jp.i1(a),c=0;for(var d=a.x9();d.i1();d.i2())c=Math.max(c,this.e(d.i9()));c<this._jt&&(c=this._jt),this.a(b,c)},a:function(a,b){var c=a.i7(),d=2*Math.PI/c,e=0,f=$b.a(c);a.i4();for(var g=0;g<c;)f[g]=this.e(a.i9())+this._jo,e+=f[g],g++,a.i2();var h=e/c,i=e/(Math.PI*2);i<b&&(i=b),a.i4();var j=0;for(var k=0;k<c;){var l=d/h*f[k];j+=l/2;var m=Math.cos(j)*i,n=Math.sin(j)*i;j+=l/2,this._ju.s2(a.i9(),m,n),k++,a.i2()}return i},e:function(a){var b=this._ju.gj(a),c=this._ju.g9(a);return b<=c?c:b}});var xb=function(){xb.superClass.constructor.call(this),this._jm=new wb,this._jk=new pb};d.ext(xb,ib,{i4:function(a){return!0},i3:function(a){if(a.x0()<2)return;this._jn=a,Hb.c(this._jn),Hb.e(this._jn);var b=new Fb(this._jn);b.a1(),b.h();var c=new db(this._jn);c.a();for(var d=b.x9();d.i1();d.i2()){var e=d.i9(),f=b.c2(e);if(f.ay()>1){var g=b.d1(e);db.h(this._jn,g.c1()),this._jm.i3(this._jn);var h=this._jn.g3();b.s7(e,h.width,h.height)}else if(f.ay()===1){var i=f.x2();b.s8(e,this._jn.gm(i)),this._jn.s2(i,0,0)}else b.s7(e,1,1);db.i(this._jn,this._jn.xf())}c.b();var j=this.a7(b);A.a4(b,j);var k=b.xk(),l=b.xl();this.a2(b,l,k),this.a1(b,l),this.a3(b,j,l),this._jk.a(l,k),this._jk.i3(b),this.a5(b,j,k);for(var m=b.x9();m.i1();m.i2()){var n=m.i9(),o=b.g4(n);for(var p=b.c2(n).x1();p.i1();p.i2()){var q=p.i9();this._jn.s2(q,o.x+this._jn.g5(q),o.y+this._jn.g6(q))}}},a7:function(a){var b=-1,c=null;for(var d=a.x9();d.i1();d.i2()){var e=d.i9();a.c2(e).ay()>b&&(c=e,b=a.c2(e).ay())}return c},a1:function(a,b){var c=function(a,c){var d=b.i3(a)-b.i3(c);return d>0?1:d>=0?0:-1};for(var d=a.x9();d.i1();d.i2())d.i9().av(c)},a2:function(a,b,c){var d=$b.a(this._jn.x0());for(var e=a.x9();e.i1();e.i2()){var f=e.i9(),g=a.c2(f);for(var h=g.x1();h.i1();h.i2()){var i=h.i9();d[i.al()]=f.al()}}var j=A.a2(a);this.a4(a,j,d,b,c)},a3:function(a,b,c){if(a.c2(b).ay()>1){var d=0,e=0,f=0;for(var g=b.ap();g.i1();g.i2()){var h=g.i8(),i=c.i3(h);i-d>e&&(e=i-d,f=(d+i)/2),d=i}360-d>e&&(f=(360+d)/2),this.a6(a,b,f);for(var j=b.ap();j.i1();j.i2()){var k=j.i8(),l=c.i3(k);for(l-=f;l<0;l+=360);c.i6(k,l)}b.av(function(a,b){var d=c.i3(a)-c.i3(b);return d>0?1:d>=0?0:-1})}},a4:function(a,b,c,d,e){var f=b.al(),g=e.i3(b);for(var h=b.ap();h.i1();h.i2()){var i=h.i8(),j=a.b(i),k=0,l=0,m=0,n=0;for(var o=j.c1();o.i1();o.i2()){var p=o.i8(),q=null,r=null;c[p.a2().al()]===f?(q=p.a2(),r=p.a3()):(q=p.a3(),r=p.a2()),m-=this._jn.g5(q),n+=this._jn.g6(q),k-=this._jn.g5(r),l+=this._jn.g6(r)}if(m!==0||n!==0){var s;for(s=Math.atan2(n,m)*180/Math.PI-g;s<0;s+=360);d.i6(i,s)}if(k!==0&&l!==0){var t=Math.atan2(l,k)*180/Math.PI;t<0&&(t+=360),e.i6(i.a3(),t)}this.a4(a,i.a3(),c,d,e)}},a5:function(a,b,c){var d=a.g4(b);for(var e=b.ap();e.i1();e.i2()){var f=e.i8(),g=f.a3(),h=a.g4(g),i=h.x-d.x,j=h.y-d.y,k=Math.atan2(j,i)*180/Math.PI;if(c.i1(g)!=null){var l=c.i3(g);k+=l}this.a6(a,g,k),this.a5(a,g,c)}},a6:function(a,b,c){c=c/180*Math.PI;var d=a.c2(b);if(d.ay()<=1)return;for(var e=d.x1();e.i1();e.i2()){var f=e.i9(),g=this._jn.g5(f),h=this._jn.g6(f),i=Math.cos(c),j=Math.sin(c),k=g*i-j*h,l=g*j+i*h;this._jn.s2(f,k,l)}}});var yb=function(){this._a=(new Date).getTime()};d.ext(yb,Object,{b:function(){return(new Date).getTime()-this._a}});var zb={};zb._A=new e(0,0),zb.b=function(a,b,c){return zb.c(a.x,a.y,b.x,b.y,c.x,c.y)},zb.c=function(a,b,c,d,e,f){c-=a,d-=b,e-=a,f-=b;var g=e*d-f*c;return g>=0?g<=0?0:-1:1},zb.d=function(a,b,c){return zb.b(a,b,c)>0},zb.f=function(a,b,c){return zb.b(a,b,c)<0},zb.g=function(a,b,c){return zb.b(a,b,c)===0},zb.h=function(a){return zb.i(a)},zb.i=function(a){var b=new K(a.ah()),c=new K;b.a2();if(b.ar())return c;var d=b.at();c.ae(d);for(;!b.ar()&&d.equals(b.am());b.at());if(b.ar())return c;d=b.at();var e=c.ae(d);for(var f=b.ah();f.i1();f.i2()){var g=f.i6();if(!g.equals(d)){d=g;if(c.ay()===2&&zb.g(c.am(),c.as(),g))e.c(g);else{var h;for(h=e;!zb.f(c.ai(h).d(),h.d(),g
);h=c.ai(h));var i;for(i=e;!zb.d(c.aj(i).d(),i.d(),g);i=c.aj(i));for(;i!==c.aj(h);c.aw(c.aj(h)));e=c.an(g,h)}}}return c},zb.j=function(){return zb.k(Number.MAX_VALUE)},zb.k=function(a){return Math.floor(Math.random()*a)},zb.l=function(a,b){return Math.random()*(b-a)+a};var Ab=function(){};d.ext(Ab,Object,{i1:function(a){this._b=a;var b=new L;b=t.a6(a),b.az(t.a7(a));var c=this.a1();for(;!b.ar();a.x5(b.c3()));return c.x1()},a1:function(){if(this._b.x0()<3)return new bb(this._b.x9());var a=this._b.xk(),b=this._b.xk(),c=this._b.xl(),d=new eb(this._b,new nb,0,this.a3(this._b)),e=this._b.x0(),f=new L,g=new L,h=new db(this._b);for(;e>3;e--){var i=d.g();for(var j=i.an();j.i1();j.i2())a.z1(j.i9(),e),b.i5(j.i9(),!1);for(var k=i.an();k.i1();k.i2()){var l=k.i9();for(var m=l.ap();m.i1();m.i2()){var n=m.i8();a.i2(n.a3())===e&&(g.aa(n),b.i5(n.a2(),!0),b.i5(n.a3(),!0))}}if(g.ay()<i.ad()-1){var o=null;for(var p=i.an();p.i1();p.i2()){var q=p.i9();if(a.i2(q)===e&&!b.i4(q))if(o==null)o=q;else{var r=this._b.xo(o,q);c.i7(r,!0),g.aa(r),o=null}}if(o!=null)for(var s=i.an();s.i1();s.i2()){var t=s.i9();if(t===o||t.aj(o)!=null)continue;var u=this._b.xo(o,t);c.i7(u,!0),g.aa(u);break}if(g.ay()<i.ad()-1){var v=2147483647,w=null;for(var x=i.an();x.i1();x.i2()){var y=x.i9();y.ad()<v&&(w=y,v=y.ad())}for(var z=i.an();z.i1();z.i2()){var A=z.i9();if(w.aj(A)!=null||w===A)continue;var B=this._b.xo(w,A);c.i7(B,!0),g.aa(B);if(g.ay()>=i.ad()-1)break}}}for(var C=i.an();C.i1();C.i2())d.b(C.i9());for(var D=g.c1();D.i1();D.i2()){var E=D.i8();c.i4(E)&&(d.d(E.a2()),d.d(E.a3()))}f.az(g),h.e(i)}h.b(),d.c();for(var F=f.c1();F.i1();F.i2()){var G=F.i8();G._h!=null&&(c.i4(G)?this._b.x5(G):this._b.h1(G))}var H=this.a4(this._b),I=new bb,J=H.ak(0),K=H.ak(1),M=null;J.a2()===K.a2()||J.a2()===K.a3()?M=J.a3():M=J.a2(),I.aa(M);for(var N=H.c1();N.i1();N.i2()){var O=N.i8();M=O.a1(M),I.aa(M)}for(var P=f.c1();P.i1();P.i2()){var Q=P.i8();!c.i4(Q)&&Q._h==null&&this._b.u1(Q)}return this._b.xi(b),this._b.xj(c),this._b.xi(a),this.a2(I),I},a2:function(a){if(a.ay()<this._b.x0()){var b=this._b.xk();for(var c=a._b;c!=null;c=c.a()){var d=c.d();b.z1(d,c)}var e;for(e=new eb(this._b,new ob(b),0,a.ay(),new ob(b));!e.e();){var f=e.f();for(var g=f.an();g.i1();g.i2()){var h=g.i9();if(b.i1(h)==null)continue;var i=b.i1(h),j=a.ai(i).d(),k=null;f.aj(j)!=null?k=a.ao(f,i):k=a.an(f,i),b.z1(f,k);break}for(var l=f.an();l.i1();l.i2()){var m=l.i9();b.i1(m)==null&&e.d(m)}}this._b.xi(b),e.c()}},a3:function(a){var b=0;for(var c=a.x9();c.i1();c.i2())b=Math.max(b,c.i9().ad());return b},a4:function(a){var b=[];for(var c=0,d=a.x0();c<d;c++)b[c]=new y;var e=new w(b);e.a6(!1),e.a8(a);var f=-1,g=null;for(var h=a.x9();h.i1();h.i2()){var i=h.i9(),j=b[i.al()];j._a+j._c>f&&(f=j._a+j._c,g=i)}var k=new L,l=g;for(var m=b[l.al()]._d;m!=null;m=b[l.al()]._d)k.ac(m),l=m.a1(l);l=g;for(var n=b[l.al()]._b;n!=null;n=b[l.al()]._d)k.ae(n),l=n.a1(l);return k}});var Bb=function(){this._v=new M,this._x=new M,this._z=new X(3,5),this._w=new X(3,5),this._y=!1,this._u=!1,this._t={}};d.ext(Bb,Object,{xm:function(){var a=new Y(this);return a},xo:function(a,b){return this.xn(a,null,b,null,0,0)},xn:function(a,b,c,d,e,f){return new S(this,a,b,c,d,e,f)},x4:function(a){this.b3(a)},b3:function(a){var b;while((b=a._o[0])!=null)this.x5(b);while((b=a._o[1])!=null)this.x5(b);this._v.c(a),a._g=null,this._y=!0},x5:function(a){this.a11(a)},a11:function(a){if(a._h!==this)throw"Error";var b=a.a2(),c=a.a3();this.a12(a,b,c),this._x.c(a),a._h=null,this._u=!0},x7:function(a){a._p=this._v._c,a._g=this,a.ac(),a._c.length<this._z._b&&this._z.a3(a,a._c.length,this._z._b),this._v.a(a),this._y=!0},x8:function(a){if(a._h!=null)throw"Error";a._c.length<this._w._b&&this._w.a3(a,a._c.length,this._w._b),a._a==null||a._a._h!==this?this._x.a(a):this._x.b(a,a._a),a._h=this,a.a4(),this.b2(a,a.a2(),null,a.a3(),null,0,0),this._u=!0},xr:function(a,b,c){var d=a.a2(),e=a.a3();a._h==null?(a._d=b,a._e=c):(d!==b&&(d.ar(a,0,0),a._d=b,b.ab(a,null,0,0,0)),e!==c&&(e.ar(a,1,1),a._e=c,c.ab(a,null,1,1,0)))},x3:function(a){this.xr(a,a.a3(),a.a2())},h1:function(a){this.a11(a)},u1:function(a){this.x8(a)},h2:function(a){this.x4(a)},h3:function(a){this.x7(a)},xa:function(){return this._v._c},x0:function(){return this._v._c},xh:function(){return this._x._c},xg:function(){return this._x._c},xb:function(){return this._v._c===0},xq:function(a){return a._g===this},xp:function(a){return a._h===this},xd:function(){return this._v._a},x9:function(){return new ab(this._v)},xf:function(){return new ab(this._x)},x2:function(a,b){var c=$b.d(this.xh());if(a!=null&&b!=null)for(var d=this.x9();d.i1();d.i2())d.i9().at(a,1,c),d.i9().at(b,0,c);else if(b==null&&a!=null)for(var e=this.x9();e.i1();e.i2())e.i9().at(a,1,c);else if(b!=null&&a==null)for(var f=this.x9();f.i1();f.i2())f.i9().at(b,0,c)},xk:function(){return this._z.b(this._v)},xl:function(){return this._w.c(this._x)},xi:function(a){this._z.a5(a,this._v)},xj:function(a){this._w.a6(a,this._x)},xc:function(a){return this._t[a]},x1:function(a,b){this._t[a]=b},x6:function(a){delete this._t[a]},b2:function(a,b,c,d,e,f,g){b.ab(a,c,0,0,f),d.ab(a,e,1,1,g)},a12:function(a,b,c){b.ar(a,0,0),c.ar(a,1,1)},c:function(){var a=0;for(var b=this.x9();b.i1();b.i2())b.i9()._p=a++;this._y=!1},b1:function(){var a=0;for(var b=this.xf();b.i1();b.i2())b.i8()._g=a++;this._u=!1},xs:function(a){a.as(this,this._z._b),a._p=this._v._c,this._v.a(a)},xt:function(a,b,c,d,e,f,g){a.a6(this,b,d,this._w._b),a._g=this._x._c,this._x.a(a),this.b2(a,a.a2(),c,a.a3(),e,f,g)}});var Cb=function(){Cb.superClass.constructor.call(this)};d.ext(Cb,Bb,{gb:function(a){return this.g1(a)},g7:function(a){return this.g2(a)},g5:function(a){var b=this.g1(a);return b.i1()+b.i3()/2},g6:function(a){var b=this.g1(a);return b.i2()+b.i4()/2},g4:function(a){return new e(this.g5(a),this.g6(a))},gi:function(a){return this.g1(a).i1()},gh:function(a){return this.g1(a).i2()},ga:function(a){var b=this.g1(a);return new e(b.i1(),b.i2())},gj:function(a){return this.g1(a).i3()},g9:function(a){return this.g1(a).i4()},gm:function(a){return new f(this.gj(a),this.g9(a))},s1:function(a,b){this.s2(a,b.x,b.y)},s2:function(a,b,c){var d=this.g1(a);d.i5(b-d.i3()/2,c-d.i4()/2)},s7:function(a,b,c){this.g1(a).i6(b,c)},s8:function(a,b){this.s7(a,b.width,b.height)},s3:function(a,b,c){this.g1(a).i5(b,c)},s4:function(a,b){this.s3(a,b.x,b.y)},gp:function(a){var b=this.g2(a),c=new B;for(var d=0;d<b.i1();d++)c.add(b.i2(d));return new k(c)},gf:function(a){var b=this.g2(a),c=new K;for(var d=0;d<b.i1();d++)c.aa(b.i2(d));return c},gc:function(a){var b=new B;b.add(this.gs(a));for(var c=this.gp(a).d();c.i1();c.i2())b.add(c.i6());return b.add(this.gl(a)),new k(b)},gd:function(a){var b=new K;b.aa(this.gs(a));for(var c=this.gp(a).d();c.i1();c.i2())b.aa(c.i6());return b.aa(this.gl(a)),b},m1:function(a,b){var c=this.g2(a);c.i5();var d=b.ah(),e=d.i6();this.gx(a,e);var f=b.as();d.i2();for(;d.i6()!==f;d.i2()){var g=d.i6();c.i4(g.x,g.y)}this.gy(a,f)},s5:function(a,b){var c=this.g2(a);c.i5();for(var d=b.d();d.i1();d.i2()){var e=d.i6();c.i4(e.x,e.y)}},s6:function(a,b){var c=this.g2(a);c.i5();for(var d=b.ah();d.i1();d.i2()){var e=d.i6();c.i4(e.x,e.y)}},m2:function(a,b,c){this.gx(a,b),this.gy(a,c)},gn:function(a){return this.g2(a).i6()},gk:function(a){return this.g2(a).i7()},gt:function(a,b){this.g2(a).i8(b)},gz:function(a,b){this.g2(a).i9(b)},gs:function(a){var b=this.g2(a).i6();if(b==null)return this.g4(a.a2());var c=new e(this.g5(a.a2())+b.x,this.g6(a.a2())+b.y);return c},gl:function(a){var b=this.g2(a).i7();if(b==null)return this.g4(a.a3());var c=new e(this.g5(a.a3())+b.x,this.g6(a.a3())+b.y);return c},gx:function(a,b){var c=new e(b.x-this.g5(a.a2()),b.y-this.g6(a.a2()));this.g2(a).i8(c)},gy:function(a,b){var c=new e(b.x-this.g5(a.a3()),b.y-this.g6(a.a3()));this.g2(a).i9(c)},g8:function(){var a=new L;for(var b=this.xf();b.i1();b.i2())a.aa(b.i8());return a},g3:function(){var a,b=a=Number.MAX_VALUE,c,d=c=Number.MIN_VALUE;for(var e=this.x9();e.i1();e.i2()){var f=this.ga(e.i9()),g=this.gm(e.i9());b=Math.min(f.x,b),a=Math.min(f.y,a),d=Math.max(f.x+g.width,d),c=Math.max(f.y+g.height,c)}for(var h=this.xf();h.i1();h.i2())for(var i=this.gp(h.i8()).c();i.i1();i.i2()){var j=i.i6();b=Math.min(j.x,b),a=Math.min(j.y,a),d=Math.max(j.x,d),c=Math.max(j.y,c)}return{x:Math.floor(b),y:Math.floor(a),width:Math.floor(d-b),height:Math.floor(c-a)}}});var Db=function(){Db.superClass.constructor.call(this),this.a(new s,new q)};d.ext(Db,Cb,{a:function(a,b){this._a3=a,this._a4=b},xo:function(a,b){return this.l2(a,b,this._a4.a6())},l2:function(a,b,c){return this.l1(a,null,b,null,0,0,c)},xn:function(a,b,c,d,e,f){return this.l1(a,b,c,d,e,f,this._a4.a6())},l1:function(a,b,c,d,e,f,g){var h=new S(this,a,b,c,d,e,f);return h._l=g,h},xm:function(){var a=new Y(this);return a._r=this._a3.m3(),a},g3:function(){var a={x:0,y:0,width:-1,height:-1};for(var b=this.x9();b.i1();b.i2())b.i9()._r.m1(a);return a},g1:function(a){return a._r},g2:function(a){return a._l},g5:function(a){return a._r.m4()},g6:function(a){return a._r.m5()},gi:function(a){return a._r.i1()},gh:function(a){return a._r.i2()},gj:function(a){return a._r.i3()},g9:function(a){return a._r.i4()},s2:function(a,b,c){a._r.m6(b,c)},s7:function(a,b,c){a._r.i6(b,c)},s3:function(a,b,c){a._r.i5(b,c)}});var Eb=function(){Eb.superClass.constructor.call(this),this._ap=this.xk(),this._as=this.xl()};d.ext(Eb,Cb,{g1:function(a){var b=this._ap.i1(a);return b==null&&(b=new V,this._ap.z1(a,b)),b},g2:function(a){var b=this._as.i1(a);return b==null&&(b=new U,this._as.i8(a,b)),b}});var Fb=function(a){Fb.superClass.constructor.call(this),this._ay=a,this._a0=this.xk(),this._au=this.xl()};d.ext(Fb,Eb,{c2:function(a){var b=this._a0.i1(a);return b},a2:function(a,b){this._a0.z1(a,b)},h:function(){this._az==null&&(this._az=this.xk());var a=$b.a(this._ay.x0()+1),b=1;for(var c=this.x9();c.i1();){var d=this.c2(c.i9());for(var e=d.x1();e.i1();e.i2()){var f=e.i9();a[f.al()]=b}var g=new L;for(var h=d.x1();h.i1();h.i2()){var i=h.i9(),j=a[i.al()];for(var k=i.ap();k.i1();k.i2()){var l=k.i8(),m=l.a3(),n=a[m.al()];n===j&&g.ac(l)}}this._az.z1(c.i9(),g),c.i2(),b++}},d1:function(a){return this._az.i1(a)},b:function(a){return this._au.i1(a)},a3:function(a,b){this._au.i8(a,b)},a1:function(){var a=this._ay.xk(),b=fb.a4($b.a(this._ay.xh())),c=t.a1(this._ay,b,a),d=t.a5(this._ay,b,c);this.d2(a,d),this._ay.xi(a)},c1:function(a){var b=null,c=-1;for(var d=0,e=a.length;d<e;d++){var f=a[d];f.ay()>c&&(b=f,c=f.ay())}return b},d2:function(a,b){var c=this._ay.xl(),d=this._ay.xk(),e=b.length;for(var f=0;f<e;f++){var g=b[f];for(var h=g.c1();h.i1();h.i2())c.i8(h.i8(),g)}var i=this.c1(b);this.a4(i,a,c,new B,d);var j={};e=b.length;for(var k=0;k<e;k++){var l=b[k];if(l.ay()>1){var m=this.xm();j[l._id]=m}}for(var n=this._ay.x9();n.i1();n.i2()){var o=n.i9();if(a.i4(o)&&d.i1(o)==null){var p=this.xm();j[o._id]=p;var q=new bb;q.aa(o),this.a2(p,q)}}var r=$b.d(2);e=b.length;for(var s=0;s<e;s++){var t=b[s];if(t.ay()===1){var u=t.c2();r[0]=u.a2(),r[1]=u.a3();for(var v=0;v<2;v++){var w=r[v];if(w.ad()===1){var x=this.xm();j[w._id]=x;var y=new bb;y.aa(w),this.a2(x,y)}}}}for(var z=this._ay.x9();z.i1();z.i2()){var A=z.i9();if(d.i1(A)!=null){var C=d.i1(A),D=j[C._id];for(var E=A.af();E.i1();E.i2()){var F=E.i8();if(c.i1(F)!==C){var G=j[c.i1(F)._id];if(G==null){var H=F.a1(A),I=d.i1(H);I!=null?G=j[I._id]:G=j[H._id]}var J=D.aj(G),K=null;J==null?(J=this.xo(D,G),K=new L):K=this.b(J),K.aa(F),this.a3(J,K)}}}else if(a.i4(A)){var M=j[A._id];for(var N=A.af();N.i1();N.i2()){var O=N.i8(),P=O.a1(A),Q=j[P._id];if(Q!=null){var R=M.aj(Q);if(R==null){var S=this.xo(M,Q),T=new L;T.aa(O),this.a3(S,T)}}}}}if(this._ay.x0()===2&&this._ay.xg()===1){var U=this._ay.xf().i8(),V=j[U.a2()._id],W=j[U.a3()._id];if(W!=null&&V!=null&&W.aj(V)==null){var X=this.xo(V,W),Y=new L;Y.aa(U),this.a3(X,Y)}}var Z=$b.a(this._ay.x0()),$=1;e=b.length;for(var _=0;_<e;_++){var ab=b[_],cb=j[ab._id];if(cb!=null){var db=this.c2(cb);db==null&&(db=new bb,this.a2(cb,db));for(var eb=ab.c1();eb.i1();eb.i2()){var fb=eb.i8(),gb=fb.a2();Z[gb.al()]!==$&&(!a.i4(gb)||d.i1(gb)===ab)&&(Z[gb.al()]=$,db.aa(gb)),gb=fb.a3(),Z[gb.al()]!==$&&(!a.i4(gb)||d.i1(gb)===ab)&&(Z[gb.al()]=$,db.aa(gb))}}}this._ay.xj(c),this._ay.xi(d)},a4:function(a,b,c,d,e){if(d.contains(a))return;d.add(a);var f=[];for(var g=a.c1();g.i1();g.i2()){var h=g.i8();f[0]=h.a2(),f[1]=h.a3();for(var i=0;i<2;i++){var j=f[i];if(b.i4(j)&&e.i1(j)==null){a.ay()>1&&e.z1(j,a);for(var k=j.af();k.i1();k.i2()){var l=c.i1(k.i8());this.a4(l,b,c,d,e)}}}}}});var Gb=function(a,b,d,e,f){this._a={},Gb.superClass.constructor.call(this);var g=new B,h,i;for(h=0,i=b.size();h<i;h++){var j=b.get(h);if(j instanceof c.Link)g.add(j);else{var k=e&&f==null&&j instanceof F;k&&j.setExpanded(!0);var l=a.getDimension(j);k&&j.setExpanded(!1);if(l==null)continue;var m=this.xm(),n=a._repulsion;d==="rightleft"||d==="leftright"?this.s7(m,l.height*n,l.width*n):this.s7(m,l.width*n,l.height*n),m.node=j,this._a[j.getId()]=m}}for(h=0,i=g.size();h<i;h++){var o=g.get(h),p=o.getFromAgent(),q=o.getToAgent(),r=this._a[p.getId()],s=this._a[q.getId()];if(r==null||s==null||r===s)continue;this.xo(r,s)}};d.ext(Gb,Db,{});var Hb={};Hb._D=new k,Hb._E=new e(0,0),Hb.b=function(a){if(a.i1()>0){var b=new B;for(var c=a.i1()-1;c>=0;c--)b.add(a.i2(c));a.i5();for(var d=0,e=b.size();d<e;d++){var f=b.get(d);a.i4(f.x,f.y)}}var g=a.i6();a.i8(a.i7()),a.i9(g)},Hb.c=function(a){Hb.d(a,!0)},Hb.d=function(a,b){if(b)for(var c=a.xf();c.i1();c.i2()){var d=c.i8();a.gt(d,Hb._E),a.gz(d,Hb._E),a.s5(d,Hb._D)}else for(var e=a.xf();e.i1();e.i2())a.s5(e.i8(),Hb._D)},Hb.e=function(a){var b=new e(0,0);for(var c=a.xf();c.i1();c.i2()){var d=c.i8();a.gt(d,b),a.gz(d,b)}},Hb.f=function(a,b,c,d){var f=a.gc(b).b(),h=$b.d(f),i=0;for(var l=a.gc(b).c();l.i1();l.i2()){var m=l.i6();if(i<=0||!m.equals(h[i-1]))h[i]=new e(m.x,m.y),i++}f=i;if(f<2)return;var n=new B,o=new g(h[1].x-h[0].x,h[1].y-h[0].y),p=Hb.i(o);p.x*=d,p.y*=d;var q=Hb.h(h[0],p),r=Hb.h(h[1],p),s=new j(q,r);for(var t=1;t<f-1;t++){var u=s,v=Hb.i(new g(h[t+1].x-h[t].x,h[t+1].y-h[t].y));v.x*=d,v.y*=d;var w=Hb.h(h[t],v),x=Hb.h(h[t+1],v);s=new j(w,x);var y=j.a6(u,s);y!=null&&n.add(new e(y.x,y.y))}var z=new g(h[f-1].x-h[f-2].x,h[f-1].y-h[f-2].y);z=Hb.i(z),z.x*=d,z.y*=d;var A=Hb.h(h[f-1],z),C=new k(n);b.a2()===c.a2()?(a.s5(c,C),a.m2(c,q,A)):(a.s5(c,C.a()),a.m2(c,A,q))},Hb.g=function(a,b,c,d){var e=d;for(var f=c.c1();f.i1();f.i2()){var g=f.i8();Hb.f(a,b,g,e),e<0&&(e-=d),e=-e}},Hb.a=function(a,b,c){return Hb.j(a,b,c,1)},Hb.l=function(a,b,c){if(a==null||a.length<1)return b!=null&&(b.x=0,b.y=0,b.width=0,b.height=0),{width:0,height:0};var d=0,e=0;for(var f=0;f<a.length;f++){var g=a[f];d=Math.max(d,g.width),e=Math.max(e,g.height)}var h=d*e*a.length,i=Math.sqrt(h/c),j=h/i,k=Math.floor(j/d),l=Math.ceil(j/d),m=Math.ceil(a.length/k),n=Math.ceil(a.length/l),o,p;k*m<l*n?(o=k,p=m):(o=l,p=n);var q=0,r=0,s=0,t=0,u;if(d>e)for(var v=0;v<a.length;v++)u=a[v],u.x=r*d,u.y=q*e,s=Math.max(s,u.x+u.width),t=Math.max(t,u.y+u.height),++r>=o&&(q++,r=0);else for(var w=0;w<a.length;w++)u=a[w],u.x=r*d,u.y=q*e,s=Math.max(s,u.x+u.width),t=Math.max(t,u.y+u.height),++q>=p&&(r++,q=0);return b!=null&&(b.x=0,b.y=0,b.width=s,b.height=t),{width:p,height:o}},Hb.j=function(a,b,c,d){if(a==null||a.length<1)return b!=null&&(b.x=0,b.y=0,b.width=0,b.height=0),0;var e,f=e=a[0].width,g,h=g=a[0].height,i=a.length;for(var j=1;j<i;j++){var k=a[j].width;f=Math.min(f,k),e=Math.max(e,k);var l=a[j].height;h=Math.min(h,l),g=Math.max(g,l)}if(h/g>.95&&f/e>.95)return Hb.l(a,b,c).width;var m=new K,n=0;for(var o=0;o<i;o++){var p=a[o];m.aa(a[o]),n=Math.floor(n+p.width*p.height)}m.a1(function(a,b){var c=Math.floor(b.height)-Math.floor(a.height);return c===0?Math.floor(b.width)-Math.floor(a.width):c});var q=0,r=0,s=Math.floor(c*Math.sqrt(n/c)),t=s,u=0,v=new K;do{var w=new K;v.aa(w);var x,y,z=x=y=0;for(var A=m.ah();A.i1();A.i2()){var B=A.i6();z+B.width>t&&w.ay()>0?(y=Math.max(y,z),w=new K,w.aa(B),v.aa(w),z=Math.floor(B.width)):(w.aa(B),z=Math.floor(z+B.width)),w.ay()===1&&(x=Math.floor(x+w.am().height))}y=Math.max(y,z),c*x>y&&u!==y&&(v.af(),t=Math.floor(t*1.1),u=y)}while(v.ar());var C=0;for(var D=v.ah();D.i1();D.i2()){var E=0,F=D.i6();for(var G=F.ah();G.i1();G.i2()){var H=G.i6();H.x=E,H.y=C,E+=H.width}q=Math.max(q,E),C+=Hb.k(F),r=Math.max(r,C)}return b!=null&&(b.x=0,b.y=0,b.width=q,b.height=r),v.ay()},Hb.k=function(a){var b=0;for(var c=a.ah();c.i1();c.i2())b=Math.max(c.i6().height,b);return b},Hb.h=function(a,b){return new e(a.x+b.x,a.y+b.y)},Hb.i=function(a){var b=Math.sqrt(a.x*a.x+a.y*a.y);return new g(-a.y/b,a.x/b)};var Ib=function(a){this._a=a,this._b=!1};d.ext(Ib,Object,{a:function(){return this._b},b:function(){return this._a},c:function(){return this._a===1},d:function(){return this._a===2},e:function(){return this._a===4},f:function(){return this._a===8},g:function(){return this._a===0}}),Ib.h=function(a,b){var c=a.xc("A");return c==null?null:c.i1(b)},Ib.i=function(a,b){var c=a.xc("B");return c==null?null:c.i1(b)},Ib.j=function(a){switch(a){case 1:return Ib.k;case 2:return Ib.l}return null},Ib.k=new Ib(1),Ib.l=new Ib(2);var Jb=function(a,b,c,d,e){this._o=0,this._l=0,this._i=0,this._d=0,this._f=0,this._b=a,this._a=1e-4,this._r=b,this._p=1,this._e=(e.gj(a)+e.g9(a))/4;var f=.45*c*Math.sqrt(d);this._k=zb.l(-f,f),this._h=zb.l(-f,f),this._g=zb.l(-f,f)};d.ext(Jb,Object,{});var Kb=function(){this._a=0,this._c=0,this._b=0};d.ext(Kb,Object,{});var Lb=function(){Lb.superClass.constructor.call(this),this._dj=0,this._dh=0,this._dq=0,this._dp=0,this._dt=0,this._de=0,this._d3=0,this._dr=0,this._ed=0,this._dw=.65,this._ea=1,this._dl=80,this._dx=3,this._d8=!0,this._eb=3e5,this._ee=2,this._di=2,this._df=1e3};d.ext(Lb,ib,{i4:function(a){return!0},i3:function(a){if(a==null)return;this._d5=a;if(!this.s(a))return;var b=new Kb,c=0,d=Math.floor(this._dx*this._dz.length*this._dz.length+20*this._dz.length);d=Math.max(d,1e4);var e=this._ea*this._ea*this._dz.length,f=this._df;try{for(;this._dj>e&&c<d;c++){var g=this.b(c&2147483647);f--===0&&(this._dy.b()>this._eb&&(c=d),f=this._df),this.h(g,b),this.d(g,b),this.i(g,b),this._d8?(this.g(g,b),this.j(g,b)):(this.f(g,b),this.c(g,b));var h=Math.sqrt(b._a*b._a+b._c*b._c+b._b*b._b);this.ac(g,b,h),this.aa(g,b,h)}}finally{this.r()}},s:function(a){if(a==null||a.xa()<1)return!1;this._d5=a,this._dp=1,this._dy=new yb,this._dt=a.x0(),this._d2=$b.d(this._dt),this._df=1+1e5/this._dt,this._ed=1/(2*this._di),this._de=this._ed*this._ee/(this._dl*.05),this._d3=Math.pow(this._dl,-1)*this._ed,this._dr=Math.pow(this._dl,3)*this._ed,this._dj=0,this._du=new Kb,this._dq=Math.max(20*this._dl,10);var b=Math.max(.1,Math.min(this._dw*this._dl,this._dq)),c=this._dt;Hb.c(a),this._dz=$b.d(c);for(var d=a.x9();d.i1();d.i2()){var e=d.i9(),f=new Jb(e,b,this._dl,this._dt,a);this._dz[--c]=f,this._dj+=f._r,this._dh+=f._r*f._r,this._du._a+=f._k,this._du._c+=f._h,this._du._b+=f._g,this._d2[e.al()]=f}return this._d8=!1,this._dz.length>0},b:function(a){var b=this._dz.length,c=b-a%b-1,d=zb.k(c+1),e=this._dz[d];return this._dz[d]=this._dz[c],this._dz[c]=e,e},f:function(a,b){var c,d,e=c=d=0;for(var f=a._b.ae();f!=null;f=f.a7()){var g=this._d2[f.a2().al()],h=g._k-a._k,i=g._h-a._h,j=g._g-a._g,k=h*h+i*i+j*j,l,m=Math.sqrt(k),n=m-(g._e+a._e);if(n<=0)continue;l=n*n*this._d3/m,e+=h*l,c+=i*l,d+=j*l}for(var o=a._b.ag();o!=null;o=o.a8()){var p=this._d2[o.a3().al()],q=p._k-a._k,r=p._h-a._h,s=p._g-a._g,t=q*q+r*r+s*s,u,v=Math.sqrt(t),w=v-(p._e+a._e);if(w<=0)continue;u=w*w*this._d3/v,e+=q*u,c+=r*u,d+=s*u}b._a+=e,b._c+=c,b._b+=d},g:function(a,b){var c,d,e=c=d=0;this._dp++,a._f=this._dp;for(var f=a._b.ae();f!=null;f=f.a7()){var g=this._d2[f.a2().al()];g._f=this._dp;var h=g._k-a._k,i=g._h-a._h,j=g._g-a._g,k=h*h+i*i+j*j,l=Math.sqrt(k);if(l!==0){var m=Math.max(1e-6,l-(a._e+g._e)),n=-this._ef[f.a5()]/(m*m);n+=m*m*this._d1[f.a5()],n/=l,e+=h*n,c+=i*n,d+=j*n}}for(var o=a._b.ag();o!=null;o=o.a8()){var p=this._d2[o.a3().al()];p._f=this._dp;var q=p._k-a._k,r=p._h-a._h,s=p._g-a._g,t=q*q+r*r+s*s,u=Math.sqrt(t);if(u!==0){var v=Math.max(1e-6,u-(a._e+p._e)),w=-this._ef[o.a5()]/(v*v);w+=v*v*this._d1[o.a5()],w/=u,e+=q*w,c+=r*w,d+=s*w}}b._a+=e,b._c+=c,b._b+=d},j:function(a,b){var c,d,e=c=d=0;for(var f=this._dt-1;f>=0;f--){var g=this._d2[f];if(g._f!==a._f){var h=a._k-g._k,i=a._h-g._h,j=a._g-g._g,k=h*h+i*i+j*j;if(k!==0){var l=Math.sqrt(k),m=Math.max(1e-6,l-(a._e+g._e)),n=this._dr/(m*m*l);e+=h*n,c+=i*n,d+=j*n}}}b._a+=e,b._c+=c,b._b+=d},c:function(a,b){var c,d,e=c=d=0;for(var f=this._dt-1;f>=0;f--){var g=this._d2[f],h=a._k-g._k,i=a._h-g._h,j=a._g-g._g,k=h*h+i*i+j*j;if(k!==0){var l=Math.sqrt(k),m,n=l-(a._e+g._e);n<=0?m=this._dr/(1e-8*l):m=this._dr/(n*n*l),e+=h*m,c+=i*m,d+=j*m}}b._a+=e,b._c+=c,b._b+=d},i:function(a,b){var c=this._du._b/this._dt-a._g;b._b+=c*this._dl*this._dt/this._dh},d:function(a,b){if(this._de!==0){var c=this._du._a/this._dt-a._k,d=this._du._c/this._dt-a._h,e=this._du._b/this._dt-a._g;b._a+=c*this._de,b._c+=d*this._de,b._b+=e*this._de}},h:function(a,b){var c=.05*(a._r+2);c>0&&(b._a=zb.l(-c,c),b._c=zb.l(-c,c),b._b=zb.l(-c,c))},ac:function(a,b,c){if(c!==0&&a._a!==0){var d=b._a*a._o+b._c*a._l+b._b*a._i,e=d/(c*a._a);this._dh-=a._r*a._r,this._dj-=a._r,a._p*e>0?a._r+=e*.45:a._r+=e*.15,a._r>this._dq?a._r=this._dq:a._r<.1&&(a._r=.1),this._dj+=a._r,this._dh+=a._r*a._r,a._p=e}},aa:function(a,b,c){if(c>0){var d=a._r/c,e=b._a*d,f=b._c*d,g=b._b*d;a._k+=e,a._h+=f,a._g+=g,this._du._a+=e,this._du._c+=f,this._du._b+=g,a._a=c,a._o=b._a,a._l=b._c,a._i=b._b}},r:function(){for(var a=this._d2.length-1;a>=0;a--){var b=this._d2[a];this._d5.s2(b._b,b._k,b._h)}}});var Mb=function(a,b,c,d){this._e=a,this._f=b,this._a=c,this._b=d,this._c={}};d.ext(Mb,Object,{resetGroup:function(){if(!this._a||this._b!=null)return;for(var a in this._c){var b=this._c[a];this._e.isExpandGroup()?b.group.setExpanded(!0):b.group.setExpanded(b.b)}},process:function(){var a=new B;for(var b=0,d=this._f.size();b<d;b++){var e=this._f.get(b);if(e instanceof c.Link)e.isLooped()||a.add(e);else{if(this._b==null&&e.getParent()instanceof F)continue;(this._b==null||this._b!=null&&this._b!==e)&&a.add(e),this._b==null&&e instanceof F&&this.layoutGroup(e)}}return a},layoutGroup:function(a){if(!this._a||this._c[a.getId()]!=null||this._b!=null)return;this._c[a.getId()]={group:a,b:a.isExpanded()},a.setExpanded(!0);var b=new B,d=a.getChildren(),e;for(var f=0,g=d.size();f<g;f++){e=d.get(f),e instanceof F&&(this.layoutGroup(e),e.setExpanded(!1)),!(e instanceof c.Link)&&!b.contains(e)&&b.add(e);if(e instanceof E){var h=e.getLinks();if(h!=null)for(var i=0,j=h.size();i<j;i++){var k=h.get(i);b.contains(k)||b.add(k)}}}var l=this._e.getGroupLayoutType(a),m=new Gb(this._e,b,l,this._a,this._b);try{var n=null;if("round"===l)n=new xb;else if("symmetry"===l)n=new Lb;else if("hierarchic"===l)n=new Vb;else if(l==="topbottom"||l==="bottomtop"||l==="rightleft"||l==="leftright")n=new jb;if(n!=null){n.i2(m);var o=Mb.createMatrix(l),p={},q={};for(var r in m._a){var s=m._a[r],t=s.node,u=m.g4(s);p[r]=t.getCenterLocation();if(o!=null){var v=o.transform(u);t.setCenterLocation(v.x,v.y)}else t.setCenterLocation(u.x,u.y);q[r]=t.getCenterLocation()}}}catch(w){}d=a.getChildren();for(f=0,g=d.size();f<g;f++)e=d.get(f),e instanceof F&&e.setExpanded(!0)}}),Mb.createMatrix=function(a){return a==="rightleft"?l.createMatrix(Math.PI/2,0,0):a==="leftright"?l.createMatrix(-Math.PI/2,0,0):a==="bottomtop"?l.createMatrix(Math.PI,0,0):null};var Nb=function(){};d.ext(Nb,Object,{i1:function(a,b,c){var d=this.a1(a,b);return this.a2(a,b,c),d},a1:function(a,b){var c=Nb.i4(a);c.ax();var d=0;for(var e=c.x1();e.i1();e.i2())b.i7(e.i9(),-1);for(var f=c.x1();f.i1();f.i2()){var g=f.i9(),h=-1;for(var i=g.aq();i.i1();i.i2())h=Math.max(h,b.i2(i.i9()));b.i7(g,h+1),d=Math.max(d,h+1)}return d+1},a2:function(a,b,c){c.az(Nb.i3(a,b))}}),Nb.i3=function(a,b){var c=new L;for(var d=a.xf();d.i1();d.i2()){var e=d.i8();b.i2(e.a2())>b.i2(e.a3())&&(a.x3(e),c.ac(e))}return c},Nb.i4=function(a){var b=$b.a(a.xa());return(new z).a1(a,b),Nb.i2(a,b)},Nb.i2=function(a,b){var c=$b.d(a.x0());for(var d=a.x9();d.i1();d.i2()){var e=d.i9(),f=e.al();c[b[f]]=e}return new bb(c)};var Ob=function(){Ob.superClass.constructor.call(this),this.c0()};d.ext(Ob,L,{c0:function(){this._bc=1,this._bd=0}});var Pb=function(){this._m1=20,this._m2=60,this._m3=5,this._m4=0};d.ext(Pb,Object,{i4:function(a){this._m3=a},i5:function(a){this._m4=a},i3:function(a){this._m1=a},i6:function(a){this._m2=a},i2:function(a){this._m5=a},t1:function(){return this._m2},a1:function(a,b){var c=$b.d(b.length);for(var d=0;d<b.length;d++)c[d]=b[d].x1();this.a2(a,c)},a2:function(a,b){var c=$b.a(b.length),d=0;for(var f=0;f<b.length;f++){var g=0,h=b[f];h.i4();for(;h.i1();h.i2())g=Math.max(g,a.g9(h.i9()));c[f]=g,h.i4();for(;h.i1();h.i2()){var i=(c[f]-a.g9(h.i9()))/2;a.s4(h.i9(),new e(a.gi(h.i9()),d+i))}var j=this.t1();d+=c[f]+j,h.i4()}},i1:function(a,b,c){this._m6=a,this.t2(b,c)}});var Qb=function(a,b){Qb.superClass.constructor.call(this)};d.ext(Qb,Pb,{t2:function(a,b){var c=this._m6;this._a=c.xc("D"),this._h=c.xc("C"),this.a1(c,a),this.tg(c,a),this.tf(a,fb.a5(this._e),this._m5,this._l),this.tb(c,this._f[0]),this.ta(a),this.th(c,this._f[0],a),this.b(a),this.tb(c,this._f[1]),this.ta(a),this.th(c,this._f[1],a),this.b(a),this.a11(this._f[1]),this.a12(a),this.tb(c,this._f[2]),this.ta(a),this.th(c,this._f[2],a),this.b(a),this.tb(c,this._f[3]),this.ta(a),this.th(c,this._f[3],a),this.b(a),this.a11(this._f[3]),this.a12(a),this.tc(c),this.tj()},a11:function(a){for(var b=0;b<a.length;b++)a[b]=-a[b]},b:function(a){for(var b=0;b<a.length;b++){var c=a[b];c.ax()}for(var d=0;d<a.length;d++){var f=0,g=null;for(var h=a[d].x1();h.i1();h.i2()){var i=h.i9(),j=i.al();this._l[j]=f++,this._b[j]=g,this._k[j]=null,g!=null&&(this._k[g.al()]=i),g=i}}var k=this._a;this._a=this._h,this._h=k;for(var l=this._m6.xf();l.i1();l.i2()){var m=l.i8(),n=this._m6.gn(m);this._m6.gt(m,new e(-n.x,n.y));var o=this._m6.gk(m);this._m6.gz(m,new e(-o.x,o.y))}var p=this._l,q=function(a,b){return a==null&&b!=null?1:a!=null&&b==null?-1:a==null&&b==null?0:p[a.a2().al()]-p[b.a2().al()]},r=function(a,b){return a==null&&b!=null?1:a!=null&&b==null?-1:a==null&&b==null?0:p[a.a3().al()]};this._m6.x2(q,r)},a12:function(a){for(var b=this._m6.xf();b.i1();b.i2()){var c=b.i8();this._m6.x3(c);var d=this._m6.gn(c),e=this._m6.gk(c);this._m6.gz(c,d),this._m6.gt(c,e)}var f=new K;for(var g=0;g<a.length;g++)f.ae(a[g]);for(var h=0;h<a.length;h++)a[h]=f.au();var i=this._l,j=function(a,b){return a==null&&b!=null?1:a!=null&&b==null?-1:a==null&&b==null?0:i[a.a2().al()]-i[b.a2().al()]},k=function(a,b){return a==null&&b!=null?1:a!=null&&b==null?-1:a==null&&b==null?0:i[a.a3().al()]};this._m6.x2(j,k)},tg:function(a,b){var c=a.x0(),d=a.xg();this._l=$b.a(c),this._b=$b.d(c),this._k=$b.d(c),this._m=$b.d(c),this._i=$b.d(c),this._o=$b.d(c),this._f=$b.e(4,c),this._c=$b.a(c),this._g=$b.a(c),this._j=$b.a(c),this._d=$b.b(c),this._e=$b.b(d);for(var e=0;e<b.length;e++){var f=0,g=null;for(var h=b[e].x1();h.i1();h.i2()){var i=h.i9(),j=i.al();this._l[j]=f++,this._b[j]=g,this._k[j]=null,g!=null&&(this._k[g.al()]=i),g=i}}var k=this._l,l=function(a,b){return a==null&&b!=null?1:a!=null&&b==null?-1:a==null&&b==null?0:k[a.a2().al()]-k[b.a2().al()]},m=function(a,b){return a==null&&b!=null?1:a!=null&&b==null?-1:a==null&&b==null?0:k[a.a3().al()]};a.x2(l,m)},tb:function(a,b){for(var c=a.x9();c.i1();c.i2()){var d=c.i9(),e=d.al();this._m[e]=d,this._i[e]=d,b[e]=Number.MAX_VALUE,this._o[e]=d,this._c[e]=Number.MAX_VALUE,this._d[e]=!1,this._j[e]=this._g[e]=0}},ta:function(a){for(var b=1;b<a.length;b++){var c=-1;for(var d=a[b]._b;d!=null;d=d.a()){var e=d.d(),f=e.al(),g=e.ak();if(g!==0){var h=Math.floor((g+1)/2),i=Math.ceil((g+1)/2),j=1,k;for(k=e.ae();j<h;k=k.a7())j++;for(var l=!1;j<=i&&!l;j++){var m=this._m6.g2(k),n=k.a2(),o=n.al();this._i[f]===e&&!this._e[k.a5()]&&c<this._l[o]&&(c=this._l[o],this._i[o]=e,this._m[f]=this._m[o],this._i[f]=this._m[f],l=!0,this._j[o]=m.i6().x,this._g[f]=m.i7().x),k=k.a7()}}}}},th:function(a,b,c){for(var d=a.x9();d.i1();d.i2()){var e=d.i9(),f=e.al();this._m[f]===e&&this.td(a,e,b)}for(var g=0;g<c.length;g++){var h=c[g].x1();if(h.i1()){var i=c[g].x1().i9(),j=i.al();this._o[this._m[j].al()]===i&&this.tk(a,i,b)}}for(var k=a.x9();k.i1();k.i2()){var l=k.i9(),m=l.al(),n=this._c[this._o[this._m[m].al()].al()];n<Number.MAX_VALUE&&(b[m]+=n)}},td:function(a,b,c){var d=b.al();if(c[d]===Number.MAX_VALUE){c[d]=0;var e=b,f=0;do{var g=e.al();g!==d&&(f-=this._g[g]);if(this._l[g]>0){var h=this._b[g],i=this._m[this._b[g].al()],j=i.al();this.td(a,i,c),this._o[d]===b&&(this._o[d]=this._o[j]),this._o[d]===this._o[j]&&(c[d]=Math.max(c[d],c[h.al()]+this.ti(a,h,e)-f))}f+=this._j[g],e=this._i[g]}while(e!==b);f=0,e=b;do{var k=e.al();k!==d&&(f-=this._g[k]),c[k]=c[d]+f,f+=this._j[k],e=this._i[k]}while(e!==b)}},tk:function(a,b,c){var d=b.al();if(this._d[d])return;this._d[d]=!0;var e=b;do{var f=e.al(),g=this._k[f];if(g!=null){var h=g.al(),i=this._o[this._m[h].al()];if(i!==this._o[d]){var j=c[h]-c[d]-this.ti(a,e,g);this._c[i.al()]!==Number.MAX_VALUE&&(j+=this._c[i.al()]),this._c[this._o[d].al()]=Math.min(this._c[this._o[d].al()],j)}else this.tk(a,this._m[h],c)}e=this._i[f]}while(e!==b)},tc:function(a){var b=$b.a(4),c=$b.a(4);for(var d=a.x9();d.i1();d.i2()){var f=d.i9(),g=f.al();c[0]+=this._f[0][g],c[1]+=this._f[1][g],c[2]+=this._f[2][g],c[3]+=this._f[3][g]}c[0]/=a.xa(),c[1]/=a.xa(),c[2]/=a.xa(),c[3]/=a.xa();for(var h=a.x9();h.i1();h.i2()){var i=h.i9(),j=i.al(),k=a.g4(i);b[0]=this._f[0][j]-c[0],b[1]=this._f[1][j]-c[1],b[2]=this._f[2][j]-c[2],b[3]=this._f[3][j]-c[3],b.sort($b.n);var l=(b[1]+b[2])/2;a.s1(i,new e(l,k.y))}},ti:function(a,b,c){var d=a.gj(b),e=a.gj(c),f;return d>1&&e>1?f=this._m1+(d+e)/2:f=this._m3+(d+e)/2,this._l[b.al()]<this._l[c.al()]?(this._a!=null&&(f+=this._a.i3(c)),this._h!=null&&(f+=this._h.i3(b))):(this._a!=null&&(f+=this._a.i3(b)),this._h!=null&&(f+=this._h.i3(c))),f},tj:function(){this._l=null,this._b=null,this._k=null,this._e=null,this._m=null,this._i=null,this._f=null,this._c=null,this._o=null,this._d=null,this._j=null,this._g=null},tf:function(a,b,c,d){var e=a.length;for(var f=2;f<e-1;f++){var g=-1,h=0,i=0,j=a[f].x1();for(var k=a[f].x1();k.i1();k.i2()){var l=k.i9(),m=null,n=!1;l.ak()===1&&(m=l.ae().a2(),c.i1(m)!=null&&c.i1(l)!=null&&(n=!0));if(i===a[f].ay()-1||n){var o=n?d[m.al()]:a[f-1].ay();for(;h<=i;h++){var p=j.i9();for(var q=p.am();q.i1();q.i2()){var r=q.i8(),s=d[r.a2().al()];(s<g||s>o)&&b.i7(q.i8(),!0)}j.i2()}g=o}i++}}}});var Rb=function(a,b){this._b=20,this._a=b,this._d=a,this._f={}};d.ext(Rb,Object,{a3:function(a){this._b=a},a4:function(a,b,c,d,e){if(this.a2(a)){var f=this.b2(a);f._o=b,f._m=e,f._n=d,f._f=c}},b2:function(a){var b=this._f[a._id];return b==null&&(b=new Sb,this._f[a._id]=b),b},a2:function(a){return this._f[a._id]!=null},c:function(){var a=fb.a1($b.a(this._d.xa())),b=fb.a1($b.a(this._d.xa()));for(var c=this._d.x9();c.i1();c.i2()){var d=c.i9();if(this.a2(d)){var e=this.b2(d);a.i6(d,this._b*(e.c()-1)),b.i6(d,this._b*(e.b()-1))}}this._d.x1("D",a),this._d.x1("C",b)},g:function(){this._d.x6("D"),this._d.x6("C")},f:function(){for(var a=this._d.x9();a.i1();a.i2()){var b=a.i9();if(this.a2(b)){var c=this._d.gi(b),d=this._d.gh(b),f=this._d.gj(b),g=this._d.g9(b),h=this.b2(b),i=h._q.ay()+h._b.ay()+h._f,j=h._d.ay()+h._g.ay()+h._o,k=h._i.ay()+h._l.ay()+h._n,l=h._h.ay()+h._k.ay()+h._m,m=this._a.a7(f,i),n=this._a.a7(f,j),o=this._a.a7(g,l),p=this._a.a7(g,k);h.a2(this._a.a8(f,i,m),this._a.a8(f,j,n),this._a.a8(g,l,o),this._a.a8(g,k,p));for(var q=h._j.c1();q.i1();q.i2()){var r=q.i8(),s=this.a1(r),t=this.b1(r),u=new K;if(s.b()===t.b())s.c()?(u.aa(new e(c+h._g._bd*n+h._c,d)),u.aa(new e(c+h._g._bd*n+h._c,d-this._b)),h._g._bd++,u.aa(new e(c+h._g._bd*n+h._c,d-this._b)),u.aa(new e(c+h._g._bd*n+h._c,d)),h._g._bd++,h._g._bc=Math.max(h._g._bc,2)):s.d()?(u.aa(new e(c+h._b._bd*m+h._p,d+g)),u.aa(new e(c+h._b._bd*m+h._p,d+g+this._b)),h._b._bd++,u.aa(new e(c+h._b._bd*m+h._p,d+g+this._b)),u.aa(new e(c+h._b._bd*m+h._p,d+g)),h._b._bd++,h._b._bc=Math.max(h._b._bc,2)):s.f()?(u.aa(new e(c,d+h._i._bd*p+h._a)),u.aa(new e(c-this._b,d+h._i._bd*p+h._a)),h._i._bd++,u.aa(new e(c-this._b,d+h._i._bd*p+h._a)),u.aa(new e(c,d+h._i._bd*p+h._a)),h._i._bd++,h._i._bc=Math.max(h._i._bc,2)):s.e()&&(u.aa(new e(c+f,d+h._h._bd*o+h._e)),u.aa(new e(c+f+this._b,d+h._h._bd*o+h._e)),h._h._bd++,u.aa(new e(c+f+this._b,d+h._h._bd*o+h._e)),u.aa(new e(c+f,d+h._h._bd*o+h._e)),h._h._bd++,h._h._bc=Math.max(h._h._bc,2)),this._d.m1(r,u);else if(s.c()||t.c()){if(s.e()||t.e())u.aa(new e(c+f-h._d._bd*n-h._c,d)),u.aa(new e(c+f-h._d._bd*n-h._c,d-this._b*h._d._bc)),u.aa(new e(c+f+this._b*h._h._bc,d-this._b*h._d._bc)),u.aa(new e(c+f+this._b*h._h._bc,d+h._h._bd*o+h._e)),u.aa(new e(c+f,d+h._h._bd*o+h._e)),h._d._bd++,h._d._bc++,h._h._bd++,h._h._bc++,t.c()&&u.ax(),this._d.m1(r,u);else if(s.f()||t.f())u.aa(new e(c+h._g._bd*n+h._c,d)),u.aa(new e(
c+h._g._bd*n+h._c,d-this._b*h._g._bc)),u.aa(new e(c-this._b*h._i._bc,d-this._b*h._g._bc)),u.aa(new e(c-this._b*h._i._bc,d+h._i._bd*p+h._a)),u.aa(new e(c,d+h._i._bd*p+h._a)),h._g._bd++,h._g._bc++,h._i._bd++,h._i._bc++,t.c()&&u.ax(),this._d.m1(r,u);else if(s.d()||t.d())u.aa(new e(c+f-h._d._bd*n-h._c,d)),u.aa(new e(c+f-h._d._bd*n-h._c,d-this._b*h._d._bc)),u.aa(new e(c+f+this._b*h.b(),d-this._b*h._d._bc)),u.aa(new e(c+f+this._b*h.b(),d+g+this._b*h._q._bc)),u.aa(new e(c+f-h._q._bd*m-h._p,d+g+this._b*h._q._bc)),u.aa(new e(c+f-h._q._bd*m-h._p,d+g)),h._d._bd++,h._d._bc++,h._k._bc++,h._h._bc++,h._q._bc++,h._q._bd++,t.c()&&u.ax(),this._d.m1(r,u)}else if(s.d()||t.d()){if(s.e()||t.e())u.aa(new e(c+f-h._q._bd*m-h._p,d+g)),u.aa(new e(c+f-h._q._bd*m-h._p,d+g+this._b*h._q._bc)),u.aa(new e(c+f+this._b*h._k._bc,d+g+this._b*h._q._bc)),u.aa(new e(c+f+this._b*h._k._bc,d+g-h._k._bd*o-h._e)),u.aa(new e(c+f,d+g-h._k._bd*o-h._e)),h._q._bd++,h._q._bc++,h._k._bd++,h._k._bc++,t.d()&&u.ax(),this._d.m1(r,u);else if(s.f()||t.f())u.aa(new e(c+h._b._bd*m+h._p,d+g)),u.aa(new e(c+h._b._bd*m+h._p,d+g+this._b*h._b._bc)),u.aa(new e(c-this._b*h._l._bc,d+g+this._b*h._b._bc)),u.aa(new e(c-this._b*h._l._bc,d+g-h._l._bd*p-h._a)),u.aa(new e(c,d+g-h._l._bd*p-h._a)),h._b._bd++,h._b._bc++,h._l._bd++,h._l._bc++,t.d()&&u.ax(),this._d.m1(r,u)}else u.aa(new e(c,d+g-h._l._bd*p-h._a)),u.aa(new e(c-this._b*h._l._bc,d+g-h._l._bd*p-h._a)),u.aa(new e(c-this._b*h._l._bc,d+g+this._b*h.a1())),u.aa(new e(c+f+this._b*h._k._bc,d+g+this._b*h.a1())),u.aa(new e(c+f+this._b*h._k._bc,d+g-h._k._bd*o-h._e)),u.aa(new e(c+f,d+g-h._k._bd*o-h._e)),h._l._bd++,h._l._bc++,h._b._bc++,h._q._bc++,h._k._bc++,h._k._bd++,t.f()&&u.ax(),this._d.m1(r,u)}}}},a5:function(a,b){for(var c=0;c<a.length;c++){var d=a[c],e=b[c];for(var f=d.x1();f.i1();f.i2()){var g=f.i9();if(this.a2(g)){var h=this.b2(g);e._g=Math.max(e._g,this._b*(h.d()-1)),e._j=Math.max(e._j,this._b*(h.a1()-1))}}}},a1:function(a){var b=this._d.xc("A"),c=null;b!=null&&(c=b.i1(a));if(c==null||c.g()){var d=this._d.xc("B");if(d==null)return Ib.j(1);var e=d.i1(a);if(e==null||e.g())return Ib.j(1);if(e.c())return Ib.j(8);if(e.f())return Ib.j(1);if(e.d())return Ib.j(4);if(e.e())return Ib.j(2)}return c},b1:function(a){var b=this._d.xc("B"),c=null;b!=null&&(c=b.i1(a));if(c==null||c.g()){var d=this._d.xc("A");if(d==null)return Ib.j(8);var e=d.i1(a);if(e==null||e.g())return Ib.j(8);if(e.c())return Ib.j(8);if(e.f())return Ib.j(1);if(e.d())return Ib.j(4);if(e.e())return Ib.j(2)}return c}});var Sb=function(){this._o=0,this._f=0,this._n=0,this._m=0,this._c=0,this._p=0,this._e=0,this._a=0,this._j=new L,this._g=new Ob,this._d=new Ob,this._b=new Ob,this._q=new Ob,this._h=new Ob,this._k=new Ob,this._i=new Ob,this._l=new Ob};d.ext(Sb,Object,{a1:function(){return Math.max(this._q._bc,this._b._bc)},d:function(){return Math.max(this._d._bc,this._g._bc)},b:function(){return Math.max(this._k._bc,this._h._bc)},c:function(){return Math.max(this._l._bc,this._i._bc)},a2:function(a,b,c,d){this._c=b,this._a=d,this._p=a,this._e=c,this._g.c0(),this._d.c0(),this._b.c0(),this._q.c0(),this._k.c0(),this._h.c0(),this._l.c0(),this._i.c0()}});var Tb=function(a,b,c,d){this._k=20,this._r=.5,this._d=a,this._c=b,this._j=c,this._m=d,this._i=a.xc("A")!=null||a.xc("B")!=null,this._t=new Wb(a,b,c,d),this._b=new Rb(a,this)};d.ext(Tb,Object,{a6:function(a){this._k=a,this._t.a1(a),this._b.a3(a)},g1:function(){return this._k},a9:function(a){return this.c1(),a},a5:function(a){return this.a1(),a},b3:function(a){return this.c1(),a=this.c4(a),this._b.c(),a},g2:function(a){return this._b.g(),a},e2:function(a){a=this.f(a),this._b.f()},e1:function(){this._t.d(),this._n!=null&&this._d.xi(this._n),this.a1(),this._d=null},a1:function(){if(!this._i)return;this._q!=null&&(this._d.x1("A",this._q),this._q=null),this._p!=null&&(this._d.x1("B",this._p),this._p=null),this._h!=null&&(this._d.xj(this._h),this._h=null),this._l!=null&&(this._d.xj(this._l),this._l=null)},c1:function(){if(!this._i)return;this._h==null&&(this._h=this._d.xl()),this._l==null&&(this._l=this._d.xl());for(var a=this._d.xf();a.i1();a.i2()){var b=a.i8(),c=this._j.i1(b.a2())!=null,d=this._j.i1(b.a3())!=null;if(c&&!d){var e=this._j.i1(b.a2());this._m.i4(e)?this._l.i8(b,Ib.h(this._d,e)):this._l.i8(b,Ib.i(this._d,e))}else if(!c&&d){var f=this._j.i1(b.a3());this._m.i4(f)?this._h.i8(b,Ib.i(this._d,f)):this._h.i8(b,Ib.h(this._d,f))}else!c&&!d&&(this._m.i4(b)?(this._h.i8(b,Ib.i(this._d,b)),this._l.i8(b,Ib.h(this._d,b))):(this._h.i8(b,Ib.h(this._d,b)),this._l.i8(b,Ib.i(this._d,b))))}this._q=this._d.xc("A"),this._p=this._d.xc("B"),this._d.x1("A",this._h),this._d.x1("B",this._l)},c4:function(a){this._n=this._d.xk(),this._a=this._d.xl(),this._g=this._d.xl();var b=new L,c=new L,d=new L,f=new L,g=new L,h=new L,i=new L,j=new L,k=new L,l=this._d.xk();for(var m=0;m<a.length;m++){var n=0;for(var o=a[m].x1();o.i1();)l.i6(o.i9(),n),o.i2(),n++}var p=function(a,b){var c=l.i3(a.a3())-l.i3(b.a3());return c<=0?c>=0?0:-1:1},q=function(a,b){var c=l.i3(a.a2())-l.i3(b.a2());return c<=0?c>=0?0:-1:1};for(var r=0;r<a.length;r++){var s=a[r];for(var t=s._b;t!=null;t=t.a()){var u=t.d();u.av(p),u.au(q);var v=0;b.af(),c.af(),d.af(),f.af(),g.af(),h.af(),i.af(),j.af(),k.af();for(var w=u.ap();w.i1();){var x=w.i8(),y=this.b1(x);y==null||y.d()||y.g()?d.aa(x):y.e()?b.aa(x):y.f()?(c.aa(x),k.aa(x)):y.c()&&(j.aa(x),k.aa(x)),w.i2(),v++}v=0;for(var z=u.am();z.i1();){var A=z.i8(),B=this.a2(A);B==null||B.c()||B.g()?f.aa(A):B.e()?b.aa(A):B.f()?(c.aa(A),k.aa(A)):B.d()&&(h.aa(A),k.aa(A)),z.i2(),v++}var C=l.i3(u);if(!k.ar()){var D=.1/k.ay();for(var E=C-.4;!k.ar();E+=D){var F=k.c3();if(F.a2()===u){var G=this._d.xm();this._n.z1(G,F.a2()),this._d.s7(G,1,1),this._c.z1(G,this._c.i1(u)),l.i6(G,E),this._a.i8(F,this._d.gn(F)),this._d.gt(F,zb._A),this._d.xr(F,G,F.a3()),s.ao(G,t)}else{var H=this._d.xm();this._n.z1(H,F.a3()),this._d.s7(H,1,1),this._c.z1(H,this._c.i1(u)),l.i6(H,E),this._g.i8(F,this._d.gk(F)),this._d.gz(F,zb._A),this._d.xr(F,F.a2(),H),s.ao(H,t)}}}if(!b.ar()){var I=.1/b.ay();for(var J=C+.1;!b.ar();J+=I){var K=b.c3();if(K.a2()===u){var M=this._d.xm();this._n.z1(M,K.a2()),this._d.s7(M,1,1),this._c.z1(M,this._c.i1(u)),l.i6(M,J),this._a.i8(K,this._d.gn(K)),this._d.gt(K,zb._A),this._d.xr(K,M,K.a3()),t=s.an(M,t)}else{var N=this._d.xm();this._n.z1(N,K.a3()),this._d.s7(N,1,1),this._c.z1(N,this._c.i1(u)),l.i6(N,J),this._g.i8(K,this._d.gk(K)),this._d.gz(K,zb._A),this._d.xr(K,K.a2(),N),t=s.an(N,t)}}}var O=Tb._z;this._b.a2(u)&&(O=this._b.b2(u));var P=O._b.ay()+h.ay()+u.ao()+g.ay()+O._q.ay();if(P>0){var Q=this._d.g9(u)/2,R=this._d.gj(u),S=this.a7(R,P),T=-0.5*R+this.a8(this._d.gj(u),P,S)+S*(O._b.ay()+h.ay());for(var U=u.ap();U.i1();U.i2()){var V=U.i8();!this.c2(V)&&this._j.i1(V.a2())==null&&(this._d.g2(V).i8(new e(T,Q)),T+=S)}}var W=this._t.a3(u),X=0,Y=0,Z=0,$=0;W!=null&&(X=W._e.ay(),Y=W._c.ay(),Z=W._b.ay(),$=W._d.ay()),P=O._g.ay()+X+j.ay()+u.ak()+i.ay()+Y+O._d.ay();if(P>0){var _=this._d.gj(u),ab=this.a7(_,P),bb=this.a8(_,P,ab),cb=-0.5*_+bb+ab*(O._g.ay()+X+j.ay()),db=-this._d.g9(u)/2;for(var eb=u.am();eb.i1();eb.i2()){var fb=eb.i8();!this.d1(fb)&&this._j.i1(fb.a3())==null&&(this._d.g2(fb).i9(new e(cb,db)),cb+=ab)}if(W!=null){var gb=-0.5*_+bb+ab*(O._g.ay()+j.ay()+W._e.ay()-1);for(var hb=W._e.c1();hb.i1();hb.i2()){var ib=hb.i8();this._d.u1(ib),ib.a2()===u&&!this.c2(ib)?(this._d.g2(hb.i8()).i8(new e(gb,db)),gb-=ab):this.d1(ib)||(this._d.g2(hb.i8()).i9(new e(gb,db)),gb-=ab),this._d.h1(ib)}gb=.5*_-bb-ab*(O._d.ay()+i.ay());for(var jb=W._c.c1();jb.i1();jb.i2()){var kb=jb.i8();this._d.u1(kb),kb.a2()===u&&!this.c2(kb)?(this._d.g2(jb.i8()).i8(new e(gb,db)),gb-=ab):this.d1(kb)||(this._d.g2(jb.i8()).i9(new e(gb,db)),gb-=ab),this._d.h1(kb)}}}this._b.a2(u)&&this._b.a4(u,X+j.ay()+u.ak()+i.ay()+Y,h.ay()+u.ao()+g.ay(),Z+c.ay(),$+b.ay())}}return this._d.xi(l),a},a7:function(a,b){return b<=1?0:a/(b-1+2*this._r)},a8:function(a,b,c){return b<=1?a*.5:(a-c*(b-1))*.5},f:function(a){var b=this.g1();this._f=this._d.xk();for(var c=0;c<a.length;c++){var d=a[c];for(var f=d._b;f!=null;){var g=f.d(),h=this._n.i1(g);if(h!=null||this._t.b2(g))f=f.a();else{var i=new bb,j=new bb,k=new bb,l=new bb,m=new bb,n=new bb,o=new L,p=new L,q=new Zb(i,j,k,l,m,n,o,p);this._f.z1(g,q),o.ab(g.am()),p.ab(g.ap());for(var r=f.b();r!=null&&this._n.i1(r.d())===g;r=r.b()){var s=r.d(),t=this.c3(s);t.f()?j.ac(s):t.c()?l.ac(s):t.d()&&n.ac(s)}var u;for(u=f.a();u!=null&&this._n.i1(u.d())===g;u=u.a()){var v=u.d(),w=this.c3(v);w.e()?i.aa(v):w.c()?k.aa(v):w.d()&&m.aa(v)}f=u}}}var x=this.d2(a),y=0;for(var z=0;z<a.length;z++){var A=x[z];z>0&&(y+=x[z-1]._j+x[z-1]._h+x[z-1]._b),y+=A._g+A._f+A._a+A._d;for(var B=a[z].x1();B.i1();B.i2()){var C=B.i9();this._d.s3(C,this._d.gi(C),this._d.gh(C)+y)}A._c+=y,A._i+=y}for(var D=0;D<a.length;D++){var E=a[D];for(var F=E.x1();F.i1();F.i2()){var G=F.i9();this._n.i1(G)!=null&&E.av(F)}}var H=this,I=function(a,b){return H.a3(a)?H.a3(b)?H._d.gi(a)>=H._d.gi(b)?-1:1:1:H.a3(b)?-1:H._d.gi(a)>=H._d.gi(b)?1:-1},J=function(a,b){return H.a3(a)?H.a3(b)?H._d.gi(a)>=H._d.gi(b)?1:-1:1:H.a3(b)?-1:H._d.gi(a)>=H._d.gi(b)?-1:1};for(var K=0;K<a.length;K++){var M=x[K];for(var N=a[K].x1();N.i1();N.i2()){var O=N.i9();if(!this._t.b2(O)){var P=this._f.i1(O),Q=P._d,R=P._a,S=P._b,T=P._h,U=P._f,V=P._c,W=P._g,X=P._e,Y=0,Z=0,$=0,_=0,ab=O.ao(),cb=O.ak(),db=this._d.gi(O),eb=this._d.gh(O),fb=this._d.gj(O),gb=this._d.g9(O),hb=this._t.a3(O),ib=Tb._z;this._b.a2(O)&&(ib=this._b.b2(O));if(hb!=null){Y=hb._d.ay(),Z=hb._b.ay(),$=hb._e.ay(),_=hb._c.ay();if(Y>0){var jb=ib._h.ay()+Q.ay()+Y+ib._k.ay(),kb=this.a7(gb,jb),lb=this.a8(gb,jb,kb),mb=eb+lb+kb*(ib._h.ay()+this.a4(Q));for(var nb=hb._d.c1();nb.i1();nb.i2()){var ob=nb.i8();this._d.u1(ob),ob.a2()===O?this.c2(ob)||this._d.gx(ob,new e(db+fb,mb)):(!this.d1(ob),this._d.gy(ob,new e(db+fb,mb))),mb+=kb,this._d.h1(ob)}}if(Z>0){var pb=ib._i.ay()+R.ay()+Z+ib._l.ay(),qb=this.a7(gb,pb),rb=this.a8(gb,pb,qb),sb=eb+rb+qb*(ib._i.ay()+this.a4(R));for(var tb=hb._b.c1();tb.i1();tb.i2()){var ub=tb.i8();this._d.u1(ub),ub.a2()===O?this.c2(ub)||this._d.gx(ub,new e(db,sb)):this.d1(ub)||this._d.gy(ub,new e(db,sb)),sb+=qb,this._d.h1(ub)}}}if(Q.ay()>0){Q.a1(I);var vb=ib._h.ay()+Q.ay()+Y+ib._k.ay(),wb=this.a7(gb,vb),xb=this.a8(gb,vb,wb),yb=eb+xb+wb*ib._h.ay(),zb=!0;while(!Q.ar()){var Ab=Q.x4();if(this.a3(Ab)){zb&&(zb=!1,yb+=wb*Y);var Bb=Ab.ag(),Cb=this._d.gd(Bb),Db=Cb.at();Cb.ac(new e(Db.x,M.b()));if(this.c2(Bb)){var Eb=this._a.i1(Bb);Cb.ac(new e(Db.x,Eb.y+this._d.g6(O))),Cb.ac(new e(Eb.x+this._d.g5(O),Eb.y+this._d.g6(O)))}else Cb.ac(new e(Db.x,yb)),Cb.ac(new e(db+fb,yb));this._d.xr(Bb,O,Bb.a3()),this._d.m1(Bb,Cb)}else{var Fb=Ab.ae(),Gb=this._d.gd(Fb),Hb=Gb.au();Gb.ae(new e(Hb.x,M.a()));if(this.d1(Fb)){var Ib=this._g.i1(Fb);Gb.ae(new e(Hb.x,Ib.y+this._d.g6(O))),Gb.ae(new e(Ib.x+this._d.g5(O),Ib.y+this._d.g6(O)))}else Gb.ae(new e(Hb.x,yb)),Gb.ae(new e(db+fb,yb));this._d.xr(Fb,Fb.a2(),O),this._d.m1(Fb,Gb)}this._d.x4(Ab),yb+=wb}}if(R.ay()>0){R.a1(J);var Jb=ib._i.ay()+R.ay()+Z+ib._l.ay(),Kb=this.a7(gb,Jb),Lb=this.a8(gb,Jb,Kb),Mb=eb+Lb+Kb*ib._i.ay(),Nb=!0;while(!R.ar()){var Ob=R.x4();if(this.a3(Ob)){Nb&&(Nb=!1,Mb+=Kb*Z);var Pb=Ob.ag(),Qb=this._d.gd(Pb),Rb=Qb.at();Qb.ac(new e(Rb.x,M.b()));if(this.c2(Pb)){var Sb=this._a.i1(Pb);Qb.ac(new e(Rb.x,Sb.y+this._d.g6(O))),Qb.ac(new e(Sb.x+this._d.g5(O),Sb.y+this._d.g6(O)))}else Qb.ac(new e(Rb.x,Mb)),Qb.ac(new e(db,Mb));this._d.xr(Pb,O,Pb.a3()),this._d.m1(Pb,Qb)}else{var Ub=Ob.ae(),Vb=this._d.gd(Ub),Wb=Vb.au();Vb.ae(new e(Wb.x,M.a()));if(this.d1(Ub)){var Xb=this._g.i1(Ub);Vb.ae(new e(Wb.x,Xb.y+this._d.g6(O))),Vb.ae(new e(Xb.x+this._d.g5(O),Xb.y+this._d.g6(O)))}else Vb.ae(new e(Wb.x,Mb)),Vb.ae(new e(db,Mb));this._d.xr(Ub,Ub.a2(),O),this._d.m1(Ub,Vb)}this._d.x4(Ob),Mb+=Kb}}var Yb=ib._g.ay()+ib._d.ay()+cb+T.ay()+S.ay()+$+_;fb=this._d.gj(O);var $b=this.a7(fb,Yb),_b=this.a8(fb,Yb,$b);Yb=ib._b.ay()+ib._q.ay()+ab+V.ay()+U.ay();var ac=this.a7(fb,Yb),bc=this.a8(fb,Yb,ac);if(T.ay()>0){var cc=$b,dc=b,ec=this._d.gi(O)+_b+cc*(ib._g.ay()+T.ay()-1),fc=this._d.gh(O),gc=M._c-M._g-T.ay()*dc,hc;for(;!T.ar();this._d.x4(hc)){hc=T.x4();var ic=hc.ag(),jc=this._d.gd(ic),kc=jc.at();jc.ac(new e(kc.x,M.b())),jc.ac(new e(kc.x,gc));if(this.c2(ic)){var lc=this._a.i1(ic);jc.ac(new e(lc.x+this._d.g5(O),gc)),jc.ac(new e(lc.x+this._d.g5(O),lc.y+this._d.g6(O)))}else jc.ac(new e(ec,gc)),jc.ac(new e(ec,fc)),ec-=cc;gc+=dc,this._d.xr(ic,O,ic.a3()),this._d.m1(ic,jc)}}if(S.ay()>0){var mc=$b,nc=b,oc=this._d.gi(O)+this._d.gj(O)-_b-mc*ib._d.ay(),pc=this._d.gh(O),qc=M._c-M._g-nc,rc;for(;!S.ar();this._d.x4(rc)){rc=S.x4();var sc=rc.ag(),tc=this._d.gd(sc),uc=tc.at();tc.ac(new e(uc.x,M.b())),tc.ac(new e(uc.x,qc));if(this.c2(sc)){var vc=this._a.i1(sc);tc.ac(new e(vc.x+this._d.g5(O),qc)),tc.ac(new e(vc.x+this._d.g5(O),vc.y+this._d.g6(O)))}else tc.ac(new e(oc,qc)),tc.ac(new e(oc,pc)),oc-=mc;qc-=nc,this._d.xr(sc,O,sc.a3()),this._d.m1(sc,tc)}}if(V.ay()>0){var wc=ac,xc=b,yc=this._d.gi(O)+bc+wc*(ib._b.ay()+V.ay()-1),zc=this._d.gh(O)+this._d.g9(O),Ac=zc+V.ay()*xc,Bc;for(;!V.ar();this._d.x4(Bc)){Bc=V.x4();var Cc=Bc.ae(),Dc=this._d.gd(Cc),Ec=Dc.au();Dc.ae(new e(Ec.x,M.a())),Dc.ae(new e(Ec.x,Ac));if(this.d1(Cc)){var Fc=this._g.i1(Cc);Dc.ae(new e(Fc.x+this._d.g5(O),Ac)),Dc.ae(new e(Fc.x+this._d.g5(O),Fc.y+this._d.g6(O)))}else Dc.ae(new e(yc,Ac)),Dc.ae(new e(yc,zc)),yc-=wc;Ac-=xc,this._d.xr(Cc,Cc.a2(),O),this._d.m1(Cc,Dc)}}if(U.ay()>0){var Gc=ac,Hc=b,Ic=this._d.gi(O)+this._d.gj(O)-bc-ac*ib._q.ay(),Jc=this._d.gh(O)+this._d.g9(O),Kc=Jc+Hc,Lc;for(;!U.ar();this._d.x4(Lc)){Lc=U.x4();var Mc=Lc.ae(),Nc=this._d.gd(Mc),Oc=Nc.au();Nc.ae(new e(Oc.x,M.a())),Nc.ae(new e(Oc.x,Kc));if(this.d1(Mc)){var Pc=this._g.i1(Mc);Nc.ae(new e(Pc.x+this._d.g5(O),Kc)),Nc.ae(new e(Pc.x+this._d.g5(O),Pc.y+this._d.g6(O)))}else Nc.ae(new e(Ic,Kc)),Nc.ae(new e(Ic,Jc)),Ic-=Gc;Kc+=Hc,this._d.xr(Mc,Mc.a2(),O),this._d.m1(Mc,Nc)}}while(!X.ar()){var Qc=X.c3(),Rc=this._d.gl(Qc);M.a()+12<Rc.y&&this._d.g7(Qc).i4(Rc.x,M.a())}while(!W.ar()){var Sc=W.c3(),Tc=this._d.gs(Sc);if(M.b()-12>Tc.y){var Uc=this._d.gf(Sc);Uc.ac(new e(Tc.x,M.b())),this._d.s6(Sc,Uc)}}}}}for(var Vc=0;Vc<a.length;Vc++){var Wc=a[Vc];for(var Xc=Wc._b;Xc!=null;Xc=Xc.a()){var Yc=Xc.d(),Zc=this._t.a3(Yc);Zc!=null&&Zc._a!=null&&(this._d.x4(Zc._a),Wc.aw(Xc.b()))}}return this._d.xi(this._f),this._d.xj(this._a),this._d.xj(this._g),a},c3:function(a){return this.a3(a)?this.b1(a.ag()):this.a2(a.ae())},b1:function(a){return this._h==null?Tb.s:this._h.i1(a)},a2:function(a){return this._l==null?Tb.u:this._l.i1(a)},c2:function(a){if(a==null)return!1;var b=this.b1(a);return b!=null&&b.a()},d1:function(a){if(a==null)return!1;var b=this.a2(a);return b!=null&&b.a()},a3:function(a){return a.ao()===1},b2:function(a){return a.ak()===1},a4:function(a){var b=0;for(var c=a._b;c!=null;c=c.a())this.b2(c.d())&&b++;return b},d2:function(a){var b=this._k,c=$b.d(a.length+1);for(var d=0;d<a.length;d++){var e=a[d],f=new Xb;c[d]=f,f._c=Number.MAX_VALUE,f._i=Number.MIN_VALUE;for(var g=e.x1();g.i1();g.i2()){var h=g.i9(),i=this._d.gb(h);f._c=Math.min(f._c,i.i2()),f._i=Math.max(f._i,i.i2()+i.i4())}}this._b.a5(a,c);for(var j=0;j<a.length;j++){var k=c[j];for(var l=a[j].x1();l.i1();l.i2()){var m=l.i9(),n=this._f.i1(m);n!=null&&(k._h=Math.max(k._h,Math.max(n._f.ay()*b,n._c.ay()*b)),k._f=Math.max(k._f,Math.max(n._b.ay()*b,n._h.ay()*b)))}}return c}}),Tb.s=Ib.j(2),Tb.u=Ib.j(1),Tb._z=new Sb;var Ub=function(){this._af=0,this._b=0};d.ext(Ub,Object,{ib:function(a){this._af=a},ia:function(a,b,c){this.a6(a,b,c),this.b2(!1);var d=this.g();if(this.o()&&d>0){var e=this.r();for(var f=0;f<20&&d>0&&this.o();f++){this.b2(!0);var g=this.g();g<d&&(this.a7(e),d=g)}this.b3(e),this.b1()}return this.c()},a6:function(a,b,c){this._b=(new Date).getTime(),this._ac=a,this._ah=b;var d=this;this._p=function(a,b){var c=d._n[a.al()]-d._n[b.al()];return c>0?1:c>=0?0:-1},this._ad=$b.d(c);for(var e=0;e<this._ad.length;e++)this._ad[e]=new bb;this._ab=$b.a(this._ac.x0()),this._f=$b.d(this._ac.x0()),this._n=$b.a(this._ac.x0()+1);var f=this._ab;this._o=function(a,b){if(a==null&&b!=null)return 1;if(a!=null&&b==null)return-1;if(a==null&&b==null)return 0;var c=a,d=b,e=c._h,g=c.a2(),h=d.a2(),i=f[g.al()]-f[h.al()];if(i===0){var j=Ub.b(Ib.h(e,c),e.gn(c)),k=Ub.b(Ib.h(e,d),e.gn(d)),l=j-k;if(l===0){var m=f[c.a3().al()]-f[d.a3().al()];if(m===0){var n=Ub.a(Ib.i(e,c),e.gk(c)),o=Ub.a(Ib.i(e,d),e.gk(d));return n-o}return m}return l}return i},this._l=function(a,b){if(a==null&&b!=null)return 1;if(a!=null&&b==null)return-1;if(a==null&&b==null)return 0;var c=a,d=b,e=c._h,g=c.a3(),h=d.a3(),i=f[g.al()]-f[h.al()];if(i===0){var j=Ub.a(Ib.i(e,c),e.gk(c)),k=Ub.a(Ib.i(e,d),e.gk(d)),l=j-k;if(l===0){var m=f[c.a2().al()]-f[d.a2().al()];if(m===0){var n=Ub.b(Ib.h(e,c),e.gn(c)),o=Ub.b(Ib.h(e,d),e.gn(d));return n-o}return m}return l}return i},this._z=function(a,b){if(a==null&&b!=null)return 1;if(a!=null&&b==null)return-1;if(a==null&&b==null)return 0;var c=a,d=b,e=c._h,f=Ub.b(Ib.h(e,c),e.gn(c)),g=Ub.b(Ib.h(e,d),e.gn(d));return f-g},this._e=function(a,b){if(a==null&&b!=null)return 1;if(a!=null&&b==null)return-1;if(a==null&&b==null)return 0;var c=a,d=b,e=c._h,f=Ub.a(Ib.i(e,c),e.gk(c)),g=Ub.a(Ib.i(e,d),e.gk(d));return f-g},this._ac.x2(this._e,this._z)},c:function(){this._ah=null,this._aa=null,this._f=null,this._n=null,this._p=null,this._o=null,this._l=null,this._ac=null;var a=this._ad;return this._ad=null,a},o:function(){var a=(new Date).getTime()-this._b;return a<=this._af},m:function(){var a=this,b=function(b,c){return Math.ceil(a._n[b.a3().al()])-Math.ceil(a._n[c.a3().al()])};for(var c=this._ac.x9();c.i1();c.i2()){for(var d=c.i9().aw();d.i1();d.i2())this._n[d.i9().al()]=zb.j();c.i9().av(b)}},b2:function(a){for(var b=0;b<this._ad.length;b++)this._ad[b].af();if(a){this.m();for(var c=0,d=this._ab.length;c<d;c++)this._ab[c]=0;this._ac.x2(null,this._z)}var e=this._ac.xm();this._ah.i7(e,0);for(var f=this._ac.x9();f.i1();f.i2())f.i9().ak()===0&&f.i9()!==e&&this._ac.xo(e,f.i9());var g=new v(this);g.a6(!0),g.a9(this._ac,e),this._ad[0].at(),this._ac.x4(e),this.d()},a1:function(){this._ac.x2(this._o,this._l);var a=0;for(var b=1;b<this._ad.length;b++){var c=this.a2(this._ad[b-1],this._ad[b]);a+=c}var d=0;return a+=d,a},a2:function(a,b){var c=a.ah(),d=b.ah(),e=new K,f=new K;this._aa=$b.d(this._ac.x0());var g=0;for(;c.i1()&&d.i1();d.i2())g+=this.a8(c.i6(),e,f,!0),g+=this.a8(d.i6(),f,e,!1),c.i2();for(;c.i1();c.i2())g+=this.a8(c.i6(),e,f,!0);for(;d.i1();d.i2())g+=this.a8(d.i6(),f,e,!1);return g},a8:function(a,b,c,d){var e=0,f=0,g=0;if(this._aa[a.al()]!=null){var h=this._aa[a.al()].a();for(var i=b._b;i!==h;i=i.a()){var j=i._c;j===a?(e++,g+=f,b.aw(i)):f++}}var k=e*c.ay()+g;if(d)for(var l=a.ag();l!=null;l=l.a8()){var m=l.a3();this._ab[m.al()]>=this._ab[a.al()]&&(this._aa[m.al()]=c.ae(m))}else for(var n=a.ae();n!=null;n=n.a7()){var o=n.a2();this._ab[o.al()]>this._ab[a.al()]&&(this._aa[o.al()]=c.ae(o))}return k},g:function(){var a=this.r(),b=this.a1(),c=!0;for(var d=0;d<3&&this.o()&&b>0;){var e=this.k();e<b?(this.a7(a),b=e):d++,c=!c}this.b3(a),this.b1();if(b>0){var f=1;for(var g=0;f===1&&b>0;g++){this.e(),this.i();var h=this.a1();h<b?(f=1,this.a7(a)):f=-1,b=h}this.b3(a),this.b1()}return b},e:function(){var a=this.l(),b=this.r(),c=$b.d(this._ac.x0());for(var d=this._ad.length-1;d>=0;d--)for(var e=this._ad[d].ah();e.i1();e.i2()){var f=e.i6();if(f.ak()===1&&f.ao()===1){var g=a.i1(f.ag());if(g!=null&&c[g.al()]==null){var h=this.a4(f,g),i=g.al(),j=c[i]=$b.d(h+1);for(var k=j.length-1;k>=0;k--)j[k]=new K}}}for(var l=0;l<this._ad.length;l++)for(var m=this._ad[l].ah();m.i1();m.i2()){var n=m.i6();if(n.ak()===1&&n.ao()===1){var o=a.i1(n.ag());if(o!=null){var p=o.al(),q=this.a4(n,o)-1;c[p][q].ae(n.ae())}}else for(var r=n.ae();r!=null;r=r.a7()){var s=a.i1(r);if(s!=null){var t=s.al(),u=this.a4(n,s)-1;c[t][u].ae(r)}}}for(var v=this._ac.x9();v.i1();v.i2()){var w=v.i9();if(c[w.al()]!=null)for(var x=w.ag();x!=null;x=x.a8()){var y=a.i1(x);if(y!=null)for(var z=c[y.al()];z[0].ay()>0;){var A=0,B;do{B=z[A].am();var C=B.a3();if(C.ak()!==1||C.ao()!==1)break;A++}while(!0);var D=z[A].at().a3();A--,D=B.a2(),B=z[A].at();var E=B.a3();while(A>=0){b[D.al()]!==b[E.al()]&&(this._ab[D.al()]=b[E.al()]),D=D.ae().a2();if(--A>=0){var F=z[A].at();E=F.a3()}}}}}this.b1(),this._ac.xj(a)},i:function(){var a=this.f(),b=this.r(),c=$b.d(this._ac.x0());for(var d=0;d<this._ad.length;d++)for(var e=this._ad[d].ah();e.i1();e.i2()){var f=e.i6();if(f.ak()===1&&f.ao()===1){var g=a.i1(f.ae());if(g!=null&&c[g.al()]==null){var h=this.a4(g,f),i=g.al(),j=c[i]=$b.d(h+1);for(var k=j.length-1;k>=0;k--)j[k]=new K}}}for(var l=this._ad.length-1;l>=0;l--)for(var m=this._ad[l].ah();m.i1();m.i2()){var n=m.i6();if(n.ak()===1&&n.ao()===1){var o=a.i1(n.ae());if(o!=null){var p=o.al(),q=this.a4(o,n)-1;c[p][q].ae(n.ag())}}else for(var r=n.ag();r!=null;r=r.a8()){var s=a.i1(r);if(s!=null){var t=s.al(),u=this.a4(s,n)-1;c[t][u].ae(r)}}}for(var v=this._ac.x9();v.i1();v.i2()){var w=v.i9();if(c[w.al()]!=null)for(var x=w.ae();x!=null;x=x.a7()){var y=a.i1(x);if(y!=null)for(var z=c[y.al()];z[0].ay()>0;){var A=0,B;do{B=z[A].am();var C=B.a2();if(C.ak()!==1||C.ao()!==1)break;A++}while(!0);var D=z[A].at().a2();A--,D=B.a3(),B=z[A].at();var E=B.a2();while(A>=0){b[D.al()]!==b[E.al()]&&(this._ab[D.al()]=b[E.al()]),D=D.ag().a3();if(--A>=0){var F=z[A].at();E=F.a2()}}}}}this.b1(),this._ac.xj(a)},a4:function(a,b){return this._ah.i2(a)-this._ah.i2(b)},l:function(){var a=fb.a6($b.d(this._ac.xg()));for(var b=this._ac.x9();b.i1();b.i2()){var c=b.i9();if(c.ao()>1){var d=0;for(var e=c.ag();e!=null;e=e.a8()){var f=e.a3();f.ak()===1&&f.ao()===1&&d++}if(d>1)for(var g=c.ag();g!=null;g=g.a8()){var h=g,i=h.a3();if(i.ak()===1&&i.ao()===1){for(;i.ak()===1&&i.ao()===1;i=h.a3())a.i8(h,c),h=i.ag();a.i8(h,c)}}}}return a},f:function(){var a=fb.a6($b.d(this._ac.xg()));for(var b=this._ac.x9();b.i1();b.i2()){var c=b.i9();if(c.ak()>1){var d=0;for(var e=c.ae();e!=null;e=e.a7()){var f=e.a2();f.ak()===1&&f.ao()===1&&d++}if(d>1)for(var g=c.ae();g!=null;g=g.a7()){var h=g,i=h.a2();if(i.ak()===1&&i.ao()===1){for(;i.ak()===1&&i.ao()===1;i=h.a2())a.i8(h,c),h=i.ae();a.i8(h,c)}}}}return a},k:function(){for(var a=1;a<this._ad.length;a++){var b=this._ad[a];for(var c=b.ah();c.i1();c.i2()){var d=c.i6();this._n[d.al()]=this.a5(d,b.ay(),d.am(),this._ad[a-1].ay()),this._n[d.al()]+=this._ab[d.al()]/(this._ad[a-1].ay()*3)}this.a3(b,this._p)}return this.a1()},a5:function(a,b,c,d){var e=0;if(c.i7()===0)e=d*this._ab[a.al()]/b;else{for(;c.i1();c.i2()){var f=c.i8();f.a2()===a?e+=this._ab[f.a3().al()]:e+=this._ab[f.a2().al()]}e/=c.i7()}return e},a7:function(a){$b.f(this._ab,a,a.length)},b3:function(a){$b.f(a,this._ab,a.length)},r:function(){var a=$b.a(this._ab.length);return this.a7(a),a},d:function(){for(var a=0;a<this._ad.length;a++){var b=0;for(var c=this._ad[a].ah();c.i1();)this._ab[c.i6().al()]=b,c.i2(),b++}},b1:function(){for(var a=0;a<this._ad.length;a++){var b=this._ad[a];for(var c=b._b;c!=null;c=c.a()){var d=c.d();this._f[this._ab[d.al()]]=d}var e=0;for(var f=b._b;f!=null;)f.c(this._f[e]),f=f.a(),e++}},a3:function(a,b){var c=a.ah();for(var d=0;d<a.ay();c.i2())this._f[d]=c.i6(),d++;$b.s(this._f,a.ay(),b);var e=0;for(var f=a._b;f!=null;)f.c(this._f[e]),this._ab[this._f[e].al()]=e,f=f.a(),e++}}),Ub.b=function(a,b){if(a==null)return 0;var c=a.a()?Math.floor(b.x):0,d=a.a()?Math.floor(b.y):0;return a.e()?1e4-d:a.f()?-1e4+d:a.c()?-2e4-c:c},Ub.a=function(a,b){if(a==null)return 0;var c=a.a()?Math.floor(b.x):0,d=a.a()?Math.floor(b.y):0;return a.e()?1e4+d:a.f()?-1e4-d:a.d()?-2e4-c:c};var Vb=function(){Vb.superClass.constructor.call(this),this._i6=0,this._i3=2147483647,this._i0=60,this._iz=20,this._i2=20,this._i4=20,this.i5(!1),this._i7=new Nb,this._i1=new Ub,this._i8=new Qb};d.ext(Vb,ib,{j2:function(){return this._i2},i4:function(a){return!0},i3:function(a){this._i6=(new Date).getTime(),Hb.d(a,!1);var b=a.xk(),c=a.xk(),d=a.xl(),e=new L,f=new Tb(a,b,c,d);f.a6(this.j2()),this._i8.i3(this._iz),this._i8.i6(this._i0),this._i8.i4(this._i2),this._i8.i5(this._i4),this._i8.i2(c);var g=this._i7.i1(a,b,e);for(var h=e.c1();h.i1();h.i2()){var i=h.i8();d.i7(i,!0);var j=a.gn(i);a.gt(i,a.gk(i)),a.gz(i,j)}this.a2(a,b,c),g=f.a9(g);var k=this.j1(a,b,g);k=f.a5(k),k=f.b3(k),this._i8.i1(a,k,b),k=f.g2(k),f.e2(k),this.b(a,c),this.w(a),this.a1(a,e),f.e1(),a.xj(d),a.xi(c),a.xi(b)},j1:function(a,b,c){if(this._i1 instanceof Ub){var d=this._i1,e=(new Date).getTime()-this._i6;d.ib(this._i3-e)}var f=this._i1.ia(a,b,c);return f},a1:function(a,b){for(var c=b.c1();c.i1();c.i2()){var d=c.i8(),e=a.gs(d),f=a.gl(d);a.x3(d);var g=a.gp(d);a.s5(d,g.a()),a.gy(d,e),a.gx(d,f)}},b:function(a,b){for(var c=a.x9();c.i1();c.i2()){var d=c.i9(),e=b.i1(d);if(e!=null&&!a.xp(e)){for(var f=d.am().i8().a2();b.i1(f)!=null;f=d.am().i8().a2())d=f;a.u1(e);var g=d.ae(),h=new K;for(;b.i1(g.a3())!=null;g=g.a3().ag()){var i=a.gs(g);h.aa(i),h.az(a.gf(g));var j=a.gl(g);j.equals(i)||h.aa(j)}var k=a.gs(g);h.aa(k),h.az(a.gf(g));var l=a.gl(g);l.equals(k)||h.aa(l),a.m1(e,h)}}for(var m=a.x9();m.i1();m.i2())b.i1(m.i9())!=null&&a.x4(m.i9())},w:function(a){for(var b=a.xf();b.i1();b.i2()){var c=b.i8(),d=a.g2(c);if(d.i1()>0){var e=new B,f=a.gc(c),g=f.c(),h=g.i6();g.i2();var i=h.x,j=h.y;if(g.i1()){var l=g.i6(),m=l.x,n=l.y;g.i2();for(;g.i1();g.i2()){var o=g.i6(),p=o.x,q=o.y,r=(i-p)*(n-q)/(j-q)+p;Math.abs(r-m)>=1&&(e.add(l),i=m,j=n),l=o,m=p,n=q}}e.size()<d.i1()&&a.s5(c,new k(e))}}},a2:function(a,b,c){var d=a.g8().c1();d.i5();for(;d.i1();d.i3()){var e=d.i8().a2(),f=d.i8().a3(),g=b.i2(f)-b.i2(e);if(g>1){var h=null,i=null,j=e;for(;g>1;g--)h=a.xm(),a.s7(h,1,1),a.s4(h,zb._A),i=a.xo(j,h),j===e&&a.gt(i,a.gn(d.i8())),b.i7(h,b.i2(j)+1),c.z1(h,d.i8()),j=h;i=a.xo(h,f),a.gz(i,a.gk(d.i8())),a.h1(d.i8())}}}});var Wb=function(a,b,c,d){this._i=20,this._j=a,this._g=b,this._a=c,this._h=d};d.ext(Wb,Object,{a1:function(a){this._i=a},b2:function(a){return this._e==null?!1:this._e.i4(a)},a3:function(a){return this._f==null?null:this._f.i1(a)},d:function(){this._j.xi(this._f),this._j.xi(this._e)}});var Xb=function(){this._c=0,this._i=0,this._g=0,this._j=0,this._f=0,this._h=0,this._d=0,this._e=0,this._a=0,this._b=0};d.ext(Xb,Object,{a:function(){return this._c-this._g-this._f-this._a},b:function(){return this._i+this._j+this._h+this._b}});var Yb=function(){this._d=new L,this._b=new L,this._c=new L,this._e=new L};d.ext(Yb,Object,{});var Zb=function(a,b,c,d,e,f,g,h){this._d=a,this._a=b,this._b=c,this._h=d,this._f=e,this._c=f,this._e=g,this._g=h};d.ext(Zb,Object,{});var $b={};$b.a=function(a,b){var c=[];for(var d=0;d<a;d++)c[d]=b||0;return c},$b.b=function(a){var b=[];for(var c=0;c<a;c++)b[c]=!1;return b},$b.c=function(a,b){if(a instanceof e)return a.x<b.x?-1:a.x>b.x?1:a.y<b.y?-1:a.y<=b.y?0:1;if(a instanceof f)return b.width>a.width?-1:b.width<a.width?1:b.height>a.height?-1:b.height>=a.height?0:1;if(a instanceof h)return a.x<b.x?-1:a.x>b.x?1:a.y<b.y?-1:a.y>b.y?1:b.width>a.width?-1:b.width<a.width?1:b.height>a.height?-1:b.height>=a.height?0:1;throw"Unkown Type: "+a},$b.d=function(a){var b=[];for(var c=0;c<a;c++)b[c]=null;return b},$b.e=function(a,b){var c=[];for(var d=0;d<a;d++)c[d]=$b.a(b);return c},$b.f=function(a,b,c){for(var d=0;d<c;d++)b[d]=a[d]},$b.s=function(a,b,c){var d=[];$b.f(a,d,b),d.sort(c),$b.f(d,a,b)},$b.n=function(a,b){return a-b}}(a)})(window);